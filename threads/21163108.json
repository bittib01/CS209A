{
  "question": {
    "tags": [
      "java",
      "concurrency",
      "parallel-processing",
      "java-8",
      "java-stream"
    ],
    "owner": {
      "account_id": 103435,
      "reputation": 14373,
      "user_id": 277042,
      "user_type": "registered",
      "accept_rate": 57,
      "profile_image": "https://www.gravatar.com/avatar/11f0ceb173142739c65eb36a550522a2?s=256&d=identicon&r=PG",
      "display_name": "Luk&#225;š Křečan",
      "link": "https://stackoverflow.com/users/277042/luk%c3%a1%c5%a1-k%c5%99e%c4%8dan"
    },
    "is_answered": true,
    "view_count": 312569,
    "protected_date": 1541496049,
    "accepted_answer_id": 22269778,
    "answer_count": 16,
    "score": 501,
    "last_activity_date": 1668950505,
    "creation_date": 1389878797,
    "last_edit_date": 1406756098,
    "question_id": 21163108,
    "content_license": "CC BY-SA 3.0",
    "link": "https://stackoverflow.com/questions/21163108/custom-thread-pool-in-java-8-parallel-stream",
    "title": "Custom thread pool in Java 8 parallel stream",
    "body": "<p>Is it possible to specify a custom thread pool for Java 8 <a href=\"http://docs.oracle.com/javase/tutorial/collections/streams/parallelism.html\">parallel stream</a>? I can not find it anywhere. </p>\n\n<p>Imagine that I have a server application and I would like to use parallel streams. But the application is large and multi-threaded so I want to compartmentalize it. I do not want a slow running task in one module of the applicationblock tasks from another module.</p>\n\n<p>If I can not use different thread pools for different modules, it means I can not safely use parallel streams in most of real world situations.</p>\n\n<p>Try the following example. There are some CPU intensive tasks executed in separate threads.\nThe tasks leverage parallel streams. The first task is broken, so each step takes 1 second (simulated by thread sleep). The issue is that other threads get stuck and wait for the broken task to finish. This is contrived example, but imagine a servlet app and someone submitting a long running task to the shared fork join pool. </p>\n\n<pre><code>public class ParallelTest {\n    public static void main(String[] args) throws InterruptedException {\n        ExecutorService es = Executors.newCachedThreadPool();\n\n        es.execute(() -&gt; runTask(1000)); //incorrect task\n        es.execute(() -&gt; runTask(0));\n        es.execute(() -&gt; runTask(0));\n        es.execute(() -&gt; runTask(0));\n        es.execute(() -&gt; runTask(0));\n        es.execute(() -&gt; runTask(0));\n\n\n        es.shutdown();\n        es.awaitTermination(60, TimeUnit.SECONDS);\n    }\n\n    private static void runTask(int delay) {\n        range(1, 1_000_000).parallel().filter(ParallelTest::isPrime).peek(i -&gt; Utils.sleep(delay)).max()\n                .ifPresent(max -&gt; System.out.println(Thread.currentThread() + \" \" + max));\n    }\n\n    public static boolean isPrime(long n) {\n        return n &gt; 1 &amp;&amp; rangeClosed(2, (long) sqrt(n)).noneMatch(divisor -&gt; n % divisor == 0);\n    }\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [
    {
      "owner": {
        "account_id": 1639936,
        "reputation": 723,
        "user_id": 1512592,
        "user_type": "registered",
        "accept_rate": 64,
        "profile_image": "https://i.sstatic.net/4bPcx.jpg?s=256",
        "display_name": "Dirk Hillbrecht",
        "link": "https://stackoverflow.com/users/1512592/dirk-hillbrecht"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1668950259,
      "post_id": 21163108,
      "comment_id": 131525576,
      "content_license": "CC BY-SA 4.0"
    }
  ],
  "answer_comments": {}
}