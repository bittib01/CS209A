{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "hibernate",
      "maven"
    ],
    "owner": {
      "account_id": 3106235,
      "reputation": 485,
      "user_id": 2628944,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/d896e549af48055e1be48149190a7326?s=256&d=identicon&r=PG",
      "display_name": "francissoria",
      "link": "https://stackoverflow.com/users/2628944/francissoria"
    },
    "is_answered": true,
    "view_count": 45917,
    "accepted_answer_id": 77638670,
    "answer_count": 2,
    "score": 8,
    "last_activity_date": 1764833978,
    "creation_date": 1702278299,
    "last_edit_date": 1764833978,
    "question_id": 77637931,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/77637931/spring-boot-3-2-0-not-loading-application-context-in-junit-code",
    "title": "Spring Boot 3.2.0 not loading application context in JUnit code",
    "body": "<p>I have this JUnit code and it works without problems in Spring Boot 3.1.\nBut when I upgrade to Spring Boot 3.2.0, it fails, and it says it fails to load application context.\nCan someone help me why this is happening?</p>\n<p>Below is the code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@ExtendWith(SpringExtension.class)\n@DataJpaTest\n@Import(TestCreateService.class)\npublic class CreateServiceTest{\n  @Autowired private TestCreateService testCreateService;\n  @Autowired private TestRepository testRepository;\n\n   ...\n\n  @Test\n  public void bulkGetOrCreateTest() throws InterruptedException {\n       ...\n      assertThat(executorService.awaitTermination(60, TimeUnit.SECONDS)).isTrue();\n      assertThat(testRepository.count()).isEqualTo(1);\n    }\n  }\n\n}\n</code></pre>\n<p>Error:</p>\n<pre><code>[ERROR] UploadTestRepositoryTest.find_with_inner_data Â» IllegalState ApplicationContext failure threshold (1) exceeded: skipping repeated attempt to load context for [MergedContextConfiguration@589d106c testClass = co.domain.system.uploadfile.UploadTestRepositoryTest, locations = [], classes = [co.test.TestApplication], contextInitializerClasses = [], activeProfiles = [], propertySourceDescriptors = [], propertySourceProperties = [&quot;org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTestContextBootstrapper=true&quot;], contextCustomizers = [[ImportsContextCustomizer@23488e7a key = [org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\n\n</code></pre>\n<p>Is there anything changed in Springboot 3.2.0?\nIs the way of writing JUNIT test for repository changed?</p>\n<p>Here is the error when I did a simple program:</p>\n<pre><code>java.lang.IllegalStateException: Failed to load ApplicationContext for [MergedContextConfiguration@58a63629 testClass = com.example.helloworld.repository.UserRepositoryTest, locations = [], classes = [com.example.helloworld.HelloWorldApplication], contextInitializerClasses = [], activeProfiles = [], propertySourceDescriptors = [], propertySourceProperties = [&quot;org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTestContextBootstrapper=true&quot;], contextCustomizers = [[ImportsContextCustomizer@7de843ef key = [org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration, org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration, org.springframework.boot.test.autoconfigure.orm.jpa.TestEntityManagerAutoConfiguration, org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration, org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration, org.springframework.boot.autoconfigure.sql.init.SqlInitializationAutoConfiguration, org.springframework.boot.test.autoconfigure.jdbc.TestDatabaseAutoConfiguration, org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration, org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration, org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration, org.springframework.boot.autoconfigure.jdbc.JdbcClientAutoConfiguration, org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration, org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration]], org.springframework.boot.test.context.filter.ExcludeFilterContextCustomizer@302c971f, org.springframework.boot.test.json.DuplicateJsonObjectContextCustomizerFactory$DuplicateJsonObjectContextCustomizer@35841320, org.springframework.boot.test.mock.mockito.MockitoContextCustomizer@0, org.springframework.boot.test.autoconfigure.OverrideAutoConfigurationContextCustomizerFactory$DisableAutoConfigurationContextCustomizer@71075444, org.springframework.boot.test.autoconfigure.actuate.observability.ObservabilityContextCustomizerFactory$DisableObservabilityContextCustomizer@1f, org.springframework.boot.test.autoconfigure.filter.TypeExcludeFiltersContextCustomizer@34be3d80, org.springframework.boot.test.autoconfigure.properties.PropertyMappingContextCustomizer@884bb438, org.springframework.boot.test.autoconfigure.web.servlet.WebDriverContextCustomizer@4d15107f, org.springframework.boot.test.context.SpringBootTestAnnotation@cd76d185], contextLoader = org.springframework.boot.test.context.SpringBootContextLoader, parent = null]\n\n    at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:180)\n    at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:130)\n    at org.springframework.test.context.support.DependencyInjectionTestExecutionListener.injectDependencies(DependencyInjectionTestExecutionListener.java:141)\n    at org.springframework.test.context.support.DependencyInjectionTestExecutionListener.prepareTestInstance(DependencyInjectionTestExecutionListener.java:97)\n    at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:247)\n    at org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:163)\n    at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n    at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)\n    at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n    at java.base/java.util.stream.StreamSpliterators$WrappingSpliterator.forEachRemaining(StreamSpliterators.java:310)\n    at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:735)\n    at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734)\n    at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:762)\n    at java.base/java.util.Optional.orElseGet(Optional.java:364)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\nCaused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'testEntityManager' defined in class path resource [org/springframework/boot/test/autoconfigure/orm/jpa/TestEntityManagerAutoConfiguration.class]: Unsatisfied dependency expressed through method 'testEntityManager' parameter 0: No qualifying bean of type 'jakarta.persistence.EntityManagerFactory' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}\n    at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:802)\n    at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:546)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1336)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1166)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:563)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:973)\n    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:946)\n    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)\n    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)\n    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)\n    at org.springframework.boot.test.context.SpringBootContextLoader.lambda$loadContext$3(SpringBootContextLoader.java:137)\n    at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:58)\n    at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:46)\n    at org.springframework.boot.SpringApplication.withHook(SpringApplication.java:1442)\n    at org.springframework.boot.test.context.SpringBootContextLoader$ContextLoaderHook.run(SpringBootContextLoader.java:552)\n    at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:137)\n    at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:108)\n    at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:225)\n    at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:152)\n    ... 17 more\nCaused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'jakarta.persistence.EntityManagerFactory' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.raiseNoMatchingBeanFound(DefaultListableBeanFactory.java:1878)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1404)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1348)\n    at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:911)\n    at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:789)\n    ... 41 more\n</code></pre>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 3245291,
        "reputation": 281,
        "user_id": 2737061,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/eec3fcb47d199353675b9d8ecdc99419?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "Radoslav Ivanov",
        "link": "https://stackoverflow.com/users/2737061/radoslav-ivanov"
      },
      "is_accepted": false,
      "score": 1,
      "last_activity_date": 1702650365,
      "creation_date": 1702650365,
      "answer_id": 77666922,
      "question_id": 77637931,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>My problem was resolved as followed: I migrated all the configurations from src/application.yaml into test/application.yaml and then I needed to make a test Bean @Primary and voila.</p>\n"
    },
    {
      "owner": {
        "account_id": 5704109,
        "reputation": 26,
        "user_id": 4508241,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/c39edf58a3cbee2732c913fabf375e1d?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "duckhunter ",
        "link": "https://stackoverflow.com/users/4508241/duckhunter"
      },
      "is_accepted": true,
      "score": 1,
      "last_activity_date": 1702287835,
      "creation_date": 1702287835,
      "answer_id": 77638670,
      "question_id": 77637931,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>My issue was solved by adding a <code>columnDefinition</code> to an enum. I use MySQL as a database.</p>\n<pre><code>@Enumerated(value = EnumType.STRING)\n@Column(name = &quot;type&quot;, length = 16, columnDefinition = &quot;VARCHAR(16)&quot;)\nvar type: EnumType = EnumType.FIRST_VALUE\n</code></pre>\n<p>Unfortunately, the error is not very clear, but that solved my issue. The error popped up once I started the application (but not within the tests).</p>\n"
    }
  ],
  "question_comments": [
    {
      "owner": {
        "account_id": 3106235,
        "reputation": 485,
        "user_id": 2628944,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/d896e549af48055e1be48149190a7326?s=256&d=identicon&r=PG",
        "display_name": "francissoria",
        "link": "https://stackoverflow.com/users/2628944/francissoria"
      },
      "reply_to_user": {
        "account_id": 5745621,
        "reputation": 927,
        "user_id": 4536931,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/Grwu3.jpg?s=256",
        "display_name": "Vincent C.",
        "link": "https://stackoverflow.com/users/4536931/vincent-c"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1702522390,
      "post_id": 77637931,
      "comment_id": 136907770,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 3106235,
        "reputation": 485,
        "user_id": 2628944,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/d896e549af48055e1be48149190a7326?s=256&d=identicon&r=PG",
        "display_name": "francissoria",
        "link": "https://stackoverflow.com/users/2628944/francissoria"
      },
      "reply_to_user": {
        "account_id": 5745621,
        "reputation": 927,
        "user_id": 4536931,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/Grwu3.jpg?s=256",
        "display_name": "Vincent C.",
        "link": "https://stackoverflow.com/users/4536931/vincent-c"
      },
      "edited": false,
      "score": 1,
      "creation_date": 1702363076,
      "post_id": 77637931,
      "comment_id": 136883659,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 3106235,
        "reputation": 485,
        "user_id": 2628944,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/d896e549af48055e1be48149190a7326?s=256&d=identicon&r=PG",
        "display_name": "francissoria",
        "link": "https://stackoverflow.com/users/2628944/francissoria"
      },
      "reply_to_user": {
        "account_id": 5745621,
        "reputation": 927,
        "user_id": 4536931,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/Grwu3.jpg?s=256",
        "display_name": "Vincent C.",
        "link": "https://stackoverflow.com/users/4536931/vincent-c"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1702357684,
      "post_id": 77637931,
      "comment_id": 136883167,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 3106235,
        "reputation": 485,
        "user_id": 2628944,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/d896e549af48055e1be48149190a7326?s=256&d=identicon&r=PG",
        "display_name": "francissoria",
        "link": "https://stackoverflow.com/users/2628944/francissoria"
      },
      "reply_to_user": {
        "account_id": 5745621,
        "reputation": 927,
        "user_id": 4536931,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/Grwu3.jpg?s=256",
        "display_name": "Vincent C.",
        "link": "https://stackoverflow.com/users/4536931/vincent-c"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1702357503,
      "post_id": 77637931,
      "comment_id": 136883153,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 3106235,
        "reputation": 485,
        "user_id": 2628944,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/d896e549af48055e1be48149190a7326?s=256&d=identicon&r=PG",
        "display_name": "francissoria",
        "link": "https://stackoverflow.com/users/2628944/francissoria"
      },
      "reply_to_user": {
        "account_id": 5745621,
        "reputation": 927,
        "user_id": 4536931,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/Grwu3.jpg?s=256",
        "display_name": "Vincent C.",
        "link": "https://stackoverflow.com/users/4536931/vincent-c"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1702357159,
      "post_id": 77637931,
      "comment_id": 136883127,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 5745621,
        "reputation": 927,
        "user_id": 4536931,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/Grwu3.jpg?s=256",
        "display_name": "Vincent C.",
        "link": "https://stackoverflow.com/users/4536931/vincent-c"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1702282196,
      "post_id": 77637931,
      "comment_id": 136872633,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 3106235,
        "reputation": 485,
        "user_id": 2628944,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/d896e549af48055e1be48149190a7326?s=256&d=identicon&r=PG",
        "display_name": "francissoria",
        "link": "https://stackoverflow.com/users/2628944/francissoria"
      },
      "reply_to_user": {
        "account_id": 5745621,
        "reputation": 927,
        "user_id": 4536931,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/Grwu3.jpg?s=256",
        "display_name": "Vincent C.",
        "link": "https://stackoverflow.com/users/4536931/vincent-c"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1702281306,
      "post_id": 77637931,
      "comment_id": 136872491,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 5745621,
        "reputation": 927,
        "user_id": 4536931,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/Grwu3.jpg?s=256",
        "display_name": "Vincent C.",
        "link": "https://stackoverflow.com/users/4536931/vincent-c"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1702278579,
      "post_id": 77637931,
      "comment_id": 136872195,
      "content_license": "CC BY-SA 4.0"
    }
  ],
  "answer_comments": {
    "77666922": [
      {
        "owner": {
          "account_id": 1297417,
          "reputation": 43191,
          "user_id": 1248114,
          "user_type": "registered",
          "accept_rate": 66,
          "profile_image": "https://i.sstatic.net/4XXrp.jpg?s=256",
          "display_name": "arkascha",
          "link": "https://stackoverflow.com/users/1248114/arkascha"
        },
        "edited": false,
        "score": 1,
        "creation_date": 1718714581,
        "post_id": 77666922,
        "comment_id": 138641359,
        "content_license": "CC BY-SA 4.0"
      }
    ],
    "77638670": [
      {
        "owner": {
          "account_id": 3106235,
          "reputation": 485,
          "user_id": 2628944,
          "user_type": "registered",
          "profile_image": "https://www.gravatar.com/avatar/d896e549af48055e1be48149190a7326?s=256&d=identicon&r=PG",
          "display_name": "francissoria",
          "link": "https://stackoverflow.com/users/2628944/francissoria"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1702522435,
        "post_id": 77638670,
        "comment_id": 136907775,
        "content_license": "CC BY-SA 4.0"
      },
      {
        "owner": {
          "account_id": 3106235,
          "reputation": 485,
          "user_id": 2628944,
          "user_type": "registered",
          "profile_image": "https://www.gravatar.com/avatar/d896e549af48055e1be48149190a7326?s=256&d=identicon&r=PG",
          "display_name": "francissoria",
          "link": "https://stackoverflow.com/users/2628944/francissoria"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1702448416,
        "post_id": 77638670,
        "comment_id": 136896509,
        "content_license": "CC BY-SA 4.0"
      }
    ]
  }
}