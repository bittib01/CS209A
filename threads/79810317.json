{
  "question": {
    "tags": [
      "java",
      "wildfly",
      "ejb",
      "elytron"
    ],
    "owner": {
      "account_id": 22029754,
      "reputation": 53,
      "user_id": 16297217,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/19aab098a5c33421a2ce2b41d81d6dd7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "bence.kovacs",
      "link": "https://stackoverflow.com/users/16297217/bence-kovacs"
    },
    "is_answered": true,
    "view_count": 69,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1762510374,
    "creation_date": 1762358899,
    "question_id": 79810317,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79810317/wildfly-37-ejb-security-domain-default-not-applied-on-4-out-of-5-modules-unles",
    "title": "WildFly 37 – EJB security domain default not applied on 4 out of 5 modules unless @SecurityDomain is explicitly set",
    "body": "<p>I'm upgrading from Wildfly 27 to Wildfly 37 and I've ran into an interesting issue. I’m deploying an EAR with multiple EJB submodules on WildFly 37.\nIn my ejb3 subsystem I’ve set:</p>\n<pre><code>&lt;default-security-domain value=&quot;mySecurityDomain&quot;/&gt;\n        &lt;application-security-domains&gt;\n            &lt;application-security-domain name=&quot;mySecurityDomain&quot; security-domain=&quot;ApplicationDomain&quot;/&gt;\n        &lt;/application-security-domains&gt;\n</code></pre>\n<p>Authentication works and one module authorizes calls correctly.\nHowever, in four of my five subdeployments, all EJB calls run as anonymous unless I explicitly add</p>\n<pre><code>@SecurityDomain(&quot;mySecurityDomain&quot;)\n</code></pre>\n<p>on the bean</p>\n<p>CLI shows all beans have</p>\n<pre><code>&quot;security-domain&quot; =&gt; &quot;mySecurityDomain&quot;\n</code></pre>\n<p>even if they dont have the annotation and are not working.</p>\n<p>The non-working module has no jboss-ejb3.xml, and all EE APIs are compileOnly.\nStill, the SecurityDomainInterceptor only attaches when the annotation is present.</p>\n<p>Why isn’t the default security domain applied automatically in this subdeployment on WildFly 37, and how can I fix it without adding @SecurityDomain to every bean?</p>\n<p>What I’ve tried:</p>\n<ul>\n<li>Verified no legacy jboss.xml/ejb-jar.xml.</li>\n<li>Confirmed jakarta.jakartaee-api not packaged.</li>\n<li>Same ApplicationDomain works in another subdeployment.</li>\n</ul>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 22029754,
        "reputation": 53,
        "user_id": 16297217,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/19aab098a5c33421a2ce2b41d81d6dd7?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "bence.kovacs",
        "link": "https://stackoverflow.com/users/16297217/bence-kovacs"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1762510374,
      "creation_date": 1762510374,
      "answer_id": 79812192,
      "question_id": 79810317,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>Finally managed to make it work. <a href=\"https://stackoverflow.com/questions/79810317/wildfly-37-ejb-security-domain-default-not-applied-on-4-out-of-5-modules-unles/79811072#79811072\">lance-javas answer</a> was mostly correct, my working module was working because i had one bean annotated with @SecurityDomain and it made the whole subdeployment work.</p>\n<p>The valid jboss-ejb3.xml syntax that was working for me (Wildfly 37):</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;jboss:ejb-jar xmlns:jboss=&quot;http://www.jboss.com/xml/ns/javaee&quot;\n               xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; version=&quot;3.2&quot;&gt;\n  &lt;assembly-descriptor&gt;\n    &lt;s:security xmlns:s=&quot;urn:security:1.1&quot;&gt;\n      &lt;ejb-name&gt;*&lt;/ejb-name&gt;\n      &lt;s:security-domain&gt;mySecurityDomain&lt;/s:security-domain&gt;\n    &lt;/s:security&gt;\n  &lt;/assembly-descriptor&gt;\n&lt;/jboss:ejb-jar&gt;\n</code></pre>\n<p>Also, putting the xml in the EARs root wasn't working, WF didn't parse it (didn't throw error on the wrong syntax), and the correct syntax wans't working either. I had to put the xml in every subdeployment.</p>\n"
    }
  ],
  "question_comments": [],
  "answer_comments": {
    "79812192": []
  }
}