{
  "question": {
    "tags": [
      "java",
      "memory"
    ],
    "owner": {
      "account_id": 3517,
      "reputation": 32221,
      "user_id": 5074,
      "user_type": "registered",
      "accept_rate": 78,
      "profile_image": "https://www.gravatar.com/avatar/5ed19e00dca9ce442f9d057337a5634f?s=256&d=identicon&r=PG",
      "display_name": "Jay R.",
      "link": "https://stackoverflow.com/users/5074/jay-r"
    },
    "is_answered": true,
    "view_count": 385575,
    "protected_date": 1581520308,
    "accepted_answer_id": 52682,
    "answer_count": 29,
    "score": 690,
    "last_activity_date": 1746693550,
    "creation_date": 1220980023,
    "last_edit_date": 1676563819,
    "question_id": 52353,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/52353/how-to-determine-the-size-of-an-object-in-java",
    "title": "How to determine the size of an object in Java",
    "body": "<p>I have an application that reads a CSV file with piles of data rows. I give the user a summary of the number of rows based on types of data, but I want to make sure that I don't read in too many rows of data and cause <code>OutOfMemoryError</code>s. Each row translates into an object. Is there a way to find out the size of that object programmatically? Is there a reference that defines how large primitive types and object references are for a <code>VM</code>?</p>\n<p>Right now, I have code that says read up to <strong>32,000 rows</strong>, but I'd also like to have code that says read as many rows as possible until I've used <strong>32MB</strong> of memory.</p>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 4440133,
        "reputation": 13694,
        "user_id": 3614835,
        "user_type": "registered",
        "accept_rate": 67,
        "profile_image": "https://i.sstatic.net/xzZDV.png?s=256",
        "display_name": "Jeffrey Bosboom",
        "link": "https://stackoverflow.com/users/3614835/jeffrey-bosboom"
      },
      "is_accepted": false,
      "score": 175,
      "last_activity_date": 1746693550,
      "last_edit_date": 1746693550,
      "creation_date": 1430700412,
      "answer_id": 30021105,
      "question_id": 52353,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>You should use <a href=\"http://openjdk.java.net/projects/code-tools/jol/\" rel=\"nofollow noreferrer\">jol</a>, a tool developed as part of the OpenJDK project.</p>\n<blockquote>\n<p>JOL (Java Object Layout) is the tiny toolbox to analyze object layout schemes in JVMs. These tools are using Unsafe, JVMTI, and Serviceability Agent (SA) heavily to decoder the actual object layout, footprint, and references. This makes JOL much more accurate than other tools relying on heap dumps, specification assumptions, etc.</p>\n</blockquote>\n<p>To get the sizes of primitives, references and array elements, use <code>VMSupport.vmDetails()</code>.  On Oracle JDK 1.8.0_40 running on 64-bit Windows (used for all following examples), this method returns</p>\n<pre><code>Running 64-bit HotSpot VM.\nUsing compressed oop with 0-bit shift.\nUsing compressed klass with 3-bit shift.\nObjects are 8 bytes aligned.\nField sizes by type: 4, 1, 1, 2, 2, 4, 4, 8, 8 [bytes]\nArray element sizes: 4, 1, 1, 2, 2, 4, 4, 8, 8 [bytes]\n</code></pre>\n<p>You can get the shallow size of an object instance using <code>ClassLayout.parseClass(Foo.class).toPrintable()</code> (optionally passing an instance to <code>toPrintable</code>).  This is only the space consumed by a single instance of that class; it does not include any other objects referenced by that class.  It <em>does</em> include VM overhead for the object header, field alignment and padding.  For <code>java.util.regex.Pattern</code>:</p>\n<pre><code>java.util.regex.Pattern object internals:\n OFFSET  SIZE        TYPE DESCRIPTION                    VALUE\n      0     4             (object header)                01 00 00 00 (0000 0001 0000 0000 0000 0000 0000 0000)\n      4     4             (object header)                00 00 00 00 (0000 0000 0000 0000 0000 0000 0000 0000)\n      8     4             (object header)                cb cf 00 20 (1100 1011 1100 1111 0000 0000 0010 0000)\n     12     4         int Pattern.flags                  0\n     16     4         int Pattern.capturingGroupCount    1\n     20     4         int Pattern.localCount             0\n     24     4         int Pattern.cursor                 48\n     28     4         int Pattern.patternLength          0\n     32     1     boolean Pattern.compiled               true\n     33     1     boolean Pattern.hasSupplementary       false\n     34     2             (alignment/padding gap)        N/A\n     36     4      String Pattern.pattern                (object)\n     40     4      String Pattern.normalizedPattern      (object)\n     44     4        Node Pattern.root                   (object)\n     48     4        Node Pattern.matchRoot              (object)\n     52     4       int[] Pattern.buffer                 null\n     56     4         Map Pattern.namedGroups            null\n     60     4 GroupHead[] Pattern.groupNodes             null\n     64     4       int[] Pattern.temp                   null\n     68     4             (loss due to the next object alignment)\nInstance size: 72 bytes (reported by Instrumentation API)\nSpace losses: 2 bytes internal + 4 bytes external = 6 bytes total\n</code></pre>\n<p>You can get a summary view of the deep size of an object instance using <code>GraphLayout.parseInstance(obj).toFootprint()</code>.  Of course, some objects in the footprint might be shared (also referenced from other objects), so it is an overapproximation of the space that could be reclaimed when that object is garbage collected.  For the result of <code>Pattern.compile(&quot;^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\\\.[a-zA-Z0-9-.]+$&quot;)</code> (taken from <a href=\"https://stackoverflow.com/a/719543/3614835\">this answer</a>), jol reports a total footprint of 1840 bytes, of which only 72 are the Pattern instance itself.</p>\n<pre><code>java.util.regex.Pattern instance footprint:\n     COUNT       AVG       SUM   DESCRIPTION\n         1       112       112   [C\n         3       272       816   [Z\n         1        24        24   java.lang.String\n         1        72        72   java.util.regex.Pattern\n         9        24       216   java.util.regex.Pattern$1\n        13        24       312   java.util.regex.Pattern$5\n         1        16        16   java.util.regex.Pattern$Begin\n         3        24        72   java.util.regex.Pattern$BitClass\n         3        32        96   java.util.regex.Pattern$Curly\n         1        24        24   java.util.regex.Pattern$Dollar\n         1        16        16   java.util.regex.Pattern$LastNode\n         1        16        16   java.util.regex.Pattern$Node\n         2        24        48   java.util.regex.Pattern$Single\n        40                1840   (total)\n</code></pre>\n<p>If you instead use <code>GraphLayout.parseInstance(obj).toPrintable()</code>, jol will tell you the address, size, type, value and path of field dereferences to each referenced object, though that's usually too much detail to be useful.  For the ongoing pattern example, you might get the following.  (Addresses will likely change between runs.)</p>\n<pre><code>java.util.regex.Pattern object externals:\n          ADDRESS       SIZE TYPE                             PATH                           VALUE\n         d5e5f290         16 java.util.regex.Pattern$Node     .root.next.atom.next           (object)\n         d5e5f2a0        120 (something else)                 (somewhere else)               (something else)\n         d5e5f318         16 java.util.regex.Pattern$LastNode .root.next.next.next.next.next.next.next (object)\n         d5e5f328      21664 (something else)                 (somewhere else)               (something else)\n         d5e647c8         24 java.lang.String                 .pattern                       (object)\n         d5e647e0        112 [C                               .pattern.value                 [^, [, a, -, z, A, -, Z, 0, -, 9, _, ., +, -, ], +, @, [, a, -, z, A, -, Z, 0, -, 9, -, ], +, \\, ., [, a, -, z, A, -, Z, 0, -, 9, -, ., ], +, $]\n         d5e64850        448 (something else)                 (somewhere else)               (something else)\n         d5e64a10         72 java.util.regex.Pattern                                         (object)\n         d5e64a58        416 (something else)                 (somewhere else)               (something else)\n         d5e64bf8         16 java.util.regex.Pattern$Begin    .root                          (object)\n         d5e64c08         24 java.util.regex.Pattern$BitClass .root.next.atom.val$rhs        (object)\n         d5e64c20        272 [Z                               .root.next.atom.val$rhs.bits   [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, true, false, true, true, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, true, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false]\n         d5e64d30         24 java.util.regex.Pattern$1        .root.next.atom.val$lhs.val$lhs.val$lhs.val$lhs.val$lhs.val$lhs (object)\n         d5e64d48         24 java.util.regex.Pattern$1        .root.next.atom.val$lhs.val$lhs.val$lhs.val$lhs.val$lhs.val$rhs (object)\n         d5e64d60         24 java.util.regex.Pattern$5        .root.next.atom.val$lhs.val$lhs.val$lhs.val$lhs.val$lhs (object)\n         d5e64d78         24 java.util.regex.Pattern$1        .root.next.atom.val$lhs.val$lhs.val$lhs.val$lhs.val$rhs (object)\n         d5e64d90         24 java.util.regex.Pattern$5        .root.next.atom.val$lhs.val$lhs.val$lhs.val$lhs (object)\n         d5e64da8         24 java.util.regex.Pattern$5        .root.next.atom.val$lhs.val$lhs.val$lhs (object)\n         d5e64dc0         24 java.util.regex.Pattern$5        .root.next.atom.val$lhs.val$lhs (object)\n         d5e64dd8         24 java.util.regex.Pattern$5        .root.next.atom.val$lhs        (object)\n         d5e64df0         24 java.util.regex.Pattern$5        .root.next.atom                (object)\n         d5e64e08         32 java.util.regex.Pattern$Curly    .root.next                     (object)\n         d5e64e28         24 java.util.regex.Pattern$Single   .root.next.next                (object)\n         d5e64e40         24 java.util.regex.Pattern$BitClass .root.next.next.next.atom.val$rhs (object)\n         d5e64e58        272 [Z                               .root.next.next.next.atom.val$rhs.bits [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, true, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false]\n         d5e64f68         24 java.util.regex.Pattern$1        .root.next.next.next.atom.val$lhs.val$lhs.val$lhs (object)\n         d5e64f80         24 java.util.regex.Pattern$1        .root.next.next.next.atom.val$lhs.val$lhs.val$rhs (object)\n         d5e64f98         24 java.util.regex.Pattern$5        .root.next.next.next.atom.val$lhs.val$lhs (object)\n         d5e64fb0         24 java.util.regex.Pattern$1        .root.next.next.next.atom.val$lhs.val$rhs (object)\n         d5e64fc8         24 java.util.regex.Pattern$5        .root.next.next.next.atom.val$lhs (object)\n         d5e64fe0         24 java.util.regex.Pattern$5        .root.next.next.next.atom      (object)\n         d5e64ff8         32 java.util.regex.Pattern$Curly    .root.next.next.next           (object)\n         d5e65018         24 java.util.regex.Pattern$Single   .root.next.next.next.next      (object)\n         d5e65030         24 java.util.regex.Pattern$BitClass .root.next.next.next.next.next.atom.val$rhs (object)\n         d5e65048        272 [Z                               .root.next.next.next.next.next.atom.val$rhs.bits [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, true, true, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false]\n         d5e65158         24 java.util.regex.Pattern$1        .root.next.next.next.next.next.atom.val$lhs.val$lhs.val$lhs.val$lhs (object)\n         d5e65170         24 java.util.regex.Pattern$1        .root.next.next.next.next.next.atom.val$lhs.val$lhs.val$lhs.val$rhs (object)\n         d5e65188         24 java.util.regex.Pattern$5        .root.next.next.next.next.next.atom.val$lhs.val$lhs.val$lhs (object)\n         d5e651a0         24 java.util.regex.Pattern$1        .root.next.next.next.next.next.atom.val$lhs.val$lhs.val$rhs (object)\n         d5e651b8         24 java.util.regex.Pattern$5        .root.next.next.next.next.next.atom.val$lhs.val$lhs (object)\n         d5e651d0         24 java.util.regex.Pattern$5        .root.next.next.next.next.next.atom.val$lhs (object)\n         d5e651e8         24 java.util.regex.Pattern$5        .root.next.next.next.next.next.atom (object)\n         d5e65200         32 java.util.regex.Pattern$Curly    .root.next.next.next.next.next (object)\n         d5e65220        120 (something else)                 (somewhere else)               (something else)\n         d5e65298         24 java.util.regex.Pattern$Dollar   .root.next.next.next.next.next.next (object)\n</code></pre>\n<p>The &quot;(something else)&quot; entries <a href=\"https://stackoverflow.com/questions/30021092/what-is-something-else-in-jol-graphlayout-output\">describe other objects in the heap that are not part of this object graph</a>.</p>\n<p>The best jol documentation is the <a href=\"https://github.com/openjdk/jol/tree/master/jol-samples/src/main/java/org/openjdk/jol/samples\" rel=\"nofollow noreferrer\">jol samples</a> in the jol repository.  The samples demonstrate common jol operations and show how you can use jol to analyze VM and garbage collector internals.</p>\n"
    }
  ],
  "question_comments": [
    {
      "owner": {
        "account_id": 880980,
        "reputation": 1270,
        "user_id": 244365,
        "user_type": "registered",
        "accept_rate": 25,
        "profile_image": "https://www.gravatar.com/avatar/4143c51b65350247de84a33eb8a9b46c?s=256&d=identicon&r=PG",
        "display_name": "PaulMurrayCbr",
        "link": "https://stackoverflow.com/users/244365/paulmurraycbr"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1715875046,
      "post_id": 52353,
      "comment_id": 138376996,
      "content_license": "CC BY-SA 4.0"
    }
  ],
  "answer_comments": {
    "30021105": [
      {
        "owner": {
          "account_id": 1282660,
          "reputation": 9275,
          "user_id": 1236401,
          "user_type": "registered",
          "accept_rate": 75,
          "profile_image": "https://i.sstatic.net/7SNgk.png?s=256",
          "display_name": "Mugen",
          "link": "https://stackoverflow.com/users/1236401/mugen"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1585816658,
        "post_id": 30021105,
        "comment_id": 107897415,
        "content_license": "CC BY-SA 4.0"
      }
    ]
  }
}