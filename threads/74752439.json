{
  "question": {
    "tags": [
      "java",
      "docker",
      "docker-multi-stage-build"
    ],
    "owner": {
      "account_id": 27210142,
      "reputation": 1,
      "user_id": 20741084,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/AEdFTp5I5Wfmk1fYdNgxRM6ag347-oqmHu58xNoWie4N=k-s256",
      "display_name": "Dima Sovkov",
      "link": "https://stackoverflow.com/users/20741084/dima-sovkov"
    },
    "is_answered": false,
    "view_count": 80,
    "closed_date": 1764866118,
    "answer_count": 2,
    "score": -3,
    "last_activity_date": 1764848983,
    "creation_date": 1670671150,
    "last_edit_date": 1670671281,
    "question_id": 74752439,
    "link": "https://stackoverflow.com/questions/74752439/docker-multi-stage-java-simple-class",
    "closed_reason": "Not suitable for this site",
    "title": "Docker multi-stage, Java simple class",
    "body": "<p>I have aproblem when creating multi assembly in Docker. I get this error error invalid or corrupt jarfile</p>\n<pre><code>FROM openjdk:18-jdk-alpine AS build\nARG JAR_FILE\nCOPY ${JAR_FILE} /app/app.jar\nCOPY . /app/source\nWORKDIR /app/source\nEXPOSE 8001\n\nFROM openjdk:18-jdk-alpine AS runtime\nCOPY --from=build /app/source/ /app/app.jar\nENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;/app/app.jar&quot;]\n</code></pre>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 26698569,
        "reputation": 4070,
        "user_id": 20306007,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/98bbc403493aee3681b71dae7abef66e?s=256&d=identicon&r=PG",
        "display_name": "life888888",
        "link": "https://stackoverflow.com/users/20306007/life888888"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1764848983,
      "last_edit_date": 1764848983,
      "creation_date": 1670742142,
      "answer_id": 74758954,
      "question_id": 74752439,
      "content_license": "CC BY-SA 4.0",
      "body": "<ol>\n<li><p>Before java run execute jar, you need create a execute jar.</p>\n</li>\n<li><p>In src, create a file name <code>manifest.mf</code></p>\n<p>Manifest-version: 1.0</p>\n<p>Main-Class: Main</p>\n</li>\n<li><p>Dockerfile</p>\n<p>FROM eclipse-temurin:17.0.5_8-jdk-ubi9-minimal AS build</p>\n<p>WORKDIR /tmp/app</p>\n<p>COPY src /tmp/app/src</p>\n<p>RUN mkdir -p /tmp/out</p>\n<p>RUN javac -d /tmp/out src/*.java</p>\n<p>RUN cp /tmp/app/src/manifest.mf /tmp/out/manifest.mf</p>\n<p>RUN ls /tmp/out/*</p>\n<p>RUN cd /tmp/out/ &amp;&amp; jar cfm /tmp/app/app.jar manifest.mf Main.class Player.class VARIANTS.class</p>\n<p>FROM eclipse-temurin:17.0.5_8-jre-ubi9-minimal</p>\n<p>WORKDIR /APP</p>\n<p>COPY --from=build /tmp/app/app.jar /APP/app.jar</p>\n<p>ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]</p>\n</li>\n<li><p>build command</p>\n<p>docker build -t taskone:1.0.0 .\ndocker tag taskone:1.0.0 taskone:latest</p>\n</li>\n<li><p>run command</p>\n<p>docker run -it taskone</p>\n</li>\n<li><p>check image command</p>\n<p>docker images | grep taskone</p>\n</li>\n<li><p>Package class to jar</p>\n<p>jar cfm /tmp/app/app.jar manifest.mf Main.class Player.class VARIANTS.class</p>\n</li>\n<li><p>If you package your class to jar in host, you don't need multi stage build. Just copy host jar file.</p>\n</li>\n</ol>\n<p>Dockerfile</p>\n<pre><code>FROM eclipse-temurin:17.0.5_8-jre-ubi9-minimal\nWORKDIR /APP\nCOPY app.jar /APP/app.jar\nENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]\n</code></pre>\n<p>I already test OK in my machine.</p>\n"
    },
    {
      "owner": {
        "account_id": 26137201,
        "reputation": 333,
        "user_id": 19827057,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/eAPUxDRv.jpg?s=256",
        "display_name": "mariya cherian",
        "link": "https://stackoverflow.com/users/19827057/mariya-cherian"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1764847764,
      "creation_date": 1764847764,
      "answer_id": 79837863,
      "question_id": 74752439,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>Your copy path is wrong.you are <strong>copying a directory into a file path.</strong></p>\n<p>COPY --from=build /app/source/ /app/app.jar</p>\n<p>So the final image does not contain the real JAR file. This may leads to the Error: Invalid or corrupt jarfile /app/app.jar</p>\n<p>Therefore it should be</p>\n<pre><code>COPY --from=build /app/app.jar /app/app.jar\n</code></pre>\n<p>Also After copying the jar  you <strong>overwrite it in the next line</strong> with COPY . /app/source</p>\n<p>Also in your code you are not building the jar but you copying.IF you already built the jar locally then it's OK. otherwise you need to <strong>include the build</strong> also.</p>\n"
    }
  ],
  "question_comments": [
    {
      "owner": {
        "account_id": 27210142,
        "reputation": 1,
        "user_id": 20741084,
        "user_type": "registered",
        "profile_image": "https://lh3.googleusercontent.com/a/AEdFTp5I5Wfmk1fYdNgxRM6ag347-oqmHu58xNoWie4N=k-s256",
        "display_name": "Dima Sovkov",
        "link": "https://stackoverflow.com/users/20741084/dima-sovkov"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1670672052,
      "post_id": 74752439,
      "comment_id": 131930090,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 27210142,
        "reputation": 1,
        "user_id": 20741084,
        "user_type": "registered",
        "profile_image": "https://lh3.googleusercontent.com/a/AEdFTp5I5Wfmk1fYdNgxRM6ag347-oqmHu58xNoWie4N=k-s256",
        "display_name": "Dima Sovkov",
        "link": "https://stackoverflow.com/users/20741084/dima-sovkov"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1670671217,
      "post_id": 74752439,
      "comment_id": 131929968,
      "content_license": "CC BY-SA 4.0"
    }
  ],
  "answer_comments": {
    "74758954": [],
    "79837863": []
  }
}