{
  "question": {
    "tags": [
      "java",
      "selenium-webdriver",
      "gitlab",
      "gitlab-ci"
    ],
    "owner": {
      "account_id": 475973,
      "reputation": 1999,
      "user_id": 886619,
      "user_type": "registered",
      "accept_rate": 75,
      "profile_image": "https://i.sstatic.net/8Rmwx.png?s=256",
      "display_name": "Mohammad Najar",
      "link": "https://stackoverflow.com/users/886619/mohammad-najar"
    },
    "is_answered": false,
    "view_count": 8628,
    "answer_count": 1,
    "score": 5,
    "last_activity_date": 1764882095,
    "creation_date": 1524893084,
    "last_edit_date": 1524928542,
    "question_id": 50073168,
    "content_license": "CC BY-SA 3.0",
    "link": "https://stackoverflow.com/questions/50073168/how-to-run-headless-chrome-in-gitlab",
    "title": "How to run headless Chrome in Gitlab",
    "body": "<p>I have a Java integration test suite that I need to run as part of a Gitlab CI process. The integration test uses Selenium webdriver against the Chrome browser. I'm new to Gitlab CI, and can't seem to find a solution to running my tests on a headless Chrome browser inside of the Gitlab environment. </p>\n\n<p>I know I need to tweak or add something inside the <code>.gitlab-ci.yml</code> but don't know what to add. </p>\n\n<p>Any help would be greatly appreciated. </p>\n\n<hr>\n\n<p><strong>Update:</strong></p>\n\n<p><strong>Scenario 1</strong>: When I add the following script to <code>.gitlab-ci.yml</code> </p>\n\n<pre><code>services:\n- selenium/standalone-chrome:latest\nvariables:\n    selenium_remote_url: \"http://selenium__standalone-chrome:4444/wd/hub/\"\n</code></pre>\n\n<p>My gitlab CI process errors out with the following exception:</p>\n\n<p><a href=\"https://i.sstatic.net/uJoJC.png\" rel=\"noreferrer\"><img src=\"https://i.sstatic.net/uJoJC.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Scenario 2</strong>: When I add the following script to <code>.gitlab-ci.yml</code> </p>\n\n<pre><code>before_script:\n  - apt-get update -qq &amp; apt-get install wget\n  - wget https://gist.githubusercontent.com/alonisser/11192482/raw/e1d8d4ed579d64902e951e4f9fa487b793035f9b/setup-headless-selenium-xvfb.sh\n  - sh setup-headless-selenium-xvfb.sh\n  - /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_1.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :1 -ac -screen 0 1280x1024x16\n  - export DISPLAY=:1\n  - sleep 3\n</code></pre>\n\n<p>My gitlab CI process errors out with the following exception:\n<a href=\"https://i.sstatic.net/EYiPR.png\" rel=\"noreferrer\"><img src=\"https://i.sstatic.net/EYiPR.png\" alt=\"enter image description here\"></a></p>\n\n<p>My integration test contains the following in the <code>@BeforeClass</code> method (i.e. the starting point of the test execution)</p>\n\n<pre><code>@BeforeClass\npublic static void beforeScenario() {\n\n\n    ChromeOptions opts = new ChromeOptions();\n\n    try {\n        File chromeDriver = new File(\"src/test/resources/drivers\");\n        String driverPath = chromeDriver.getPath() + \"/chromedriver\";       \n\n        chromeDriver = new File(driverPath);\n\n        if (chromeDriver != null &amp;&amp; !chromeDriver.canExecute()) {\n            System.out.println(\"Setting driver as executable\");\n            chromeDriver.setExecutable(true);\n        }\n        if (chromeDriver != null &amp;&amp; !chromeDriver.canRead()) {\n            System.out.println(\"Setting driver as readable\");\n            chromeDriver.setReadable(true);\n        }\n\n\n        opts.addArguments(\"--headless\");\n        opts.addArguments(\"--disable-gpu\");\n        opts.addArguments(\"--no-sandbox\");\n        opts.addArguments(\"window-size=1200x600\");  \n\n\n        ChromeDriverService service = new ChromeDriverService.Builder()\n                .usingAnyFreePort()\n                .withEnvironment(ImmutableMap.of(\"DISPLAY\", \":1\"))\n                .usingDriverExecutable(new File(System.getenv(\"webdriver.chrome.driver\")))\n                .build();\n\n        service.start();\n        driver = new ChromeDriver(service, opts);\n    } catch (Exception ex) {\n        ex.printStackTrace();\n        System.exit(1);\n    }\n\n}\n</code></pre>\n\n<p>In <strong>Scenario 1</strong> I use the following java line to get the env param</p>\n\n<pre><code>.usingDriverExecutable(new File(System.getenv(\"selenium_remote_url\")))\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}