{
  "question": {
    "tags": [
      "java",
      "mongodb",
      "spring-boot"
    ],
    "owner": {
      "account_id": 21849828,
      "reputation": 497,
      "user_id": 16142058,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/yXll4.jpg?s=256",
      "display_name": "summerisbetterthanwinter",
      "link": "https://stackoverflow.com/users/16142058/summerisbetterthanwinter"
    },
    "is_answered": true,
    "view_count": 914,
    "accepted_answer_id": 77213123,
    "answer_count": 3,
    "score": 1,
    "last_activity_date": 1764764965,
    "creation_date": 1696158270,
    "last_edit_date": 1696195468,
    "question_id": 77210202,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/77210202/always-connect-test-database-on-mongodb-with-spring-boot",
    "title": "Always connect test database on mongodb with Spring Boot",
    "body": "<p>I have studied on mongodb with spring boot</p>\n<p>I install mongo with docker-compose, I use Mongo Compass to interactive with mongo database, and I create product database</p>\n<pre class=\"lang-bash prettyprint-override\"><code>version: &quot;3.8&quot;\nservices:\n    mongodb:\n        image : mongo\n        container_name: mongodb\n        environment:\n        - PUID=1000\n        - PGID=1000\n        volumes:\n        - ./database/product-service/mongodb:/data/db\n        ports:\n        - 27017:27017\n        restart: unless-stopped\n</code></pre>\n<p>Spring Boot code</p>\n<p>Controller</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RestController\n@RequestMapping(&quot;/api/v1/product&quot;)\n@RequiredArgsConstructor\npublic class ProductController {\n    private final ProductService productService;\n\n    @PostMapping\n    @ResponseStatus(HttpStatus.CREATED)\n    public void createProduct(@RequestBody ProductRequest productRequest) {\n        productService.createProduct(productRequest);\n    }\n\n    @GetMapping\n    @ResponseStatus(HttpStatus.OK)\n    public List&lt;ProductResponse&gt; getAllProducts() {\n        return productService.getAllProducts();\n    }\n}\n\n</code></pre>\n<p>Service</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class ProductService {\n    private final ProductRepository productRepository;\n\n    public void createProduct(ProductRequest productRequest) {\n        Product product = Product.builder()\n                .name(productRequest.getName())\n                .description(productRequest.getDescription())\n                .price(productRequest.getPrice())\n                .build();\n        productRepository.save(product);\n        log.info(&quot;Product {} is saved&quot;, product.getId());\n    }\n\n    public List&lt;ProductResponse&gt; getAllProducts() {\n        List&lt;Product&gt;products = productRepository.findAll();\n        log.info(&quot;Get all products&quot;);\n        return products.stream().map(product -&gt; map2ProductResponse(product)).toList();\n    }\n\n    private ProductResponse map2ProductResponse(Product product) {\n        return ProductResponse.builder()\n                .id(product.getId())\n                .name(product.getName())\n                .description(product.getDescription())\n                .price(product.getPrice())\n                .build();\n    }\n}\n</code></pre>\n<p>entity</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Document(value = &quot;product&quot;)\n@AllArgsConstructor\n@NoArgsConstructor\n@Builder\n@Data\npublic class Product {\n    private String id;\n    private String name;\n    private String description;\n    private BigDecimal price;\n}\n\n</code></pre>\n<p>With spring boot app, I configed on appllication.properties file like that</p>\n<pre><code>spring.data.mongodb.uri=mongodb://127.0.0.1:27017/product\n</code></pre>\n<p>Because I have found some <a href=\"https://stackoverflow.com/questions/25750815/how-to-specify-database-name-in-spring-data-mongodb\">posts</a></p>\n<p>I have tried replace with this, nothing change</p>\n<pre><code>spring.data.mongodb.port=27017\nspring.data.mongodb.database=product\nspring.data.mongodb.host=localhost\n</code></pre>\n<p>when I check the Mongo Compass, it always connect to <strong>test</strong> database, although I specify <strong>product</strong> database like application.properties</p>\n<p><a href=\"https://i.sstatic.net/v8V5A.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n<p>I have also found the similar <a href=\"https://stackoverflow.com/questions/72537715/spring-boot-and-mongodb-always-connect-to-database-test\">question</a>, I have tried with that solution, it not working for me and the solution is too complicated for me. It raise a error</p>\n<pre><code>Error creating bean with name 'mongoConfig': Injection of autowired dependencies failed\n</code></pre>\n<p>And I can not fix that problem, because I'm new with mongo</p>\n<p>How I can change spring boot app connect to another database?</p>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 17470048,
        "reputation": 1,
        "user_id": 12666039,
        "user_type": "registered",
        "profile_image": "https://lh5.googleusercontent.com/-WgvZP0y8dnQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reQr_1r9o5_s8sVK_xn0QjaKehnwg/s256-rj/photo.jpg",
        "display_name": "Napsta Kid",
        "link": "https://stackoverflow.com/users/12666039/napsta-kid"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1764764965,
      "last_edit_date": 1764764965,
      "creation_date": 1764758369,
      "answer_id": 79836776,
      "question_id": 77210202,
      "content_license": "CC BY-SA 4.0",
      "body": "<p><strong>If you’re using Spring Boot 4.0.0 or above:</strong></p>\n<p>Instead of:</p>\n<pre><code>spring.data.mongodb.uri=mongodb://localhost:27017/loan\n</code></pre>\n<p>Use:</p>\n<pre><code>spring.mongodb.uri=mongodb://localhost:27017/loan\n</code></pre>\n<p><strong>If that doesn’t work, you can define your own <code>MongoTemplate</code> bean:</strong></p>\n<pre><code>@Configuration\npublic class MongoConfig {\n\n    @Bean\n    @Profile({&quot;dev&quot;, &quot;default&quot;})\n    public MongoTemplate mongoTemplateDev() {\n        return new MongoTemplate(mongoClient(), &quot;loan&quot;);\n    }\n\n    @Bean\n    @Profile(&quot;test&quot;)\n    public MongoTemplate mongoTemplateTest() {\n        return new MongoTemplate(mongoClient(), &quot;test&quot;);\n    }\n\n    @Bean\n    @Profile(&quot;prod&quot;)\n    public MongoTemplate mongoTemplateProd() {\n        return new MongoTemplate(mongoClient(), &quot;loan&quot;);\n    }\n\n    private MongoClient mongoClient() {\n        System.out.println(&quot;Connecting to MongoDB...&quot;);\n        return MongoClients.create(&quot;mongodb://localhost:27017&quot;);\n        }\n}\n</code></pre>\n"
    },
    {
      "owner": {
        "account_id": 19946683,
        "reputation": 11,
        "user_id": 14617186,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/59471987ec6b48023d5968c505de921b?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "Rajesh Nair",
        "link": "https://stackoverflow.com/users/14617186/rajesh-nair"
      },
      "is_accepted": false,
      "score": 1,
      "last_activity_date": 1696251346,
      "last_edit_date": 1696251346,
      "creation_date": 1696200573,
      "answer_id": 77212575,
      "question_id": 77210202,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I see that you have database and collection name same as &quot;product&quot;. Try different naming for database and collection for standardization.</p>\n<p>For connecting to product database from your java code, you could write a configuration class annotated with <code>@ConfigurationProperties(prefix = &quot;spring.data.mongodb&quot;)</code> with a bean for <code>MongoClient</code> like this</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Bean\npublic MongoClient mongoClient() {\n    return MongoClients.create(getConnectionString());\n}\n</code></pre>\n<p>You can build the connectionString from your <code>application.properties</code> like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>var sb = new StringBuilder();\nsb.append(&quot;mongodb://&quot;);\nsb.append(getDBUsername(dbUserName));\nsb.append(&quot;:&quot;);\nsb.append(getDBPasswordByPath(dbPassword));\nsb.append(&quot;@&quot;);\nsb.append(getHost());\nsb.append(&quot;:&quot;);\nsb.append(getPort());\nsb.append(&quot;/&quot;);\nsb.append(getDbName());\nsb.append(&quot;?retrywrites=false&quot;);\n</code></pre>\n"
    },
    {
      "owner": {
        "account_id": 21849828,
        "reputation": 497,
        "user_id": 16142058,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/yXll4.jpg?s=256",
        "display_name": "summerisbetterthanwinter",
        "link": "https://stackoverflow.com/users/16142058/summerisbetterthanwinter"
      },
      "is_accepted": true,
      "score": 5,
      "last_activity_date": 1696217867,
      "creation_date": 1696217867,
      "answer_id": 77213123,
      "question_id": 77210202,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I have tried to read mongo for a couple hours <a href=\"https://www.mongodb.com/docs/drivers/java/sync/current/fundamentals/auth/\" rel=\"noreferrer\">docs</a>, I have found the solution.</p>\n<p>Almost of authentication mechanisms, we can not set database name</p>\n<p>For example with default authentication mechanism using connection string or mongo credential, I don't see the parameter for database name, only include <strong>username</strong>, <strong>authenticationDb</strong>, and <strong>password</strong></p>\n<p>With connection string:</p>\n<pre class=\"lang-java prettyprint-override\"><code>MongoClient mongoClient = MongoClients\n.create(&quot;mongodb://&lt;username&gt;:&lt;password&gt;@&lt;hostname&gt;:&lt;port&gt;/?authSource=&lt;authenticationDb&gt;&quot;);\n</code></pre>\n<p>With MongoCredential:</p>\n<pre class=\"lang-java prettyprint-override\"><code>MongoCredential credential = MongoCredential.createCredential(&quot;&lt;username&gt;&quot;, &quot;&lt;authenticationDb&gt;&quot;, &quot;&lt;password&gt;&quot;);\nMongoClient mongoClient = MongoClients.create(\n    MongoClientSettings.builder()\n        .applyToClusterSettings(builder -&gt;\n                builder.hosts(Arrays.asList(new ServerAddress(&quot;&lt;hostname&gt;&quot;, &lt;port&gt;))))\n        .credential(credential)\n        .build());\n</code></pre>\n<p>Other mechanisms are same.</p>\n<p>Thus, I have tried to create config file</p>\n<pre class=\"lang-java prettyprint-override\"><code>\n@Configuration\npublic class MongoDBConfig {\n    @Bean\n    public MongoClient mongoClient() {\n        return MongoClients.create(&quot;mongodb://root:pass12345@127.0.0.1:27018&quot;);\n    }\n}\n\n</code></pre>\n<p>and add database name in application.properties</p>\n<pre><code>spring.data.mongodb.database=product\n</code></pre>\n<p>Its amazing, it work perfectly like I want</p>\n"
    }
  ],
  "question_comments": [
    {
      "owner": {
        "account_id": 21849828,
        "reputation": 497,
        "user_id": 16142058,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/yXll4.jpg?s=256",
        "display_name": "summerisbetterthanwinter",
        "link": "https://stackoverflow.com/users/16142058/summerisbetterthanwinter"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1696197614,
      "post_id": 77210202,
      "comment_id": 136119350,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 14870107,
        "reputation": 131,
        "user_id": 10737839,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/5e0Bc.jpg?s=256",
        "display_name": "dev_fondue",
        "link": "https://stackoverflow.com/users/10737839/dev-fondue"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1696197145,
      "post_id": 77210202,
      "comment_id": 136119296,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 21849828,
        "reputation": 497,
        "user_id": 16142058,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/yXll4.jpg?s=256",
        "display_name": "summerisbetterthanwinter",
        "link": "https://stackoverflow.com/users/16142058/summerisbetterthanwinter"
      },
      "reply_to_user": {
        "account_id": 28694012,
        "reputation": 8945,
        "user_id": 21972629,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/u2A0d.png?s=256",
        "display_name": "jQueeny",
        "link": "https://stackoverflow.com/users/21972629/jqueeny"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1696173442,
      "post_id": 77210202,
      "comment_id": 136116733,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 28694012,
        "reputation": 8945,
        "user_id": 21972629,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/u2A0d.png?s=256",
        "display_name": "jQueeny",
        "link": "https://stackoverflow.com/users/21972629/jqueeny"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1696172645,
      "post_id": 77210202,
      "comment_id": 136116643,
      "content_license": "CC BY-SA 4.0"
    }
  ],
  "answer_comments": {
    "79836776": [
      {
        "owner": {
          "account_id": -1,
          "reputation": 1,
          "user_id": -1,
          "user_type": "moderator",
          "profile_image": "https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=256&d=identicon&r=PG",
          "display_name": "Community",
          "link": "https://stackoverflow.com/users/-1/community"
        },
        "edited": false,
        "score": 2,
        "creation_date": 1764761407,
        "post_id": 79836776,
        "comment_id": 140885180,
        "content_license": "CC BY-SA 4.0"
      }
    ],
    "77212575": [
      {
        "owner": {
          "account_id": 21849828,
          "reputation": 497,
          "user_id": 16142058,
          "user_type": "registered",
          "profile_image": "https://i.sstatic.net/yXll4.jpg?s=256",
          "display_name": "summerisbetterthanwinter",
          "link": "https://stackoverflow.com/users/16142058/summerisbetterthanwinter"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1696214769,
        "post_id": 77212575,
        "comment_id": 136120466,
        "content_license": "CC BY-SA 4.0"
      }
    ],
    "77213123": [
      {
        "owner": {
          "account_id": 12315202,
          "reputation": 358,
          "user_id": 8985718,
          "user_type": "registered",
          "profile_image": "https://i.sstatic.net/VFhO9.jpg?s=256",
          "display_name": "Sayed Hussainullah Sadat",
          "link": "https://stackoverflow.com/users/8985718/sayed-hussainullah-sadat"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1702401318,
        "post_id": 77213123,
        "comment_id": 136890577,
        "content_license": "CC BY-SA 4.0"
      }
    ]
  }
}