{
  "question": {
    "tags": [
      "java",
      "azure-blob-storage",
      "azure-storage",
      "uuid"
    ],
    "owner": {
      "account_id": 1324418,
      "reputation": 1519,
      "user_id": 1269572,
      "user_type": "registered",
      "accept_rate": 76,
      "profile_image": "https://www.gravatar.com/avatar/71bbb43fc9269586beb0688707ebae7c?s=256&d=identicon&r=PG",
      "display_name": "Viktor",
      "link": "https://stackoverflow.com/users/1269572/viktor"
    },
    "is_answered": true,
    "view_count": 78,
    "accepted_answer_id": 79824494,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1763558673,
    "creation_date": 1762950738,
    "last_edit_date": 1763006763,
    "question_id": 79817739,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79817739/azure-storage-blob-upload-filename-collision-with-uuid",
    "title": "Azure Storage blob upload filename collision with UUID",
    "body": "<p>During performance test we got some error from Azure Storage saying that</p>\n<blockquote>\n<p>com.azure.storage.blob.models.BlobStorageException: Status code 409, &quot;<Code>BlobAlreadyExists</Code>The specified blob already exists. RequestId:53c64237-701e-0086-6766-52cc7f000000</p>\n</blockquote>\n<p>The obvious reason would be that we want to use the same id to upload the blob to Azure.<br />\nHowever what we have is</p>\n<pre><code>@Override\npublic String storeQuote(final JsonNode quote) {\n    final String uuid = UUID.randomUUID().toString();\n    try {\n        final String blobName = BLOB_PREFIX + uuid;\n\n        LOGGER.debug(&quot;Uploading content to blob[{}].&quot;, blobName);\n        BlobClient blobClient = blobContainerClient.getBlobClient(blobName);\n        blobClient.upload(BinaryData.fromObject(quote));\n        LOGGER.debug(&quot;Upload was successful to blob [{}].&quot;, blobName);\n\n        return uuid;\n    }\n    catch (Exception e) {\n        throw new AzureBlogStorageErrorException(&quot;Error occurred when stored the quote in to Azure Blob Storage!&quot;, e);\n    }\n}\n</code></pre>\n<p>I can hardly imagine that we had 10+ times UUID collision in 1-2 hours performance test (I am just joking, obviously it can't happen or I am just very-very-... unlucky).</p>\n<p>Any idea please what the issue can be please?</p>\n<p>//////////////////////// question 1 ////////////////////////<br />\nI haven't set any retry mechanism, can this problem be caused by that? Is there a default retry if nothing is set? As far as I know there isn't but I am not 100% sure.</p>\n"
  },
  "answers": [
    {
      "posted_by_collectives": [
        {
          "tags": [
            "azure-static-website-hosting",
            "azureservicebus",
            "azure-data-sync",
            "azure-load-balancer",
            "azure-logic-app-standard",
            "azure-management-api",
            "azure-secrets",
            "azure-notificationhub",
            "azure-analytics",
            "azure-app-configuration",
            "azure-elasticpool",
            "azure-iot-suite",
            "azure-function-http",
            "azure-data-explorer",
            "azure-hub",
            "azure-web-roles",
            "azure-rtos",
            "azure-service-runtime",
            "azure-timeseries-insights",
            "azure-function-async",
            "azure-mobile-services",
            "azure-metrics-advisor",
            "azure-defender",
            "azure-ad-b2c",
            "azure-ml-component",
            "azure-webjobs-triggered",
            "azure-iot-dps",
            "azure-java-tools",
            "azure-management-portal",
            "microsoft-entra-id",
            "azure-hdinsight",
            "azure-app-service-envrmnt",
            "azure-sentinel",
            "azure-dsvm",
            "azure-storage-explorer",
            "azure-workflow-automation",
            "azure-webjobssdk",
            "azure-anomaly-detector",
            "azure-mapping-data-flow",
            "azure-sql",
            "azure-sdk-.net",
            "azure-caching",
            "azure-redis-cache",
            "azure-cost-calculation",
            "azure-purview",
            "azure-batch",
            "azure-mysql-database",
            "azure-stack",
            "azure-relay",
            "azure-private-link",
            "azure-elastic-sharding",
            "azure-sdk-for-go",
            "kql",
            "azure-service-hooks",
            "azure-http-trigger",
            "azure-availability-set",
            "azure-diagnostics",
            "azure-blockchain-service",
            "azure-database-postgresql",
            "azure-data-lake",
            "azure-service-fabric-mesh",
            "fhir-server-for-azure",
            "azure-in-role-cache",
            "azure-free-services",
            "azure-gov",
            "azure-mcd",
            "azure-ddos",
            "azure-media-services",
            "azure-python-sdk",
            "sitecore-azure",
            "microsoft-entra-internet-access",
            "azure-log-analytics-workspace",
            "azure-databoxfamily",
            "defaultazurecredential",
            "azure-vm",
            "azure-autoscaling-block",
            "azure-lab-services",
            "azure-app-api",
            "azure-spring-boot",
            "azure-resource-group",
            "azure-zulu",
            "azure-billing-api",
            "azure-blob-trigger",
            "azure-form-recognizer",
            "azureclicredential",
            "azure-file-copy",
            "azure-iot-edge",
            "azure-linux",
            "azure-bastion",
            "azure-compliance-policy",
            "azure-function-app-proxy",
            "azure-backup-vault",
            "azure-keyvault",
            "azure-emulator",
            "azure-cosmosdb-emulator",
            "azure-storage-queues",
            "azure-image-builder",
            "azure-functions-runtime",
            "azure-data-studio",
            "azure-acs",
            "azure-ai",
            "azure-aks",
            "azure-mobile-engagement",
            "azure-deployment",
            "azure-service-plan",
            "azure-cosmosdb-cassandra-api",
            "azurerm-app-service",
            "django-pyodbc-azure",
            "adal",
            "azure-data-catalog",
            "azure-machine-learning-service",
            "azure-application-roles",
            "azure-sql-reporting",
            "azure-security-center",
            "sql-server-azure",
            "azure-static-website-routing",
            "azure-storage-files",
            "azure-java-sdk",
            "azure-ad-b2b",
            "azure-data-share",
            "azure-monitoring",
            "azure-resource-manager",
            "azure-servicebus-subscriptions",
            "azure-private-dns",
            "azure-iot-central",
            "azure-ilb",
            "adal.js",
            "azure-cli",
            "azure-agent",
            "azure-application-registration",
            "azure-speech",
            "azure-synapse-link",
            "azure-sphere",
            "azure-vm-templates",
            "azure-cdn",
            "azure-dns",
            "azure-table-storage",
            "azure-notebooks",
            "azure-information-protection",
            "azure-storage-emulator",
            "azure-authentication",
            "azure-migrate",
            "azure-dashboard",
            "azure-arc",
            "azure-managed-identity",
            "azure-language-understanding",
            "azure-site-recovery",
            "terraform-provider-azure",
            "azure-spring-cloud",
            "azure-ad-graph-api",
            "azure-eventgrid",
            "azure-automation",
            "azure-servicebusrelay",
            "azure-managed-grafana",
            "azure-sdk",
            "azure-industrial-iot",
            "azure-sas",
            "microsoft-entra-external-id",
            "azure-sql-edge",
            "azure-ad-msal",
            "azure-app-service-plans",
            "azure-databricks",
            "azure-appservice",
            "azure-cosmosdb-tables",
            "azure-media-player",
            "azure-adal-deprecation",
            "azure-sql-managed-instance",
            "azure-search-.net-sdk",
            "azure-update-management-center",
            "sql-azure-federations",
            "passport-azure-ad",
            "azure-web-app-firewall",
            "azure-web-app-for-containers",
            "azure.data.tables",
            "spring-cloud-azure",
            "azure-container-instances",
            "azure-cosmosdb-changefeed",
            "azure-api-apps",
            "azure-log-analytics",
            "azure-static-web-app",
            "azure-iot-hub",
            "azure-ase",
            "azure-alerts",
            "azure-ad-verifiable-credentials",
            "pulumi-azure",
            "azure-elastic-scale",
            "azure-logic-apps",
            "azure-sdk-python",
            "azure-cosmosdb-gremlinapi",
            "kitchen-azurerm",
            "azure-object-anchors",
            "azure-bot-service",
            "azure-function-queue",
            "azuremlsdk",
            "azure-load-testing",
            "azure-triggers",
            "azure-postgresql",
            "azure-durable-functions",
            "azure-api-management",
            "azure-qna-maker",
            "azure-functions-core-tools",
            "azure-virtual-network",
            "azure-custom-providers",
            "azure-cognitive-search",
            "azure-queues",
            "microsoft-custom-vision",
            "azure-configuration",
            "azure-storage-account",
            "azure-scheduler",
            "azure-servicebus-topics",
            "azure-tablequery",
            "azure-dev-spaces",
            "azure-application-settings",
            "azure-blob-storage",
            "azure-pipelines-release-pipeline",
            "spark-bash-azure-databricks",
            "azure-integration-account",
            "azure-regions",
            "azure-database-mysql",
            "azure-waf",
            "azure-rm-template",
            "azure-servicebus-queues",
            "azure-virtual-machine",
            "azure-communication-services",
            "azure-cognitive-services",
            "azure-container-registry",
            "azure-nsg",
            "azure-data-lake-gen2",
            "azure-pack",
            "azure-deployment-slots",
            "azure-hybrid-connections",
            "azure-appfabric",
            "azure-batch-account",
            "azure-powershell",
            "azure-eventhub",
            "azure-data-factory",
            "azure-runbook",
            "azure-acr",
            "azure-ad-powershell-v2",
            "azure-synapse",
            "azure-adf",
            "azure-iot-hub-device-update",
            "azure-anomaly-detection",
            "azure-cosmosdb-mongovcore",
            "azure-cosmosdb",
            "azure-sdk-php",
            "azure-application-insights",
            "azure-packaging",
            "azure-promptflow",
            "azure-policy",
            "azure-monitor",
            "azure-connect",
            "azure-node-sdk",
            "azureshell",
            "azure-text-translation",
            "azure-traffic-manager",
            "azure-oms",
            "azure-iot-sdk",
            "azure-sdk-go",
            "azure-active-directory",
            "azure-clouddrive",
            "azure-container-apps",
            "azure-quantum",
            "azure-public-ip",
            "azure-digital-twins",
            "azure-bicep",
            "azure-ml-pipelines",
            "azure-sdk-for-java",
            "azureadgraph-deprecation",
            "azure-store",
            "azure-signalr",
            "azure-functions",
            "azure",
            "azure-sql-database",
            "azure-container-service",
            "azure-video-indexer",
            "azurekinect",
            "azure-managed-disk",
            "azure-maps",
            "rebus-azureservicebus",
            "azure-ad-role",
            "azure-app-registration",
            "azure-managed-app",
            "azure-feature-manager",
            "azure-advisor",
            "azure-resource-graph",
            "azure-calculator",
            "azure-private-dns-zone",
            "azure-ai-translator",
            "azure-fluent-api",
            "azure-remote-rendering",
            "azure-cosmosdb-mongoapi",
            "azure-web-app-service",
            "azure-monitor-workbooks",
            "azure-role-environment",
            "azure-managed-database",
            "azure-function-app",
            "azure-static-web-app-routing",
            "azure-ad-v2",
            "azure-sdk-for-ruby",
            "azure-management",
            "azure-availability-zones",
            "azure-oauth",
            "azure-identity",
            "azure-service-fabric",
            "azure-rbac",
            "azure-android-sdk",
            "azure-compute-emulator",
            "azure-performancecounters",
            "azure-web-pubsub",
            "azure-cosmosdb-sqlapi",
            "azure-iot-hub-device-management",
            "azure-functions-proxies",
            "azure-security",
            "azure-cloud-shell",
            "azure-sdk-js",
            "azure-custom-domain",
            "azureportal",
            "azure-webjobs-continuous",
            "azure-ad-domain-services",
            "azure-rm",
            "azure-rest-api",
            "azure-git-deployment",
            "azure-spatial-anchors",
            "azure-application-proxy",
            "azure-application-gateway",
            "azure-worker-roles",
            "azure-webhooks",
            "azure-vpn",
            "azure-affinity-group",
            "azure-debugger",
            "azure-webjobs",
            "azure-marketplace",
            "azure-xplat-cli",
            "microsoft-entra-private-access",
            "azure-functions-docker",
            "sql-azure-alerts",
            "azure-devtest-labs",
            "azure-webapps",
            "azure-vm-scale-set",
            "azure-subscription",
            "azure-storage",
            "azure-ad-b2c-custom-policy",
            "azure-management-groups",
            "azure-disk",
            "azure-cloud-services",
            "azure-application-insights-profiler",
            "azure-blueprints",
            "azure-china",
            "azure-stream-analytics",
            "azure-sql-server",
            "azure-blockchain-workbench",
            "azure-analysis-services",
            "azure-service-principal",
            "azureml-python-sdk",
            "azure-front-door",
            "azure-sdk-ruby",
            "azure-files",
            "azure-auto-ml",
            "azure-billing",
            "azure-cli2"
          ],
          "external_links": [
            {
              "type": "support",
              "link": "https://stackoverflow.com/contact?topic=15"
            }
          ],
          "description": "A collective for developers to engage, share, and learn about Microsoft Azureâ€™s open-source frameworks, languages, and platform. This collective is organized and managed by the Stack Overflow community.",
          "link": "/collectives/azure",
          "name": "Microsoft Azure",
          "slug": "azure"
        }
      ],
      "owner": {
        "account_id": 223215,
        "reputation": 3104,
        "user_id": 482270,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/oXbT0.jpg?s=256",
        "display_name": "akseli",
        "link": "https://stackoverflow.com/users/482270/akseli"
      },
      "is_accepted": true,
      "score": 0,
      "last_activity_date": 1763558673,
      "creation_date": 1763558673,
      "answer_id": 79824494,
      "question_id": 79817739,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>Azure Storage SDK does, indeed, have a default retry mechanism built in. Most likely, the issue you're running into stems from partially completed uploads.</p>\n<p>Since you're performance testing, the most likely scenario is that the upload is creating the file in your storage container, but due to high loads, the <code>success</code> response isn't being received by the client. Thus, the client will retry the upload using the same UUID.</p>\n<p>In order to mitigate the issue you're going to want to use the <code>BlobServiceClientBuilder.retryOptions()</code> method to setup your retries. You can find documentation regarding the different options you can work with <a href=\"https://learn.microsoft.com/en-us/java/api/com.azure.core.http.policy.retryoptions?view=azure-java-stable\" rel=\"nofollow noreferrer\">here.</a></p>\n"
    }
  ],
  "question_comments": [],
  "answer_comments": {
    "79824494": [
      {
        "owner": {
          "account_id": 1324418,
          "reputation": 1519,
          "user_id": 1269572,
          "user_type": "registered",
          "accept_rate": 76,
          "profile_image": "https://www.gravatar.com/avatar/71bbb43fc9269586beb0688707ebae7c?s=256&d=identicon&r=PG",
          "display_name": "Viktor",
          "link": "https://stackoverflow.com/users/1269572/viktor"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1764540819,
        "post_id": 79824494,
        "comment_id": 140880563,
        "content_license": "CC BY-SA 4.0"
      }
    ]
  }
}