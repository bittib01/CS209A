{
  "question": {
    "tags": [
      "java",
      "ssl",
      "https"
    ],
    "owner": {
      "account_id": 422964,
      "reputation": 34570,
      "user_id": 802050,
      "user_type": "registered",
      "accept_rate": 89,
      "profile_image": "https://www.gravatar.com/avatar/b64ecf035c26728e5e3635b940d2cd38?s=256&d=identicon&r=PG",
      "display_name": "M Sach",
      "link": "https://stackoverflow.com/users/802050/m-sach"
    },
    "is_answered": true,
    "view_count": 2394279,
    "protected_date": 1429607933,
    "accepted_answer_id": 9619478,
    "answer_count": 38,
    "score": 645,
    "last_activity_date": 1747740026,
    "creation_date": 1331216234,
    "last_edit_date": 1629113435,
    "question_id": 9619030,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/9619030/resolving-javax-net-ssl-sslhandshakeexception-sun-security-validator-validatore",
    "title": "Resolving javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed Error?",
    "body": "<p><strong>Edit :</strong> I tried to format the question and accepted answer in more presentable way at my <a href=\"https://tech-geek-passion.blogspot.com/2017/09/how-to-resolve-javaxnetsslsslhandshakee.html\" rel=\"noreferrer\">blog</a>.</p>\n<p>Here is the original issue.</p>\n<p>I am getting this error:</p>\n<blockquote>\n<p>detailed message sun.security.validator.ValidatorException: PKIX path\nbuilding failed:<br />\nsun.security.provider.certpath.SunCertPathBuilderException: unable to\nfind valid certification path  to requested target</p>\n<p>cause javax.net.ssl.SSLHandshakeException:\nsun.security.validator.ValidatorException: PKIX path   building\nfailed: sun.security.provider.certpath.SunCertPathBuilderException:\nunable to find valid certification path to requested target</p>\n</blockquote>\n<p>I am using Tomcat 6 as webserver. I have two HTTPS web applications installed on different Tomcats on different ports but on the same machine. Say App1 (port 8443) and  App2 (port 443). App1 connects to App2. When App1 connects to App2 I get the above error. I know this is a very common error so came across many solutions on different forums and sites. I have the below entry in <code>server.xml</code> of both Tomcats:</p>\n<pre><code>keystoreFile=&quot;c:/.keystore&quot; \nkeystorePass=&quot;changeit&quot;\n</code></pre>\n<p>Every site says the same reason that certificate given by app2 is not in the trusted store of app1 jvm. This seems to be true also when I tried to hit the same URL in IE browser, it works (with warming, There is a problem with this web site's security certificate. Here I say continue to this website). But when same URL is hit by Java client (in my case) I get the above error. So to put it in the truststore I tried these three options:</p>\n<h3>Option 1</h3>\n<pre><code>System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;C:/.keystore&quot;);\nSystem.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;changeit&quot;);\n</code></pre>\n<h3>Option 2</h3>\n<p>Setting below in environment variable</p>\n<pre><code>CATALINA_OPTS -- param name\n-Djavax.net.ssl.trustStore=C:\\.keystore -Djavax.net.ssl.trustStorePassword=changeit ---param value\n</code></pre>\n<h3>Option 3</h3>\n<p>Setting below in environment variable</p>\n<pre><code>JAVA_OPTS -- param name\n-Djavax.net.ssl.trustStore=C:\\.keystore -Djavax.net.ssl.trustStorePassword=changeit ---param value\n</code></pre>\n<h3>Result</h3>\n<p>But nothing worked.</p>\n<p><strong>What at last worked</strong> is executing the Java approach suggested in <a href=\"https://stackoverflow.com/questions/1828775/httpclient-and-ssl\">How to handle invalid SSL certificates with Apache HttpClient?</a> by Pascal Thivent i.e. executing the program InstallCert.</p>\n<p><strong>But this approach is fine for devbox setup but I can not use it at production environment.</strong></p>\n<p>I am wondering why three approaches mentioned above did not work when I have mentioned the same values in <code>server.xml</code> of App2 server and same values in truststore by setting</p>\n<p><code>System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;C:/.keystore&quot;) and System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;changeit&quot;);</code></p>\n<p>in App1 program.</p>\n<p>For more information this is how I am making the connection:</p>\n<pre><code>URL url = new URL(urlStr);\n\nURLConnection conn = url.openConnection();\n\nif (conn instanceof HttpsURLConnection) {\n\n  HttpsURLConnection conn1 = (HttpsURLConnection) url.openConnection();\n  \n  conn1.setHostnameVerifier(new HostnameVerifier() {\n    public boolean verify(String hostname, SSLSession session) {\n      return true;\n    }\n  });\n\n  reply.load(conn1.getInputStream());\n</code></pre>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 8137156,
        "reputation": 161,
        "user_id": 6128451,
        "user_type": "registered",
        "profile_image": "https://graph.facebook.com/1079571178773490/picture?type=large",
        "display_name": "Nubian",
        "link": "https://stackoverflow.com/users/6128451/nubian"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1747740026,
      "last_edit_date": 1747740026,
      "creation_date": 1486711825,
      "answer_id": 42153814,
      "question_id": 9619030,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I tried almost everything by adding the SSL cert to .keystore, but, it was not working with Java1_6_x.\nFor me it helped if we start using newer version of Java, Java1_8_x as JVM.</p>\n"
    },
    {
      "owner": {
        "account_id": 1707279,
        "reputation": 1283,
        "user_id": 1566091,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/e6ca9d5d316439b86e220b185ef9a283?s=256&d=identicon&r=PG",
        "display_name": "YaDa",
        "link": "https://stackoverflow.com/users/1566091/yada"
      },
      "is_accepted": false,
      "score": 6,
      "last_activity_date": 1747739979,
      "last_edit_date": 1747739979,
      "creation_date": 1492957223,
      "answer_id": 43572322,
      "question_id": 9619030,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>For me, this error appeared too while trying to connect to a process behind an NGINX reverse proxy which was handling the SSL.</p>\n<p>It turned out the problem was a certificate without the entire certificate chain concatenated.\nWhen I added intermediate certs, the problem was solved.</p>\n"
    },
    {
      "owner": {
        "account_id": 2220824,
        "reputation": 17544,
        "user_id": 3168721,
        "user_type": "registered",
        "accept_rate": 97,
        "profile_image": "https://i.sstatic.net/YN22H.jpg?s=256",
        "display_name": "tk_",
        "link": "https://stackoverflow.com/users/3168721/tk"
      },
      "is_accepted": false,
      "score": 4,
      "last_activity_date": 1747739945,
      "last_edit_date": 1747739945,
      "creation_date": 1547463014,
      "answer_id": 54180049,
      "question_id": 9619030,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>for safety we should not use self signed certificates in our implementation. However, when it comes to development often we have to use trial environments which got self-signed certs. I tried to fix this issue programmatically in my code and I fail. However, by adding the cert to the jre trust-store fixed my issue. Please find below steps,</p>\n<ol>\n<li>Download the site cert,</li>\n</ol>\n<ul>\n<li>Using <a href=\"https://drive.google.com/file/d/1wCoE8KX-vUM4RKc15wqsLnNWL9gTUJwp/view?usp=sharing\" rel=\"nofollow noreferrer\">Chrome</a></li>\n<li>Using <a href=\"https://superuser.com/a/97203/358866\">Firefox</a></li>\n</ul>\n<ol start=\"2\">\n<li><p>Copy the certificate(ex:cert_file.cer) into the directory $JAVA_HOME\\Jre\\Lib\\Security</p>\n</li>\n<li><p>Open CMD in Administrator and change the directory to $JAVA_HOME\\Jre\\Lib\\Security</p>\n</li>\n<li><p>Import the certificate to a trust store using below command,</p>\n</li>\n</ol>\n<blockquote>\n<p>keytool -import -alias ca -file <strong>cert_file.cer</strong> -keystore cacerts\n-storepass changeit</p>\n</blockquote>\n<p><em>If you got a error saying keytool is not recognizable please <a href=\"https://stackoverflow.com/a/14199969/3168721\">refer this.</a></em></p>\n<p>Type <strong>yes</strong> like below</p>\n<blockquote>\n<p>Trust this certificate: <strong>[Yes]</strong></p>\n</blockquote>\n<ol start=\"5\">\n<li>Now try to run your code or access the URL programmatically using java.</li>\n</ol>\n<hr />\n<p><strong>Update</strong></p>\n<p>If your app server is jboss try adding below system property</p>\n<pre><code>System.setProperty(&quot;org.jboss.security.ignoreHttpsHost&quot;,&quot;true&quot;);\n</code></pre>\n"
    },
    {
      "owner": {
        "account_id": 451585,
        "reputation": 5005,
        "user_id": 847553,
        "user_type": "registered",
        "accept_rate": 86,
        "profile_image": "https://www.gravatar.com/avatar/5801de3dc295f8754df80f58f409c8c7?s=256&d=identicon&r=PG",
        "display_name": "Dave Richardson",
        "link": "https://stackoverflow.com/users/847553/dave-richardson"
      },
      "is_accepted": false,
      "score": 3,
      "last_activity_date": 1747739929,
      "last_edit_date": 1747739929,
      "creation_date": 1589902147,
      "answer_id": 61894817,
      "question_id": 9619030,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>This seems as good a place as any to document another possible reason for the infamous PKIX error message. After spending far too long looking at the keystore and truststore contents and various java installation configs I realised that my issue was down to... a typo.</p>\n<p>The typo meant that I was also using the keystore as the truststore. As my companies Root CA was not defined as a standalone cert in the keystore but only as part of a cert chain, and was not defined anywhere else (i.e. cacerts) I kept getting the PKIX error.</p>\n<p>After a failed release (this is prod config, it was ok elsewhere) and two days of head scratching I finally saw the typo, and now all is good.</p>\n"
    },
    {
      "owner": {
        "account_id": 13669828,
        "reputation": 676,
        "user_id": 9862732,
        "user_type": "registered",
        "profile_image": "https://graph.facebook.com/1598343040292219/picture?type=large",
        "display_name": "Sergey  Molchanovsky",
        "link": "https://stackoverflow.com/users/9862732/sergey-molchanovsky"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1733930046,
      "creation_date": 1733930046,
      "answer_id": 79272217,
      "question_id": 9619030,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I encountered this problem when we upgraded our Flutter project to JAVA_17 and Gradle 8.</p>\n<p>In my case, the solution was just updating all the SDK Tools in Android Studio:</p>\n<p><a href=\"https://i.sstatic.net/GPcG8eiQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/GPcG8eiQ.png\" alt=\"screenshot\" /></a></p>\n"
    },
    {
      "owner": {
        "account_id": 143589,
        "reputation": 1522,
        "user_id": 352035,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/5e04ebdfaafc326122015749a5706191?s=256&d=identicon&r=PG",
        "display_name": "AutomatedMike",
        "link": "https://stackoverflow.com/users/352035/automatedmike"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1727090870,
      "creation_date": 1727090870,
      "answer_id": 79014410,
      "question_id": 9619030,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>None of the previous answers worked for me using Spring 5 in the situation where I don't control the code making the http connection.</p>\n<p>The following code disables SSL Certificate verification for all new RestTemplates:</p>\n<pre><code>@Bean\npublic RestTemplateCustomizer restTemplateCustomizer() {\n    return restTemplate -&gt; {\n        try {\n            SSLContext sslContext = SSLContextBuilder.create()\n                    .loadTrustMaterial((TrustStrategy) (chain, authType) -&gt; true)\n                    .build();\n\n            SSLConnectionSocketFactory socketFactory = \n                    new SSLConnectionSocketFactory(\n                        sslContext, NoopHostnameVerifier.INSTANCE);\n\n            PoolingHttpClientConnectionManager connectionManager = \n                    PoolingHttpClientConnectionManagerBuilder.create()\n                        .setSSLSocketFactory(socketFactory)\n                        .build();\n\n            CloseableHttpClient httpClient = HttpClients.custom()\n                    .setConnectionManager(connectionManager)\n                    .build();\n\n            HttpComponentsClientHttpRequestFactory requestFactory = \n                    new HttpComponentsClientHttpRequestFactory(httpClient);\n\n            restTemplate.setRequestFactory(requestFactory);\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    };\n</code></pre>\n"
    }
  ],
  "question_comments": [
    {
      "owner": {
        "account_id": 329906,
        "reputation": 13385,
        "user_id": 653708,
        "user_type": "registered",
        "accept_rate": 90,
        "profile_image": "https://i.sstatic.net/bch50.jpg?s=256",
        "display_name": "8bitjunkie",
        "link": "https://stackoverflow.com/users/653708/8bitjunkie"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1719358895,
      "post_id": 9619030,
      "comment_id": 138700394,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 5938469,
        "reputation": 947,
        "user_id": 4670625,
        "user_type": "registered",
        "accept_rate": 67,
        "profile_image": "https://graph.facebook.com/10205142650399275/picture?type=large",
        "display_name": "David Marciel",
        "link": "https://stackoverflow.com/users/4670625/david-marciel"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1636461535,
      "post_id": 9619030,
      "comment_id": 123558234,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 4999034,
        "reputation": 2564,
        "user_id": 6722075,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/2bunn.jpg?s=256",
        "display_name": "Tohid Makari",
        "link": "https://stackoverflow.com/users/6722075/tohid-makari"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1612269181,
      "post_id": 9619030,
      "comment_id": 116708682,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 416701,
        "reputation": 4484,
        "user_id": 792238,
        "user_type": "registered",
        "accept_rate": 87,
        "profile_image": "https://i.sstatic.net/Gr7qI.jpg?s=256",
        "display_name": "Siddhartha",
        "link": "https://stackoverflow.com/users/792238/siddhartha"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1523052916,
      "post_id": 9619030,
      "comment_id": 86416955,
      "content_license": "CC BY-SA 3.0"
    }
  ],
  "answer_comments": {
    "42153814": [],
    "43572322": [],
    "54180049": [],
    "61894817": [],
    "79272217": [],
    "79014410": []
  }
}