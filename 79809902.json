{
  "question": {
    "tags": [
      "java",
      "kubernetes",
      "jvm"
    ],
    "owner": {
      "account_id": 1181771,
      "reputation": 1288,
      "user_id": 1156561,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/cfa23205cce07923a8c4e3f4b0824389?s=256&d=identicon&r=PG",
      "display_name": "Carsten",
      "link": "https://stackoverflow.com/users/1156561/carsten"
    },
    "is_answered": false,
    "view_count": 133,
    "answer_count": 0,
    "score": 1,
    "last_activity_date": 1762337876,
    "creation_date": 1762337876,
    "question_id": 79809902,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79809902/java-21-container-support-active-processor-count",
    "title": "Java 21+ container support: active processor count",
    "body": "<p>In containers running Java 21+, I would like to have the active processor count reflect the actual available hardware cores, regardless of configured CPU shares.</p>\n<p>CSR <a href=\"https://bugs.openjdk.org/browse/JDK-8281571\" rel=\"nofollow noreferrer\">JDK-8281571</a> &quot;Do not use CPU Shares to compute active processor count&quot; explains the problem with using Docker/Kubernetes CPU resource limits to determine the active processor count with <code>-XX:+UseContainerSupport</code> and I understand it to have changed this.</p>\n<p>In Java 21 however, the deprecated flags controlling this (<code>UseContainerCpuShares</code> and <code>PreferContainerQuotaForCPUCount</code>) are gone, and I cannot find documentation on what the situation is supposed to be wrt container CPU limits.</p>\n<p>The behavior in Kubernetes, with resource limits like this:</p>\n<pre><code>   resources:\n      limits:\n         cpu: 1000m\n</code></pre>\n<p>is that the active processor count is limited to <code>1</code> with all the problems described in JDK-8281571 (<code>Runtime.getRuntime().availableProcessors()</code> returns <code>1</code>).</p>\n<p>I could override this explicitly with <code>-XX:ActiveProcessorCount=n</code>, but this requires explicitly configuring the concrete processor count, which might change with node updates and tends to be missed during updates.</p>\n<p>I tried setting <code>-XX:ActiveProcessorCount=-1</code>, however this does not do anything.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}