{
  "question": {
    "tags": [
      "java",
      "jpa",
      "criteria"
    ],
    "owner": {
      "account_id": 3168929,
      "reputation": 823,
      "user_id": 2678337,
      "user_type": "registered",
      "accept_rate": 80,
      "profile_image": "https://www.gravatar.com/avatar/8afac1f3269318fd8a9aae9b87b657f3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Giovane",
      "link": "https://stackoverflow.com/users/2678337/giovane"
    },
    "is_answered": true,
    "view_count": 136995,
    "accepted_answer_id": 18958802,
    "answer_count": 9,
    "score": 51,
    "last_activity_date": 1764327501,
    "creation_date": 1379937337,
    "last_edit_date": 1497265897,
    "question_id": 18958614,
    "content_license": "CC BY-SA 3.0",
    "link": "https://stackoverflow.com/questions/18958614/union-to-jpa-query",
    "title": "UNION to JPA Query",
    "body": "<p>Is it possible to query \"UNION\" in JPA and even \"Criteria Builder\"?</p>\n\n<p>I'm looking for examples, but so far i got no result.</p>\n\n<p>Does anyone have any examples of how to use it?</p>\n\n<p>Or would that be with native sql?</p>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 24121769,
        "reputation": 19,
        "user_id": 18090829,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/aae10d930c8d060b1f89504598dca428?s=256&d=identicon&r=PG",
        "display_name": "Frederic",
        "link": "https://stackoverflow.com/users/18090829/frederic"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1764327501,
      "creation_date": 1764327501,
      "answer_id": 79832484,
      "question_id": 18958614,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I know it's an old closed question but I'm experimenting on an alternative that I almost never saw on SO. By using the <code>querydsl-sql</code> dependency, we can use <code>JPASQLQuery</code>. Those queries are closer to SQL compared to <code>JPAQuery</code>. What you can do with <code>JPASQLQuery</code> and not with <code>JPAQuery</code> is, for instance, having a <code>select</code> in the <code>from</code> clause, or omit the <code>from</code> clause at all (by passing the correct template associated to the DB you're using, it will generate <code>from dual</code> in case of an Oracle DB for instance). The <code>JPASQLQuery</code> is normally using the SQL Q-class (generated by scanning a DB) but can also be using the JPA Q-class (generated by the JPA entity class). The only problem using JPA Q-class is that you can't navigate between relations between entities and you have to join everything manually.</p>\n<p>Here is an example of a <code>JPASQLQuery</code> with union:</p>\n<pre class=\"lang-java prettyprint-override\"><code>QFoo fooQuery = QFoo.foo;\nList&lt;Integer&gt; dates = new JPASQLQuery&lt;&gt;(entityManager, SQLTemplates.DEFAULT).union(\n    SQLExpressions.select(fooQuery.date.max().as(&quot;mdate&quot;))\n       .from(fooQuery)\n       .where(fooQuery.type.eq(1)),\n    SQLExpressions.select(fooQuery.anotherDate.max().as(&quot;mdate&quot;))\n       .from(fooQuery)\n       .where(fooQuery.type.eq(2))).fetch();\n</code></pre>\n<p>using such entity:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Entity\n@Getter\n@Setter\n@Table(name = &quot;FOO&quot;)\npublic class Foo {\n\n    @Id\n    @Column(name = &quot;ID&quot;)\n    private Long id;\n\n    @Column(name = &quot;DATE_&quot;, nullable = false)\n    private Integer date;\n\n    @Column(name = &quot;ANOTHER_DATE&quot;, nullable = false)\n    private Integer anotherDate;\n\n    @Column(name = &quot;TYPE_&quot;, nullable = false)\n    private Integer type;\n}\n</code></pre>\n"
    },
    {
      "owner": {
        "account_id": 4790702,
        "reputation": 21,
        "user_id": 3869979,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/cecacc359bc4cafb1114b1ddf19ba765?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "user3869979",
        "link": "https://stackoverflow.com/users/3869979/user3869979"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1656234448,
      "creation_date": 1656234448,
      "answer_id": 72760234,
      "question_id": 18958614,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I have solved this in my project.</p>\n<p><strong>Union/Union All will work if you change it to native query and use like below</strong></p>\n<pre><code>//In Your Entity class\n@NamedNativeQuery(name=&quot;EntityClassName.functionName&quot;, \nquery=&quot;your_native_query&quot;)\n\n//In your Repository class\n@Query(native=true)\nList&lt;Result&gt; functionName();\n</code></pre>\n<p><strong>Below method of defining Native query in JPA repository will not solve this problem</strong></p>\n<pre><code>@Query(value=&quot;your_native_query&quot;, native=true)\n</code></pre>\n<p>will not</p>\n"
    },
    {
      "owner": {
        "account_id": 7184343,
        "reputation": 910,
        "user_id": 5486945,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/q9mkD.png?s=256",
        "display_name": "yOshi",
        "link": "https://stackoverflow.com/users/5486945/yoshi"
      },
      "is_accepted": false,
      "score": 1,
      "last_activity_date": 1553267377,
      "last_edit_date": 1553267377,
      "creation_date": 1553266981,
      "answer_id": 55302501,
      "question_id": 18958614,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>There is no direct union for JPA, what I did was to build two specifications.</p>\n\n<pre><code>Specification&lt;Task&gt; specification = Specification.where(null);\nSpecification&lt;Task&gt; specification2 = Specification.where(null;\n</code></pre>\n\n<p>They belong to a single table but return different values</p>\n\n<pre><code>specification = specification.and((root, criteriaQuery, criteriaBuilder) -&gt; criteriaBuilder.equal(criteriaBuilder.function(MONTH, Integer.class, root.get(\"deliveryExpirationDate\")), month));\n        specification2 = specification2.and((root, criteriaQuery, criteriaBuilder) -&gt; criteriaBuilder.lessThan(criteriaBuilder.function(MONTH, Integer.class, root.get(\"deliveryExpirationDate\")), month))\n            .and((root, criteriaQuery, criteriaBuilder) -&gt; criteriaBuilder.equal(root.get(\"enable\"), true));\n</code></pre>\n\n<p>for this example it is a table of tasks that in the first specification I need the tasks of the current month enabled and disabled, and in the second specification I only need the tasks enabled of the previous months.</p>\n\n<pre><code>Specification&lt;Task&gt; specificationFullJoin = Specification.where(specification).or(specification2);\n</code></pre>\n\n<p>Esto es muy útil para que la lista de tareas devueltas tenga paginación.</p>\n\n<pre><code>taskRepository.findAll(specificationFullJoin, pageable).map(TaskResponse::new); //Here you can continue adding filters, sort or search.\n</code></pre>\n\n<p>It helps me a lot, I hope it is what they are looking for or that it serves them something.</p>\n"
    },
    {
      "owner": {
        "account_id": 1319573,
        "reputation": 22021,
        "user_id": 1265660,
        "user_type": "registered",
        "accept_rate": 75,
        "profile_image": "https://i.sstatic.net/WFK9j.jpg?s=256",
        "display_name": "Masudul",
        "link": "https://stackoverflow.com/users/1265660/masudul"
      },
      "is_accepted": true,
      "score": 50,
      "last_activity_date": 1550601302,
      "last_edit_date": 1550601302,
      "creation_date": 1379937870,
      "answer_id": 18958802,
      "question_id": 18958614,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>SQL supports UNION, but JPA 2.0 JPQL does not. Most unions can be done in terms of joins, but some can not, and some are more difficult to express using joins.</p>\n\n<p>EclipseLink supports UNION.</p>\n"
    },
    {
      "owner": {
        "account_id": 8088812,
        "reputation": 4729,
        "user_id": 6095444,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/347fc0e31105ebad8fcf817fd20d2b21?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "Pravin Bansal",
        "link": "https://stackoverflow.com/users/6095444/pravin-bansal"
      },
      "is_accepted": false,
      "score": 9,
      "last_activity_date": 1550273325,
      "creation_date": 1550273325,
      "answer_id": 54718344,
      "question_id": 18958614,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>write native query (set it true , default its false) - ex.</p>\n\n<pre><code>String findQuery = \"select xyz from abc union select abc from def\"\n@Query(value = findQuery, nativeQuery = true)\n//method\n</code></pre>\n"
    }
  ],
  "question_comments": [
    {
      "owner": {
        "account_id": 228790,
        "reputation": 2456,
        "user_id": 491320,
        "user_type": "registered",
        "accept_rate": 85,
        "profile_image": "https://www.gravatar.com/avatar/9e17d255ad8cf580c1fe4b26ff7af369?s=256&d=identicon&r=PG",
        "display_name": "danizmax",
        "link": "https://stackoverflow.com/users/491320/danizmax"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1433493843,
      "post_id": 18958614,
      "comment_id": 49386422,
      "content_license": "CC BY-SA 3.0"
    }
  ],
  "answer_comments": {
    "79832484": [],
    "72760234": [],
    "55302501": [],
    "18958802": [],
    "54718344": [
      {
        "owner": {
          "account_id": 3403134,
          "reputation": 188,
          "user_id": 2854878,
          "user_type": "registered",
          "profile_image": "https://i.sstatic.net/XVLuf.jpg?s=256",
          "display_name": "Cleberson Falk",
          "link": "https://stackoverflow.com/users/2854878/cleberson-falk"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1700961741,
        "post_id": 54718344,
        "comment_id": 136716088,
        "content_license": "CC BY-SA 4.0"
      }
    ]
  }
}