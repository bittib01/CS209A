{
  "question": {
    "tags": [
      "java",
      "xml",
      "web-services",
      "wsdl",
      "cxf"
    ],
    "owner": {
      "account_id": 4291079,
      "reputation": 841,
      "user_id": 3507435,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/U23RM.png?s=256",
      "display_name": "Toparvion",
      "link": "https://stackoverflow.com/users/3507435/toparvion"
    },
    "is_answered": false,
    "view_count": 32519,
    "answer_count": 1,
    "score": 3,
    "last_activity_date": 1764760100,
    "creation_date": 1412756299,
    "last_edit_date": 1413280413,
    "question_id": 26252200,
    "content_license": "CC BY-SA 3.0",
    "link": "https://stackoverflow.com/questions/26252200/javax-xml-ws-soap-soapfaultexception-unmarshalling-error-unexpected-element-u",
    "title": "javax.xml.ws.soap.SOAPFaultException: Unmarshalling Error: unexpected element (uri:&quot;&quot;, local:&quot;fault&quot;) after migrating from AXIS to CXF",
    "body": "<h2>The Problem</h2>\n\n<p>I am trying to migrate my web service <em>client</em> from <strong>Apache AXIS-1</strong> to <strong>Apache CXF</strong>.  The web service itself runs om AXIS-1 and is out of my control.<br>\nI generated all the CXF artifacts and the client has been working well until any fault is thrown by the service. The faulty XML looks like:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;\n  &lt;soapenv:Body&gt;\n    &lt;soapenv:Fault&gt;\n      &lt;faultcode&gt;soapenv:Server&lt;/faultcode&gt;\n      &lt;faultstring&gt;Remote error processing component card request&lt;/faultstring&gt;\n      &lt;detail&gt;\n        &lt;fault&gt;\n          &lt;faultcode&gt;:-303&lt;/faultcode&gt;\n          &lt;faultstring&gt;Remote error processing component card request&lt;/faultstring&gt;\n          &lt;faultactor&gt;remote_service&lt;/faultactor&gt;\n          &lt;detail&gt;\n            &lt;common-detail&gt;\n              &lt;code&gt;-303&lt;/code&gt;\n              &lt;message&gt;Remote error processing component card request&lt;/message&gt;\n            &lt;/common-detail&gt;\n          &lt;/detail&gt;\n        &lt;/fault&gt;\n      &lt;/detail&gt;\n    &lt;/soapenv:Fault&gt;\n  &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n</code></pre>\n\n<p>This makes the CXF generated client fall with exception:</p>\n\n<pre><code>javax.xml.bind.UnmarshalException: unexpected element (uri:\"\", local:\"fault\"). \nExpected elements are &lt;{http://some.namespace.org}AnsBonusAutopayStatus&gt;,&lt;{http://some.namespace.org}AnsBonusAutopaySubscribe&gt;,\n...\n&lt;{http://some.namespace.org}fault&gt;\n    at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallingContext.handleEvent(UnmarshallingContext.java:603)\n    at com.sun.xml.bind.v2.runtime.unmarshaller.Loader.reportError(Loader.java:244)\n    at com.sun.xml.bind.v2.runtime.unmarshaller.Loader.reportError(Loader.java:239)\n    at com.sun.xml.bind.v2.runtime.unmarshaller.Loader.reportUnexpectedChildElement(Loader.java:116)\n    at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallingContext$DefaultRootLoader.childElement(UnmarshallingContext.java:1009)\n    at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallingContext._startElement(UnmarshallingContext.java:446)\n    at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallingContext.startElement(UnmarshallingContext.java:427)\n    at com.sun.xml.bind.v2.runtime.unmarshaller.InterningXmlVisitor.startElement(InterningXmlVisitor.java:71)\n    at com.sun.xml.bind.v2.runtime.unmarshaller.SAXConnector.startElement(SAXConnector.java:137)\n    at com.sun.xml.bind.unmarshaller.DOMScanner.visit(DOMScanner.java:240)\n    at com.sun.xml.bind.unmarshaller.DOMScanner.scan(DOMScanner.java:123)\n...\n</code></pre>\n\n<p>AFAIU from this stacktrace, unmarshaller expects the <strong>fault</strong> element to have certain namespace declaration but it comes without one.</p>\n\n<p>Can anyone suggest what is wrong with that client and how to avoid the error?</p>\n\n<h2>Tested Solutions</h2>\n\n<p>There are a lot of similar questions but not all the solutions are applicable for me because I can't change anything on the server side (at least for backward compatibility reasons) and changing the WSDL is also not appreciated. Thus changes are restricted in client side only (including its (re)generation).\nI've tried several possible solutions based on similar questions:</p>\n\n<ul>\n<li>adding <strong>package-info.class</strong> with default namespace declaration - nothing changes;</li>\n<li>force setting empty namespace for generated <strong>Fault</strong> and/or <strong>Fault_Exception</strong> classes - <strong>NullPointerException</strong> in CXF routines during constructing the exception object (see EDIT section below);</li>\n<li>using <strong>SAX XmlFilter</strong> - couldn't find a way to embed it into CXF generated routines.</li>\n</ul>\n\n<h2>Additional Info</h2>\n\n<p>CXF generated classes for exception and its faultInfo (without any of my changes) look like:<br>\n<strong>Fault</strong> class:</p>\n\n<pre><code>@XmlAccessorType(XmlAccessType.FIELD)\n@XmlType(name = \"\", propOrder = {\n    \"faultcode\",\n    \"faultstring\",\n    \"faultactor\",\n    \"detail\"\n})\n@XmlRootElement(name = \"fault\")\npublic class Fault {\n\n    @XmlElement(required = true)\n    protected String faultcode;\n...\n</code></pre>\n\n<p><strong>Fault_Exception</strong> class:</p>\n\n<pre><code>@WebFault(name = \"fault\", targetNamespace = \"http://some.namespace.org\")\npublic class Fault_Exception extends Exception {\n\n    private Fault fault;\n\n    public Fault_Exception() {\n        super();\n    }\n...\n</code></pre>\n\n<p>Some WSDL excerpts.\n<strong>WSDL Fault</strong> message declaration:</p>\n\n<pre><code>  &lt;wsdl:message name=\"Fault\"&gt;\n    &lt;wsdl:part name=\"fault\" element=\"fault\"/&gt;\n  &lt;/wsdl:message&gt;\n</code></pre>\n\n<p><strong>XSD fault</strong> element:</p>\n\n<pre><code>&lt;xs:element name=\"fault\"&gt;\n&lt;xs:annotation&gt;\n  &lt;xs:documentation&gt;Comment describing your root element&lt;/xs:documentation&gt;\n&lt;/xs:annotation&gt;\n&lt;xs:complexType&gt;\n  &lt;xs:sequence&gt;\n    &lt;xs:element name=\"faultcode\"&gt;...&lt;/xs:element&gt;\n    &lt;xs:element name=\"faultstring\"&gt;...&lt;/xs:element&gt;\n    &lt;xs:element name=\"faultactor\"&gt;...&lt;/xs:element&gt;\n    &lt;xs:element minOccurs=\"0\" name=\"detail\"&gt;...&lt;/xs:element&gt;\n  &lt;/xs:sequence&gt;\n&lt;/xs:complexType&gt;\n&lt;/xs:element&gt;\n</code></pre>\n\n<p><strong>WSDL operation description</strong> example:</p>\n\n<pre><code>&lt;wsdl:operation name=\"BonusConversionState\"&gt;\n  &lt;wsdl:input name=\"BonusConversionStateRequest\" message=\"tns:BonusConversionStateRequest\"/&gt;\n  &lt;wsdl:output name=\"BonusConversionStateResponse\" message=\"tns:BonusConversionStateResponse\"/&gt;\n  &lt;wsdl:fault name=\"Fault\" message=\"tns:Fault\"/&gt;\n&lt;/wsdl:operation&gt;\n</code></pre>\n\n<p><strong>WSDL root element:</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;wsdl:definitions targetNamespace=\"http://some.namespace.org\" \n                  xmlns:wsdl=\"http://schemas.xmlsoap.org/wsdl/\" \n                  xmlns:tns=\"http://some.namespace.org\" \n                  xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" \n                  xmlns:soap=\"http://schemas.xmlsoap.org/wsdl/soap/\"&gt;\n</code></pre>\n\n<p>More additional info can be provided.<br>\nThanks in advance!</p>\n\n<h2>EDIT:</h2>\n\n<p>During \"investigation\" I've found out that <em>NullPointerException</em> (that I mentioned in \"Tested Solutions\") is not a consequence of my faulty actions. It's a bug of CXF:</p>\n\n<ul>\n<li><a href=\"https://issues.apache.org/jira/browse/CXF-2555\" rel=\"nofollow\">https://issues.apache.org/jira/browse/CXF-2555</a>;</li>\n<li><a href=\"https://issues.apache.org/jira/browse/CXF-3763\" rel=\"nofollow\">https://issues.apache.org/jira/browse/CXF-3763</a>.</li>\n</ul>\n\n<p>Both tickets are closed with resolution \"Fixed\", but in comments users report they still catch this bug. It seems that developers did not cover all the cases where custom exceptions are handled by CXF and for some reasons it sometimes leads to</p>\n\n<blockquote>\n  <p>org.apache.cxf.interceptor.ClientFaultConverter processFaultDetail<br>\n  INFO: Exception occurred while creating exception: null<br>\n  java.lang.NullPointerException</p>\n</blockquote>\n\n<p>Has anybody ever faced this problem too?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}