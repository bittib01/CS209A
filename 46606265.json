{
  "question": {
    "tags": [
      "java",
      "spring",
      "jedis",
      "spring-data-redis"
    ],
    "owner": {
      "account_id": 5096604,
      "reputation": 216,
      "user_id": 4087702,
      "user_type": "registered",
      "profile_image": "https://graph.facebook.com/100001927913553/picture?type=large",
      "display_name": "Vivek Bansal",
      "link": "https://stackoverflow.com/users/4087702/vivek-bansal"
    },
    "is_answered": false,
    "view_count": 10237,
    "answer_count": 1,
    "score": 3,
    "last_activity_date": 1764889630,
    "creation_date": 1507294547,
    "last_edit_date": 1507295930,
    "question_id": 46606265,
    "content_license": "CC BY-SA 3.0",
    "link": "https://stackoverflow.com/questions/46606265/cannot-get-jedis-connection-could-not-get-a-resource-from-the-pool",
    "title": "Cannot get Jedis connection, Could not get a resource from the pool",
    "body": "<p>I am creating a Web Application and using Redis for data storage. \nI have used JedisPoolConfig (redis client-jedis version 2.9.0) .\nSo when I test my application with help of Apache Jmeter with following configurations :</p>\n\n<pre><code>Number of threads(Users): 30\nRamp-Up period(in seconds) : 0\nLoop-Count : 1\n</code></pre>\n\n<p>and JedisPoolConfig with following configurations :</p>\n\n<pre><code>redis.sentinel.enable=true\nredis.sentinel.ip=localhost\nredis.sentinel.port=6379\nredis.instance.account.masterName=master\nredis.pool.max-active = 20\nredis.pool.max-idle = 10\n</code></pre>\n\n<p>with this code (which is created as Bean on startup of Spring Application) : </p>\n\n<pre><code>JedisConnectionFactory factory = new JedisConnectionFactory();\n        factory.setPort(port);\n        factory.setHostName(hostName);\n        factory.afterPropertiesSet();\n        factory.setUsePool(true);\n        JedisPoolConfig jedisPoolConfig = new JedisPoolConfig();\n        jedisPoolConfig.setMaxTotal(redisPoolMaxActive);\n        jedisPoolConfig.setMaxIdle(redisPoolMaxIdle);\n        factory.setPoolConfig(jedisPoolConfig);\n        return factory;\n</code></pre>\n\n<p>with this code for fetching new Connection everytime a Request comes : </p>\n\n<pre><code>@Autowired\nprivate JedisConnectionFactory redisConnectionFactory;\nprivate StringRedisSerializer stringRedisSerializer = new StringRedisSerializer();\nprivate RedisTemplate getNewConnection(){\n        RedisTemplate redisTemplate = new RedisTemplate();\n        redisTemplate.setConnectionFactory(redisConnectionFactory);\n        redisTemplate.setKeySerializer(stringRedisSerializer);\n        redisTemplate.setHashKeySerializer(stringRedisSerializer);\n        redisTemplate.setValueSerializer(stringRedisSerializer);\n        redisTemplate.afterPropertiesSet();\n        return redisTemplate;\n    }\n</code></pre>\n\n<p>Edit : my usage for redisTemplate for multi/exec inside Redis :</p>\n\n<pre><code>redisTemplate.setEnableTransactionSupport(true);\n\nredisTemplate.multi();\n\nfor (ArrayList&lt;Pair&lt;String, String&gt;&gt; pairs : keys){\n    for (Pair&lt;String,String&gt; pair: pairs)\n        redisTemplate.opsForHash().get(makeMap(pair.getFirst(), version) , pair.getSecond());\n}\n\nreturn redisTemplate.exec();\n</code></pre>\n\n<p>I successfully get the response for 20 requests but could not get the response for rest 10 requests. The issue I am facing is after 20 connections have been used by first 20 requests , the rest 10 requests are not able to get the jedis connection from the pool and thus I get the following exception : </p>\n\n<pre><code>    2017-10-06 17:38:11.753 ERROR 3539 --- [io-8080-exec-12] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.data.redis.RedisConnectionFailureException: Cannot get Jedis connection; nested exception is redis.clients.jedis.exceptions.JedisException: Could not get a resource from the pool] with root cause\n\njava.util.NoSuchElementException: Timeout waiting for idle object\n    at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:449) ~[commons-pool2-2.4.2.jar:2.4.2]\n    at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:363) ~[commons-pool2-2.4.2.jar:2.4.2]\n    at redis.clients.util.Pool.getResource(Pool.java:49) ~[jedis-2.9.0.jar:na]\n    at redis.clients.jedis.JedisPool.getResource(JedisPool.java:226) ~[jedis-2.9.0.jar:na]\n    at redis.clients.jedis.JedisPool.getResource(JedisPool.java:16) ~[jedis-2.9.0.jar:na]\n    at org.springframework.data.redis.connection.jedis.JedisConnectionFactory.fetchJedisConnector(JedisConnectionFactory.java:194) ~[spring-data-redis-1.8.6.RELEASE.jar:na]\n    at org.springframework.data.redis.connection.jedis.JedisConnectionFactory.getConnection(JedisConnectionFactory.java:348) ~[spring-data-redis-1.8.6.RELEASE.jar:na]\n    at org.springframework.data.redis.core.RedisConnectionUtils.doGetConnection(RedisConnectionUtils.java:129) ~[spring-data-redis-1.8.6.RELEASE.jar:na]\n    at org.springframework.data.redis.core.RedisConnectionUtils.bindConnection(RedisConnectionUtils.java:67) ~[spring-data-redis-1.8.6.RELEASE.jar:na]\n    at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:192) ~[spring-data-redis-1.8.6.RELEASE.jar:na]\n    at org.springframework.data.redis.core.RedisTemplate.execute(RedisTemplate.java:169) ~[spring-data-redis-1.8.6.RELEASE.jar:na]\n    at org.springframework.data.redis.core.RedisTemplate.multi(RedisTemplate.java:868) ~[spring-data-redis-1.8.6.RELEASE.jar:na]\n    at net.media.mml.redis.repository.RedisRepository.makeTransaction(RedisRepository.java:50) ~[max-data-0.0.1-SNAPSHOT.jar:0.0.1-SNAPSHOT]\n    at net.media.mml.redis.repository.RedisRepository.getFromRedis(RedisRepository.java:66) ~[max-data-0.0.1-SNAPSHOT.jar:0.0.1-SNAPSHOT]\n    at net.media.mml.service.DimensionGetter.getDimensions(DimensionGetter.java:64) ~[ml-api.jar:0.0.1-SNAPSHOT]\n    at net.media.mml.service.MLQueriesGetter.makeQueries(MLQueriesGetter.java:32) ~[ml-api.jar:0.0.1-SNAPSHOT]\n    at net.media.mml.controller.MaxQueryController.query(MaxQueryController.java:61) ~[ml-api.jar:0.0.1-SNAPSHOT]\n    at sun.reflect.GeneratedMethodAccessor270.invoke(Unknown Source) ~[na:na]\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_131]\n    at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_131]\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205) ~[spring-web-4.3.10.RELEASE.jar:4.3.10.RELEASE]\n</code></pre>\n\n<p>I have searched over the net but not able to find the solution to this. Can anybody help me? </p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}