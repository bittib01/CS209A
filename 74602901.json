{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "feature-flags"
    ],
    "owner": {
      "account_id": 4817502,
      "reputation": 124,
      "user_id": 3889179,
      "user_type": "registered",
      "accept_rate": 57,
      "profile_image": "https://www.gravatar.com/avatar/2e31c306cff99347988cd834e1a1263c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "tobes",
      "link": "https://stackoverflow.com/users/3889179/tobes"
    },
    "is_answered": false,
    "view_count": 265,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1764592222,
    "creation_date": 1669649388,
    "last_edit_date": 1671476713,
    "question_id": 74602901,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/74602901/java-spring-boot-application-to-toggle-between-data-sources-configuration-class",
    "title": "Java Spring Boot application to toggle between data sources (Configuration Classes)",
    "body": "<p>I have a Java Spring Boot application currently connected to an on premises database. I am trying to figure out how to toggle between the existing datasource and a new one I have added. I have both data sources added in the application yml and defined in 2 (Config classes). I want to add logic to determine which one to use, a simple if-statement.</p>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 952025,
        "reputation": 703,
        "user_id": 977959,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/98bad573a218d15db413dd8bd4682e75?s=256&d=identicon&r=PG",
        "display_name": "danipenaperez",
        "link": "https://stackoverflow.com/users/977959/danipenaperez"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1764592222,
      "last_edit_date": 1764592222,
      "creation_date": 1764591695,
      "answer_id": 79834811,
      "question_id": 74602901,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>Create a main unique DataSource Bean which extends <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/jdbc/datasource/lookup/AbstractRoutingDataSource.html\" rel=\"nofollow noreferrer\">AbstractRoutingDataSource</a></p>\n<p>The abstract Datasource can hold internal DataSource references using the method public <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/jdbc/datasource/lookup/AbstractRoutingDataSource.html#setTargetDataSources(java.util.Map)\" rel=\"nofollow noreferrer\">void setTargetDataSources(Map&lt;Object, Object&gt; targetDataSources)</a> .</p>\n<p>Dirty Code:</p>\n<pre><code> HashMap dataSourcesDriverMapping = new HashMap();\n dataSouceYAMLConfig.foreach(d-&gt;{\n        DriverManagerDataSource dataSource = new DriverManagerDataSource();\n        dataSource.setDriverClassName(d.databasePlatform);\n        dataSource.setUrl(d.getValue().getUrl());\n        dataSource.setUsername(d.getValue().getUsername());\n        dataSource.setPassword(d.getValue().getPassword());\n        dataSourcesDriverMapping.put(d.getKey(), dataSource); //Datasource1, Datasource2\n            \n })\n\n//Set internal hold Datasources Configurations        \ncustomDataSource.setTargetDataSources(dataSourcesDriverMapping);\n//Set first as default\ncustomDataSource.setCurrentDataSourceName(dataSourcesDriverMapping.keySet().iterator().next());\n</code></pre>\n<p>To switch the current thread DataSource execution , ask your featureFlags (the if/else statement that you said) service and then overwrite the determineCurrentLookupKey() at your AbstractRoutingDataSource extended DataSource bean to return the desired DataSource Reference based on your featureFlags Service response.</p>\n<p>Example dirty code:</p>\n<pre><code>@Slf4j\npublic class CustomRoutingDataSource extends AbstractRoutingDataSource {\n    \n    private FeatureFlagService ffService;\n    \n    @Override\n    protected Object determineCurrentLookupKey() {\n        return featureFlagsService.getFlagValue();  //Returns the key on DataSource Mapping-&gt; Map&lt;Object, Object&gt; targetDataSources\n        \n    }\n}\n\n\n</code></pre>\n<p>You can find simple example here <a href=\"https://stackoverflow.com\">https://www.baeldung.com/spring-abstract-routing-data-source</a></p>\n<p>If you want to get more flexible and extended bean flowing routing recently I have been working in Spring Boot project that is focused in bean dynamic routing. (Clean Code and flexible integrations). This is the link, <a href=\"https://github.com/danipenaperez/spring-boot-flowed-routing\" rel=\"nofollow noreferrer\">spring-boot-flowed-routing</a></p>\n"
    }
  ],
  "question_comments": [
    {
      "owner": {
        "account_id": 4817502,
        "reputation": 124,
        "user_id": 3889179,
        "user_type": "registered",
        "accept_rate": 57,
        "profile_image": "https://www.gravatar.com/avatar/2e31c306cff99347988cd834e1a1263c?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "tobes",
        "link": "https://stackoverflow.com/users/3889179/tobes"
      },
      "reply_to_user": {
        "account_id": 7358121,
        "reputation": 5543,
        "user_id": 5602214,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/FM5gL.jpg?s=256",
        "display_name": "Prashant",
        "link": "https://stackoverflow.com/users/5602214/prashant"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1671478730,
      "post_id": 74602901,
      "comment_id": 132103805,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 7358121,
        "reputation": 5543,
        "user_id": 5602214,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/FM5gL.jpg?s=256",
        "display_name": "Prashant",
        "link": "https://stackoverflow.com/users/5602214/prashant"
      },
      "edited": false,
      "score": 1,
      "creation_date": 1671477597,
      "post_id": 74602901,
      "comment_id": 132103523,
      "content_license": "CC BY-SA 4.0"
    }
  ],
  "answer_comments": {
    "79834811": []
  }
}