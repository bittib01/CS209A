{
  "question": {
    "tags": [
      "java",
      "json",
      "amazon-web-services",
      "amazon-dynamodb",
      "objectmapper"
    ],
    "owner": {
      "account_id": 11866151,
      "reputation": 789,
      "user_id": 8683646,
      "user_type": "registered",
      "accept_rate": 0,
      "profile_image": "https://www.gravatar.com/avatar/8005c41198f674be2f2fa7f730c12989?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "D.Zet",
      "link": "https://stackoverflow.com/users/8683646/d-zet"
    },
    "is_answered": true,
    "view_count": 37719,
    "answer_count": 5,
    "score": 13,
    "last_activity_date": 1765040622,
    "creation_date": 1513865584,
    "last_edit_date": 1513909400,
    "question_id": 47926783,
    "content_license": "CC BY-SA 3.0",
    "link": "https://stackoverflow.com/questions/47926783/aws-dynamodb-could-not-unconvert-attribute-error",
    "title": "AWS DynamoDB: Could not unconvert attribute error",
    "body": "<p>I have an issuse and I can't handle it. I've created CRUD methods for example in KitchenService. I have methods like addProduct etc and these works fine.. But I have Recipe class where I'm using Product class field.. In this case I have huge problems. </p>\n\n<p>My addRecipe method:</p>\n\n<pre><code>public Recipe addRecipe (Recipe recipe){\n\n    List&lt;RecipeElement&gt; recipeElements = recipe.getRecipeElements();\n    for (RecipeElement recipeElement : recipeElements) {\n        String id = recipeElement.getProduct().getId();\n        Product product = databaseController.get(Product.class, id);\n        recipeElement.setProduct(product);\n    }\n\n    databaseController.saveRecipe(recipe);\n    logger.log(\"Recipe created\");\n\n    return recipe;\n</code></pre>\n\n<p>Build succesfull so I want to test it in POSTMAN, that's how look JSON witch I'm sending:</p>\n\n<pre><code>{\"id\":null,\"name\":\"test3\",\"labels\":[\"GLUTEN_FREE\"],\"author\":{\"name\":\"Plejer Annołn\",\"id\":\"testID2\"},\"media\":{\"name\":\"heheszki\",\"url\":\"http://blabla.pl\",\"mediaType\":\"IMAGE\"},\"recipeElements\":[{\"product\":{\"id\":\"ecacaf36-29a2-41c6-942e-be5a715ed094\"},\"weight\":\"100\"}],\"approved\":false}\n</code></pre>\n\n<p>And then I get \"message\": \"Internal server error\" so I'm checking logs, that's what I found there:</p>\n\n<pre><code>Product[Media]; could not unconvert attribute: com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMappingException\n\nCaused by: com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMappingException: could not invoke public void pl.javamill.model.kitchen.Product.setMedia(pl.javamill.model.common.Media) on class pl.kitchen.Product with value {name=heheszki, url=http://blabla.pl, mediaType=IMAGE} of type class java.util.LinkedHashMap\n</code></pre>\n\n<p>This is how look Recipe Class:</p>\n\n<pre><code>@DynamoDBTable(tableName = \"recipe\")\npublic class Recipe extends Request {\n/**\n * Id of kitchen content\n */\nprivate String id;\n/**\n * Name of recipe\n */\nprivate String name;\n\n/**\n * Labels of product for example gluten fee product\n */\nprivate List&lt;KitchenLabel&gt; labels;\n\n/**\n * Author of content.\n */\nprivate Author author;\n\n/**\n * Address of content image.\n */\nprivate Media media;\n\nprivate Boolean approved;\n\nprivate List&lt;RecipeElement&gt; recipeElements;\n\n@DynamoDBHashKey(attributeName = \"id\")\n@DynamoDBAutoGeneratedKey\npublic String getId() {\n    return id;\n}\n\npublic void setId(String id) {\n    this.id = id;\n}\n\n@DynamoDBAttribute(attributeName = \"Name\")\npublic String getName() {\n    return name;\n}\n\npublic void setName(String name) {\n    this.name = name;\n}\n\n@DynamoDBTypeConverted(converter = EnumConverter.class)\n@DynamoDBAttribute(attributeName = \"Labels\")\npublic List&lt;KitchenLabel&gt; getLabels() {\n    return labels;\n}\n\npublic void setLabels(List&lt;KitchenLabel&gt; labels) {\n    this.labels = labels;\n}\n\n@DynamoDBTypeConverted(converter = ObjectConverter.class)\n@DynamoDBAttribute(attributeName = \"Author\")\npublic Author getAuthor() {\n    return author;\n}\n\npublic void setAuthor(Author author) {\n    this.author = author;\n}\n\n@DynamoDBTypeConverted(converter = ObjectConverter.class)\n@DynamoDBAttribute(attributeName = \"Media\")\npublic Media getMedia() {\n    return media;\n}\n\npublic void setMedia(Media media) {\n    this.media = media;\n}\n\n@DynamoDBAttribute(attributeName = \"Approved\")\npublic Boolean getApproved() {\n    return approved;\n}\n\npublic void setApproved(Boolean approved) {\n    this.approved = approved;\n}\n\n@DynamoDBTypeConverted(converter = ObjectConverter.class)\n@DynamoDBAttribute(attributeName = \"RecipeElements\")\npublic List&lt;RecipeElement&gt; getRecipeElements() {\n    return recipeElements;\n}\n\npublic void setRecipeElements(List&lt;RecipeElement&gt; recipeElements) {\n    this.recipeElements = recipeElements;\n}\n</code></pre>\n\n<p>RecipeElement class:</p>\n\n<pre><code>public class RecipeElement {\n\n\nprivate Product product;\nprivate Integer weight;\n\n@DynamoDBTypeConverted(converter = ObjectConverter.class)\n@DynamoDBHashKey(attributeName = \"product\")\npublic Product getProduct() {\n    return product;\n}\n\npublic void setProduct(Product product) {\n        this.product = product;\n    }\n\n    public Integer getWeight() {\n        return weight;\n    }\n\n    public void setWeight(Integer weight) {\n        this.weight = weight;\n    }\n}\n</code></pre>\n\n<p>And Product class:</p>\n\n<pre><code>@DynamoDBTable(tableName = \"product\")\npublic class Product extends Request {\n    /**\n     * Id of kitchen content\n     */\n    private String id;\n\n    /**\n     * Name of product\n     */\n    private String name;\n\n    /**\n     * Calories in 100g\n     */\n    private Integer calories;\n\n    /**\n     * Fat in 100g\n     */\n    private Double fat;\n\n    /**\n     * Total carbo in 100g\n     */\n    private Double carbo;\n\n    /**\n     * Total Protein in 100g\n     */\n    private Double protein;\n\n    /**\n     * Labels of product for example gluten fee product\n     */\n    private List&lt;ProductKind&gt; productKinds;\n\n    /**\n     * Author of content.\n     */\n    private Author author;\n\n    /**\n     * Address of content image.\n     */\n    private Media media;\n\n    private Boolean approved;\n\n    @DynamoDBHashKey(attributeName = \"id\")\n    @DynamoDBAutoGeneratedKey\n    public String getId() {\n        return id;\n    }\n\n    public void setId(String id) {\n        this.id = id;\n    }\n\n    @DynamoDBAttribute(attributeName = \"Name\")\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    @DynamoDBAttribute(attributeName = \"Calories\")\n    public Integer getCalories() {\n        return calories;\n    }\n\n    public void setCalories(Integer calories) {\n        this.calories = calories;\n    }\n\n    @DynamoDBAttribute(attributeName = \"Fat\")\n    public Double getFat() {\n        return fat;\n    }\n\n    public void setFat(Double fat) {\n        this.fat = fat;\n    }\n\n    @DynamoDBAttribute(attributeName = \"Carbo\")\n    public Double getCarbo() {\n        return carbo;\n    }\n\n    public void setCarbo(Double carbo) {\n        this.carbo = carbo;\n    }\n\n    @DynamoDBAttribute(attributeName = \"Protein\")\n    public Double getProtein() {\n        return protein;\n    }\n\n    public void setProtein(Double protein) {\n        this.protein = protein;\n    }\n\n    @DynamoDBTypeConverted(converter = EnumConverter.class)\n    @DynamoDBAttribute(attributeName = \"ProductKinds\")\n    public List&lt;ProductKind&gt; getProductKinds() {\n        return productKinds;\n    }\n\n    public void setProductKinds(List&lt;ProductKind&gt; productKinds) {\n        this.productKinds = productKinds;\n    }\n\n    @DynamoDBTypeConverted(converter = ObjectConverter.class)\n    @DynamoDBAttribute(attributeName = \"Author\")\n    public Author getAuthor() {\n        return author;\n    }\n\n    public void setAuthor(Author author) {\n        this.author = author;\n    }\n\n    @DynamoDBTypeConverted(converter = ObjectConverter.class)\n    @DynamoDBAttribute(attributeName = \"Media\")\n    public Media getMedia() {\n        return media;\n    }\n\n    public void setMedia(Media media) {\n        this.media = media;\n    }\n\n    @DynamoDBAttribute(attributeName = \"Approved\")\n    public Boolean getApproved() {\n        return approved;\n    }\n\n    public void setApproved(Boolean approved) {\n        this.approved = approved;\n    }\n</code></pre>\n\n<p>And this is my converter class:</p>\n\n<pre><code>public class ObjectConverter&lt;T extends Object&gt; \nimplements DynamoDBTypeConverter&lt;String, T&gt; {\n\n    ObjectMapper objectMapper = new ObjectMapper();\n\n    @Override\n    public String convert(T object) {\n        try {\n            return objectMapper.writeValueAsString(object);\n        } catch (JsonProcessingException e) {\n            e.printStackTrace();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        throw new IllegalArgumentException(\"Unable to parse JSON\");\n    }\n\n    @Override\n    public T unconvert(String object) {\n        try {\n            T unconvertedObject = objectMapper.readValue(object, \n                new TypeReference&lt;T&gt;() {\n            });\n            return unconvertedObject;\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n}\n</code></pre>\n\n<p>Can someone help me with this issue?</p>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 4528798,
        "reputation": 11857,
        "user_id": 3679900,
        "user_type": "registered",
        "accept_rate": 48,
        "profile_image": "https://i.sstatic.net/tFAHl.png?s=256",
        "display_name": "y2k-shubham",
        "link": "https://stackoverflow.com/users/3679900/y2k-shubham"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1765040622,
      "creation_date": 1765040622,
      "answer_id": 79839812,
      "question_id": 47926783,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I ran into this exact same issue recently and wanted to share what fixed it for me.</p>\n<h3>The Problem</h3>\n<p>We added a new field to our DynamoDB model and started getting this error in production:</p>\n<pre><code>DynamoDBMappingException: UserRecord[ExpirationTimestamp]; could not unconvert attribute\n    at com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapperTableModel.unconvert(DynamoDBMapperTableModel.java:271)\n    at com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapper.privateMarshallIntoObject(DynamoDBMapper.java:478)\n    at com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapper.load(DynamoDBMapper.java:444)\nCaused by: DynamoDBMappingException: could not invoke null on class com.company.myservice.model.UserRecord with value 1765024084 of type class java.lang.Long\n</code></pre>\n<h3>What I was doing wrong</h3>\n<p>I had added a getter method with the <code>@DynamoDBAttribute</code> annotation but completely forgot to add the setter:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@DynamoDBAttribute(attributeName = &quot;ExpirationTimestamp&quot;)\n@DoNotEncrypt\npublic long getExpirationTimestamp() {\n    return this.creation + DEFAULT_TTL;\n}\n// Oops - no setter method!\n</code></pre>\n<p>Turns out when DynamoDB tries to load/deserialize records, it needs to call the setter method. Since I didn't have one, it was trying to call null → hence the &quot;could not invoke null&quot; error.</p>\n<h3>The fix</h3>\n<p>Just added the missing setter method:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@DynamoDBAttribute(attributeName = &quot;ExpirationTimestamp&quot;)\n@DoNotEncrypt\npublic long getExpirationTimestamp() {\n    return this.creation + DEFAULT_TTL;\n}\n\npublic void setExpirationTimestamp(final long expirationTimestamp) {\n    // no-op since this is a computed field\n}\n</code></pre>\n<p>Even though my field is computed (I don't actually want to store the value that gets passed in), I still need the setter method for DynamoDB to work properly.</p>\n<h3>Why this happens</h3>\n<p>According to the <a href=\"https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/datamodeling/DynamoDBMapper.html\" rel=\"nofollow noreferrer\">AWS SDK docs</a>, each property needs both getter and setter methods.</p>\n<p>I also found similar issues reported on <a href=\"https://github.com/aws/aws-sdk-java/issues/1096\" rel=\"nofollow noreferrer\">GitHub</a> and other places that confirm you need both methods.</p>\n"
    },
    {
      "owner": {
        "account_id": 22531657,
        "reputation": 13,
        "user_id": 16723586,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/f7cf53bd8e67338b36d086f48477edfa?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "Kiznet007",
        "link": "https://stackoverflow.com/users/16723586/kiznet007"
      },
      "is_accepted": false,
      "score": -1,
      "last_activity_date": 1665505253,
      "creation_date": 1665505253,
      "answer_id": 74031216,
      "question_id": 47926783,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I had the same issue with the error discussed in this posted question. I was failing one test in my integration tests for my Controller class. I basically followed what @Tom Ben Gal said in their answer and I got it working. All I did was placed a no-arg constructor in my Record class and regenerated the setters and getters for the property that was throwing the error in my Record class. Now my integration tests pass on both AWS and Vocareum. Thanks @Tom Ben Gal</p>\n"
    }
  ],
  "question_comments": [],
  "answer_comments": {
    "79839812": [
      {
        "owner": {
          "account_id": 4528798,
          "reputation": 11857,
          "user_id": 3679900,
          "user_type": "registered",
          "accept_rate": 48,
          "profile_image": "https://i.sstatic.net/tFAHl.png?s=256",
          "display_name": "y2k-shubham",
          "link": "https://stackoverflow.com/users/3679900/y2k-shubham"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1765040811,
        "post_id": 79839812,
        "comment_id": 140890534,
        "content_license": "CC BY-SA 4.0"
      }
    ],
    "74031216": []
  }
}