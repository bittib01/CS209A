{
  "question": {
    "tags": [
      "java",
      "java-native-interface",
      "native",
      "keyword"
    ],
    "owner": {
      "account_id": 228170,
      "reputation": 16601,
      "user_id": 490315,
      "user_type": "registered",
      "accept_rate": 94,
      "profile_image": "https://i.sstatic.net/rEBlR9fk.jpg?s=256",
      "display_name": "whirlwin",
      "link": "https://stackoverflow.com/users/490315/whirlwin"
    },
    "is_answered": true,
    "view_count": 266163,
    "accepted_answer_id": 6101324,
    "answer_count": 10,
    "score": 550,
    "last_activity_date": 1707592780,
    "creation_date": 1306175385,
    "last_edit_date": 1466360778,
    "question_id": 6101311,
    "content_license": "CC BY-SA 3.0",
    "link": "https://stackoverflow.com/questions/6101311/what-is-the-native-keyword-in-java-for",
    "title": "What is the native keyword in Java for?",
    "body": "<p>While playing <a href=\"http://www.sporcle.com/games/robv/java_keywords\">this puzzle</a> (It's a Java keyword trivia game), I came across the <code>native</code> keyword.</p>\n\n<p>What is the native keyword in Java used for?</p>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 481416,
        "reputation": 392690,
        "user_id": 895245,
        "user_type": "registered",
        "accept_rate": 49,
        "profile_image": "https://i.sstatic.net/5Powi.jpg?s=256",
        "display_name": "Ciro Santilli OurBigBook.com",
        "link": "https://stackoverflow.com/users/895245/ciro-santilli-ourbigbook-com"
      },
      "is_accepted": false,
      "score": 545,
      "last_activity_date": 1707592780,
      "last_edit_date": 1707592780,
      "creation_date": 1433396902,
      "answer_id": 30635871,
      "question_id": 6101311,
      "content_license": "CC BY-SA 4.0",
      "body": "<p><strong>Minimal runnable example</strong></p>\n<p>Main.java</p>\n<pre><code>public class Main {\n    public native int square(int i);\n    public static void main(String[] args) {\n        System.loadLibrary(&quot;Main&quot;);\n        System.out.println(new Main().square(2));\n    }\n}\n</code></pre>\n<p>Main.c</p>\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;jni.h&gt;\n#include &quot;Main.h&quot;\n\nJNIEXPORT jint JNICALL Java_Main_square(\n    JNIEnv *env, jobject obj, jint i) {\n  return i * i;\n}\n</code></pre>\n<p>Compile and run:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>sudo apt-get install build-essential openjdk-7-jdk\nexport JAVA_HOME='/usr/lib/jvm/java-7-openjdk-amd64'\njavac Main.java\njavah -jni Main\ngcc -shared -fpic -o libMain.so -I${JAVA_HOME}/include \\\n  -I${JAVA_HOME}/include/linux Main.c\njava -Djava.library.path=. Main\n</code></pre>\n<p>Output:</p>\n<pre class=\"lang-none prettyprint-override\"><code>4\n</code></pre>\n<p>Tested on Ubuntu 14.04 AMD64. Also worked with Oracle JDK 1.8.0_45.</p>\n<p><a href=\"https://github.com/cirosantilli/java-cheat/tree/77437774e632ba6ecb483f6e69726431a23b5808/jni\" rel=\"noreferrer\">Example on GitHub</a> for you to play with.</p>\n<p>Underscores in Java package / file names must be escaped with <code>_1</code> in the C function name as mentioned at: <a href=\"https://stackoverflow.com/questions/16069209/invoking-jni-functions-in-android-package-name-containing-underscore/35015592#35015592\">Invoking JNI functions in Android package name containing underscore</a></p>\n<p><strong>Interpretation</strong></p>\n<p><code>native</code> allows you to:</p>\n<ul>\n<li>call a compiled dynamically loaded library (here written in C) with arbitrary assembly code from Java</li>\n<li>and get results back into Java</li>\n</ul>\n<p>This could be used to:</p>\n<ul>\n<li>write faster code on a critical section with better CPU assembly instructions (not CPU portable)</li>\n<li>make direct system calls (not OS portable)</li>\n</ul>\n<p>with the tradeoff of lower portability.</p>\n<p>It is also possible for you to call Java from C, but you must first create a JVM in C: <a href=\"https://stackoverflow.com/questions/819536/how-to-call-java-function-from-c\">How to call Java functions from C++?</a></p>\n<p>Analogous native extension APIs are also present in many other &quot;VM languages&quot; for the same reasons, e.g. <a href=\"https://docs.python.org/3/c-api/index.html\" rel=\"noreferrer\">Python</a>, <a href=\"https://nodejs.org/api/addons.html\" rel=\"noreferrer\">Node.js</a>, <a href=\"https://docs.ruby-lang.org/en/2.4.0/extension_rdoc.html\" rel=\"noreferrer\">Ruby</a>.</p>\n<p><strong>Android NDK</strong></p>\n<p>The concept is exact the same in this context, except that you have to use Android boilerplate to set it up.</p>\n<p>The official NDK repository contains &quot;canonical&quot; examples such as the hello-jni app:</p>\n<ul>\n<li><a href=\"https://github.com/googlesamples/android-ndk/blob/4df5a2705e471a0818c6b2dbc26b8e315d89d307/hello-jni/app/src/main/java/com/example/hellojni/HelloJni.java#L39\" rel=\"noreferrer\">https://github.com/googlesamples/android-ndk/blob/4df5a2705e471a0818c6b2dbc26b8e315d89d307/hello-jni/app/src/main/java/com/example/hellojni/HelloJni.java#L39</a></li>\n<li><a href=\"https://github.com/googlesamples/android-ndk/blob/4df5a2705e471a0818c6b2dbc26b8e315d89d307/hello-jni/app/src/main/cpp/hello-jni.c#L27\" rel=\"noreferrer\">https://github.com/googlesamples/android-ndk/blob/4df5a2705e471a0818c6b2dbc26b8e315d89d307/hello-jni/app/src/main/cpp/hello-jni.c#L27</a></li>\n</ul>\n<p>In you <code>unzip</code> an <code>.apk</code> with NDK on Android O, you can see the pre-compiled <code>.so</code> that corresponds to the native code under <code>lib/arm64-v8a/libnative-lib.so</code>.</p>\n<p>TODO confirm: furthermore, <code>file /data/app/com.android.appname-*/oat/arm64/base.odex</code>, says it is a shared library, which I think is the AOT precompiled .dex corresponding to the Java files in ART, see also: <a href=\"https://stackoverflow.com/questions/9593527/what-are-odex-files-in-android\">What are ODEX files in Android?</a> So maybe the Java is actually also run via a <code>native</code> interface?</p>\n<p><strong>Example in the OpenJDK 8</strong></p>\n<p>Let's find find where <code>Object#clone</code> is defined in jdk8u60-b27.</p>\n<p>We will conclude that it is implemented with a <code>native</code> call.</p>\n<p>First we find:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>find . -name Object.java\n</code></pre>\n<p>which leads us to <a href=\"http://hg.openjdk.java.net/jdk8u/jdk8u60/jdk/file/afbc08ea922b/src/share/classes/java/lang/Object.java#l212\" rel=\"noreferrer\">jdk/src/share/classes/java/lang/Object.java#l212</a>:</p>\n<pre><code>protected native Object clone() throws CloneNotSupportedException;\n</code></pre>\n<p>Now comes the hard part, finding where clone is amidst all the indirection. The query that helped me was:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>find . -iname object.c\n</code></pre>\n<p>which would find either C or C++ files that might implement Object's native methods. It leads us to <a href=\"http://hg.openjdk.java.net/jdk8u/jdk8u60/jdk/file/afbc08ea922b/src/share/native/java/lang/Object.c#l47\" rel=\"noreferrer\">jdk/share/native/java/lang/Object.c#l47</a>:</p>\n<pre class=\"lang-c prettyprint-override\"><code>static JNINativeMethod methods[] = {\n    ...\n    {&quot;clone&quot;,       &quot;()Ljava/lang/Object;&quot;,   (void *)&amp;JVM_Clone},\n};\n\nJNIEXPORT void JNICALL\nJava_java_lang_Object_registerNatives(JNIEnv *env, jclass cls)\n{\n    (*env)-&gt;RegisterNatives(env, cls,\n                            methods, sizeof(methods)/sizeof(methods[0]));\n}\n</code></pre>\n<p>which leads us to the <code>JVM_Clone</code> symbol:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>grep -R JVM_Clone\n</code></pre>\n<p>which leads us to <a href=\"http://hg.openjdk.java.net/jdk8u/jdk8u60/hotspot/file/10ad4b9d79f9/src/share/vm/prims/jvm.cpp#l580\" rel=\"noreferrer\">hotspot/src/share/vm/prims/jvm.cpp#l580</a>:</p>\n<pre class=\"lang-cpp prettyprint-override\"><code>JVM_ENTRY(jobject, JVM_Clone(JNIEnv* env, jobject handle))\n    JVMWrapper(&quot;JVM_Clone&quot;);\n</code></pre>\n<p>After expanding a bunch of macros, we come to the conclusion that this is the definition point.</p>\n"
    }
  ],
  "question_comments": [],
  "answer_comments": {
    "30635871": [
      {
        "owner": {
          "account_id": 29964239,
          "reputation": 515,
          "user_id": 22963183,
          "user_type": "registered",
          "profile_image": "https://lh3.googleusercontent.com/a/ACg8ocI5BTS-lDd1gp3CHh6_2Pg8za9zjLOG4m_Fw9yDti_V=k-s256",
          "display_name": "happy",
          "link": "https://stackoverflow.com/users/22963183/happy"
        },
        "edited": false,
        "score": 2,
        "creation_date": 1729963841,
        "post_id": 30635871,
        "comment_id": 139528732,
        "content_license": "CC BY-SA 4.0"
      }
    ]
  }
}