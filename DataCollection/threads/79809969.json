{
  "question": {
    "tags": [
      "java",
      "arrays",
      "generics",
      "comparator",
      "classcastexception"
    ],
    "owner": {
      "account_id": 23597695,
      "reputation": 11,
      "user_id": 17634642,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/OVsQC.jpg?s=256",
      "display_name": "Raam",
      "link": "https://stackoverflow.com/users/17634642/raam"
    },
    "is_answered": false,
    "view_count": 118,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1762424015,
    "creation_date": 1762342036,
    "last_edit_date": 1762359350,
    "question_id": 79809969,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79809969/classcastexception-when-comparing-elements-in-custom-arrayorderedlist-using-comp",
    "title": "ClassCastException when comparing elements in custom ArrayOrderedList using Comparator",
    "body": "<p>I am implementing an ordered list that automatically inserts elements in the correct sorted position using a Comparator. The list is built from scratch (not using java.util.ArrayList) and uses an internal raw array.</p>\n<p>Here is the base list implementation:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class ArrayList&lt;T&gt; implements ListADT&lt;T&gt; {\n    protected T[] array;\n    protected int count;\n    private static final int DEFAULT_CAPACITY = 10;\n\n    @SuppressWarnings(&quot;unchecked&quot;)\n    public ArrayList() {\n        array = (T[]) (new Object[DEFAULT_CAPACITY]); // internal storage\n        count = 0;\n    }\n\n    protected void expandCapacity() {\n        array = java.util.Arrays.copyOf(array, array.length * 2);\n    }\n}\n\n</code></pre>\n<p>And here is the ordered version:</p>\n<pre class=\"lang-java prettyprint-override\"><code>\npublic class ArrayOrderedList&lt;T&gt; extends ArrayList&lt;T&gt; implements OrderedListADT&lt;T&gt; {\n\n    private Comparator&lt;T&gt; comparator;\n\n    public ArrayOrderedList(Comparator&lt;T&gt; comparator) {\n        this.comparator = comparator;\n    }\n\n    @Override\n    public void add(T element) {\n        if (count == array.length)\n            expandCapacity();\n\n        int i = 0;\n\n        // The error occurs here:\n        while (i &lt; count &amp;&amp; comparator.compare(element, array[i]) &gt; 0) {\n            i++;\n        }\n\n        for (int j = count; j &gt; i; j--) {\n            array[j] = array[j - 1];\n        }\n\n        array[i] = element;\n        count++;\n    }\n}\n\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public interface OrderedListADT&lt;T&gt; extends ListADT&lt;T&gt; {\n\npublic void add(T element);\n\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public interface ListADT&lt;T&gt;  extends Iterable&lt;T&gt;{\n\n    public T removeFirst();\n\n    public T removeLast();\n\n    public T remove( T Object);\n    public T first();\n\n    public T last();\n\n    public boolean contains(T target);\n\n    public boolean isEmpty();\n\n    public int size();\n\n    public Iterator&lt;T&gt; iterator();\n\n    public String toString();\n\n\n}\n</code></pre>\n<p>Demo code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class ArrayOrderedListDemo {\n    public static void main(String[] args) {\n        ArrayOrderedList&lt;Integer&gt; array1 = new ArrayOrderedList&lt;&gt;(Comparator.naturalOrder());\n        array1.add(2);\n        array1.add(5);\n        array1.add(4);\n        array1.add(1);\n    }\n}\n\n\n\n</code></pre>\n<p>Expected behavior</p>\n<p>I expect the elements to be inserted in sorted ascending order, for example:</p>\n<p>[1, 2, 4, 5]</p>\n<p>Actual Runtime Error</p>\n<pre><code>Exception in thread &quot;main&quot; java.lang.ClassCastException:\nclass [Ljava.lang.Object; cannot be cast to class [Ljava.lang.Comparable;\n([Ljava.lang.Object; and [Ljava.lang.Comparable; are in module java.base of loader 'bootstrap')\n    at OrderedList.ArrayOrderedList.add(ArrayOrderedList.java:14)\n    at OrderedList.ArrayOrderedListDemo.main(ArrayOrderedListDemo.java:10)\n</code></pre>\n<p>What I understand so far</p>\n<p>This happens because the internal array is actually an Object[] but the comparison operation indirectly expects the stored elements to be in a Comparable[] (even though I am using a Comparator).</p>\n<p>Constraints</p>\n<p>This is an academic exercise where:</p>\n<p>The list must be implemented from scratch.</p>\n<p>I cannot use java.util.ArrayList.</p>\n<p>I cannot use reflection or Array.newInstance(...).</p>\n<p>I must store elements in a generic array like this:</p>\n<p>array = (T[]) new Object[n];</p>\n<p>My Question</p>\n<p>How can I safely compare elements using a Comparator when they are stored in an Object[], without converting the internal array into a Comparable[], and without using reflection?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}