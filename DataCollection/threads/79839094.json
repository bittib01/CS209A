{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "mockito"
    ],
    "owner": {
      "account_id": 16866055,
      "reputation": 11,
      "user_id": 12195739,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAeLmW9XcQzHxvnxr8lzn-8SqbnNO6HxO5ydFp-5g=k-s256",
      "display_name": "Roman Gajardo Robles",
      "link": "https://stackoverflow.com/users/12195739/roman-gajardo-robles"
    },
    "is_answered": false,
    "view_count": 52,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1765060727,
    "creation_date": 1764951052,
    "last_edit_date": 1764957988,
    "question_id": 79839094,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79839094/classcastexception-monovoid-unit-test-java",
    "title": "ClassCastException Mono&lt;Void&gt; unit test Java",
    "body": "<p>i have the method in springboot that consume a endpoint</p>\n<pre class=\"lang-java prettyprint-override\"><code>public Mono&lt;Void&gt; mesaVisadoCalculadoraNotificar(NotificarIn in) {\n        setTimeoutErrorCode(&quot;MVC-01&quot;);\n        return Mono.fromCallable(() -&gt; {\n            WebTarget path = target.path(MesaVisadoCalculadora.NOTIFICAR.getUri());\n            \n            return restHelper.performRequest(path, in, new GenericType&lt;Void&gt;(){}, HttpAction.POST);\n        });\n    }\n}\n</code></pre>\n<p>and this test</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Test\npublic void mesavisadoCalculadoraNotificaTest(){\n    when(target.path(Mockito.anyString())).thenReturn(target);\n    when(restHelper.performRequest(Mockito.any(WebTarget.class), Mockito.any(), Mockito.any(GenericType.class),Mockito.any(HttpAction.class))).thenReturn(Mono.empty());\n\n    Mono&lt;Void&gt; promise = agent.mesaVisadoCalculadoraNotificar(in);\n    promise.block()\n    Assertions.assertNotNull(promise);\n   \n\n}\n</code></pre>\n<p>but in the line promise.block() return ClassCastException, any idea what it might be,</p>\n<p>this is a error in console:</p>\n<pre class=\"lang-none prettyprint-override\"><code>MesavisadoCalculadoraAgentTest &gt; mesavisadoCalculadoraNotificaTest() FAILED\n    java.lang.ClassCastException at MesavisadoCalculadoraAgentTest.java:65\n\njava.lang.ClassCastException: reactor.core.publisher.MonoIgnorePublisher cannot be cast to java.lang.Void\n    at infrastructure.agent.apimesavisadocalculadora.MesaVisadoCalculadoraAgent.lambda$mesaVisadoCalculadoraNotificar$0(MesaVisadoCalculadoraAgent.java:45)\n    at reactor.core.publisher.MonoCallable.block(MonoCallable.java:81)\n    at reactor.core.publisher.MonoCallable.block(MonoCallable.java:74)\n    at infrastructure.agent.apimesavisadocalculadora.MesavisadoCalculadoraAgentTest.mesavisadoCalculadoraNotificaTest(MesavisadoCalculadoraAgentTest.java:65)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:686)\n    at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)\n</code></pre>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 20338,
        "reputation": 65322,
        "user_id": 48503,
        "user_type": "registered",
        "accept_rate": 100,
        "profile_image": "https://www.gravatar.com/avatar/672f798341250dd228b286738e8d6309?s=256&d=identicon&r=PG",
        "display_name": "Luke Woodward",
        "link": "https://stackoverflow.com/users/48503/luke-woodward"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1765060727,
      "last_edit_date": 1765060727,
      "creation_date": 1764959811,
      "answer_id": 79839217,
      "question_id": 79839094,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I think the problem is that:</p>\n<ul>\n<li>you are setting up your <code>restClient.performRequest</code> method to return a <code>Mono&lt;Void&gt;</code>,</li>\n<li>if you have a callable that returns a value of type <code>T</code>, then wrapping this callable in  <code>Mono.fromCallable(...)</code> returns a value of type <code>Mono&lt;T&gt;</code>.</li>\n</ul>\n<p>If you want <code>Mono.fromCallable(...)</code> to return <code>Mono&lt;Void&gt;</code>, then the callable needs to return <code>Void</code>. Therefore, the inner callable should return <code>null</code> rather than a <code>Mono</code>.</p>\n<p>Try replacing the <code>Mono.empty()</code> in your mock setup with <code>null</code>.</p>\n<p><em>Disclaimer: I haven't tested this.</em></p>\n"
    }
  ],
  "question_comments": [
    {
      "owner": {
        "account_id": 16866055,
        "reputation": 11,
        "user_id": 12195739,
        "user_type": "registered",
        "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAeLmW9XcQzHxvnxr8lzn-8SqbnNO6HxO5ydFp-5g=k-s256",
        "display_name": "Roman Gajardo Robles",
        "link": "https://stackoverflow.com/users/12195739/roman-gajardo-robles"
      },
      "reply_to_user": {
        "account_id": 6095312,
        "reputation": 35076,
        "user_id": 4756299,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/6fe43a9d31f2308c4e64a62cf0c310d1?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "Andrew Henle",
        "link": "https://stackoverflow.com/users/4756299/andrew-henle"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1764955177,
      "post_id": 79839094,
      "comment_id": 140889439,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 6095312,
        "reputation": 35076,
        "user_id": 4756299,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/6fe43a9d31f2308c4e64a62cf0c310d1?s=256&d=identicon&r=PG&f=y&so-version=2",
        "display_name": "Andrew Henle",
        "link": "https://stackoverflow.com/users/4756299/andrew-henle"
      },
      "edited": false,
      "score": 1,
      "creation_date": 1764953797,
      "post_id": 79839094,
      "comment_id": 140889405,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 16866055,
        "reputation": 11,
        "user_id": 12195739,
        "user_type": "registered",
        "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAeLmW9XcQzHxvnxr8lzn-8SqbnNO6HxO5ydFp-5g=k-s256",
        "display_name": "Roman Gajardo Robles",
        "link": "https://stackoverflow.com/users/12195739/roman-gajardo-robles"
      },
      "reply_to_user": {
        "account_id": 1535561,
        "reputation": 9056,
        "user_id": 1431720,
        "user_type": "registered",
        "accept_rate": 89,
        "profile_image": "https://www.gravatar.com/avatar/f5a1388d4d3b2bf03b11bb5658c68c29?s=256&d=identicon&r=PG",
        "display_name": "Robert",
        "link": "https://stackoverflow.com/users/1431720/robert"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1764953673,
      "post_id": 79839094,
      "comment_id": 140889401,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 1535561,
        "reputation": 9056,
        "user_id": 1431720,
        "user_type": "registered",
        "accept_rate": 89,
        "profile_image": "https://www.gravatar.com/avatar/f5a1388d4d3b2bf03b11bb5658c68c29?s=256&d=identicon&r=PG",
        "display_name": "Robert",
        "link": "https://stackoverflow.com/users/1431720/robert"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1764952141,
      "post_id": 79839094,
      "comment_id": 140889371,
      "content_license": "CC BY-SA 4.0"
    }
  ],
  "answer_comments": {
    "79839217": []
  }
}