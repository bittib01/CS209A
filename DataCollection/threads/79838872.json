{
  "question": {
    "tags": [
      "java",
      "javafx",
      "javafx-8"
    ],
    "owner": {
      "account_id": 10187542,
      "reputation": 2675,
      "user_id": 20692967,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/NZSXm.jpg?s=256",
      "display_name": "Sergey Zolotarev",
      "link": "https://stackoverflow.com/users/20692967/sergey-zolotarev"
    },
    "is_answered": true,
    "view_count": 71,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1764968329,
    "creation_date": 1764937122,
    "last_edit_date": 1764954417,
    "question_id": 79838872,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79838872/nested-javafx-services",
    "title": "Nested JavaFX Services",
    "body": "<p>Here's a simplistic form for &quot;saving&quot; DB connection settings.</p>\n<ol>\n<li>It has two fields: URL and password. Valid credentials are &quot;test&quot; and &quot;test&quot;.</li>\n<li>It has two buttons: &quot;Test connection&quot; and &quot;Save&quot;.</li>\n<li>&quot;Test connection&quot; attempts to connect using provided credentials (that is, imagine it does). If they are not, then the fields get outlined in red.</li>\n<li>&quot;Save&quot; first tests the connection and, if successful, saves the settings.</li>\n</ol>\n<p>Important: testing connection can be done clicking either button, but saving must be performed only on clicking &quot;Save&quot;.</p>\n<h1>Approach #1</h1>\n<p>I can declare two separate <code>Service</code>s. It means the saving listener is not activated on testing. However, the connection failure handling (red outlining) must either be duplicated in the save listener or be missing (in my MRE it's missing). In the real application, the testing functionality belongs to a child component's scope (imagine the testing button would be inside some container with a tiny spinner to boot that reflected the test status, for example). It would be a bit weird if my form would be nosing around in the child component's scope repeating the same failure handling.</p>\n<pre class=\"lang-java prettyprint-override\"><code>import javafx.application.Application;\nimport javafx.concurrent.Service;\nimport javafx.concurrent.WorkerStateEvent;\nimport javafx.css.PseudoClass;\nimport javafx.geometry.Insets;\nimport javafx.geometry.Pos;\nimport javafx.scene.Parent;\nimport javafx.scene.Scene;\nimport javafx.scene.control.Button;\nimport javafx.scene.control.Label;\nimport javafx.scene.control.TextField;\nimport javafx.scene.layout.Background;\nimport javafx.scene.layout.BackgroundFill;\nimport javafx.scene.layout.CornerRadii;\nimport javafx.scene.layout.GridPane;\nimport javafx.scene.layout.HBox;\nimport javafx.scene.paint.Color;\nimport javafx.scene.text.Font;\nimport javafx.stage.Stage;\n\nimport java.net.URL;\nimport java.time.Duration;\nimport java.util.Optional;\n\n\npublic class FXServiceDemo extends Application {\n\n    static TextField urlField;\n    static TextField passwordField;\n\n    @Override\n    public void start(Stage primaryStage) {\n        primaryStage.setScene(createScene());\n        primaryStage.setTitle(&quot;DB Settings&quot;);\n        primaryStage.show();\n    }\n\n    private Scene createScene() {\n        Parent root = createRoot();\n        Scene scene = new Scene(root);\n        findStylesheet().ifPresent(s -&gt; scene.getStylesheets().add(s));\n        return scene;\n    }\n\n    private static Optional&lt;String&gt; findStylesheet() {\n        URL nullableStylesheet = FXServiceDemo.class.getResource(&quot;/styles/styles.css&quot;);\n        Optional&lt;URL&gt; stylesheetOptional = Optional.ofNullable(nullableStylesheet);\n        return stylesheetOptional.map(URL::toExternalForm);\n    }\n\n    private Parent createRoot() {\n        GridPane root = new GridPane();\n        root.setAlignment(Pos.CENTER);\n        root.setPadding(new Insets(5));\n        root.hgapProperty().set(5);\n        root.vgapProperty().set(5);\n        Label header = new Label(&quot;DB settings&quot;);\n        header.setFont(Font.font(20));\n        root.add(header, 0, 0, 2, 1);\n        root.addRow(1, new Label(&quot;URL&quot;), urlField = new TextField());\n        root.addRow(2, new Label(&quot;Password&quot;), passwordField = new TextField());\n        root.add(createButtonRow(), 1, 3, 2, 1);\n        return root;\n    }\n\n    private HBox createButtonRow() {\n        HBox row = new HBox();\n        row.setSpacing(5);\n        row.setAlignment(Pos.CENTER_RIGHT);\n        row.getChildren().add(createTestConnectionButton());\n        row.getChildren().add(createSaveButton());\n        return row;\n    }\n\n    Service&lt;Void&gt; testConnectionService = Services.from(this::testConnection);\n    private Button createTestConnectionButton() {\n        Button button = new Button();\n        button.textProperty().set(&quot;Test Connection&quot;);\n        button.setOnAction(e -&gt; testConnectionService.restart());\n        button.disableProperty().bind(testConnectionService.runningProperty());\n        testConnectionService.addEventHandler(WorkerStateEvent.WORKER_STATE_SUCCEEDED, FXServiceDemo::onConnectionSuccess);\n        testConnectionService.addEventHandler(WorkerStateEvent.WORKER_STATE_FAILED, FXServiceDemo::onConnectionFailure);\n        return button;\n    }\n\n    private static void onConnectionSuccess(WorkerStateEvent e) {\n        setValid(true);\n        System.out.println(&quot;Connection was not established.&quot;);\n    }\n\n    private static void onConnectionFailure(WorkerStateEvent e) {\n        setValid(false);\n        System.out.println(&quot;Connection was not established.&quot;);\n    }\n\n    private static void setValid(boolean valid) {\n        PseudoClass invalid = PseudoClass.getPseudoClass(&quot;invalid&quot;);\n        urlField.pseudoClassStateChanged(invalid, !valid);\n        passwordField.pseudoClassStateChanged(invalid, !valid);\n    }\n\n    Service&lt;Void&gt; saveSettingsService = Services.from(this::saveSettings);\n    private Button createSaveButton() {\n        Button button = new Button();\n        button.textFillProperty().set(Color.WHITE);\n        button.backgroundProperty().set(new Background(new BackgroundFill(Color.GREEN, new CornerRadii(3), null)));\n        button.textProperty().set(&quot;Save&quot;);\n        button.setOnAction(e -&gt; saveSettingsService.restart());\n        button.disableProperty().bind(testConnectionService.runningProperty().or(saveSettingsService.runningProperty()));\n        saveSettingsService.addEventHandler(WorkerStateEvent.WORKER_STATE_SUCCEEDED, FXServiceDemo::onSaveSuccess);\n        saveSettingsService.addEventHandler(WorkerStateEvent.WORKER_STATE_FAILED, FXServiceDemo::onSaveFailure);\n        return button;\n    }\n\n    private static void onSaveSuccess(WorkerStateEvent e) {\n        System.out.println(&quot;Connection settings successfully saved.&quot;);\n    }\n\n    private static void onSaveFailure(WorkerStateEvent e) {\n        System.out.println(&quot;Connection settings could not saved.&quot;);\n    }\n\n    private void testConnection() {\n        System.out.println(&quot;Testing connection...&quot;);\n        sleep(Duration.ofSeconds(1));\n        if (credentialsValid()) return;\n        throw new IllegalArgumentException(&quot;Invalid Credentials&quot;);\n    }\n\n    private boolean credentialsValid() {\n        String correctUrl = &quot;test&quot;;\n        String correctPass = &quot;test&quot;;\n        return correctUrl.equals(urlField.textProperty().get()) &amp;&amp;\n                correctPass.equals(passwordField.textProperty().get());\n    }\n\n    private void saveSettings() {\n        testConnection();\n        System.out.println(&quot;Saving connection settings...&quot;);\n        sleep(Duration.ofSeconds(1));\n    }\n\n    private static void sleep(Duration duration) {\n        try {\n            Thread.sleep(duration.toMillis());\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n</code></pre>\n<pre class=\"lang-none prettyprint-override\"><code>import javafx.concurrent.Service;\nimport javafx.concurrent.Task;\n\npublic class Services {\n\n    public static Service&lt;Void&gt; from(Runnable task) {\n        return new Service&lt;Void&gt;() {\n            @Override\n            protected Task&lt;Void&gt; createTask() {\n                return new Task&lt;Void&gt;() {\n                    @Override\n                    protected Void call() {\n                        task.run();\n                        return null;\n                    }\n                };\n            }\n        };\n    }\n}\n</code></pre>\n<pre class=\"lang-css prettyprint-override\"><code>/* resources/styles/styles.css */\n\n.text-field:invalid {\n    -fx-border-color : salmon;\n}\n</code></pre>\n<p><a href=\"https://i.sstatic.net/F0BDQRWV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/F0BDQRWV.png\" alt=\"enter image description here\" /></a></p>\n<h1>Approach #2</h1>\n<p>I can declare one <code>Service</code>. Then failure handling will be executed no matter which button triggers it. However, testing connection will then notify the same saving listener (since listeners would also be shared). In effect, it would mean the testing button would be saving as well — unacceptable.</p>\n<h1>Approach #3</h1>\n<p><strong>(theoretical)</strong></p>\n<p>If I could:</p>\n<ol>\n<li>Declare two separate services.</li>\n<li>But have the saving service &quot;contain&quot; the lifecycle of the testing service.</li>\n</ol>\n<p>I could meet all of my requirements.</p>\n<p>However, it seems, I can't have nested <code>Service</code>s in JavaFX.</p>\n<h1>Approach #4</h1>\n<p><strong>(theoretical)</strong></p>\n<p>I could call some <code>restartAndThen(resultConsumer)</code> method that would register no additional listeners but execute a one-off callback on that particular invocation – the invocation performed by the saving button's action listener.</p>\n<p>Again, it's imaginary. No such API exists.</p>\n<p>How do I achieve my goals?</p>\n<p>Java 8.</p>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 2819940,
        "reputation": 14002,
        "user_id": 2423906,
        "user_type": "registered",
        "accept_rate": 100,
        "profile_image": "https://i.sstatic.net/rkpYv.jpg?s=256",
        "display_name": "SedJ601",
        "link": "https://stackoverflow.com/users/2423906/sedj601"
      },
      "is_accepted": false,
      "score": 2,
      "last_activity_date": 1764968329,
      "creation_date": 1764968329,
      "answer_id": 79839299,
      "question_id": 79838872,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>I think you need two <code>Task&lt;Boolean&gt;</code>. In your first case only run the one task. In your second case, run the first task and run the second task if the first task returns true (valid credientials).</p>\n<pre><code>import javafx.application.Application;\nimport javafx.css.PseudoClass;\nimport javafx.geometry.Insets;\nimport javafx.geometry.Pos;\nimport javafx.scene.Parent;\nimport javafx.scene.Scene;\nimport javafx.scene.control.Button;\nimport javafx.scene.control.Label;\nimport javafx.scene.control.TextField;\nimport javafx.scene.layout.Background;\nimport javafx.scene.layout.BackgroundFill;\nimport javafx.scene.layout.CornerRadii;\nimport javafx.scene.layout.GridPane;\nimport javafx.scene.layout.HBox;\nimport javafx.scene.paint.Color;\nimport javafx.scene.text.Font;\nimport javafx.stage.Stage;\n\nimport java.time.Duration;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport javafx.concurrent.Task;\n\n\npublic class App extends Application {\n\n    TextField urlField;\n    TextField passwordField;\n    Button btnTestConnection;\n    Button btnSave;\n    \n    @Override\n    public void start(Stage primaryStage) {  \n        Parent root = createRoot();\n        Scene scene = new Scene(root);\n        scene.getStylesheets().add(getClass().getResource(&quot;styles/styles.css&quot;).toExternalForm());        \n        primaryStage.setScene(scene);\n        primaryStage.setTitle(&quot;DB Settings&quot;);\n        primaryStage.show();\n    }\n\n    private Parent createRoot() {\n        GridPane root = new GridPane();\n        root.setAlignment(Pos.CENTER);\n        root.setPadding(new Insets(5));\n        root.hgapProperty().set(5);\n        root.vgapProperty().set(5);\n        Label header = new Label(&quot;DB settings&quot;);\n        header.setFont(Font.font(20));\n        root.add(header, 0, 0, 2, 1);\n        root.addRow(1, new Label(&quot;URL&quot;), urlField = new TextField());\n        root.addRow(2, new Label(&quot;Password&quot;), passwordField = new TextField());\n        root.add(createButtonRow(), 1, 3, 2, 1);\n        return root;\n    }\n\n    private HBox createButtonRow() {\n        HBox row = new HBox();\n        row.setSpacing(5);\n        row.setAlignment(Pos.CENTER_RIGHT);\n        \n        btnTestConnection = createTestConnectionButton();\n        row.getChildren().add(btnTestConnection);\n        \n        btnSave = createSaveSettingButton();\n        row.getChildren().add(btnSave);\n        \n        return row;\n    }\n\n    private Button createTestConnectionButton() \n    {\n        Button button = new Button();\n        button.textProperty().set(&quot;Test Connection&quot;);        \n        button.setOnAction(e -&gt; \n        {\n            Task&lt;Boolean&gt; testConnectionTask = testConnectionTask();        \n            button.disableProperty().bind(testConnectionTask.runningProperty());\n            testConnectionTask.setOnSucceeded((t) -&gt; {\n                if(testConnectionTask.getValue())\n                {\n                    System.out.println(&quot;Valid Credentials&quot;);\n                }\n                else\n                {\n                    System.out.println(&quot;Invalid Credentials&quot;);\n                }\n\n                setValid(testConnectionTask.getValue());\n            });\n\n            exec.submit(testConnectionTask);\n\n        });\n\n        return button;\n    }\n\n    private Task&lt;Boolean&gt; testConnectionTask() \n    {\n            Task&lt;Boolean&gt; testConnectTask = new Task&lt;Boolean&gt;(){\n                @Override\n                protected Boolean call() throws Exception {\n                    System.out.println(&quot;Testing connection...&quot;);\n                    sleep(Duration.ofSeconds(1));\n                    return credentialsValid();\n                }\n            };\n\n            return testConnectTask;\n    }\n    \n\n    private Button createSaveSettingButton() {\n        Button button = new Button(&quot;Save&quot;);\n        button.textFillProperty().set(Color.WHITE);\n        button.backgroundProperty().set(new Background(new BackgroundFill(Color.GREEN, new CornerRadii(3), null)));\n        button.setOnAction(e -&gt; \n        {\n            button.disableProperty().bind(btnTestConnection.disableProperty());\n            \n            Task&lt;Boolean&gt; testConnectionTask = testConnectionTask();        \n            btnTestConnection.disableProperty().bind(testConnectionTask.runningProperty());\n            testConnectionTask.setOnSucceeded((t) -&gt; {\n                if(testConnectionTask.getValue())\n                {\n                    System.out.println(&quot;Valid Credentials&quot;);\n                    Task&lt;Boolean&gt; saveSettingTask = saveSettingsTask();\n                    btnTestConnection.disableProperty().bind(saveSettingTask.runningProperty());\n                    saveSettingTask.setOnSucceeded((v) -&gt; {\n                        System.out.println(&quot;Setting were saved!&quot;);\n                    });\n                    \n                    exec.submit(saveSettingTask);\n                }\n                else\n                {\n                    System.out.println(&quot;Invalid Credentials&quot;);\n                }\n\n                setValid(testConnectionTask.getValue());\n            });\n\n            exec.submit(testConnectionTask);\n        });\n        \n        \n        \n        \n        return button;\n    }    \n\n    private Task&lt;Boolean&gt; saveSettingsTask() \n    {\n        Task&lt;Boolean&gt; saveSettingsTask = new Task&lt;Boolean&gt;() {\n            @Override\n            protected Boolean call() throws Exception {\n                System.out.println(&quot;Saving connection settings...&quot;);\n                sleep(Duration.ofSeconds(5));\n                \n                return true;\n            }\n        };\n        \n        return saveSettingsTask;\n    }\n    \n    \n    \n    \n    private void setValid(boolean valid) {\n        PseudoClass invalid = PseudoClass.getPseudoClass(&quot;invalid&quot;);\n        urlField.pseudoClassStateChanged(invalid, !valid);\n        passwordField.pseudoClassStateChanged(invalid, !valid);\n    }\n   \n    private boolean credentialsValid() {\n        String correctUrl = &quot;test&quot;;\n        String correctPass = &quot;test&quot;;\n        return correctUrl.equals(urlField.textProperty().get()) &amp;&amp;\n                correctPass.equals(passwordField.textProperty().get());\n    }\n    \n    private final ExecutorService exec = Executors.newSingleThreadExecutor(\n        // An executor which creates daemon threads\n        runnable -&gt; {\n            Thread thread = new Thread(runnable);\n            thread.setDaemon(true);\n            return thread;\n        }\n    );\n    \n    private static void sleep(Duration duration) {\n        try {\n            Thread.sleep(duration.toMillis());\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n</code></pre>\n"
    }
  ],
  "question_comments": [
    {
      "owner": {
        "account_id": 2819940,
        "reputation": 14002,
        "user_id": 2423906,
        "user_type": "registered",
        "accept_rate": 100,
        "profile_image": "https://i.sstatic.net/rkpYv.jpg?s=256",
        "display_name": "SedJ601",
        "link": "https://stackoverflow.com/users/2423906/sedj601"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1765085621,
      "post_id": 79838872,
      "comment_id": 140891052,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 2053598,
        "reputation": 44936,
        "user_id": 1831987,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/38b1c37530189ec4471a43a618e33f67?s=256&d=identicon&r=PG",
        "display_name": "VGR",
        "link": "https://stackoverflow.com/users/1831987/vgr"
      },
      "edited": false,
      "score": 1,
      "creation_date": 1765057002,
      "post_id": 79838872,
      "comment_id": 140890798,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 322981,
        "reputation": 346871,
        "user_id": 642706,
        "user_type": "registered",
        "accept_rate": 58,
        "profile_image": "https://i.sstatic.net/ZWEI3.jpg?s=256",
        "display_name": "Basil Bourque",
        "link": "https://stackoverflow.com/users/642706/basil-bourque"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1764962428,
      "post_id": 79838872,
      "comment_id": 140889604,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 2518243,
        "reputation": 210896,
        "user_id": 2189127,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
        "display_name": "James_D",
        "link": "https://stackoverflow.com/users/2189127/james-d"
      },
      "edited": false,
      "score": 1,
      "creation_date": 1764955100,
      "post_id": 79838872,
      "comment_id": 140889436,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 10187542,
        "reputation": 2675,
        "user_id": 20692967,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/NZSXm.jpg?s=256",
        "display_name": "Sergey Zolotarev",
        "link": "https://stackoverflow.com/users/20692967/sergey-zolotarev"
      },
      "reply_to_user": {
        "account_id": 2518243,
        "reputation": 210896,
        "user_id": 2189127,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
        "display_name": "James_D",
        "link": "https://stackoverflow.com/users/2189127/james-d"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1764954630,
      "post_id": 79838872,
      "comment_id": 140889431,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 2518243,
        "reputation": 210896,
        "user_id": 2189127,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
        "display_name": "James_D",
        "link": "https://stackoverflow.com/users/2189127/james-d"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1764949688,
      "post_id": 79838872,
      "comment_id": 140889294,
      "content_license": "CC BY-SA 4.0"
    },
    {
      "owner": {
        "account_id": 2518243,
        "reputation": 210896,
        "user_id": 2189127,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/e8e6e627b4b90ec816c5c7aa04cbcc26?s=256&d=identicon&r=PG",
        "display_name": "James_D",
        "link": "https://stackoverflow.com/users/2189127/james-d"
      },
      "edited": false,
      "score": 0,
      "creation_date": 1764948392,
      "post_id": 79838872,
      "comment_id": 140889240,
      "content_license": "CC BY-SA 4.0"
    }
  ],
  "answer_comments": {
    "79839299": [
      {
        "owner": {
          "account_id": 10187542,
          "reputation": 2675,
          "user_id": 20692967,
          "user_type": "registered",
          "profile_image": "https://i.sstatic.net/NZSXm.jpg?s=256",
          "display_name": "Sergey Zolotarev",
          "link": "https://stackoverflow.com/users/20692967/sergey-zolotarev"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1765091816,
        "post_id": 79839299,
        "comment_id": 140891098,
        "content_license": "CC BY-SA 4.0"
      },
      {
        "owner": {
          "account_id": 2819940,
          "reputation": 14002,
          "user_id": 2423906,
          "user_type": "registered",
          "accept_rate": 100,
          "profile_image": "https://i.sstatic.net/rkpYv.jpg?s=256",
          "display_name": "SedJ601",
          "link": "https://stackoverflow.com/users/2423906/sedj601"
        },
        "reply_to_user": {
          "account_id": 10187542,
          "reputation": 2675,
          "user_id": 20692967,
          "user_type": "registered",
          "profile_image": "https://i.sstatic.net/NZSXm.jpg?s=256",
          "display_name": "Sergey Zolotarev",
          "link": "https://stackoverflow.com/users/20692967/sergey-zolotarev"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1765085210,
        "post_id": 79839299,
        "comment_id": 140891047,
        "content_license": "CC BY-SA 4.0"
      },
      {
        "owner": {
          "account_id": 10187542,
          "reputation": 2675,
          "user_id": 20692967,
          "user_type": "registered",
          "profile_image": "https://i.sstatic.net/NZSXm.jpg?s=256",
          "display_name": "Sergey Zolotarev",
          "link": "https://stackoverflow.com/users/20692967/sergey-zolotarev"
        },
        "edited": false,
        "score": 0,
        "creation_date": 1765043719,
        "post_id": 79839299,
        "comment_id": 140890576,
        "content_license": "CC BY-SA 4.0"
      }
    ]
  }
}