{
  "question": {
    "tags": [
      "java",
      "classloader"
    ],
    "owner": {
      "account_id": 1376,
      "reputation": 61855,
      "user_id": 1836,
      "user_type": "registered",
      "accept_rate": 90,
      "profile_image": "https://www.gravatar.com/avatar/6dfac666dcbd18678c62b338f62a7b7d?s=256&d=identicon&r=PG",
      "display_name": "Matthew Farwell",
      "link": "https://stackoverflow.com/users/1836/matthew-farwell"
    },
    "is_answered": true,
    "view_count": 14918,
    "answer_count": 6,
    "score": 19,
    "last_activity_date": 1764544664,
    "creation_date": 1302702375,
    "question_id": 5650334,
    "content_license": "CC BY-SA 3.0",
    "link": "https://stackoverflow.com/questions/5650334/java-classloaders-why-search-the-parent-classloader-first",
    "title": "Java classloaders: why search the parent classloader first?",
    "body": "<p>The correct behaviour for a classloader in Java is to:</p>\n\n<ol>\n<li>If it has already been loaded, return the class</li>\n<li>Call the parent loadClass()</li>\n<li>Try and load the class itself.</li>\n</ol>\n\n<p>So the class defined in the system classpath should always get loaded first. Tomcat defines classloader per war, which has the system classloader as a parent, so if you try to load a class, it will first look in the system classpath and then in the classpath defined in the war file.</p>\n\n<p>As per my understanding, this is for two reasons:</p>\n\n<ol>\n<li>To avoid problems with different versions of classes being used. Imagine I redefined java.lang.Object in a war, it would be a nightmare.</li>\n<li>To avoid dependencies on child classloaders: The system classloader cannot depend on child classloaders: it would be hard to redeploy a war, for instance.</li>\n</ol>\n\n<p>So, the question is:</p>\n\n<p>In addition to the above problems, are there any other pitfalls to implementing a classloader which does not do a parent search first?</p>\n"
  },
  "answers": [
    {
      "owner": {
        "account_id": 262720,
        "reputation": 10174,
        "user_id": 547779,
        "user_type": "registered",
        "accept_rate": 83,
        "profile_image": "https://i.sstatic.net/w0Lho.jpg?s=256",
        "display_name": "Tarlog",
        "link": "https://stackoverflow.com/users/547779/tarlog"
      },
      "is_accepted": false,
      "score": 18,
      "last_activity_date": 1764544664,
      "last_edit_date": 1764544664,
      "creation_date": 1302703387,
      "answer_id": 5650562,
      "question_id": 5650334,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>Tomcat doesn't look for a parent classloader first. Actually, it does the opposite: it first looks in the webapp and only then goes to the parent classloader (which is &quot;lib&quot; for Tomcat 6/7 and &quot;shared&quot; for Tomcat 5.5). The exception to this rule is the system classes (I think everything that has package java.* and javax.*), these classes were looked for only in the system classloader. I believe the reason they do it is the #1 reason you stated.</p>\n<p>So, it's ok to implement a parent-first strategy. It's also ok to implement parent-last. Both strategies have their pros and cons.</p>\n<p>Another reason to implement parent-first: you reduce the amount of classes loaded in perm memory. Imagine you have multiple web applications using the same library. With parent-first, the library with be loaded once. With parent-last, it will be loaded multiple times.<br />\nHowever, with parent-first, all web-apps will be required to use the same version of the library, while with parent-last they may use different versions.</p>\n"
    },
    {
      "owner": {
        "account_id": 6409279,
        "reputation": 1260,
        "user_id": 7676237,
        "user_type": "registered",
        "profile_image": "https://i.sstatic.net/6BHJY.jpg?s=256",
        "display_name": "puppylpg",
        "link": "https://stackoverflow.com/users/7676237/puppylpg"
      },
      "is_accepted": false,
      "score": 0,
      "last_activity_date": 1547321345,
      "creation_date": 1547321345,
      "answer_id": 54163144,
      "question_id": 5650334,
      "content_license": "CC BY-SA 4.0",
      "body": "<p>Tomcat web application class loader doesn't obey \"use parent first\". As mentioned in <a href=\"https://tomcat.apache.org/tomcat-7.0-doc/class-loader-howto.html\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>As mentioned above, the web application class loader diverges from the default Java delegation model (in accordance with the recommendations in the Servlet Specification, version 2.4, section 9.7.2 Web Application Classloader). When a request to load a class from the web application's WebappX class loader is processed, this class loader will look in the local repositories first, instead of delegating before looking. There are exceptions. Classes which are part of the JRE base classes cannot be overridden.</p>\n</blockquote>\n"
    }
  ],
  "question_comments": [],
  "answer_comments": {
    "5650562": [],
    "54163144": []
  }
}