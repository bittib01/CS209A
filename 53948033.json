{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-webflux",
      "reactor-netty"
    ],
    "owner": {
      "account_id": 356977,
      "reputation": 1033,
      "user_id": 696839,
      "user_type": "registered",
      "accept_rate": 71,
      "profile_image": "https://www.gravatar.com/avatar/19bd1bdd3d1ba0b18bbc49dd5145717a?s=256&d=identicon&r=PG",
      "display_name": "mwalter",
      "link": "https://stackoverflow.com/users/696839/mwalter"
    },
    "is_answered": false,
    "view_count": 8444,
    "answer_count": 2,
    "score": 2,
    "last_activity_date": 1764806680,
    "creation_date": 1545928060,
    "last_edit_date": 1545943198,
    "question_id": 53948033,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/53948033/how-to-customize-netty-with-spring-boot-2-1-webflux",
    "title": "How to customize Netty with Spring Boot 2.1 Webflux?",
    "body": "<p>I would like to customize Netty in my Spring Boot Webflux project. In my POM I added Spring Boot Webflux and Spring Boot Actuator dependencies. Next I overwrote the customize() method of WebServerFactoryCustomizer as described in the <a href=\"https://docs.spring.io/spring-boot/docs/current/reference/html/howto-embedded-web-servers.html#howto-configure-webserver\" rel=\"nofollow noreferrer\">Spring documentation</a>.</p>\n\n<pre><code>@Component\npublic class NettyConfiguration implements WebServerFactoryCustomizer&lt;NettyReactiveWebServerFactory&gt; {\n\n    @Override\n    public void customize(NettyReactiveWebServerFactory factory) {\n        factory.addServerCustomizers(new NettyCustomizer());\n    }\n}\n</code></pre>\n\n<p>Then I implemented the Netty bootstrapping in my NettyCustomizer:</p>\n\n<pre><code>public class NettyCustomizer implements NettyServerCustomizer {\n\n    private final EventLoopGroup bossGroup = new NioEventLoopGroup(22);\n    private final EventLoopGroup workerGroup = new NioEventLoopGroup();\n\n    @Override\n    public HttpServer apply(HttpServer httpServer) {\n        return httpServer.tcpConfiguration(tcpServer -&gt;\n                tcpServer.bootstrap(serverBootstrap -&gt;\n                        serverBootstrap\n                                .group(bossGroup, workerGroup)\n                                .channel(NioServerSocketChannel.class)\n                                .handler(new LoggingHandler(LogLevel.DEBUG))\n                                .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() {\n                                    @Override\n                                    public void initChannel(final SocketChannel socketChannel) {\n                                        socketChannel.pipeline().addLast(new BufferingInboundHandler());\n                                    }\n                                })\n                                .option(ChannelOption.SO_BACKLOG, 128)\n                                .childOption(ChannelOption.SO_KEEPALIVE, true))\n                        .port(8899)\n        );\n    }\n}\n</code></pre>\n\n<p>Now if I start the Spring Boot application I get a \"Unable to start Netty\" error.</p>\n\n<pre><code>org.springframework.boot.web.server.WebServerException: Unable to start Netty\nCaused by: java.lang.IllegalStateException: group set already\n</code></pre>\n\n<p>So it seems there is no way to override Netty bootstrapping if using Webflux. Changing the addServerCustomizers() method to setServerCustomizers() in the customize() method leads to the same exceptions unfortunately. Does anybody know how to customize Netty together with Spring Boot?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}