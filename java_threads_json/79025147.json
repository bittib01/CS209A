{
  "question": {
    "tags": [
      "java",
      "c++",
      "macos",
      "java-native-interface",
      "address-sanitizer"
    ],
    "owner": {
      "account_id": 1818669,
      "reputation": 3258,
      "user_id": 1653225,
      "user_type": "registered",
      "accept_rate": 68,
      "profile_image": "https://www.gravatar.com/avatar/19097d5cf2cd514aa099c002c7337111?s=256&d=identicon&r=PG",
      "display_name": "Nick Williams",
      "link": "https://stackoverflow.com/users/1653225/nick-williams"
    },
    "is_answered": false,
    "view_count": 255,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1733957758,
    "creation_date": 1727311153,
    "question_id": 79025147,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79025147/how-do-i-properly-pre-load-asan-libraries-on-macos-with-java-binary-jni-library",
    "title": "How do I properly pre-load ASAN libraries on macOS with Java binary (JNI library) with SIP enabled",
    "body": "<p>We have a large C++ library for which we have created Java bindings using SWIG (so a JNI shared library). We build for and run tests on many build platforms across macOS, Linux, and Windows; debug and opt; and ASAN.</p>\n<p>We're having problems with ASAN + Java, specifically, on some macOS machines. For our regular C++ library and its tests, on all operating systems, we have no problems. We've sorted out all the compiler flags, linking flags, and runtime environment variables to make ASAN work properly.</p>\n<p>But for the Java binding JNI library on macOS (only), things are different. When we load our ASAN-linked binding library and try to use it in Java on macOS, we get the following error and the Java process aborts:</p>\n<pre><code>==36055==ERROR: Interceptors are not working. This may be because AddressSanitizer is loaded too late (e.g. via dlopen). Please launch the executable with:\nDYLD_INSERT_LIBRARIES=/path/to/libclang_rt.asan_osx_dynamic.dylib\n&quot;interceptors not installed&quot; &amp;&amp; 0\n</code></pre>\n<p>When we attempted the obvious—launching the Java process with <code>DYLD_INSERT_LIBRARIES</code> specified—it works on our local developer machines but not on our builders. Upon further investigation, we determined that our developer machines have SIP (System Integrity Protection) disabled while our builders have SIP enabled. Our Infra team informed us that disabling SIP is not an option, so we <em>must</em> make this work with SIP enabled.</p>\n<p>What is the proper way to force Java to pre-load the ASAN library on SIP-enabled macOS systems to prevent this error?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}