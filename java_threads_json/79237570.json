{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-boot-test"
    ],
    "owner": {
      "account_id": 1384974,
      "reputation": 133,
      "user_id": 1317202,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/ac5a4396c75dc2d7d79b6f9842dcba69?s=256&d=identicon&r=PG",
      "display_name": "M4veR1K",
      "link": "https://stackoverflow.com/users/1317202/m4ver1k"
    },
    "is_answered": true,
    "view_count": 14192,
    "accepted_answer_id": 79596963,
    "answer_count": 6,
    "score": 8,
    "last_activity_date": 1761208375,
    "creation_date": 1732893477,
    "last_edit_date": 1733758011,
    "question_id": 79237570,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79237570/spring-boot-3-4-mockitospybean-causes-nullpointerexception-during-postconstru",
    "title": "Spring Boot 3.4: @MockitoSpyBean causes NullPointerException during @PostConstruct",
    "body": "<p>I'm currently migrating a Spring Boot app to version 3.4.</p>\n<p>In this version, <code>@MockBean</code> and <code>@SpyBean</code> are deprecated and replaced by <code>@MockitoBean</code> and <code>@MockitoSpyBean</code></p>\n<p>I've made the changes in my class annotated with <code>@TestConfiguration</code>, and since then my SpringBootTests are failing at the initialization phase.</p>\n<p>This is how my configuration class looks like:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@TestConfiguration\npublic class IntegrationTestConfig {\n\n    @MockitoSpyBean\n    private LanguageRepository languageRepository;\n\n    @PostConstruct\n    void setUp() {\n        when(languageRepository.findAllCodes()).thenReturn(List.of(&quot;fr&quot;, &quot;en&quot;));\n    }\n}\n</code></pre>\n<p>This configuration is included via a custom meta-annotation, like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Retention(RetentionPolicy.RUNTIME)\n@SpringBootTest(classes = {IntegrationTestConfig.class, SpringSecurityTestConfig.class})\n@ActiveProfiles(&quot;test&quot;)\n@Sql(scripts = &quot;classpath:sql/clearTables.sql&quot;, executionPhase = ExecutionPhase.AFTER_TEST_METHOD)\n@AutoConfigureMockMvc\npublic @interface IntegrationTest {\n\n}\n</code></pre>\n<p>Since making this change, I now encounter the following error during <code>@PostConstruct</code> execution:\n<code>java.lang.NullPointerException: Cannot invoke &quot;package.whatever.LanguageRepository.findAllCodes()&quot; because &quot;this.languageRepository&quot; is null</code></p>\n<p>The error does not occur if I revert to the deprecated API (<code>@SpyBean</code>). Everything works fine with the old annotations.</p>\n<p><strong>My questions:</strong></p>\n<ul>\n<li>What am I missing here?</li>\n<li>How can I recover the same behavior as before, preferably without relying on base test class inheritance with a <code>@BeforeEach</code> setup?</li>\n</ul>\n<hr />\n<p><strong>Edit</strong>: Giving context</p>\n<p>This <code>@SpyBean</code> is used to mock something only done at application startup where an external WS call is made.</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Bean\nApplicationRunner fetchTranslations(LocalazyService translationService) {\n    log.info(&quot;Initializing translations...&quot;);\n    return ignored -&gt; translationService.updateTranslationsWithCdn();\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}