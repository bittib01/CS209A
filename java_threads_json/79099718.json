{
  "question": {
    "tags": [
      "java",
      "docker",
      "apache-kafka",
      "docker-compose",
      "kraft"
    ],
    "owner": {
      "account_id": 31060124,
      "reputation": 47,
      "user_id": 23872174,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/93d0aff2fc9f44b095d671fe21afa539?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "elenwen",
      "link": "https://stackoverflow.com/users/23872174/elenwen"
    },
    "is_answered": false,
    "view_count": 377,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1735414965,
    "creation_date": 1729196267,
    "last_edit_date": 1729431840,
    "question_id": 79099718,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79099718/apache-kafka-kraft-cancelled-in-flight-api-versions-request",
    "title": "Apache Kafka Kraft - Cancelled in-flight API_VERSIONS request",
    "body": "<pre><code>acks = -1\n    auto.include.jmx.reporter = true\n    batch.size = 16384\n    bootstrap.servers = [localhost:9092, localhost:9094, localhost:9096]\n    buffer.memory = 33554432\n    client.dns.lookup = use_all_dns_ips\n    client.id = producer-4\n    compression.type = none\n    connections.max.idle.ms = 540000\n    delivery.timeout.ms = 120000\n    enable.idempotence = true\n    enable.metrics.push = true\n    interceptor.classes = []\n    key.serializer = class org.apache.kafka.common.serialization.StringSerializer\n    linger.ms = 0\n    max.block.ms = 60000\n    max.in.flight.requests.per.connection = 5\n    max.request.size = 1048576\n    metadata.max.age.ms = 300000\n    metadata.max.idle.ms = 300000\n    metric.reporters = []\n    metrics.num.samples = 2\n    metrics.recording.level = INFO\n    metrics.sample.window.ms = 30000\n    partitioner.adaptive.partitioning.enable = true\n    partitioner.availability.timeout.ms = 0\n    partitioner.class = null\n    partitioner.ignore.keys = false\n    receive.buffer.bytes = 32768\n    reconnect.backoff.max.ms = 1000\n    reconnect.backoff.ms = 50\n    request.timeout.ms = 30000\n    retries = 3\n    retry.backoff.max.ms = 1000\n    retry.backoff.ms = 100\n    sasl.client.callback.handler.class = null\n    sasl.jaas.config = null\n    sasl.kerberos.kinit.cmd = /usr/bin/kinit\n    sasl.kerberos.min.time.before.relogin = 60000\n    sasl.kerberos.service.name = null\n    sasl.kerberos.ticket.renew.jitter = 0.05\n    sasl.kerberos.ticket.renew.window.factor = 0.8\n    sasl.login.callback.handler.class = null\n    sasl.login.class = null\n    sasl.login.connect.timeout.ms = null\n    sasl.login.read.timeout.ms = null\n    sasl.login.refresh.buffer.seconds = 300\n    sasl.login.refresh.min.period.seconds = 60\n    sasl.login.refresh.window.factor = 0.8\n    sasl.login.refresh.window.jitter = 0.05\n    sasl.login.retry.backoff.max.ms = 10000\n    sasl.login.retry.backoff.ms = 100\n    sasl.mechanism = GSSAPI\n    sasl.oauthbearer.clock.skew.seconds = 30\n    sasl.oauthbearer.expected.audience = null\n    sasl.oauthbearer.expected.issuer = null\n    sasl.oauthbearer.jwks.endpoint.refresh.ms = 3600000\n    sasl.oauthbearer.jwks.endpoint.retry.backoff.max.ms = 10000\n    sasl.oauthbearer.jwks.endpoint.retry.backoff.ms = 100\n    sasl.oauthbearer.jwks.endpoint.url = null\n    sasl.oauthbearer.scope.claim.name = scope\n    sasl.oauthbearer.sub.claim.name = sub\n    sasl.oauthbearer.token.endpoint.url = null\n    security.protocol = PLAINTEXT\n    security.providers = null\n    send.buffer.bytes = 131072\n    socket.connection.setup.timeout.max.ms = 30000\n    socket.connection.setup.timeout.ms = 10000\n    ssl.cipher.suites = null\n    ssl.enabled.protocols = [TLSv1.2, TLSv1.3]\n    ssl.endpoint.identification.algorithm = https\n    ssl.engine.factory.class = null\n    ssl.key.password = null\n    ssl.keymanager.algorithm = SunX509\n    ssl.keystore.certificate.chain = null\n    ssl.keystore.key = null\n    ssl.keystore.location = null\n    ssl.keystore.password = null\n    ssl.keystore.type = JKS\n    ssl.protocol = TLSv1.3\n    ssl.provider = null\n    ssl.secure.random.implementation = null\n    ssl.trustmanager.algorithm = PKIX\n    ssl.truststore.certificates = null\n    ssl.truststore.location = null\n    ssl.truststore.password = null\n    ssl.truststore.type = JKS\n    transaction.timeout.ms = 60000\n    transactional.id = null\n    value.serializer = class org.apache.kafka.common.serialization.StringSerializer\n\n2024-10-18T20:00:49.577+03:00  INFO 5480 --- [card-composer-service] [o-auto-1-exec-1] o.a.k.c.t.i.KafkaMetricsCollector        : initializing Kafka metrics collector\n2024-10-18T20:00:49.577+03:00  INFO 5480 --- [card-composer-service] [o-auto-1-exec-1] o.a.k.clients.producer.KafkaProducer     : [Producer clientId=producer-4] Instantiated an idempotent producer.\n2024-10-18T20:00:49.580+03:00  INFO 5480 --- [card-composer-service] [o-auto-1-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka version: 3.7.0\n2024-10-18T20:00:49.580+03:00  INFO 5480 --- [card-composer-service] [o-auto-1-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka commitId: 2ae524ed625438c5\n2024-10-18T20:00:49.580+03:00  INFO 5480 --- [card-composer-service] [o-auto-1-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka startTimeMs: 1729270849580\n2024-10-18T20:00:49.583+03:00  INFO 5480 --- [card-composer-service] [ad | producer-4] org.apache.kafka.clients.NetworkClient   : [Producer clientId=producer-4] Node -2 disconnected.\n2024-10-18T20:00:49.583+03:00  INFO 5480 --- [card-composer-service] [ad | producer-4] org.apache.kafka.clients.NetworkClient   : [Producer clientId=producer-4] Cancelled in-flight API_VERSIONS request with correlation id 0 due to node -2 being disconnected (elapsed time since creation: 1ms, elapsed time since send: 1ms, request timeout: 30000ms)\n2024-10-18T20:00:49.583+03:00  WARN 5480 --- [card-composer-service] [ad | producer-4] org.apache.kafka.clients.NetworkClient   : [Producer clientId=producer-4] Bootstrap broker localhost:9094 (id: -2 rack: null) disconnected\n2024-10-18T20:00:49.587+03:00  INFO 5480 --- [card-composer-service] [ad | producer-4] org.apache.kafka.clients.NetworkClient   : [Producer clientId=producer-4] Node -3 disconnected.\n2024-10-18T20:00:49.587+03:00  INFO 5480 --- [card-composer-service] [ad | producer-4] org.apache.kafka.clients.NetworkClient   : [Producer clientId=producer-4] Cancelled in-flight API_VERSIONS request with correlation id 3 due to node -3 being disconnected (elapsed time since creation: 1ms, elapsed time since send: 1ms, request timeout: 30000ms)\n2024-10-18T20:00:49.587+03:00  WARN 5480 --- [card-composer-service] [ad | producer-4] org.apache.kafka.clients.NetworkClient   : [Producer clientId=producer-4] Bootstrap broker localhost:9096 (id: -3 rack: null) disconnected\n2024-10-18T20:00:49.587+03:00  INFO 5480 --- [card-composer-service] [ad | producer-4] o.a.k.c.p.internals.TransactionManager   : [Producer clientId=producer-4] ProducerId set to 1003 with epoch 0\n2024-10-18T20:00:49.701+03:00  INFO 5480 --- [card-composer-service] [ad | producer-4] org.apache.kafka.clients.Metadata        : [Producer clientId=producer-4] Cluster ID: nQCoigKGSP22Wno_34Ez0Q\n2024-10-18T20:00:49.709+03:00  INFO 5480 --- [card-composer-service] [o-auto-1-exec-1] o.a.k.clients.producer.KafkaProducer     : [Producer clientId=producer-4] Closing the Kafka producer with timeoutMillis = 9223372036854775807 ms.\n\n\n</code></pre>\n<p>I get this error when I'm  trying to execute request :</p>\n<pre><code>{\n    &quot;listOfWords&quot;: &quot;side;main;plot;joke;joker;circus;&quot;,\n    &quot;onlyTranslate&quot;: false\n}\n</code></pre>\n<p>My ProducerConfig:</p>\n<pre><code>import org.apache.kafka.clients.producer.KafkaProducer;\nimport org.apache.kafka.clients.producer.ProducerConfig;\nimport org.apache.kafka.clients.producer.ProducerRecord;\nimport org.apache.kafka.common.serialization.StringSerializer;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Properties;\n\n@Component\npublic class KafkaProducerRequest {\n    public void sendMessage(String message) {\n        Properties props = new Properties();\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;localhost:9092,localhost:9094,localhost:9096&quot;);\n        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        props.put(ProducerConfig.RETRIES_CONFIG, &quot;3&quot;);\n\n        KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);\n        ProducerRecord&lt;String, String&gt; producerRecord = new ProducerRecord&lt;&gt;(&quot;image-handler-topic&quot;, message);\n\n        producer.send(producerRecord);\n        producer.flush();\n        producer.close();\n    }\n}\n</code></pre>\n<p>DockerFile:</p>\n<pre><code>version: &quot;3.9&quot;\nnetworks:\n  main-network:\n    driver: bridge\nvolumes:\n  volume-kafka-1:\n  volume-kafka-2:\n  volume-kafka-3:\n\nservices:\n  kafka1:\n    image: 'bitnami/kafka:latest'\n    ports:\n      - &quot;9092:9092&quot;\n    networks:\n      - main-network\n    environment:\n      - KAFKA_ENABLE_KRAFT=yes\n      - KAFKA_CFG_NODE_ID=0\n      - KAFKA_BROKER_ID=0\n      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER\n      - ALLOW_PLAINTEXT_LISTENER=yes\n      - KAFKA_CFG_PROCESS_ROLES=controller,broker\n      - KAFKA_CFG_LISTENERS=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093\n      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://kafka1:9092\n      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT\n      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka1:9093,1@kafka2:9095,2@kafka3:9097\n      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER\n      - KAFKA_KRAFT_CLUSTER_ID=nQCoigKGSP22Wno_34Ez0Q\n    volumes:\n      - volume-kafka-1:/bitnami/kafka\n  kafka2:\n    image: 'bitnami/kafka:latest'\n    ports:\n      - &quot;9094:9092&quot;\n    networks:\n      - main-network\n    environment:\n      - KAFKA_ENABLE_KRAFT=yes\n      - KAFKA_CFG_NODE_ID=1\n      - KAFKA_BROKER_ID=1\n      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER\n      - ALLOW_PLAINTEXT_LISTENER=yes\n      - KAFKA_CFG_PROCESS_ROLES=controller,broker\n      - KAFKA_CFG_LISTENERS=PLAINTEXT://0.0.0.0:9094,CONTROLLER://0.0.0.0:9095\n      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://kafka2:9094\n      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT\n      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka1:9093,1@kafka2:9095,2@kafka3:9097\n      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER\n      - KAFKA_KRAFT_CLUSTER_ID=nQCoigKGSP22Wno_34Ez0Q\n    volumes:\n      - volume-kafka-2:/bitnami/kafka\n  kafka3:\n    image: 'bitnami/kafka:latest'\n    ports:\n      - &quot;9096:9092&quot;\n    networks:\n      - main-network\n    environment:\n      - KAFKA_ENABLE_KRAFT=yes\n      - KAFKA_CFG_NODE_ID=2\n      - KAFKA_BROKER_ID=2\n      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER\n      - ALLOW_PLAINTEXT_LISTENER=yes\n      - KAFKA_CFG_PROCESS_ROLES=controller,broker\n      - KAFKA_CFG_LISTENERS=PLAINTEXT://0.0.0.0:9096,CONTROLLER://0.0.0.0:9097\n      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://kafka3:9096\n      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT\n      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka1:9093,1@kafka2:9095,2@kafka3:9097\n      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER\n      - KAFKA_KRAFT_CLUSTER_ID=nQCoigKGSP22Wno_34Ez0Q\n    volumes:\n      - volume-kafka-3:/bitnami/kafka\n  ui:\n    image: provectuslabs/kafka-ui:v0.7.1\n    ports:\n      - &quot;9898:8080&quot;\n    environment:\n      - KAFKA_CLUSTERS_0_BOOTSTRAP_SERVERS=kafka1:9092,kafka2:9094,kafka3:9096\n      - KAFKA_CLUSTERS_0_NAME=kraft\n    networks:\n      - main-network\n</code></pre>\n<p>I think it's something wrong with my Kafka Configuration but I can't realize the problem because I'm new to Apache Kafka Kraft D: so I wish you could help me.</p>\n<p>My consumer also shows this log (I have added a third node) :</p>\n<pre><code>2024-10-18T20:04:41.029+03:00  INFO 16880 --- [image-handler-service] [           main] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-instance-1-1, groupId=instance-1] Discovered group coordinator kafka3:9096 (id: 2147483645 rack: null)\n2024-10-18T20:04:41.029+03:00  INFO 16880 --- [image-handler-service] [           main] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-instance-1-1, groupId=instance-1] Group coordinator kafka3:9096 (id: 2147483645 rack: null) is unavailable or invalid due to cause: coordinator unavailable. isDisconnected: false. Rediscovery will be attempted.\n2024-10-18T20:04:41.029+03:00  INFO 16880 --- [image-handler-service] [           main] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-instance-1-1, groupId=instance-1] Requesting disconnect from last known coordinator kafka3:9096 (id: 2147483645 rack: null)\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}