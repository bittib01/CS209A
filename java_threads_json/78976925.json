{
  "question": {
    "tags": [
      "java",
      "log4j2"
    ],
    "owner": {
      "account_id": 35597793,
      "reputation": 1,
      "user_id": 27297985,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/d7db7f55db96792da9bf6894781bebb5?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Dragonmeister",
      "link": "https://stackoverflow.com/users/27297985/dragonmeister"
    },
    "is_answered": false,
    "view_count": 285,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1750501691,
    "creation_date": 1726125478,
    "last_edit_date": 1750501691,
    "question_id": 78976925,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78976925/log4j2-does-not-load-custom-consolelogconverter-and-socketlogresolverfactor-plug",
    "title": "Log4j2 does not load custom ConsoleLogConverter and SocketLogResolverFactor plugins",
    "body": "<p>I am trying to add two custom plugins to Log4j2: <code>ConsoleLogConverter</code> and <code>SocketLogResolverFactory</code>. However, Log4j2 does not load these plugins when the application is launched, despite the fact that they are correctly positioned and annotated.</p>\n<p>I did this in principle in order to add masking to the logs, but so far I can't even test whether it works or not</p>\n<ul>\n<li>Log4j2 version: 2.24</li>\n<li>Java versions: 17</li>\n<li>Framework: Spring Boot 3.3.2</li>\n<li>Build system: Maven\nI have tried both the log4j2.plugins file to create and the log4j2.component.properties file to create.\nAnd at first Log4j2Plugins.dat was only in target, then I added it to be copied from target to resources, but my converter does not register.</li>\n</ul>\n<p>Here's what I've already checked:</p>\n<ol>\n<li>Checked that the classes <code>ConsoleLogConverter</code> and <code>SocketLogResolverFactory</code> are in the correct package and annotated using `@Plugin'.</li>\n<li>Made sure that the configuration file is <code>log4j2.xml</code> is loaded at startup.</li>\n<li>Checked that the annotations <code>@Plugin</code> and <code>@PluginFactory</code> were imported from the correct Log4j packages.</li>\n<li>Checked for conflicting versions of Log4j2 and other libraries in <code>pom.xml</code>.</li>\n</ol>\n<p>log4j2.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Configuration status=&quot;trace&quot; monitorInterval=&quot;10&quot;&gt;\n    &lt;Properties&gt;\n        &lt;Property name=&quot;encProvider&quot;/&gt;\n    &lt;/Properties&gt;\n    &lt;Appenders&gt;\n        &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;\n            &lt;PatternLayout pattern=&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg_json%n&quot;/&gt;\n            &lt;Filters&gt;\n                &lt;RegexFilter regex=&quot;(?i).*Authorization.*&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;\n                &lt;RegexFilter regex=&quot;(?i).*getAccessToken.*&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;\n                &lt;RegexFilter regex=&quot;(?i).*jwt.*&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot;/&gt;\n            &lt;/Filters&gt;\n        &lt;/Console&gt;\n    &lt;/Appenders&gt;\n\n    &lt;Loggers&gt;\n        &lt;Root level=&quot;info&quot;&gt;\n            &lt;AppenderRef ref=&quot;Console&quot;/&gt;\n        &lt;/Root&gt;\n    &lt;/Loggers&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<p>Pom for log4j2</p>\n<pre><code>  &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n            &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;\n            &lt;version&gt;${log4j.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n            &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;\n            &lt;version&gt;${log4j.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n            &lt;artifactId&gt;log4j-slf4j2-impl&lt;/artifactId&gt;\n            &lt;version&gt;${log4j.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n            &lt;artifactId&gt;log4j-layout-template-json&lt;/artifactId&gt;\n            &lt;version&gt;${log4j.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;excludes&gt;\n                        &lt;exclude&gt;\n                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                        &lt;/exclude&gt;\n                    &lt;/excludes&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;annotationProcessorPaths&gt;\n                        &lt;path&gt;\n                            &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n                            &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;\n                            &lt;version&gt;${mapstruct.version}&lt;/version&gt;\n                        &lt;/path&gt;\n                        &lt;path&gt;\n                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                            &lt;version&gt;${lombok.version}&lt;/version&gt;\n                        &lt;/path&gt;\n                        &lt;path&gt;\n                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                            &lt;artifactId&gt;lombok-mapstruct-binding&lt;/artifactId&gt;\n                            &lt;version&gt;${lombok.mapstruct.binding.version}&lt;/version&gt;\n                        &lt;/path&gt;\n                        &lt;path&gt;\n                            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n                            &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;\n                            &lt;version&gt;${log4j2.version}&lt;/version&gt;\n                        &lt;/path&gt;\n                    &lt;/annotationProcessorPaths&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.liquibase&lt;/groupId&gt;\n                &lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;${liquibase.version}&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;propertyFile&gt;\n                        src/main/resources/liquibase/liquibase.properties\n                    &lt;/propertyFile&gt;\n                    &lt;changeLogFile&gt;\n                        src/main/resources/liquibase/db_changelog_master.yaml\n                    &lt;/changeLogFile&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.2.0&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;id&gt;copy-log4j2-plugins&lt;/id&gt;\n                        &lt;phase&gt;process-resources&lt;/phase&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;copy-resources&lt;/goal&gt;\n                        &lt;/goals&gt;\n                        &lt;configuration&gt;\n                            &lt;outputDirectory&gt;${basedir}/src/main/resources/META-INF/org/apache/logging/log4j/core/config/plugins&lt;/outputDirectory&gt;\n                            &lt;resources&gt;\n                                &lt;resource&gt;\n                                    &lt;directory&gt;${project.build.directory}/classes/META-INF/org/apache/logging/log4j/core/config/plugins&lt;/directory&gt;\n                                    &lt;includes&gt;\n                                        &lt;include&gt;Log4j2Plugins.dat&lt;/include&gt;\n                                    &lt;/includes&gt;\n                                &lt;/resource&gt;\n                            &lt;/resources&gt;\n                        &lt;/configuration&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n</code></pre>\n<p>ConsoleLogConverter</p>\n<pre><code>@SuppressWarnings(&quot;unused&quot;)\n@Plugin(name = &quot;ConsoleLogConverter&quot;, category = CATEGORY)\n@ConverterKeys({&quot;msg_json&quot;})\npublic class ConsoleLogConverter extends LogEventPatternConverter implements LogEventAppender {\n\n    public ConsoleLogConverter() {\n        super(&quot;Message&quot;, &quot;message&quot;);\n        System.out.println(&quot;ConsoleLogConverter loaded!&quot;);\n    }\n\n    public static ConsoleLogConverter newInstance(String[] options) {\n        return new ConsoleLogConverter();\n    }\n\n    @Override\n    public void format(LogEvent event, StringBuilder toAppendTo) {\n        appendAsJson(event, toAppendTo);\n    }\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}