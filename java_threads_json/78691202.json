{
  "question": {
    "tags": [
      "python",
      "java",
      "azure-openai"
    ],
    "owner": {
      "account_id": 31867139,
      "reputation": 39,
      "user_id": 24679796,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/c194cd7d7d67240d0c3dd69e92f73b85?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Rich",
      "link": "https://stackoverflow.com/users/24679796/rich"
    },
    "is_answered": false,
    "view_count": 278,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1721943803,
    "creation_date": 1719823278,
    "last_edit_date": 1719829462,
    "question_id": 78691202,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78691202/azure-open-ai-very-different-results-on-gpt4o-between-python-and-java-api",
    "title": "Azure Open AI - very different results on gpt4o between Python and Java API",
    "body": "<p>I am making the same call to Azure Open AI using the Java and Python APIs, and receiving very different results:</p>\n<ol>\n<li>Same System Prompt</li>\n<li>Same User Prompt</li>\n<li>Same (latest) versions of azureai packages for Java and Python</li>\n</ol>\n<p>Despite exactly the same user and system prompts going in, the responses are very very different - with the python prompt being &quot;correct&quot; and following the guidelines supplied in the prompt</p>\n<p>I am supplying a worked example</p>\n<p><strong>User Prompt</strong></p>\n<pre><code>The following text is a customer complaint about Cheque In. Your task is to summarise your understanding of what the customer complaint was about in a few sentences.\n\n&lt;&lt;&lt;COMPLAINT&gt;&gt;&gt;\nI received a check from NS&amp;I for £425 and tried to upload it using the check system on my online account but your system does not accept checks from the government there, I now have to drive 16 miles pay for parking ti the nearest Big Bank bank !! All because your system does not accept government checks !!!!!\n\nAlways follow these guidelines in your response:\n\n&lt;&lt;&lt;GUIDELINES&gt;&gt;&gt;\n* Start with &quot;I understand that…&quot;.\n* DO NOT include anything beyond your summary.\n* Always use active voice.\n* Always address the customer directly using &quot;you&quot;.\n* Refer to the bank as &quot;we&quot; and refer to any human advisor or agent as a colleague.\n* Be clear, polite, and use language that is easy to understand.\n* NEVER include any details about internal bank processes or systems, instead say &quot;our records&quot;.\n* Only use facts from the provided context. DO NOT make up information.\n* This task is VERY sensitive; you MUST NOT make mistakes.\n* DO NOT mention account markers.\n* Always format monetary values as £x,xxx.xx.\n* Use “day month year” format for dates e.g 22 May 2023\n* Only use the last 4 digits of account numbers.\n* Always use British spelling, NOT American.\n</code></pre>\n<p><strong>System Prompt</strong></p>\n<pre><code>You are a complaint handler for a customer service department at Big Bank\n</code></pre>\n<p>Python Code</p>\n<pre class=\"lang-py prettyprint-override\"><code>from dotenv import load_dotenv\nimport os, sys\nimport jwt\nimport openai\nfrom msal import ConfidentialClientApplication\nfrom openai import AzureOpenAI\n\ndef get_jwt_token():\n    # org_constants\n    auth = os.getenv(&quot;MS_AUTH_URL&quot;)\n\n    # Provide Azure Client/App ID and Secret to Variables\n    client_secret = os.getenv(&quot;AZURE_CLIENT_SECRET&quot;)\n    client_id = os.getenv(&quot;AZURE_CLIENT_ID&quot;)\n\n    scope_list = [client_id + &quot;/.default&quot;]\n\n    # Getting JWT Token Using MSAL Methods for OpenAI Authentication\n    app = ConfidentialClientApplication(client_id=client_id, client_credential=client_secret, authority=auth)\n    result = app.acquire_token_for_client(scopes=scope_list)\n    return result.get(&quot;access_token&quot;)\n\napi_base_full_chat = os.getenv(&quot;API_BASE_FULL_CHAT&quot;)\ndeployment_model_chat = os.getenv(&quot;DEPLOYMENT_MODEL_CHAT&quot;)\napi_version_chat = os.getenv(&quot;AZURE_OPENAI_API_VERSION&quot;)\n\ndef create_chat_client():\n    client_chat = AzureOpenAI(\n        api_key=get_jwt_token(),\n        azure_deployment=deployment_model_chat,\n        azure_endpoint=api_base_full_chat,\n        api_version=api_version_chat,\n    )\n    return client_chat\n\nchat = create_chat_client()\n\nresponse = chat.chat.completions.create(\n                model=deployment_model_chat,\n                messages=[\n                    {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a complaint handler for a customer service department at Big Bank&quot;},\n                    {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_prompt},\n                ]\n                )\n\nprint(response.choices[0].message.content)\n</code></pre>\n<p><strong>Java Code</strong></p>\n<pre><code>        this.setEnvironmnet();\n        //Get JWT\n        String auth = String.format(&quot;%s/%s&quot;, &quot;https://login.microsoftonline.com&quot;, System.getProperty(&quot;AZURE_TENANT_ID&quot;));\n        IClientSecret mySecret  = ClientCredentialFactory.createFromSecret(System.getProperty(&quot;AZURE_CLIENT_SECRET&quot;));\n        ConfidentialClientApplication app = ConfidentialClientApplication.builder(System.getProperty(&quot;AZURE_CLIENT_ID&quot;), mySecret)\n                .authority(auth)\n                .proxy(getProxy())\n                .build();\n        Set&lt;String&gt; scopes = new HashSet&lt;&gt;();\n        scopes.add(String.format(&quot;%s/.default&quot;, System.getProperty(&quot;AZURE_CLIENT_ID&quot;)));\n        ClientCredentialParameters params = ClientCredentialParameters.builder(scopes).build();\n        IAuthenticationResult result = app.acquireToken(params).get(5000, TimeUnit.MILLISECONDS);\n\n        //Add JWT to header - get a 401 if try to use TokenCredential!\n        ClientOptions options = new ClientOptions();\n        List&lt;Header&gt; headers = new ArrayList&lt;&gt;();\n        headers.add(new Header(&quot;Authorization&quot;, String.format(&quot;Bearer %s&quot;, result.accessToken())));\n        options.setHeaders(headers);\n\n        //get client\n        OpenAIClient client = new OpenAIClientBuilder()\n                .clientOptions(options)\n                //  .credential(this.getToken())\n                .endpoint(System.getProperty(&quot;AZURE_GPT4O_URL&quot;))\n                .buildClient();\n\n        //Build and submit Prompt\n        List&lt;ChatRequestMessage&gt; chatMessages = new ArrayList&lt;&gt;();\n        chatMessages.add(new ChatRequestSystemMessage(this.getUnderstandingSystemPrompt()));\n        chatMessages.add(new ChatRequestUserMessage(this.getUnderstandingUserPrompt()));\n        ChatCompletionsOptions chatOptions = new ChatCompletionsOptions(chatMessages);\n        ChatCompletions response = this.getClient().getChatCompletions(&quot;gpt4o_2024-05-13&quot;, chatOptions);\n        response.getChoices().forEach(message -&gt; {\n            System.out.println(message.getMessage().getContent());\n        });\n</code></pre>\n<p><strong>Python Results</strong></p>\n<p>I understand that you received a cheque for £425.00 from NS&amp;I and tried to upload it using our cheque system on your online account. Your complaint is that our system does not accept government cheques, which now requires you to drive 16 miles and pay for parking to visit the nearest Big Bank branch.</p>\n<p><strong>Java Results</strong></p>\n<p>Dear Customer,</p>\n<p>Thank you for reaching out to us. I understand your frustration regarding the check deposit issue involving the sum of $425. Please accept my sincere apologies for the inconvenience this has caused you.</p>\n<p>From your message, it appears that you were trying to upload a check using the online system but encountered a problem since our system does not support checks from the government. This has now left you in a situation where you need to drive 16 miles to our nearest branch for parking, which adds to your frustration.</p>\n<p>Please allow me to address your concerns systematically:</p>\n<ol>\n<li><p><strong>Understanding the Issue</strong>:</p>\n<ul>\n<li>We understand that you received a check from the government and attempted to upload it using our online check system.</li>\n<li>The system currently does not accept government-issued checks, causing you to resort to visiting a branch in person.</li>\n</ul>\n</li>\n<li><p><strong>Customer Experience</strong>:</p>\n<ul>\n<li>Your inconvenience in driving a significant distance to visit a branch is duly noted. We empathize with the unexpected trouble this has caused you.</li>\n</ul>\n</li>\n</ol>\n<p>Moving forward, here's what we can do to assist you:</p>\n<ol>\n<li><p><strong>Alternative Submission</strong>:</p>\n<ul>\n<li>You can consider mailing the check to your branch. If you prefer this option, please let us know so we can provide you with the necessary details and ensure a prompt processing and response time.</li>\n</ul>\n</li>\n<li><p><strong>Feedback to Improve</strong>:</p>\n<ul>\n<li>Your feedback will be forwarded to our IT and service teams to evaluate the possibility of including government-issued checks in the online check-processing system.</li>\n</ul>\n</li>\n<li><p><strong>Compensation for Inconvenience</strong>:</p>\n<ul>\n<li>We would like to offer you a small compensation for your inconvenience. Please provide us with your mailing address, and we will send you a reimbursement for your travel expenses.</li>\n</ul>\n</li>\n<li><p><strong>Personal Assistance</strong>:</p>\n<ul>\n<li>If there are any other specific needs or assistance you require, please do not hesitate to let us know. We are here to help you.</li>\n</ul>\n</li>\n</ol>\n<p>Once again, I apologize for the inconvenience and appreciate your understanding and patience as we work to resolve this issue. Thank you for banking with us, and we look forward to providing you with better services in the future.</p>\n<p>Sincerely,</p>\n<p>[Your Name]<br />\nCustomer Service Department<br />\nBig Bank</p>\n<p>As you can see the user prompt appears to be largely ignored in the Java version - any help appreciated</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}