{
  "question": {
    "tags": [
      "java",
      "openid-connect",
      "spring-authorization-server"
    ],
    "owner": {
      "account_id": 34890065,
      "reputation": 11,
      "user_id": 26845920,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/e997f4499620b8ac8963649da1d84512?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Shivesh Kaundinya",
      "link": "https://stackoverflow.com/users/26845920/shivesh-kaundinya"
    },
    "is_answered": false,
    "view_count": 490,
    "answer_count": 3,
    "score": 0,
    "last_activity_date": 1735888292,
    "creation_date": 1724130319,
    "last_edit_date": 1724188449,
    "question_id": 78890688,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78890688/do-we-need-to-save-oauth2authorizationrequest-in-oauth2authorizationservice-save",
    "title": "Do we need to save OAuth2AuthorizationRequest in OAuth2AuthorizationService.save method?",
    "body": "<p>I am using Spring Authorization Server to create an authorization server.</p>\n<p>For saving and retrieving authorizations, I have implemented a custom authorization service implementing the <code>OAuth2AuthorizationService</code> interface. When the <code>save</code> method is invoked, I save the client, grant type, authorized scopes, principal and the tokens available in the <code>authorization</code> object. I do not save any attributes of the authorization object as I have not defined any custom attributes.</p>\n<p>When I send the request to <code>/authorize</code> endpoint, I get beack the authorization code and it is saved to the DB as expected. However, when I invoke the <code>/token</code> endpoint to get the access token, an exception is thrown.</p>\n<pre><code>java.lang.NullPointerException: Cannot invoke &quot;org.springframework.security.oauth2.core.endpoint.OAuth2AuthorizationRequest.getAdditionalParameters()&quot; because\n\n&quot;authorizationRequest&quot; is null at org.springframework.security.oauth2.server.authorization.authentication.CodeVerifierAuthenticator.authenticate(CodeVerifierAuthenticator.java:97) at org.springframework.security.oauth2.server.authorization.authentication.CodeVerifierAuthenticator.authenticatelfAvailable(CodeVerifierAuthenticator.java:73) at org.springframework.security.oauth2.server.authorization.authentication.ClientSecretAuthentication Provider.authenticate(ClientSecretAuthenticationProvider.java:151) at org.springframework.security.authentication.ProviderManager.authenticate(ProviderManager.java:182) at org.springframework.security.authentication. ObservationAuthenticationManager.lambda$authenticate$1(ObservationAuthenticationManager.java:54)\n</code></pre>\n<p>I traced the <code>null</code> OAuth2AuthorizationRequest object to <code>CodeVerifierAuthenticator.authenticate</code> method:</p>\n<pre><code>OAuth2AuthorizationRequest authorizationRequest = (OAuth2AuthorizationRequest)authorization.getAttribute(OAuth2AuthorizationRequest.class.getName()); \n\n</code></pre>\n<p>Since, I am not saving the authorization request present as attribute in authorization object, I cannot fetch it back. Also, I do not think that the authorization request itself would need to be stored.</p>\n<p>Therefore, I want to confirm if it indeed needs to be saved or maybe I am doing something wrong.</p>\n<p>I have tried to create a new authorization request object and assigning it to authorization after fetching it from DB. However, the Authorization request builder is only available for Authorization grant type and required request URI which I don't want to hardcode.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}