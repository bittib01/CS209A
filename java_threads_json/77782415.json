{
  "question": {
    "tags": [
      "java",
      "xml",
      "dom"
    ],
    "owner": {
      "account_id": 1831208,
      "reputation": 168,
      "user_id": 1662571,
      "user_type": "registered",
      "accept_rate": 100,
      "profile_image": "https://www.gravatar.com/avatar/00d1ca229be2313b3d6ea36e06338222?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "sparkey",
      "link": "https://stackoverflow.com/users/1662571/sparkey"
    },
    "is_answered": true,
    "view_count": 312,
    "accepted_answer_id": 77783706,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1711469036,
    "creation_date": 1704737120,
    "question_id": 77782415,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/77782415/java-xml-parsing-document-deferreddocumentimpl-vs-document-xmldocument-disc",
    "title": "Java XML Parsing: Document (DeferredDocumentImpl) vs Document (XMLDocument) Discrepancy in Different Environments",
    "body": "<p>I'm encountering an issue with XML parsing in Java 8 where the same code behaves differently in production compared to lower environments.</p>\n<p>Here's the Java code snippet that prints the XML nodeValue using a partial XPath:</p>\n<pre><code>import org.w3c.dom.Document;\nimport org.w3c.dom.Node;\nimport org.xml.sax.InputSource;\n\nimport javax.xml.parsers.DocumentBuilder;\nimport javax.xml.parsers.DocumentBuilderFactory;\nimport javax.xml.xpath.*;\nimport java.io.ByteArrayInputStream;\nimport java.io.InputStreamReader;\nimport java.nio.charset.StandardCharsets;\n\npublic class XMLParserDemo {\npublic static void main(String[] args) throws Exception {\nfinal String xml = &quot;&lt;?xml version=\\&quot;1.0\\&quot; encoding=\\&quot;UTF-8\\&quot; standalone=\\&quot;yes\\&quot;?&gt;\\n&quot; +\n&quot;&lt;securityDataUpdated xmlns:ns0=\\&quot;http://xmlns.paddy.com/canonical/1\\&quot; xmlns=\\&quot;http://xmlns.paddy.com/canonical/2.1\\&quot; version=\\&quot;362\\&quot;&gt;\\n&quot; +\n&quot; &lt;ns0:header&gt;\\n&quot; +\n&quot; &lt;ns0:correlationId&gt;c3004188-ae3d-11ee-a506-0242ac120002&lt;/ns0:correlationId&gt;\\n&quot; +\n&quot; &lt;ns0:sourceSystem&gt;CASH&lt;/ns0:sourceSystem&gt;\\n&quot; +\n&quot; &lt;ns0:initialCreationDate&gt;2017-05-04&lt;/ns0:initialCreationDate&gt;\\n&quot; +\n&quot; &lt;ns0:creationTimestamp&gt;2023-10-20T03:59:39.256-04:00&lt;/ns0:creationTimestamp&gt;\\n&quot; +\n&quot; &lt;/ns0:header&gt;\\n&quot; +\n&quot; &lt;ns0:comment&gt;hhga1002M&lt;/ns0:comment&gt;\\n&quot; +\n&quot; &lt;securityTypeIndicator&gt;CASH FLOW&lt;/securityTypeIndicator&gt;\\n&quot; +\n&quot; &lt;publishingAssetClass&gt;CF&lt;/publishingAssetClass&gt;\\n&quot; +\n&quot; &lt;cashInformation active=\\&quot;true\\&quot;&gt;\\n&quot; +\n&quot; &lt;productType system=\\&quot;BRDR\\&quot;&gt;FORWARD&lt;/productType&gt;\\n&quot; +\n&quot; &lt;name&gt;COP Onsh Fwd OutRt 10Y&lt;/name&gt;\\n&quot; +\n&quot; &lt;identifier type=\\&quot;ICEBERG-UNIQUE\\&quot;&gt;IX35571185-0&lt;/identifier&gt;\\n&quot; +\n&quot; &lt;identifier type=\\&quot;TICKER\\&quot;&gt;CLO+10Y&lt;/identifier&gt;\\n&quot; +\n&quot; &lt;identifier type=\\&quot;ICEBERG-ID-GLOBAL\\&quot;&gt;BBG00GMFSG55&lt;/identifier&gt;\\n&quot; +\n&quot; &lt;identifier type=\\&quot;PADDY-ID\\&quot;&gt;92157699&lt;/identifier&gt;\\n&quot; +\n&quot; &lt;identifier type=\\&quot;BRDR-UNIQUE-ID\\&quot;&gt;92157699-NA-NA&lt;/identifier&gt;\\n&quot; +\n&quot; &lt;issue active=\\&quot;true\\&quot;&gt;\\n&quot; +\n&quot; &lt;issueActivityStatus&gt;ACTIVE&lt;/issueActivityStatus&gt;\\n&quot; +\n&quot; &lt;/issue&gt;\\n&quot; +\n&quot; &lt;classification&gt;\\n&quot; +\n&quot; &lt;marketSector&gt;Curncy&lt;/marketSector&gt;\\n&quot; +\n&quot; &lt;/classification&gt;\\n&quot; +\n&quot; &lt;adpDetails&gt;\\n&quot; +\n&quot; &lt;adpSrcFlag&gt;false&lt;/adpSrcFlag&gt;\\n&quot; +\n&quot; &lt;adpPrivateRangeFlag&gt;false&lt;/adpPrivateRangeFlag&gt;\\n&quot; +\n&quot; &lt;/adpDetails&gt;\\n&quot; +\n&quot; &lt;BRDRVersionDetails&gt;\\n&quot; +\n&quot; &lt;BRDRVersionNumber&gt;362&lt;/BRDRVersionNumber&gt;\\n&quot; +\n&quot; &lt;BRDRVersionTimestamp&gt;2021-12-10T17:47:32.103-05:00&lt;/BRDRVersionTimestamp&gt;\\n&quot; +\n&quot; &lt;BRDRPublishedTimestamp&gt;2023-10-20T03:59:39.263-04:00&lt;/BRDRPublishedTimestamp&gt;\\n&quot; +\n&quot; &lt;/BRDRVersionDetails&gt;\\n&quot; +\n&quot; &lt;productTaxonomy&gt;\\n&quot; +\n&quot; &lt;lrmProductCode&gt;1234&lt;/lrmProductCode&gt;\\n&quot; +\n&quot; &lt;lrmProductDescription&gt;Obsolete&lt;/lrmProductDescription&gt;\\n&quot; +\n&quot; &lt;/productTaxonomy&gt;\\n&quot; +\n&quot; &lt;isOTISSecurity&gt;true&lt;/isOTISSecurity&gt;\\n&quot; +\n&quot; &lt;isTOMSNSecurity&gt;false&lt;/isTOMSNSecurity&gt;\\n&quot; +\n&quot; &lt;isPolypathSecurity&gt;false&lt;/isPolypathSecurity&gt;\\n&quot; +\n&quot; &lt;ISOCountryCode&gt;IN&lt;/ISOCountryCode&gt;\\n&quot; +\n&quot; &lt;/cashInformation&gt;\\n&quot; +\n&quot;&lt;/securityDataUpdated&gt;&quot;;\n\nDocument doc = getDocFromString(xml);\nSystem.out.println(getValueFromXml(&quot;/*//identifier[@type='BRDR-UNIQUE-ID']/text()&quot;, doc));\n}\n\npublic static Document getDocFromString(String xml) throws Exception {\nDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\nDocumentBuilder builder = factory.newDocumentBuilder();\nInputSource is = new InputSource(new InputStreamReader(new ByteArrayInputStream(xml.getBytes(StandardCharsets.UTF_8))));\nreturn builder.parse(is);\n}\n\npublic static String getValueFromXml(String xPathExpr, Document doc) throws XPathExpressionException {\nXPathFactory xPathfactory = XPathFactory.newInstance();\nXPath xpath = xPathfactory.newXPath();\n\nXPathExpression expr = xpath.compile(xPathExpr);\nNode node = (Node) expr.evaluate(doc, XPathConstants.NODE);\nreturn node != null ? node.getNodeValue() : null;\n}\n}\n</code></pre>\n<p>In lower environments, this code successfully prints the value for any valid <code>XPath</code>. However, in production, the <code>getValueFromXml</code> method returns null for the same <code>XPath</code> expressions.</p>\n<p>Upon remote debugging in production using IntelliJ, I noticed that <code>getDocFromString</code> returns a different structure of the Document object (<code>XMLDocument</code>) in production, as opposed to <code>DeferredDocumentImpl</code> in the lower environments. In the lower environment, the Document object structure consists of <code>fNodeCount</code>, <code>fNodeType</code>, etc., whereas in production, the Document object contains fields like &quot;<code>err</code>&quot; and <code>validateErrNodeStr = &quot;oracle.xml.schemavalidator.nodeerr&quot;</code>, <code>validateErrParentStr = &quot;oracle.xml.schemavalidator.parenterr&quot;</code>.</p>\n<p><strong>Dev (Lower environment)</strong></p>\n<p><a href=\"https://i.sstatic.net/bnv77.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/bnv77.png\" alt=\"enter image description here\" /></a></p>\n<p><strong>Production</strong></p>\n<p><a href=\"https://i.sstatic.net/cDHAc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/cDHAc.png\" alt=\"enter image description here\" /></a></p>\n<p>I'm puzzled as to why the Document structure is different in production, given that the same code, XML, and JDK (Java 8) version are used.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}