{
  "question": {
    "tags": [
      "java",
      "kotlin",
      "jna",
      "comexception",
      "ole-automation"
    ],
    "owner": {
      "account_id": 11743767,
      "reputation": 61,
      "user_id": 8595154,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/1d31d3cd8bb55b642857bf8a1be90546?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Tyrael",
      "link": "https://stackoverflow.com/users/8595154/tyrael"
    },
    "is_answered": true,
    "view_count": 107,
    "answer_count": 1,
    "score": 3,
    "last_activity_date": 1757536671,
    "creation_date": 1755509414,
    "last_edit_date": 1755571389,
    "question_id": 79738509,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79738509/how-to-call-a-com-function-with-a-variant-parameter-using-jna",
    "title": "How to call a COM function with a Variant * parameter using JNAï¼Ÿ",
    "body": "<p>Background and environment:</p>\n<p>I have a Windows software installed, which has a Component Model Object. The COM provides a function:</p>\n<pre><code>long GetValue(VARIANT* v, short a, short b, [optional] VARIANT c, [optional] VARIANT d);\n</code></pre>\n<p>I got the function signature information by the <code>oleview.exe</code>  tool.</p>\n<p>There is a C# example. I need to refactor it to Kotlin.</p>\n<pre><code>object valOutput = null;\nshort a = 1;\nshort b = 101;\nstring c = &quot;0&quot;;\nstring d = &quot;m&quot;;\no.GetValue(ref valOutput, a, b, c, d);\n</code></pre>\n<p>Problem:</p>\n<p>I am using JNA and Kotlin to refactor the C# example.</p>\n<p>I have successfully initialized the COM and called some functions. Everything works until I call the &quot;GetValue&quot; function.</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>val valOutput = Variant.VARIANT()\nval a = 1\nval b = 101\nval c = &quot;0&quot;\nval d = &quot;m&quot;\no.GetValue(valOutput, a.toShort(), b.toShort(), c, d)\n</code></pre>\n<p>I got an Exception:</p>\n<pre><code>com.sun.jna.platform.win32.COM.COMInvokeException: Type mismatch. (HRESULT: 80020005) (puArgErr=4)\n    at com.sun.jna.platform.win32.COM.COMUtils.checkRC(COMUtils.java:187)\n    at com.sun.jna.platform.win32.COM.util.ProxyObject.oleMethod(ProxyObject.java:736)\n    at com.sun.jna.platform.win32.COM.util.ProxyObject.invokeMethod(ProxyObject.java:450)\n    at com.sun.jna.platform.win32.COM.util.ProxyObject.invoke(ProxyObject.java:256)\n    at com.sun.proxy.$Proxy26.GetValueEx(Unknown Source)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:566)\n    at com.sun.jna.platform.win32.COM.util.Factory$ProxyObject2$1.call(Factory.java:98)\n    at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n    at java.base/java.lang.Thread.run(Thread.java:829)\n    at java.base/java.util.concurrent.FutureTask.report(FutureTask.java:122)\n    at java.base/java.util.concurrent.FutureTask.get(FutureTask.java:205)\n    at com.sun.jna.platform.win32.COM.util.ComThread.execute(ComThread.java:155)\n    at com.sun.jna.platform.win32.COM.util.Factory.runInComThread(Factory.java:172)\n    at com.sun.jna.platform.win32.COM.util.Factory.access$100(Factory.java:56)\n    at com.sun.jna.platform.win32.COM.util.Factory$ProxyObject2.invoke(Factory.java:95)\n...\n</code></pre>\n<p>What does the exception mean? How to fix it?</p>\n<p>I have changed the calling Kotlin code as below and got the same exception.</p>\n<pre><code>val valOutput = Variant.VARIANT.ByReference()\no.GetValue(valOutput, a.toShort(), b.toShort(), c, d)\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}