{
  "question": {
    "tags": [
      "java",
      "animation",
      "javafx",
      "key-value"
    ],
    "owner": {
      "account_id": 12506291,
      "reputation": 821,
      "user_id": 9103039,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name": "Starnec",
      "link": "https://stackoverflow.com/users/9103039/starnec"
    },
    "is_answered": true,
    "view_count": 184,
    "accepted_answer_id": 79783939,
    "answer_count": 1,
    "score": 4,
    "last_activity_date": 1759931031,
    "creation_date": 1759664241,
    "question_id": 79782956,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79782956/instant-animation-with-keyvalue-when-using-the-overlay-parent-height-as-the-targ",
    "title": "Instant animation with KeyValue when using the overlay parent height as the target value",
    "body": "<p>I previously posted a <a href=\"https://stackoverflow.com/questions/79782134/how-to-make-an-overlay-animation-in-a-stackpane-with-javafx\">question</a> about why the overlay animation in the <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/layout/StackPane.html\" rel=\"nofollow noreferrer\">StackPane</a> container occurs instantly when using <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/animation/KeyFrame.html\" rel=\"nofollow noreferrer\">KeyFrame</a>.</p>\n<p>@Slaw pointed out the root of the issue in a <a href=\"https://stackoverflow.com/questions/79782134/how-to-make-an-overlay-animation-in-a-stackpane-with-javafx#comment-140776591:%7E:text=A%20couple%20things,yesterday\">comment</a>:</p>\n<blockquote>\n<p>You're using on-finished handlers of <code>KeyFrame</code>. Those are executed once at the end of the frame's duration. They do not cause the value to change incrementally over time.</p>\n</blockquote>\n<p>And to solve it:</p>\n<blockquote>\n<p>For that, pass a <code>KeyValue</code> when creating the <code>KeyFrame</code></p>\n</blockquote>\n<p>He also suggested reading his <a href=\"https://stackoverflow.com/questions/77385708/is-there-a-way-to-detect-the-same-event-on-multiple-nodes/77386307#77386307\">answer</a> to a previously posted <a href=\"https://stackoverflow.com/questions/77385708/is-there-a-way-to-detect-the-same-event-on-multiple-nodes\">question</a>, explaining how similar animations should be handled.</p>\n<h2>Solution</h2>\n<p>Following @slaw, answer: the <code>OverLayAnimation</code> class handles the <code>overlay</code> and <code>iconLabel</code> animations, respectively, using <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/animation/ParallelTransition.html\" rel=\"nofollow noreferrer\">ParallelTransition</a>, for both sliding the overlay down and fading the label in. <code>playForward()</code>  <code>playBackward()</code> handles both events <code>MOUSE_ENTERED</code>  <code>MOUSE_EXITED</code></p>\n<h2>Problem</h2>\n<p>The <code>createToBottomAnimation()</code> returns a <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/animation/Timeline.html\" rel=\"nofollow noreferrer\">Timeline</a> for transitioning the overlay. When the Keyframe's to value is hardcoded (200, for example), the animation occurs smoothly and the max height updates gradually. However, the issue is that when resizing the window, the overlay will not fill all its container since its <code>parent</code> has grown and the value is hardcoded.</p>\n<p>For that, I set the value to <code>overlay.getParent().getMaxHeight()</code>. The overlay does fill its container now, but <strong>no animation is occurring</strong></p>\n<h2>Code</h2>\n<pre><code>import javafx.animation.*;\nimport javafx.application.Application;\nimport javafx.geometry.Insets;\nimport javafx.geometry.Pos;\nimport javafx.scene.Scene;\nimport javafx.scene.control.Label;\nimport javafx.scene.image.Image;\nimport javafx.scene.image.ImageView;\nimport javafx.scene.input.MouseEvent;\nimport javafx.scene.layout.*;\nimport javafx.stage.Stage;\nimport javafx.util.Duration;\n\nimport java.util.Objects;\n\npublic class Example extends Application {\n    private ImageView createImageIcon(String path) {\n        Image image = new Image(Objects.requireNonNull(getClass().getResourceAsStream(path)));\n        ImageView imageView = new ImageView(image);\n        imageView.setPreserveRatio(true);\n        imageView.setFitHeight(200);\n        imageView.setFitWidth(200);\n\n        return imageView;\n    }\n\n    private Pane crateImageIconContainer(ImageView image, VBox overlay, String iconTitle, HBox rootElement) {\n        Pane region = new Pane();\n        HBox.setMargin(region, new Insets(30, 30, 30, 30));\n        region.maxWidthProperty().bind(rootElement.widthProperty().divide(3));\n        region.maxHeightProperty().bind(region.widthProperty());\n        region.setPrefSize(400, 400);\n\n        StackPane stackableContainer = new StackPane();\n        HBox.setMargin(stackableContainer, new Insets(30, 30, 30, 30));\n        stackableContainer.prefWidthProperty().bind(region.widthProperty());\n        stackableContainer.prefHeightProperty().bind(region.heightProperty());\n\n        stackableContainer.setStyle(&quot;-fx-background-color: #ff0000;&quot;);\n\n        region.getChildren().add(stackableContainer);\n\n        image.fitWidthProperty().bind(stackableContainer.widthProperty().divide(1.5));\n        image.fitHeightProperty().bind(stackableContainer.heightProperty().divide(1.5));\n\n        Label iconLabel = new Label(iconTitle);\n        iconLabel.setOpacity(0);\n        overlay.getChildren().add(iconLabel);\n\n        overlay.setAlignment(Pos.CENTER);\n        StackPane.setAlignment(overlay, Pos.TOP_CENTER);\n        overlay.setStyle(&quot;-fx-background-color: #ffffff;&quot;);\n        overlay.setOpacity(0.8);\n        overlay.setMaxHeight(0);\n\n        stackableContainer.getChildren().addAll(image, overlay);\n\n        var animation = new OverLayAnimation(overlay, iconLabel);\n        stackableContainer.addEventHandler(MouseEvent.MOUSE_ENTERED, e -&gt; {\n            e.consume();\n            animation.playForward();\n        });\n        stackableContainer.addEventHandler(MouseEvent.MOUSE_EXITED, e -&gt; {\n            e.consume();\n            animation.playBackward();\n        });\n        return region;\n    }\n\n    @Override\n    public void start(Stage primaryStage) throws Exception {\n        HBox mainContainer = new HBox();\n        HBox.setHgrow(mainContainer, Priority.ALWAYS);\n        mainContainer.setAlignment(Pos.CENTER);\n        mainContainer.setStyle(&quot;-fx-background-color: #00396c;&quot;);\n\n        ImageView photoIcon = createImageIcon(&quot;../resources/photo.png&quot;);\n        ImageView videoIcon = createImageIcon(&quot;../resources/video.png&quot;);\n        ImageView webCamIcon = createImageIcon(&quot;../resources/webcam.png&quot;);\n\n        Pane photoIconContainer = crateImageIconContainer(photoIcon, new VBox(), &quot;Photo&quot;, mainContainer);\n        Pane videoIconContainer = crateImageIconContainer(videoIcon, new VBox(), &quot;Video&quot;, mainContainer);\n        Pane webCamIconContainer = crateImageIconContainer(webCamIcon, new VBox(), &quot;Web Cam&quot;, mainContainer);\n\n        mainContainer.getChildren().addAll(photoIconContainer, videoIconContainer, webCamIconContainer);\n\n        Scene scene = new Scene(mainContainer, 900, 350);\n        primaryStage.setTitle(&quot;Color isolator&quot;);\n        primaryStage.setScene(scene);\n        primaryStage.show();\n    }\n\n    private static class OverLayAnimation {\n        private final VBox overlay;\n        private final Label iconLabel;\n        private static final Duration DURATION = Duration.millis(350);\n        private final ParallelTransition transition;\n\n        OverLayAnimation(VBox overlay, Label iconLabel) {\n            this.overlay = overlay;\n            this.iconLabel = iconLabel;\n\n            var toBottom = createToBottomAnimation();\n            var fadeInOut = createFadeInAndOutAnimation();\n\n            transition = new ParallelTransition(toBottom, fadeInOut);\n        }\n\n        void playForward() {\n            transition.setRate(1);\n            transition.play();\n        }\n\n        void playBackward() {\n            // Does not execute\n            // transition.setRate(-1);\n            // transition.play();\n\n            KeyValue x = new KeyValue(overlay.maxHeightProperty(), 0);\n            KeyFrame frame = new KeyFrame(DURATION, x);\n            Timeline timeline = new Timeline(frame);\n            timeline.play();\n        }\n\n        private Animation createToBottomAnimation() {\n            // Animate instantly\n            KeyValue x = new KeyValue(overlay.maxHeightProperty(), ((Pane) overlay.getParent()).getMaxHeight());\n\n            // Animate smoothly\n            // KeyValue x = new KeyValue(overlay.maxHeightProperty(), 200);\n            KeyFrame frame = new KeyFrame(DURATION, x);\n            return new Timeline(frame);\n        }\n\n        private Animation createFadeInAndOutAnimation() {\n            var fadeInOut = new FadeTransition(DURATION, iconLabel);\n            fadeInOut.setFromValue(0);\n            fadeInOut.setToValue(1);\n            return fadeInOut;\n        }\n    }\n}\n</code></pre>\n<h2>Results</h2>\n<p>This is how the <a href=\"https://imgur.com/a/UOA0hr4\" rel=\"nofollow noreferrer\">instant</a> animation look like. And <a href=\"https://imgur.com/a/1H5oR47\" rel=\"nofollow noreferrer\">this</a> is how the animation is supposed to look like, but since the to value is 200, it will not fill the container.</p>\n<p>I would like to know why the animation occurs instantly and, if possible, why <code>setRate(-1)</code> in <code>playBackward()</code> does not cause the keyFrame to go backward with the overlay animation.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}