{
  "question": {
    "tags": [
      "java",
      "oracle-database",
      "jdbc"
    ],
    "owner": {
      "account_id": 14484134,
      "reputation": 1,
      "user_id": 10463531,
      "user_type": "registered",
      "profile_image": "https://lh5.googleusercontent.com/-lAkkaUFxnTQ/AAAAAAAAAAI/AAAAAAAAAtY/Fu9fbLP2E6c/s256-rj/photo.jpg",
      "display_name": "Santiago ",
      "link": "https://stackoverflow.com/users/10463531/santiago"
    },
    "is_answered": false,
    "view_count": 79,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1717415598,
    "creation_date": 1716353316,
    "last_edit_date": 1717415598,
    "question_id": 78515370,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78515370/databasechangelistener-not-showing-event-changes",
    "title": "DatabaseChangeListener not showing event changes",
    "body": "<p>I am implementing DCN to get notifications for records being inserted into a table. When I try inserting records, either within the application or with external scripts, it does not show the events in the console.</p>\n<p>The next code is my implementation:</p>\n<pre><code>package co.app.dcn;\n\nimport oracle.jdbc.OracleConnection;\nimport oracle.jdbc.OracleDriver;\nimport oracle.jdbc.OracleStatement;\nimport oracle.jdbc.dcn.DatabaseChangeRegistration;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.stereotype.Component;\n\nimport javax.annotation.PostConstruct;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Statement;\nimport java.util.Properties;\n\n@Component\npublic class OracleDCNListener {\n\n    @Autowired\n    private JdbcTemplate jdbcTemplate;\n\n    @Value(&quot;${spring.datasource.username}&quot;)\n    private String DCN_USER;\n\n    @Value(&quot;${spring.datasource.password}&quot;)\n    private String DCN_PASSWORD;\n\n    @Value(&quot;${spring.datasource.url}&quot;)\n    private String DCN_URL;\n\n    @PostConstruct\n    public void initialize() throws SQLException {\n\n\n        var conn = connect();\n\n        var prop = new Properties();\n\n        prop.setProperty(OracleConnection.DCN_NOTIFY_ROWIDS, &quot;true&quot;);\n        prop.setProperty(OracleConnection.DCN_QUERY_CHANGE_NOTIFICATION, &quot;true&quot;);\n\n        DatabaseChangeRegistration dcr = conn.registerDatabaseChangeNotification(prop);\n\n        try {\n            DCNListener list = new DCNListener(this);\n            dcr.addListener(list);\n\n            // second step: add objects in the registration:\n            Statement stmt = conn.createStatement();\n            // associate the statement with the registration:\n            ((OracleStatement) stmt).setDatabaseChangeRegistration(dcr);\n            ResultSet rs = stmt.executeQuery(&quot;SELECT * FROM CONTRATOS.CON_ESTADOS_PAGOS_CONTRATOS_NOTIFY&quot;);\n\n            String[] tableNames = dcr.getTables();\n            for (int i = 0; i &lt; tableNames.length; i++)\n                System.out.println(tableNames[i] + &quot; is part of the registration.&quot;);\n            rs.close();\n            stmt.close();\n        } catch (SQLException ex) {\n            if (conn != null)\n                conn.unregisterDatabaseChangeNotification(dcr);\n            throw ex;\n        } finally {\n            try {\n                // Note that we close the connection!\n                conn.close();\n            } catch (Exception innerex) {\n                innerex.printStackTrace();\n            }\n        }\n\n        synchronized (this) {\n            // The following code modifies the dept table and commits:\n            try {\n                OracleConnection conn2 = connect();\n                conn2.setAutoCommit(false);\n                Statement stmt2 = conn2.createStatement();\n                stmt2.executeUpdate(&quot;insert into contratos.CON_ESTADOS_PAGOS_CONTRATOS_NOTIFY (ID, ID_CLASE_DOCUMENTO, NUMERO_DOCUMENTO, OBSERVACIONES, ID_ESTADO, DESCRIPCION_ESTADO, FECHA_HORA_CREACION) values (99999920, 0, 0, ' ', 0, ' ', ' ')&quot;,\n                        Statement.RETURN_GENERATED_KEYS);\n                ResultSet autoGeneratedKey = stmt2.getGeneratedKeys();\n                if (autoGeneratedKey.next())\n                    System.out.println(&quot;inserted one row with ROWID=&quot; + autoGeneratedKey.getString(1));\n                stmt2.executeUpdate(&quot;insert into contratos.CON_ESTADOS_PAGOS_CONTRATOS_NOTIFY (ID, ID_CLASE_DOCUMENTO, NUMERO_DOCUMENTO, OBSERVACIONES, ID_ESTADO, DESCRIPCION_ESTADO, FECHA_HORA_CREACION) values (99999922, 0, 0, ' ', 0, ' ', ' ')&quot;,\n                        Statement.RETURN_GENERATED_KEYS);\n                autoGeneratedKey = stmt2.getGeneratedKeys();\n                if (autoGeneratedKey.next())\n                    System.out.println(&quot;inserted one row with ROWID=&quot; + autoGeneratedKey.getString(1));\n                stmt2.close();\n                conn2.commit();\n                conn2.close();\n            } catch (SQLException ex) {\n                ex.printStackTrace();\n            }\n\n            // wait until we get the event\n            try {\n                this.wait();\n            } catch (InterruptedException ie) {\n            }\n        }\n\n        // At the end: close the registration (comment out these 3 lines in order\n        // to leave the registration open).\n        //OracleConnection conn3 = connect();\n        //conn3.unregisterDatabaseChangeNotification(dcr);\n        //conn3.close();\n    }\n\n    OracleConnection connect() throws SQLException {\n        OracleDriver dr = new OracleDriver();\n        Properties prop = new Properties();\n        prop.setProperty(&quot;user&quot;, DCN_USER);\n        prop.setProperty(&quot;password&quot;, DCN_PASSWORD);\n\n        return (OracleConnection) dr.connect(DCN_URL, prop);\n    }\n\n}\n</code></pre>\n<pre><code>package co.app.dcn;\n\nimport oracle.jdbc.dcn.DatabaseChangeEvent;\nimport oracle.jdbc.dcn.DatabaseChangeListener;\n\npublic class DCNListener implements DatabaseChangeListener {\n\n    OracleDCNListener oracleDCNListener;\n\n    public DCNListener(OracleDCNListener oracleDCNListener) {\n        this.oracleDCNListener = oracleDCNListener;\n    }\n\n    public void onDatabaseChangeNotification(DatabaseChangeEvent e)\n    {\n        Thread t = Thread.currentThread();\n        System.out.println(&quot;DCNDemoListener: got an event (&quot;+this+&quot; running on thread &quot;+t+&quot;)&quot;);\n        System.out.println(e.toString());\n        synchronized( oracleDCNListener ){ oracleDCNListener.notify();}\n    }\n}\n</code></pre>\n<p>I already checked SELECT * FROM USER_CHANGE_NOTIFICATION_REGS and yes the records of the registration are being created.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}