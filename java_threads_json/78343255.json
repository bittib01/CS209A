{
  "question": {
    "tags": [
      "java",
      "redis",
      "quarkus",
      "vert.x",
      "amazon-elasticache"
    ],
    "owner": {
      "account_id": 15676985,
      "reputation": 93,
      "user_id": 11312013,
      "user_type": "registered",
      "profile_image": "https://lh4.googleusercontent.com/--VSKUaB3mAg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdXAe7cOv3fQ7m26TMZh8Ei3fq6Gg/mo/s256-rj/photo.jpg",
      "display_name": "Konstantin Rezchikov",
      "link": "https://stackoverflow.com/users/11312013/konstantin-rezchikov"
    },
    "is_answered": false,
    "view_count": 586,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1715201935,
    "creation_date": 1713380088,
    "question_id": 78343255,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78343255/quarkus-redis-client-is-creating-huge-amount-of-connections",
    "title": "Quarkus Redis Client is creating huge amount of connections",
    "body": "<p>In my quarkus redis client, I am creating way more connections than my connection pool should allow. I am not sure why this is happening. My connection pool has <code>maxPoolSize = 6 maxPoolWaiting = 24</code> but yet my elasticache service shows that my current connections on my shards went up to 1.4k and 700. <a href=\"https://i.sstatic.net/zqZZA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/zqZZA.png\" alt=\"Elasticache Current Connections\" /></a></p>\n<p>Why is this happening and how can I limit the amount of connections that my quarkus client is creating? This amount of connections is causing me the cache to have a  high cpu usage which is not good for scaling.</p>\n<p>I am using <code>   &lt;quarkus.platform.version&gt;2.16.4.Final&lt;/quarkus.platform.version&gt;</code>\nThis is the code I've been using to customize the RedisOptions.</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @Override\n    public void customize(String clientName, RedisOptions options) {\n        NetClientOptions netOptions = options.getNetClientOptions();\n        netOptions.setSsl(true).setHostnameVerificationAlgorithm(&quot;HTTPS&quot;)\n                .setReconnectAttempts(reconnectAttempts).setReconnectInterval(reconnectInterval).setConnectTimeout(connectTimeout)\n                .setTcpKeepAlive(true).setIdleTimeout(5000).setIdleTimeoutUnit(TimeUnit.MILLISECONDS);\n    }\n</code></pre>\n<p>and this is how I am using the RedisClient in my code</p>\n<pre class=\"lang-java prettyprint-override\"><code>\n    @Inject\n    public CacheService(\n            @RedisClientName(&quot;cache&quot;) @NotNull ReactiveRedisDataSource reactiveRedisDataSource,\n    ) {\n        commands = reactiveRedisDataSource.value(byte[].class);\n        keyCommands = reactiveRedisDataSource.key();\n}\n\n    public Uni&lt;Optional&lt;Item&gt;&gt; getItem(String key) {\n        return commands.get(key).onItem().transform(&quot;turnFromBytestoItem&quot;);\n    }\n</code></pre>\n<p>and this is my connection logic in the application.properties</p>\n<pre><code>quarkus.redis.cache.hosts=rediss://${HOST:localhost}:6379\nquarkus.redis.cache.client-type=cluster\nquarkus.redis.cache.replicas=share\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}