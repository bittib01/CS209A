{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "websocket",
      "jhipster"
    ],
    "owner": {
      "account_id": 24548949,
      "reputation": 1094,
      "user_id": 18458353,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/3k4Po.png?s=256",
      "display_name": "Charfeddine Mohamed Ali",
      "link": "https://stackoverflow.com/users/18458353/charfeddine-mohamed-ali"
    },
    "is_answered": true,
    "view_count": 152,
    "accepted_answer_id": 79524121,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1754665011,
    "creation_date": 1742157407,
    "last_edit_date": 1742505913,
    "question_id": 79513210,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79513210/spring-websocket-configuration",
    "title": "Spring Websocket configuration",
    "body": "<p>I am trying to set up a WebSocket server using Spring Boot and i tried to connect to it using Postman (New Request â†’ WebSocket). However, I keep getting the following error response:</p>\n<pre><code>Error: Unexpected server response: 200\n</code></pre>\n<p>This is my WebSocketConfig.java</p>\n<pre><code>import org.springframework.context.annotation.Configuration;\nimport org.springframework.messaging.simp.config.MessageBrokerRegistry;\nimport org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;\nimport org.springframework.web.socket.config.annotation.StompEndpointRegistry;\nimport org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;\n\n@Configuration\n@EnableWebSocketMessageBroker\npublic class WebSocketConfig implements WebSocketMessageBrokerConfigurer {\n\n    @Override\n    public void configureMessageBroker(MessageBrokerRegistry config) {\n        config.enableSimpleBroker(&quot;/topic&quot;); \n        config.setApplicationDestinationPrefixes(&quot;/app&quot;); \n    }\n\n    @Override\n    public void registerStompEndpoints(StompEndpointRegistry registry) {\n        registry.addEndpoint(&quot;/ws&quot;) \n            .setAllowedOrigins(&quot;*&quot;).withSockJS(); \n        ;\n    }\n}\n</code></pre>\n<p>This is my security config</p>\n<pre><code>\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        // @formatter:off\n        http\n            .csrf().disable() // ðŸš€ Fully disables CSRF protection\n            .addFilterBefore(corsFilter, UsernamePasswordAuthenticationFilter.class)\n            .exceptionHandling()\n                .authenticationEntryPoint(problemSupport)\n                .accessDeniedHandler(problemSupport)\n        .and()\n            .headers()\n                .contentSecurityPolicy(jHipsterProperties.getSecurity().getContentSecurityPolicy())\n            .and()\n                .referrerPolicy(ReferrerPolicyHeaderWriter.ReferrerPolicy.STRICT_ORIGIN_WHEN_CROSS_ORIGIN)\n            .and()\n                .permissionsPolicy().policy(&quot;camera=(), fullscreen=(self), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), midi=(), payment=(), sync-xhr=()&quot;)\n            .and()\n                .frameOptions().sameOrigin()\n        .and()\n            .sessionManagement()\n                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)\n        .and()\n            .authorizeRequests()\n            .antMatchers(HttpMethod.OPTIONS, &quot;/**&quot;).permitAll()\n            .antMatchers(&quot;/app/**/*.{js,html}&quot;).permitAll()\n            .antMatchers(&quot;/ws/**&quot;).permitAll()\n            .antMatchers(&quot;/i18n/**&quot;).permitAll()\n            .antMatchers(&quot;/content/**&quot;).permitAll()\n            .antMatchers(&quot;/swagger-ui/**&quot;).permitAll()\n            .antMatchers(&quot;/test/**&quot;).permitAll()\n            .antMatchers(&quot;/h2-console/**&quot;).permitAll()\n            .antMatchers(&quot;/api/authenticate&quot;).permitAll()\n            .antMatchers(&quot;/api/register&quot;).permitAll()\n            .antMatchers(&quot;/api/activate&quot;).permitAll()\n            .antMatchers(HttpMethod.GET, &quot;/api/products/{id}&quot;).permitAll()\n            .antMatchers(&quot;/api/account/reset-password/init&quot;).permitAll()\n            .antMatchers(&quot;/api/account/reset-password/finish&quot;).permitAll()\n            .antMatchers(&quot;/api/_search/products/public&quot;).permitAll()\n            .antMatchers(&quot;/api/products/public&quot;).permitAll()\n            .antMatchers(&quot;/api/products/public/trending&quot;).permitAll()\n            .antMatchers(&quot;/api/product-categories/public&quot;).permitAll()\n            .antMatchers(&quot;/api/admin/**&quot;).hasAuthority(AuthoritiesConstants.ADMIN)\n            .antMatchers(&quot;/api/**&quot;).authenticated()\n            .antMatchers(&quot;/management/health&quot;).permitAll()\n            .antMatchers(&quot;/management/health/**&quot;).permitAll()\n            .antMatchers(&quot;/management/info&quot;).permitAll()\n            .antMatchers(&quot;/management/prometheus&quot;).permitAll()\n            .antMatchers(&quot;/management/**&quot;).hasAuthority(AuthoritiesConstants.ADMIN)\n            .and()\n            .httpBasic()\n            .and()\n            .apply(securityConfigurerAdapter());\n        return http.build();\n        // @formatter:on\n    }\n\n    @Bean\n    public SessionRegistry sessionRegistry() {\n        return new SessionRegistryImpl();\n    }\n\n    private JWTConfigurer securityConfigurerAdapter() {\n        return new JWTConfigurer(tokenProvider);\n    }\n}\n</code></pre>\n<p>and this is the logs i got when starting the app</p>\n<pre><code>2025-03-16 02:17:31 2025-03-16T02:17:31.170Z DEBUG 1 --- [           main] o.s.m.s.ExecutorSubscribableChannel      : clientOutboundChannel added SubProtocolWebSocketHandler[StompSubProtocolHandler[v10.stomp, v11.stomp, v12.stomp]] \n2025-03-16 02:17:31 2025-03-16T02:17:31.170Z DEBUG 1 --- [           main] o.s.m.s.ExecutorSubscribableChannel      : clientInboundChannel added WebSocketAnnotationMethodMessageHandler[prefixes=[/app/]] \n2025-03-16 02:17:31 2025-03-16T02:17:31.171Z  INFO 1 --- [           main] o.s.m.s.b.SimpleBrokerMessageHandler     : Starting... \n2025-03-16 02:17:31 2025-03-16T02:17:31.171Z DEBUG 1 --- [           main] o.s.m.s.ExecutorSubscribableChannel      : clientInboundChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1c1ab84e] \n2025-03-16 02:17:31 2025-03-16T02:17:31.171Z DEBUG 1 --- [           main] o.s.m.s.ExecutorSubscribableChannel      : brokerChannel added SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1c1ab84e] \n2025-03-16 02:17:31 2025-03-16T02:17:31.171Z  INFO 1 --- [           main] o.s.m.s.b.SimpleBrokerMessageHandler     : BrokerAvailabilityEvent[available=true, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@1c1ab84e]] \n2025-03-16 02:17:31 2025-03-16T02:17:31.171Z  INFO 1 --- [           main] o.s.m.s.b.SimpleBrokerMessageHandler     : Started. \n2025-03-16 02:17:31 2025-03-16T02:17:31.171Z DEBUG 1 --- [           main] o.s.m.s.ExecutorSubscribableChannel      : clientInboundChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]] \n2025-03-16 02:17:31 2025-03-16T02:17:31.171Z DEBUG 1 --- [           main] o.s.m.s.ExecutorSubscribableChannel      : brokerChannel added UserDestinationMessageHandler[DefaultUserDestinationResolver[prefix=/user/]]\n</code></pre>\n<pre><code>2025-03-16 02:18:30 2025-03-16T02:18:30.492Z  INFO 1 --- [MessageBroker-1] o.s.w.s.c.WebSocketMessageBrokerStats    : WebSocketSession[0 current WS(0)-HttpStream(0)-HttpPoll(0), 0 total, 0 closed abnormally (0 connect failure, 0 send limit, 0 transport error)], stompSubProtocol[processed CONNECT(0)-CONNECTED(0)-DISCONNECT(0)], stompBrokerRelay[null], inboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], outboundChannel[pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], sockJsScheduler[pool size = 3, active threads = 1, queued tasks = 2, completed tasks = 0]\n</code></pre>\n<p><strong>What I Have Tried</strong>\nConnecting using Postman with:</p>\n<ul>\n<li>ws://localhost:8080/ws/websocket (with .withSockJS())</li>\n<li>ws://localhost:8080/ws (without .withSockJS())</li>\n<li>Ensured that /ws/** is accessible in Spring Security.</li>\n<li>Disabled CSRF</li>\n</ul>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}