{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-security",
      "jwt",
      "spring-authorization-server"
    ],
    "owner": {
      "account_id": 28468254,
      "reputation": 35,
      "user_id": 21783983,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/ANssh.png?s=256",
      "display_name": "leo",
      "link": "https://stackoverflow.com/users/21783983/leo"
    },
    "is_answered": true,
    "view_count": 310,
    "accepted_answer_id": 79461377,
    "answer_count": 1,
    "score": 2,
    "last_activity_date": 1740320249,
    "creation_date": 1740283594,
    "question_id": 79460663,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79460663/spring-oauth2authorizationservice-implementations-persist-jwt-access-tokens",
    "title": "Spring OAuth2AuthorizationService implementations persist JWT access tokens",
    "body": "<p>I recently began developing an OAuth/OIC identity provider with Spring Boot 3, Spring Security 6, and Spring Authorization Server. I'm new to OAuth but have some experience with session-based web authentication, and generally understand JWTs.</p>\n<p>My current plan to authenticate users is to issue <strong>opaque</strong> refresh tokens and self-contained <strong>JWT</strong> access tokens. This way, I get the benefit of being able to revoke the long lived refresh tokens at will (because they are checked against the server-side every time they're used), but the shorter-lived access tokens can be used and trusted without the client having to ask the server for anything (except the public signing key). The refresh token will be used every once in a while to request a new access token from the server when the old one expires.</p>\n<p>While implementing this with Spring Authorization Server, I came across the OAuth2AuthorizationService interface. This interface will store OAuth2Authorization objects persistently (or in memory, depending on which implementation is used). OAuth2Authorization objects can contain both a refresh token and access token. Why do the both of these need to be stored with the OAuth2AuthorizationService?</p>\n<p>If I was using an opaque access token it would make sense, but I'm using a JWT access token. so there's no benefit to storing them persistently because they are supposed to be trusted as-is until they expire. Clients aren't expected to check a JWT against the server, because that defeats the point of the token being self-contained!</p>\n<p>Is there something I'm missing, or are the default implementations of OAuth2AuthorizationService just covering their bases by storing both tokens server-side, just in case you configured refresh tokens and access tokens to be opaque? I'm going to be storing my tokens server-side in a persistent Redis instance, so I don't want to waste space in memory unless I absolutely have to. Is it okay for my implementation of OAuth2AuthorizationService to just store refresh tokens and map them to a user's ID or information, then build the OAuth2Authorization object on the spot when it's requested?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}