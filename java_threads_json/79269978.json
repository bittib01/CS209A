{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-security"
    ],
    "owner": {
      "account_id": 157966,
      "reputation": 857,
      "user_id": 376263,
      "user_type": "registered",
      "accept_rate": 47,
      "profile_image": "https://www.gravatar.com/avatar/cde0d8ca836f3c2d78087cb8a5bd593e?s=256&d=identicon&r=PG",
      "display_name": "Vish",
      "link": "https://stackoverflow.com/users/376263/vish"
    },
    "is_answered": false,
    "view_count": 176,
    "answer_count": 1,
    "score": 2,
    "last_activity_date": 1753201286,
    "creation_date": 1733869436,
    "last_edit_date": 1733958023,
    "question_id": 79269978,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79269978/nosuchbeandefinitionexception-no-qualifying-bean-of-type-org-springframework-s",
    "title": "NoSuchBeanDefinitionException: No qualifying bean of type &#39;org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager&#39; available",
    "body": "<p>I am trying to get the OAuth2 client going for client credentials grant type and am following the new features released in 6.4 mentioned here <a href=\"https://spring.io/blog/2024/10/28/restclient-support-for-oauth2-in-spring-security-6-4\" rel=\"nofollow noreferrer\">https://spring.io/blog/2024/10/28/restclient-support-for-oauth2-in-spring-security-6-4</a></p>\n<p>I am finding that <code>OAuth2AuthorizedClientManager</code> is not available as mentioned here <a href=\"https://spring.io/blog/2024/10/28/restclient-support-for-oauth2-in-spring-security-6-4#:%7E:text=Spring%20Security%20provides,in%20our%20application\" rel=\"nofollow noreferrer\">https://spring.io/blog/2024/10/28/restclient-support-for-oauth2-in-spring-security-6-4#:~:text=Spring%20Security%20provides,in%20our%20application</a>.</p>\n<p>Error encountered</p>\n<pre><code>\nAction:\n\nConsider defining a bean of type 'org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager' in your configuration.\n\n....\n\n[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.510 s &lt;&lt;&lt; FAILURE! -- in com.example.demo.DemoApplicationTests\n[ERROR] com.example.demo.DemoApplicationTests.contextLoads -- Time elapsed: 0.003 s &lt;&lt;&lt; ERROR!\njava.lang.IllegalStateException: Failed to load ApplicationContext for [WebMergedContextConfiguration@59cda16e testClass = com.example.demo.DemoApplicationTests, locations = [], classes = [com.example.demo.DemoApplication], contextInitializerClasses = [], activeProfiles = [], propertySourceDescriptors = [], propertySourceProperties = [&quot;org.springframework.boot.test.context.SpringBootTestContextBootstrapper=true&quot;], contextCustomizers = [org.springframework.boot.test.context.filter.ExcludeFilterContextCustomizer@663c9e7a, org.springframework.boot.test.json.DuplicateJsonObjectContextCustomizerFactory$DuplicateJsonObjectContextCustomizer@6bbe85a8, org.springframework.boot.test.mock.mockito.MockitoContextCustomizer@0, org.springframework.boot.test.web.client.TestRestTemplateContextCustomizer@3f191845, org.springframework.boot.test.web.reactor.netty.DisableReactorResourceFactoryGlobalResourcesContextCustomizerFactory$DisableReactorResourceFactoryGlobalResourcesContextCustomizerCustomizer@5524cca1, org.springframework.boot.test.autoconfigure.OnFailureConditionReportContextCustomizerFactory$OnFailureConditionReportContextCustomizer@353352b6, org.springframework.boot.test.autoconfigure.actuate.observability.ObservabilityContextCustomizerFactory$DisableObservabilityContextCustomizer@1f, org.springframework.boot.test.autoconfigure.properties.PropertyMappingContextCustomizer@0, org.springframework.boot.test.autoconfigure.web.servlet.WebDriverContextCustomizer@43df23d3, org.springframework.test.context.support.DynamicPropertiesContextCustomizer@0, org.springframework.boot.test.context.SpringBootTestAnnotation@a2815468], resourceBasePath = &quot;src/main/webapp&quot;, contextLoader = org.springframework.boot.test.context.SpringBootContextLoader, parent = null]\n        at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:180)\n        at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:130)\n        at org.springframework.test.context.web.ServletTestExecutionListener.setUpRequestContextIfNecessary(ServletTestExecutionListener.java:191)\n        at org.springframework.test.context.web.ServletTestExecutionListener.prepareTestInstance(ServletTestExecutionListener.java:130)\n        at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:260)\n        at org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:160)\n        at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)\n        at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n        at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)\n        at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n        at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1708)\n        at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n        at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n        at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\n        at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\n        at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n        at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)\n        at java.base/java.util.Optional.orElseGet(Optional.java:364)\n        at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n        at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\nCaused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'restClientConfig' defined in file [/Users/viswanathgnanasekaranuma/projects/oauth2client/target/classes/com/example/demo/RestClientConfig.class]: Unsatisfied dependency expressed through constructor parameter 0: No qualifying bean of type 'org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}\n        at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:804)\n        at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1371)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1208)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:563)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:336)\n        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:288)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:334)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.instantiateSingleton(DefaultListableBeanFactory.java:1122)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingleton(DefaultListableBeanFactory.java:1093)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:1030)\n        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:987)\n        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627)\n        at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752)\n        at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439)\n        at org.springframework.boot.SpringApplication.run(SpringApplication.java:318)\n        at org.springframework.boot.test.context.SpringBootContextLoader.lambda$loadContext$3(SpringBootContextLoader.java:137)\n        at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:58)\n        at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:46)\n        at org.springframework.boot.SpringApplication.withHook(SpringApplication.java:1461)\n        at org.springframework.boot.test.context.SpringBootContextLoader$ContextLoaderHook.run(SpringBootContextLoader.java:553)\n        at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:137)\n        at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:108)\n        at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:225)\n        at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:152)\n        ... 19 more\nCaused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {@org.springframework.beans.factory.annotation.Autowired(required=true)}\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.raiseNoMatchingBeanFound(DefaultListableBeanFactory.java:2139)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1589)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1514)\n        at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:913)\n        at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791)\n        ... 45 more\n\n[INFO] \n[INFO] Results:\n[INFO] \n[ERROR] Errors: \n[ERROR]   DemoApplicationTests.contextLoads Â» IllegalState Failed to load ApplicationContext for [WebMergedContextConfiguration@59cda16e testClass = com.example.demo.DemoApplicationTests, locations = [], classes = [com.example.demo.DemoApplication], contextInitializerClasses = [], activeProfiles = [], propertySourceDescriptors = [], propertySourceProperties = [&quot;org.springframework.boot.test.context.SpringBootTestContextBootstrapper=true&quot;], contextCustomizers = [org.springframework.boot.test.context.filter.ExcludeFilterContextCustomizer@663c9e7a, org.springframework.boot.test.json.DuplicateJsonObjectContextCustomizerFactory$DuplicateJsonObjectContextCustomizer@6bbe85a8, org.springframework.boot.test.mock.mockito.MockitoContextCustomizer@0, org.springframework.boot.test.web.client.TestRestTemplateContextCustomizer@3f191845, org.springframework.boot.test.web.reactor.netty.DisableReactorResourceFactoryGlobalResourcesContextCustomizerFactory$DisableReactorResourceFactoryGlobalResourcesContextCustomizerCustomizer@5524cca1, org.springframework.boot.test.autoconfigure.OnFailureConditionReportContextCustomizerFactory$OnFailureConditionReportContextCustomizer@353352b6, org.springframework.boot.test.autoconfigure.actuate.observability.ObservabilityContextCustomizerFactory$DisableObservabilityContextCustomizer@1f, org.springframework.boot.test.autoconfigure.properties.PropertyMappingContextCustomizer@0, org.springframework.boot.test.autoconfigure.web.servlet.WebDriverContextCustomizer@43df23d3, org.springframework.test.context.support.DynamicPropertiesContextCustomizer@0, org.springframework.boot.test.context.SpringBootTestAnnotation@a2815468], resourceBasePath = &quot;src/main/webapp&quot;, contextLoader = org.springframework.boot.test.context.SpringBootContextLoader, parent = null]\n[INFO] \n[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n\n</code></pre>\n<p>my pom.xml</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.4.0&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;com.example&lt;/groupId&gt;\n    &lt;artifactId&gt;demo&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;demo&lt;/name&gt;\n    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\n    &lt;url/&gt;\n    &lt;licenses&gt;\n        &lt;license/&gt;\n    &lt;/licenses&gt;\n    &lt;developers&gt;\n        &lt;developer/&gt;\n    &lt;/developers&gt;\n    &lt;scm&gt;\n        &lt;connection/&gt;\n        &lt;developerConnection/&gt;\n        &lt;tag/&gt;\n        &lt;url/&gt;\n    &lt;/scm&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;21&lt;/java.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre>\n<p>my RestClientConfig</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.example.demo;\n\nimport jakarta.annotation.PostConstruct;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.http.converter.FormHttpMessageConverter;\nimport org.springframework.security.oauth2.client.OAuth2AuthorizedClientManager;\nimport org.springframework.security.oauth2.client.endpoint.*;\nimport org.springframework.security.oauth2.client.http.OAuth2ErrorResponseErrorHandler;\nimport org.springframework.security.oauth2.client.web.client.OAuth2ClientHttpRequestInterceptor;\nimport org.springframework.security.oauth2.core.http.converter.OAuth2AccessTokenResponseHttpMessageConverter;\nimport org.springframework.web.client.RestClient;\n\n@Configuration\npublic class RestClientConfig {\n\n  private final OAuth2AuthorizedClientManager authorizedClientManager;\n  private RestClient restClient;\n\n  public RestClientConfig(@Autowired OAuth2AuthorizedClientManager authorizedClientManager) {\n    this.authorizedClientManager = authorizedClientManager;\n  }\n\n  @PostConstruct\n  void initialize() {\n    OAuth2ClientHttpRequestInterceptor requestInterceptor =\n        new OAuth2ClientHttpRequestInterceptor(authorizedClientManager);\n    this.restClient =\n        RestClient.builder()\n            .messageConverters(\n                (messageConverters) -&gt; {\n                  messageConverters.clear();\n                  messageConverters.add(new FormHttpMessageConverter());\n                  messageConverters.add(new OAuth2AccessTokenResponseHttpMessageConverter());\n                })\n            .defaultStatusHandler(new OAuth2ErrorResponseErrorHandler())\n            // TODO: Customize the instance of RestClient as needed...\n            .requestInterceptor(requestInterceptor)\n            .build();\n  }\n\n  @Bean\n  public RestClient restClient() {\n    return this.restClient;\n  }\n\n  @Bean\n  public OAuth2AccessTokenResponseClient&lt;OAuth2AuthorizationCodeGrantRequest&gt;\n  authorizationCodeAccessTokenResponseClient() {\n    RestClientAuthorizationCodeTokenResponseClient accessTokenResponseClient =\n        new RestClientAuthorizationCodeTokenResponseClient();\n    accessTokenResponseClient.setRestClient(this.restClient);\n\n    return accessTokenResponseClient;\n  }\n\n  @Bean\n  public OAuth2AccessTokenResponseClient&lt;OAuth2RefreshTokenGrantRequest&gt;\n  refreshTokenAccessTokenResponseClient() {\n    RestClientRefreshTokenTokenResponseClient accessTokenResponseClient =\n        new RestClientRefreshTokenTokenResponseClient();\n    accessTokenResponseClient.setRestClient(this.restClient);\n\n    return accessTokenResponseClient;\n  }\n\n  @Bean\n  public OAuth2AccessTokenResponseClient&lt;OAuth2ClientCredentialsGrantRequest&gt;\n  clientCredentialsAccessTokenResponseClient() {\n    RestClientClientCredentialsTokenResponseClient accessTokenResponseClient =\n        new RestClientClientCredentialsTokenResponseClient();\n    accessTokenResponseClient.setRestClient(this.restClient);\n\n    return accessTokenResponseClient;\n  }\n\n  @Bean\n  public OAuth2AccessTokenResponseClient&lt;JwtBearerGrantRequest&gt;\n  jwtBearerAccessTokenResponseClient() {\n    RestClientJwtBearerTokenResponseClient accessTokenResponseClient =\n        new RestClientJwtBearerTokenResponseClient();\n    accessTokenResponseClient.setRestClient(this.restClient);\n\n    return accessTokenResponseClient;\n  }\n\n  @Bean\n  public OAuth2AccessTokenResponseClient&lt;TokenExchangeGrantRequest&gt;\n  tokenExchangeAccessTokenResponseClient() {\n    RestClientTokenExchangeTokenResponseClient accessTokenResponseClient =\n        new RestClientTokenExchangeTokenResponseClient();\n    accessTokenResponseClient.setRestClient(this.restClient);\n\n    return accessTokenResponseClient;\n  }\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}