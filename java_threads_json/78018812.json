{
  "question": {
    "tags": [
      "java",
      "struts2",
      "httpsession",
      "wildfly-11"
    ],
    "owner": {
      "account_id": 11946951,
      "reputation": 11,
      "user_id": 16930595,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/6e1fd9bcfb2432550c55df0271e10e5c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "vikas",
      "link": "https://stackoverflow.com/users/16930595/vikas"
    },
    "is_answered": false,
    "view_count": 1344,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1711016795,
    "creation_date": 1708325439,
    "last_edit_date": 1711016795,
    "question_id": 78018812,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78018812/session-not-invalidated-properly-getting-error-ut000010-session-is-invalid",
    "title": "session not invalidated properly getting error UT000010: Session is invalid",
    "body": "<p>I upgraded Struts version 2.3 to 6.0. It's built successfully but when I am trying to login  to the  application I am getting</p>\n<blockquote>\n<p>UT000010: Session is invalid HubC5VAM4TUaSwQgPtLbbmAEXTAZii0VTrfXfNJw</p>\n</blockquote>\n<p>on the browser.</p>\n<p>I am using wildfly 24+\nStruts 6.0</p>\n<p><strong>Error stack:</strong></p>\n<pre><code>1:21:41,611 INFO  [stdout] (default task-1) 2024-02-19 01:21:41,602 ERROR [org.apache.struts2.dispatcher.DefaultDispatcherErrorHandler] Exception occurred during processing request: UT000010: Session is invalid HubC5VAM4TUaSwQgPtLbbmAEXTAZii0VTrfXfNJw\n\n01:21:41,611 INFO  [stdout] (default task-1) java.lang.IllegalStateException: UT000010: Session is invalid HubC5VAM4TUaSwQgPtLbbmAEXTAZii0VTrfXfNJw\n\n01:21:41,611 INFO  [stdout] (default task-1)    at io.undertow.server.session.InMemorySessionManager$SessionImpl.getAttribute(InMemorySessionManager.java:519) ~[undertow-core-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,611 INFO  [stdout] (default task-1)    at io.undertow.servlet.spec.HttpSessionImpl.getAttribute(HttpSessionImpl.java:122) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,611 INFO  [stdout] (default task-1)    at org.apache.struts2.dispatcher.SessionMap.get(SessionMap.java:157) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,611 INFO  [stdout] (default task-1)    at org.apache.struts2.dispatcher.SessionMap.put(SessionMap.java:175) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,612 INFO  [stdout] (default task-1)    at org.apache.struts2.interceptor.csp.DefaultCspSettings.associateNonceWithSession(DefaultCspSettings.java:90) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,612 INFO  [stdout] (default task-1)    at org.apache.struts2.interceptor.csp.DefaultCspSettings.addCspHeaders(DefaultCspSettings.java:78) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,612 INFO  [stdout] (default task-1)    at org.apache.struts2.interceptor.csp.CspInterceptor.beforeResult(CspInterceptor.java:49) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,612 INFO  [stdout] (default task-1)    at com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:274) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,612 INFO  [stdout] (default task-1)    at com.ge.hca.torch.presentation.securityfilter.TorchTokenSessionStoreInterceptor.doIntercept(TorchTokenSessionStoreInterceptor.java:176) ~[classes:?]\n\n01:21:41,612 INFO  [stdout] (default task-1)    at com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:99) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,612 INFO  [stdout] (default task-1)    at com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:251) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,613 INFO  [stdout] (default task-1)    at org.apache.struts2.factory.StrutsActionProxy.execute(StrutsActionProxy.java:48) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,613 INFO  [stdout] (default task-1)    at org.apache.struts2.dispatcher.Dispatcher.serviceAction(Dispatcher.java:637) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,613 INFO  [stdout] (default task-1)    at org.apache.struts2.dispatcher.ExecuteOperations.executeAction(ExecuteOperations.java:79) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,613 INFO  [stdout] (default task-1)    at org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter.doFilter(StrutsPrepareAndExecuteFilter.java:140) ~[struts2-core-6.0.0.jar:6.0.0]\n\n01:21:41,613 INFO  [stdout] (default task-1)    at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,613 INFO  [stdout] (default task-1)    at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,613 INFO  [stdout] (default task-1)    at com.ge.hca.torch.presentation.securityfilter.SqlInjectionAndXSSFilter.doFilter(SqlInjectionAndXSSFilter.java:79) ~[classes:?]\n\n01:21:41,613 INFO  [stdout] (default task-1)    at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,614 INFO  [stdout] (default task-1)    at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,614 INFO  [stdout] (default task-1)    at com.ge.hca.torch.presentation.securityfilter.AccessFilter.doFilter(AccessFilter.java:86) ~[classes:?]\n\n01:21:41,614 INFO  [stdout] (default task-1)    at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,614 INFO  [stdout] (default task-1)    at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,614 INFO  [stdout] (default task-1)    at org.apache.logging.log4j.web.Log4jServletFilter.doFilter(Log4jServletFilter.java:71) ~[log4j-web-2.17.1.jar:2.17.1]\n\n01:21:41,614 INFO  [stdout] (default task-1)    at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,614 INFO  [stdout] (default task-1)    at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,614 INFO  [stdout] (default task-1)    at io.undertow.servlet.handlers.FilterHandler.handleRequest(FilterHandler.java:84) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,614 INFO  [stdout] (default task-1)    at io.undertow.servlet.handlers.security.ServletSecurityRoleHandler.handleRequest(ServletSecurityRoleHandler.java:62) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,615 INFO  [stdout] (default task-1)    at io.undertow.servlet.handlers.ServletChain$1.handleRequest(ServletChain.java:68) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,615 INFO  [stdout] (default task-1)    at io.undertow.servlet.handlers.ServletDispatchingHandler.handleRequest(ServletDispatchingHandler.java:36) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,615 INFO  [stdout] (default task-1)    at org.wildfly.extension.undertow.security.SecurityContextAssociationHandler.handleRequest(SecurityContextAssociationHandler.java:78) ~[?:?]\n\n01:21:41,615 INFO  [stdout] (default task-1)    at io.undertow.server.handlers.PredicateHandler.handleRequest(PredicateHandler.java:43) ~[undertow-core-2.2.8.Final.jar!/:2.2.8.Final]\n\n01:21:41,615 INFO  [stdout] (default task-1)    at io.undertow.servlet.handlers.RedirectDirHandler.handleRequest(RedirectDirHandler.java:68) ~[undertow-servlet-2.2.8.Final.jar!/:2.2.8.Final]\n\n</code></pre>\n<p>This is my login action code</p>\n<pre><code>            if(null==mode)\n            {\n                HttpSession session = getServletRequest().getSession(false);\n                log.debug(session + &quot;&quot; + getServletRequest().getSession(false));\n                if (null != session) \n                {\n                    session.invalidate();                   \n                }\n                //removed form above if condition during migration of struts2 as struts1 session was created in locale settings\n                session = getServletRequest().getSession(true);\n            }           \n            userVO=(UserVO)getSessionObject(getServletRequest(),TorchConstants.GLOBAL_USERINFO_KEY);\n</code></pre>\n<p>this is my session code of login action parent class code</p>\n<pre><code>   protected Object getSessionObject(HttpServletRequest req, String attrName) {\n        HttpSession httpSession = null;\n        httpSession = req.getSession(false);\n        Object obj = null;\n        if (null != httpSession) {\n            obj = httpSession.getAttribute(attrName);\n        }\n        return obj;\n    }\n</code></pre>\n<p>not getting how to handle this situation.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}