{
  "question": {
    "tags": [
      "java",
      "reflection",
      "quarkus",
      "influxdb"
    ],
    "owner": {
      "account_id": 7729157,
      "reputation": 743,
      "user_id": 5852900,
      "user_type": "registered",
      "accept_rate": 100,
      "profile_image": "https://www.gravatar.com/avatar/50f001ff1ed0583841128d5ea5ee73b2?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "JWo",
      "link": "https://stackoverflow.com/users/5852900/jwo"
    },
    "is_answered": false,
    "view_count": 121,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1733325380,
    "creation_date": 1731876861,
    "last_edit_date": 1733016713,
    "question_id": 79198151,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79198151/illegalargumentexception-can-not-get-field-of-pojo-after-running-tests-the-seco",
    "title": "IllegalArgumentException: Can not get field of POJO after running tests the second time. Tests fail after hot reload",
    "body": "<p>I'm using the InfluxDB Java Client to manage metrics in a Quarkus service.\nFor that I have created an extension that provides a dev container of InfluxDB 2.</p>\n<p>When I start my tests everything works, but when I trigger the hot reload by saving any file the test, that should send the metric to the database fails.</p>\n<p>Here is the test. The model is at the bottom:</p>\n<pre><code>package mypackage.models.measurements;\n\nimport static mypackage.config.InfluxDBConstants.DefaultConstants.BUCKET;\nimport static org.junit.jupiter.api.Assertions.assertTrue;\n\nimport java.time.Duration;\nimport java.time.Instant;\nimport java.util.concurrent.TimeUnit;\n\nimport org.junit.jupiter.api.Test;\nimport org.junit.jupiter.api.TestInstance;\nimport org.junit.jupiter.api.TestInstance.Lifecycle;\n\nimport com.influxdb.annotations.Column;\nimport com.influxdb.annotations.Measurement;\nimport com.influxdb.client.InfluxDBClient;\nimport com.influxdb.client.InfluxDBClientFactory;\nimport com.influxdb.client.domain.WritePrecision;\n\nimport myextension.quarkus.devservices.influxdb.runtime.InfluxDBConfig;\nimport mypackage.config.InfluxDBConstants.JobMetricConstants.Fields;\nimport mypackage.config.InfluxDBConstants.JobMetricConstants.Tags;\nimport io.quarkus.test.junit.QuarkusTest;\nimport jakarta.inject.Inject;\n\n/**\n * JobMetricTest\n */\n@QuarkusTest\n@TestInstance(Lifecycle.PER_CLASS)\npublic class JobMetricTest {\n\n    @Inject\n    InfluxDBConfig config;\n\n    public InfluxDBClient getClient() {\n        InfluxDBClient client = InfluxDBClientFactory.create(\n                config.url(),\n                config.token().toCharArray(),\n                config.organization().get(),\n                config.bucket().get());\n        assertTrue(client.ping());\n        return client;\n    }\n\n    @Test\n    public void testInitialization() throws InterruptedException {\n        Instant testTime = Instant.now();\n        JobMetric metric = new JobMetric(&quot;testJob&quot;);\n        assertTrue(metric.duration == -1);\n        TimeUnit.MILLISECONDS.sleep(1);\n        metric.finish();\n        assertTrue(metric.duration &gt; 0);\n        assertTrue(metric.job.equals(&quot;testJob&quot;));\n        assertTrue(metric.start.getEpochSecond() &gt;= testTime.getEpochSecond());\n    }\n\n    @Test\n    public void testInfluxReflection() throws InterruptedException {\n        InfluxDBClient client = getClient();\n        Metric metric = new Metric();\n\n        metric.job = &quot;job&quot;;\n        metric.hasError = false;\n        metric.duration = Double.valueOf(-1);\n        metric.start = Instant.now();\n        Instant stop = Instant.now();\n        Duration d  = Duration.between(metric.start, stop);\n        metric.duration = (double) d.getSeconds();\n        metric.duration += ((double) d.toMillisPart()) / 1000;\n        client.getWriteApiBlocking()\n            .writeMeasurement(          // Line 72: Fails here!\n                BUCKET,\n                config.organization().get(),\n                WritePrecision.NS,\n                metric\n            );\n\n\n        \n    }\n}\n\n@Measurement(name = &quot;metric&quot;)\nclass Metric {\n    @Column(timestamp = true)\n    public Instant start;\n\n    @Column(tag = true, name = Tags.JOB)\n    public String job;\n\n    @Column(name = Fields.HAS_ERROR, tag = false)\n    public Boolean hasError;\n\n    @Column(name = Fields.DURATION, tag = false)\n    public Double duration;\n\n\n}\n</code></pre>\n<p>Here is the exception:</p>\n<pre><code>2024-11-17 21:42:17,616 ERROR [io.qua.test] (Test runner thread) ==================== TEST REPORT #2 ==================== [Error Occurred After Shutdown]\n2024-11-17 21:42:17,616 ERROR [io.qua.test] (Test runner thread) Test JobMetricTest#testInfluxReflextion() failed \n [Error Occurred After Shutdown]: java.lang.IllegalArgumentException: Can not get java.lang.Double field mypackage.models.measurements.Metric.duration on mypackage.models.measurements.Metric\n    at java.base/jdk.internal.reflect.MethodHandleFieldAccessorImpl.newGetIllegalArgumentException(MethodHandleFieldAccessorImpl.java:86)\n    at java.base/jdk.internal.reflect.MethodHandleObjectFieldAccessorImpl.get(MethodHandleObjectFieldAccessorImpl.java:61)\n    at java.base/java.lang.reflect.Field.get(Field.java:444)\n    at com.influxdb.client.internal.MeasurementMapper.getObject(MeasurementMapper.java:130)\n    at com.influxdb.client.internal.MeasurementMapper.toPoint(MeasurementMapper.java:68)\n    at com.influxdb.client.internal.AbstractWriteClient$BatchWriteDataMeasurement.toLineProtocol(AbstractWriteClient.java:386)\n    at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:212)\n    at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:212)\n    at java.base/java.util.Collections$2.tryAdvance(Collections.java:5074)\n    at java.base/java.util.Collections$2.forEachRemaining(Collections.java:5082)\n    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:556)\n    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:546)\n    at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)\n    at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:265)\n    at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:702)\n    at com.influxdb.client.internal.AbstractWriteBlockingClient.write(AbstractWriteBlockingClient.java:69)\n    at com.influxdb.client.internal.WriteApiBlockingImpl.writeMeasurements(WriteApiBlockingImpl.java:253)\n    at com.influxdb.client.internal.WriteApiBlockingImpl.writeMeasurement(WriteApiBlockingImpl.java:220)\n    at com.influxdb.client.internal.WriteApiBlockingImpl.writeMeasurement(WriteApiBlockingImpl.java:207)\n    at mypackage.models.measurements.JobMetricTest.testInfluxReflextion(JobMetricTest.java:72)\n</code></pre>\n<p>As I said a test rerun causes the exception, but stopping the tests and restarting them results in one positive test run until there is a rerun.</p>\n<p>When I remove duration from Metric the same error occurs but with the job field.</p>\n<p>I'm using Java 21, Quarkus 3.15 and InfluxDBClient 7.2.0</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}