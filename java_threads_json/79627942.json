{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "apache-poi",
      "docx4j"
    ],
    "owner": {
      "account_id": 21968025,
      "reputation": 24,
      "user_id": 16244952,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/50e879bc22575e3878554a2d609cd641?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "MKSHRI",
      "link": "https://stackoverflow.com/users/16244952/mkshri"
    },
    "is_answered": true,
    "view_count": 257,
    "answer_count": 3,
    "score": 0,
    "last_activity_date": 1747860180,
    "creation_date": 1747613757,
    "last_edit_date": 1747860180,
    "question_id": 79627942,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79627942/how-to-dynamically-populate-data-in-to-paragraph-of-word-document-in-spring-boot",
    "title": "How to dynamically populate data in to paragraph of word document in spring boot",
    "body": "<p>In my Java Spring boot project. I am working on a task to populate dynamic data (coming from front end Request DTO) in to existing Word Document template and that data should be populated before that template available for download(that should be in word format and that template exist with formats(styles fonts image etc). However i am not able to populate data properly.\nWhen I insert the data, the formatting changes in the <code>docx</code> file, and if I am able to maintain the format, the placeholders don't update with the data. I've tried <code>Apache POI</code> and poi-tl, but I haven't been able to resolve it.\nIf you have any suggestions on which library to use ?</p>\n<p>My current implementation uses <code>Apache POI</code> library which replace place holder with data however it is modifying the format of the template (which should not happen). It is happening because i am creating new run here. If i didn't create new run it will not replace place holder with data because each place holder will be part of different run. i am stuck here couldn't move forward.\nPlease can any one help.</p>\n<pre class=\"lang-java prettyprint-override\"><code>    /**\n     * Downloads the Memorandum of Understanding (MoU) template and sends it as a\n     * response. Retrieves the template from the classpath, sets appropriate\n     * response headers, and streams the document content for download.\n     *\n     * @param response the HttpServletResponse used to send the file to the client\n     * @throws CollegeException if the template file is missing or an error occurs\n     *                          while streaming data\n     */\n    @Override\n    public void downloadMouTemplate(HttpServletResponse response, MouTemplateRequestDTO mouTemplateDto) {\n        log.info(&quot;CollegeServiceImpl :: downloadTemplate()&quot;);\n\n        try {\n            ClassPathResource fileResource = new ClassPathResource(&quot;templates/myWordDoc.docx&quot;);\n\n            // Validate if the file exists before proceeding\n            if (!fileResource.exists() || fileResource.contentLength() == 0) {\n                log.error(&quot;MoU template file not found or empty&quot;);\n                throw new CollegeException(&quot;Template file not found&quot;);\n            }\n\n            try (InputStream fileStream = fileResource.getInputStream();\n                    XWPFDocument document = new XWPFDocument(fileStream);\n                    OutputStream outputStream = response.getOutputStream()) {\n\n\n                HashMap&lt;String, String&gt; collegeMap = new HashMap&lt;&gt;();\n                collegeMap.put(&quot;collegeName&quot;, mouTemplateDto.getCollegeName());\n                collegeMap.put(&quot;collegeAddress&quot;, mouTemplateDto.getCollegeAddress());\n                replacePlaceholders(document, collegeMap);\n\n                response.setContentType(&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;);\n                response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment; filename=\\&quot;myWordDocuement.docx\\&quot;&quot;);\n                response.setStatus(HttpServletResponse.SC_OK);\n\n                document.write(outputStream);\n                response.flushBuffer();\n\n            } catch (IOException e) {\n                log.error(&quot;Error while reading the file&quot;, e.getMessage());\n                throw new CollegeException(&quot;Error while reading the MoU template file&quot;);\n            }\n\n        } catch (CollegeException e) {\n            log.error(&quot;Template Not found exception: {}&quot;, e.getMessage());\n            throw e;\n        } catch (Exception e) {\n            log.error(&quot;Unexpected error while downloading the MoU template&quot;, e.getMessage());\n            throw new CollegeException(&quot;Unexpected error while downloading the MoU template.&quot;);\n        }\n    }\n    \n    private static void replacePlaceholders(XWPFDocument document, Map&lt;String, String&gt; data) {\n        // Replace placeholders in document paragraphs\n        for (XWPFParagraph paragraph : document.getParagraphs()) {\n            replacePlaceholdersInParagraph(paragraph, data);\n        }\n\n        // Replace placeholders inside tables\n        for (XWPFTable table : document.getTables()) {\n            for (XWPFTableRow row : table.getRows()) {\n                for (XWPFTableCell cell : row.getTableCells()) {\n                    for (XWPFParagraph paragraph : cell.getParagraphs()) {\n                        replacePlaceholdersInParagraph(paragraph, data); // Call the correct method\n                    }\n                }\n            }\n        }\n    }\n\n    private static void replacePlaceholdersInParagraph(XWPFParagraph paragraph, Map&lt;String, String&gt; data){ List&lt;XWPFRun&gt; runs = paragraph.getRuns();\n        if (runs != null &amp;&amp; !runs.isEmpty()) {\n            StringBuilder fullText = new StringBuilder();\n\n            for (XWPFRun run : runs) {\n                String runText = run.getText(0);\n                if (runText != null) {\n                    fullText.append(runText);\n                }\n            }\n\n            // Replace placeholders\n            String updatedText = fullText.toString();\n            for (Map.Entry&lt;String, String&gt; entry : data.entrySet()) {\n                updatedText = updatedText.replace(&quot;${&quot; + entry.getKey() + &quot;}&quot;, entry.getValue());\n            }\n\n            // Remove existing runs to maintain formatting\n            for (int i = runs.size() - 1; i &gt;= 0; i--) {\n                paragraph.removeRun(i);\n            }\n\n            // Create a new run with replaced text\n            XWPFRun newRun = paragraph.createRun();\n            newRun.setText(updatedText);\n        }\n    }\n</code></pre>\n<p><strong>Inside MyWordDoc paragraph</strong> -</p>\n<p>${collegName} an educational institution affiliated with VTU and located at ${collegAddress} (hereinafter referred to as &quot;College&quot;).</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}