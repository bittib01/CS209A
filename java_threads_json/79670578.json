{
  "question": {
    "tags": [
      "java",
      "maven",
      "migration",
      "apache-commons-fileupload",
      "module-info"
    ],
    "owner": {
      "account_id": 1927984,
      "reputation": 753,
      "user_id": 1738007,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/PqYoh.jpg?s=256",
      "display_name": "Tugalsan Karabacak",
      "link": "https://stackoverflow.com/users/1738007/tugalsan-karabacak"
    },
    "is_answered": true,
    "view_count": 754,
    "accepted_answer_id": 79695311,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1760375841,
    "creation_date": 1750247538,
    "last_edit_date": 1760375841,
    "question_id": 79670578,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79670578/java-maven-apache-commons-fileupload-how-to-migrate-from-1-5-to-1-6-0",
    "title": "JAVA maven apache commons-fileupload: How to migrate from 1.5 to 1.6.0",
    "body": "<p>[MOTIVATION]</p>\n<p>I have a maven project that uses commons-fileupload 1.5. When I want to update the dependency to 1.6.0, it does not compile. <a href=\"https://github.com/tugalsan/com.tugalsan.blg.org_apache_commons_fileupload_1_6_0\" rel=\"nofollow noreferrer\">here</a></p>\n<p>[LIMITATION]</p>\n<p>I cannot use jakarta libraries on code, because of later dependency (org.gwtproject).</p>\n<p>[MIGRATION IN CONFIGURATION FILES]</p>\n<p><code>@pom.xml</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>&lt;dependency&gt;\n    &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;&lt;!-- poi excel does not like u! --&gt;\n    &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;\n    &lt;exclusions&gt;\n        &lt;exclusion&gt;\n            &lt;groupId&gt;commons-io&lt;/groupId&gt;\n            &lt;artifactId&gt;commons-io&lt;/artifactId&gt;\n        &lt;/exclusion&gt;\n    &lt;/exclusions&gt;\n    &lt;version&gt;1.6.0&lt;/version&gt;&lt;!-- 1.5 was working --&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p><code>@module-info.java</code>:</p>\n<pre><code>requires org.apache.commons.fileupload;//commons.fileupload;\n</code></pre>\n<p>[COMPILE ERRORS]</p>\n<pre><code>cd C:\\git\\blg\\com.tugalsan.blg.org_apache_commons_fileupload_1_6_0; JAVA_HOME=C:\\\\bin\\\\java\\\\home cmd /c &quot;\\&quot;C:\\\\bin\\\\netbeans\\\\home\\\\java\\\\maven\\\\bin\\\\mvn.cmd\\&quot; -Dmaven.ext.class.path=C:\\\\bin\\\\netbeans\\\\home\\\\java\\\\maven-nblib\\\\netbeans-eventspy.jar --no-transfer-progress clean install&quot;\n\nRequired filename-based automodules detected: [javax.servlet-api-4.0.1.jar]. Please don't publish this project to a public artifact repository!\n\nCOMPILATION ERROR : \n-------------------------------------------------------------\ncom/tugalsan/blg/org_apache_commons_fileupload_1_6_0/server/TS_SUploadWebServlet.java:[113,51] cannot access javax.servlet.ServletContextListener\n  class file for javax.servlet.ServletContextListener not found\ncom/tugalsan/blg/org_apache_commons_fileupload_1_6_0/server/TS_SUploadWebServlet.java:[48,35] cannot access javax.servlet.http.HttpServletRequest\n  class file for javax.servlet.http.HttpServletRequest not found\ncom/tugalsan/blg/org_apache_commons_fileupload_1_6_0/server/TS_SUploadWebServlet.java:[55,73] no suitable method found for parseRequest(javax.servlet.http.HttpServletRequest)\n    method org.apache.commons.fileupload.FileUploadBase.parseRequest(org.apache.commons.fileupload.RequestContext) is not applicable\n      (argument mismatch; javax.servlet.http.HttpServletRequest cannot be converted to org.apache.commons.fileupload.RequestContext)\n    method org.apache.commons.fileupload.servlet.ServletFileUpload.parseRequest(javax.servlet.http.HttpServletRequest) is not applicable\n      (argument mismatch; javax.servlet.http.HttpServletRequest cannot be converted to javax.servlet.http.HttpServletRequest)\n3 errors \n</code></pre>\n<p>[QUESTION]</p>\n<p>What code changes should I apply to migrate fully.</p>\n<p>[ADDITIONAL NOTES]</p>\n<p>on netbeans on projects on dependencies, javax.servlet-api-4.0.1.jar &amp; commons-fileupload-1.6.0.jar &amp; commons-io-2.19.0.jar exists.<br></p>\n<br>\n[MRE FILES]<br>\npom.xml\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;com.tugalsan&lt;/groupId&gt;\n    &lt;artifactId&gt;com.tugalsan.blg.org_apache_commons_fileupload_1_6_0&lt;/artifactId&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;\n            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;\n            &lt;version&gt;4.0.1&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;&lt;!-- poi excel does not like u! --&gt;\n            &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;\n            &lt;exclusions&gt;\n                &lt;exclusion&gt;\n                    &lt;groupId&gt;commons-io&lt;/groupId&gt;\n                    &lt;artifactId&gt;commons-io&lt;/artifactId&gt;\n                &lt;/exclusion&gt;\n            &lt;/exclusions&gt;\n            &lt;version&gt;1.6.0&lt;/version&gt;&lt;!-- 1.5 was working --&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;commons-io&lt;/groupId&gt;\n            &lt;artifactId&gt;commons-io&lt;/artifactId&gt;\n            &lt;version&gt;2.19.0&lt;/version&gt; &lt;!-- poi version 5 needs it, becuase servlet-upload and gwt messes up --&gt;\n        &lt;/dependency&gt;        \n    &lt;/dependencies&gt;\n    \n    &lt;build&gt;\n        &lt;resources&gt; \n            &lt;resource&gt;\n                &lt;directory&gt;src/main/java&lt;/directory&gt;\n                &lt;includes&gt;\n                    &lt;include&gt;**/*.java&lt;/include&gt;\n                    &lt;include&gt;**/*.gwt.xml&lt;/include&gt;\n                &lt;/includes&gt;\n            &lt;/resource&gt;\n            &lt;resource&gt;\n                &lt;directory&gt;src/main/resources&lt;/directory&gt;\n                &lt;includes&gt;\n                    &lt;include&gt;**/*.*&lt;/include&gt;\n                &lt;/includes&gt;\n            &lt;/resource&gt;\n        &lt;/resources&gt;\n        \n        &lt;pluginManagement&gt;\n            &lt;plugins&gt;\n                &lt;plugin&gt;\n                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                    &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;\n                    &lt;version&gt;3.3.1&lt;/version&gt;\n                    &lt;executions&gt;\n                        &lt;execution&gt;\n                            &lt;id&gt;attach-sources&lt;/id&gt;\n                            &lt;phase&gt;package&lt;/phase&gt;\n                            &lt;goals&gt;\n                                &lt;goal&gt;jar-no-fork&lt;/goal&gt;\n                            &lt;/goals&gt;\n                        &lt;/execution&gt;\n                    &lt;/executions&gt;\n                &lt;/plugin&gt;\n            &lt;/plugins&gt;\n        &lt;/pluginManagement&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.13.0&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;release&gt;24&lt;/release&gt;&lt;!--prop.jdk--&gt;\n                    &lt;enablePreview&gt;true&lt;/enablePreview&gt;\n                    &lt;!--&lt;compilerArgs&gt;\n                       &lt;arg&gt;- -add-modules&lt;/arg&gt;\n                        &lt;arg&gt;jdk.incubator.vector&lt;/arg&gt;\n                    &lt;/compilerArgs&gt; --&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n    \n    &lt;properties&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n    &lt;/properties&gt;\n&lt;/project&gt;\n</code></pre>\n<p>module-info.java</p>\n<pre><code>module com.tugalsan.blg.org_apache_commons_fileupload_1_6_0 {\n        requires javax.servlet.api; \n\n//        requires commons.fileupload;\n        requires org.apache.commons.fileupload;//;\n\n}\n</code></pre>\n<p>TS_SUploadWebServlet.java</p>\n<pre><code>package com.tugalsan.blg.org_apache_commons_fileupload_1_6_0.server;\n\nimport javax.servlet.http.*;\nimport java.io.File;\nimport static java.lang.System.out;\nimport java.nio.file.Files;\nimport java.nio.file.Path;\nimport javax.servlet.annotation.MultipartConfig;\nimport javax.servlet.annotation.WebListener;\nimport javax.servlet.annotation.WebServlet;\nimport org.apache.commons.fileupload.disk.DiskFileItemFactory;\nimport org.apache.commons.fileupload.servlet.FileCleanerCleanup;\nimport org.apache.commons.fileupload.servlet.ServletFileUpload;\n\n@WebServlet(&quot;/u&quot;)\n@MultipartConfig(\n        fileSizeThreshold = 1024 * 1024 * TS_SUploadWebServlet.UPLOAD_MB_LIMIT_MEMORY,\n        maxFileSize = 1024 * 1024 * TS_SUploadWebServlet.UPLOAD_MB_LIMIT_FILE,\n        maxRequestSize = 1024 * 1024 * TS_SUploadWebServlet.UPLOAD_MB_LIMIT_REQUESTBALL,\n        location = &quot;/&quot; + TS_SUploadWebServlet.UPLOAD_DIR_NAME//means C:/bin/tomcat/home/work/Catalina/localhost/spi-xxx/upload (do create it)\n)\npublic class TS_SUploadWebServlet extends HttpServlet {\n\n    final public static String UPLOAD_DIR_NAME = &quot;p&quot;;\n    final public static int UPLOAD_MB_LIMIT_MEMORY = 10;\n    final public static int UPLOAD_MB_LIMIT_FILE = 25;\n    final public static int UPLOAD_MB_LIMIT_REQUESTBALL = 50;\n\n    @Override\n    public void doGet(HttpServletRequest rq, HttpServletResponse rs) {\n        call(this, rq, rs);\n    }\n\n    @Override\n    protected void doPost(HttpServletRequest rq, HttpServletResponse rs) {\n        call(this, rq, rs);\n    }\n\n    public static void call(HttpServlet servlet, HttpServletRequest rq, HttpServletResponse rs) {\n        try {\n            var appPath = rq.getServletContext().getRealPath(&quot;&quot;);// constructs path of the directory to save uploaded file\n            var savePath = appPath + File.separator + TS_SUploadWebServlet.UPLOAD_DIR_NAME;// creates the save directory if it does not exists\n            var fileSaveDir = new File(savePath);\n            if (!fileSaveDir.exists()) {\n                fileSaveDir.mkdir();\n            }\n\n            if (!ServletFileUpload.isMultipartContent(rq)) {\n                println(rs, &quot;USER_NOT_MULTIPART&quot;);\n                return;\n            }\n\n            //GETING ITEMS\n            //WARNING: Dont touch request before this, like execution getParameter or such!\n            var items = new ServletFileUpload(new DiskFileItemFactory()).parseRequest(rq);\n\n            //GETTING PROFILE\n            var profile = items.stream().filter(item -&gt; item.isFormField()).findFirst().orElse(null);\n            if (profile == null) {\n                println(rs, &quot;RESULT_UPLOAD_USER_PROFILE_NULL&quot;);\n                return;\n            }\n            println(rs, &quot;profile_selected&quot;);\n\n            var profileValue = profile.getString();\n            if (profileValue == null) {\n                println(rs, &quot;RESULT_UPLOAD_USER_PROFILEVALUE_NULL&quot;);\n                return;\n            }\n            println(rs, &quot;profileValue: &quot; + profileValue);\n\n            //GETING SOURCEFILE\n            var sourceFile = items.stream().filter(item -&gt; !item.isFormField()).findFirst().orElse(null);\n            if (sourceFile == null) {\n                println(rs, &quot;RESULT_UPLOAD_USER_SOURCEFILE_NULL&quot;);\n                return;\n            }\n            println(rs, &quot;sourceFile_selected&quot;);\n\n            var sourceFileName = sourceFile.getName();\n            if (sourceFileName == null) {\n                println(rs, &quot;RESULT_UPLOAD_USER_SOURCEFILENAME_NULL&quot;);\n                return;\n            }\n            println(rs, &quot;sourceFileName: &quot; + sourceFileName);\n\n            //COMPILING TARGET FILE\n            var targetFile = fileSaveDir.toPath().resolve(profileValue).resolve(sourceFileName);\n\n            //CREATE DIRECTORIES\n            targetFile.getParent().toFile().mkdirs();\n\n            //STORE FILE\n            Files.createFile(targetFile);\n            sourceFile.write(targetFile.toFile());\n\n            //RETURN SUCCESS FLAG\n            rs.setStatus(HttpServletResponse.SC_CREATED);\n            println(rs, &quot;RESULT_UPLOAD_USER_SUCCESS&quot;);\n        } catch (Exception e) {\n            throwIfInterruptedException(e);\n            e.printStackTrace();\n        }\n    }\n\n    private static void println(HttpServletResponse rs, String msg) {\n        try {\n            out.println(&quot;println: &quot; + msg);\n            rs.getWriter().println(msg);\n        } catch (Exception e) {\n            throwIfInterruptedException(e);\n        }\n    }\n\n    //---------------------------- LISTENER ----------------\n    @WebListener\n    public class ApacheFileCleanerCleanup extends FileCleanerCleanup {\n\n    }\n\n    //----------------------------- UTILS -----------------------\n    @SuppressWarnings(&quot;unchecked&quot;)\n    private static &lt;T extends Throwable&gt; void _throwAsUncheckedException(Throwable exception) throws T {\n        throw (T) exception;\n    }\n\n    @Deprecated //only internalUse\n    private static void throwAsUncheckedException(Throwable exception) {\n        TS_SUploadWebServlet.&lt;RuntimeException&gt;_throwAsUncheckedException(exception);\n    }\n\n    public static &lt;R&gt; R throwIfInterruptedException(Throwable t) {\n        if (isInterruptedException(t)) {\n            Thread.currentThread().interrupt();\n            throwAsUncheckedException(t);\n        }\n        return null;\n    }\n\n    public static boolean isInterruptedException(Throwable t) {\n        if (t instanceof InterruptedException) {\n            return true;\n        }\n        if (t.getCause() != null) {\n            return isInterruptedException(t.getCause());\n        }\n        return false;\n    }\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}