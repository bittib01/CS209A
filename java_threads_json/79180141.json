{
  "question": {
    "tags": [
      "java",
      "docker-compose",
      "opensearch",
      "opensearch-dashboards"
    ],
    "owner": {
      "account_id": 32592403,
      "reputation": 11,
      "user_id": 25326297,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/ce729fd06d6fa287e690d6c8a3c26fff?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Richa sharma",
      "link": "https://stackoverflow.com/users/25326297/richa-sharma"
    },
    "is_answered": false,
    "view_count": 1327,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1742603786,
    "creation_date": 1731396198,
    "last_edit_date": 1731420682,
    "question_id": 79180141,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79180141/opensearch-2-17-error-notsslrecordexception-not-an-ssl-tls-record",
    "title": "Opensearch 2.17 error: NotSslRecordException: not an SSL/TLS record",
    "body": "<p>We're migrating one of our projects from Elasticsearch 7.1.1 to Opensearch 2.17.0. I'm running into below error while executing the integration tests on my local machine as the test cases try to run the docker container for inserting the indexes. The ssl certificates are not added as we want to keep the configuration as minimum as possible while verifying the migration with local setup. The opensearch-node1 container does get initialized  but it doesn't get started and throws the error.</p>\n<p>docker container error logs:</p>\n<pre><code>22:39:24.430 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT: [2024-11-11T17:09:24,429][INFO ][o.o.p.PluginsService     ] [d29698dca672] PluginService:onIndexModule index:[.opensearch-sap-log-types-config/kCsJtTTNTdyyCfps0UUZDQ]\n22:39:24.463 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT: [2024-11-11T17:09:24,459][ERROR][o.o.h.n.s.SecureNetty4HttpServerTransport] [d29698dca672] Exception during establishing a SSL connection: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 474554202f20485454502f312e310d0a557365722d4167656e743a204a6176612f31312e302e32330d0a486f73743a206c6f63616c686f73743a35303831340d0a4163636570743a20746578742f68746d6c2c20696d6167652f6769662c20696d6167652f6a7065672c202a3b20713d2e322c202a2f2a3b20713d2e320d0a436f6e6e656374696f6e3a206b6565702d616c6976650d0a0d0a\n22:39:24.465 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 474554202f20485454502f312e310d0a557365722d4167656e743a204a6176612f31312e302e32330d0a486f73743a206c6f63616c686f73743a35303831340d0a4163636570743a20746578742f68746d6c2c20696d6167652f6769662c20696d6167652f6a7065672c202a3b20713d2e322c202a2f2a3b20713d2e320d0a436f6e6e656374696f6e3a206b6565702d616c6976650d0a0d0a\n22:39:24.466 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT:  at io.netty.handler.ssl.SslHandler.decodeJdkCompatible(SslHandler.java:1312) ~[netty-handler-4.1.112.Final.jar:4.1.112.Final]\n22:39:24.474 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT:  at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1385) ~[netty-handler-4.1.112.Final.jar:4.1.112.Final]\n22:39:24.475 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT:  at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:530) ~[netty-codec-4.1.112.Final.jar:4.1.112.Final]\n22:39:24.475 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT:  at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:469) ~[netty-codec-4.1.112.Final.jar:4.1.112.Final]\n22:39:24.475 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT:  at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290) ~[netty-codec-4.1.112.Final.jar:4.1.112.Final]\n.\n.\n.\n22:39:24.475 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT: [2024-11-11T17:09:24,460][WARN ][o.o.h.AbstractHttpServerTransport] [d29698dca672] caught exception while handling client http traffic, closing connection Netty4HttpChannel{localAddress=/172.17.0.3:9200, remoteAddress=/172.17.0.1:55068}\n22:39:24.475 [docker-java-stream--288341315] INFO  com.company.proj1.integration.OpensearchAware - STDOUT: io.netty.handler.codec.DecoderException: io.netty.handler.ssl.NotSslRecordException: not an SSL/TLS record: 474554202f20485454502f312e310d0a557365722d4167656e743a204a6176612f31312e302e32330d0a486f73743a206c6f63616c686f73743a35303831340d0a4163636570743a20746578742f68746d6c2c20696d6167652f6769662c20696d6167652f6a7065672c202a3b20713d2e322c202a2f2a3b20713d2e320d0a436f6e6e656374696f6e3a206b6565702d616c6976650d0a0d0a\n\n</code></pre>\n<p>I tried disabling all Opensearch security related configurations but somehow it's making no difference in the error.</p>\n<p>docker-compose.yml:</p>\n<pre><code>version: '3'\n\nservices:\n\n  # docker build -t local_elastic .\n  # docker-compose up\n  opensearch-node1:\n    image: opensearchproject/opensearch:latest\n    container_name: opensearch-node1\n    environment:\n      - cluster.name=opensearch-cluster # Name the cluster\n      - node.name=opensearch-node1 # Name the node that will run in this container\n      - discovery.seed_hosts=opensearch-node1 # Nodes to look for when discovering the cluster\n      - &quot;OPENSEARCH_JAVA_OPTS=-Xms512m -Xmx512m&quot; # Set min and max JVM heap sizes to at least 50% of system RAM\n      - &quot;DISABLE_INSTALL_DEMO_CONFIG=true&quot; # Prevents execution of bundled demo script which installs demo certificates and security configurations to OpenSearch\n      - &quot;DISABLE_SECURITY_PLUGIN=true&quot; # Disables security plugin\n      #- plugins.security.ssl.transport.enabled=true\n      - plugins.security.ssl.http.enabled=false\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n      nofile:\n        soft: 65536\n        hard: 65536\n    cap_add:\n      - IPC_LOCK\n    volumes:\n      - opensearch-data1:/usr/share/opensearch/data\n      - ./opensearch.yml:/usr/share/opensearch/opensearch.yml\n    ports:\n      - 9200:9200\n      - 9600:9600\n    networks:\n      - opensearch-net # All of the containers will join the same Docker bridge network\n\n  opensearch-dashboards:\n    image: opensearchproject/opensearch-dashboards:latest\n    container_name: opensearch-dashboards\n    ports:\n      - 5601:5601 # Map host port 5601 to container port 5601\n    expose:\n      - &quot;5601&quot; # Expose port 5601 for web access to OpenSearch Dashboards\n    environment:\n      - 'OPENSEARCH_HOSTS=[&quot;http://opensearch-node1:9200&quot;]'\n      - &quot;DISABLE_SECURITY_DASHBOARDS_PLUGIN=true&quot; # disables security dashboards plugin in OpenSearch Dashboards\n    networks:\n      - opensearch-net\n\nvolumes:\n  opensearch-data1:\n\nnetworks:\n  opensearch-net:\n</code></pre>\n<p>Also here's the piece of code from the integration test which is trying to start the container:</p>\n<pre><code>private static final CustomOpenSearchContainer opensearchContainer;\n\nstatic{\n    opensearchContainer = new CustomOpenSearchContainer().withLogConsumer(new Slf4jLogConsumer(log));\n    opensearchContainer.start();\n    setOpensearchAddress(opensearchContainer.getHttpHostAddress());\n}\n\npublic static class CustomOpenSearchContainer extends GenericContainer&lt;CustomOpenSearchContainer&gt; {\n    @Override\n    protected void configure() {\n        Path dockerFilePath = Paths.get(&quot;src/integration-test/resources/docker/Dockerfile&quot;);\n        ImageFromDockerfile dockerImage = new ImageFromDockerfile().withDockerfile(dockerFilePath);\n\n        setImage(dockerImage);\n\n        log.info(&quot;Starting an opensearch container.&quot;);\n        //withNetworkAliases(&quot;opensearch-&quot; + Base58.randomString(6));\n        withEnv(&quot;discovery.type&quot;, &quot;single-node&quot;);\n        withEnv(&quot;OPENSEARCH_INITIAL_ADMIN_PASSWORD&quot;, &quot;admin&quot;);\n        addExposedPorts(OPENSEARCH_DEFAULT_PORT);\n        setWaitStrategy(new HttpWaitStrategy()\n                .forPort(OPENSEARCH_DEFAULT_PORT)\n                .forStatusCodeMatching(response -&gt; response == HTTP_OK)\n                .withStartupTimeout(Duration.ofMinutes(2)));\n    }\n\n    public String getHttpHostAddress() {\n        return getHost() + &quot;:&quot; + getMappedPort(9200);\n    }\n}\n\n</code></pre>\n<p>opensearch.yml:</p>\n<pre><code>cluster.name: opensearch-cluster\nnode.name: opensearch-node1\npath.data: /usr/share/opensearch/data\npath.logs: /usr/share/opensearch/logs\nnetwork.host: 0.0.0.0\nhttp.port: 9200\n\n# SSL/TLS settings\n#plugins.security.ssl.transport.enabled: false\n#plugins.security.ssl.http.enabled: false\nplugins.security.disabled: true\n\n# Discovery settings\ndiscovery.seed_hosts: [&quot;opensearch-node1&quot;]\ncluster.initial_master_nodes: [&quot;opensearch-node1&quot;]\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}