{
  "question": {
    "tags": [
      "java",
      "hibernate",
      "jpa",
      "merge",
      "transient"
    ],
    "owner": {
      "account_id": 30152840,
      "reputation": 13,
      "user_id": 23107845,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/cef6d00af3f6f04e3d1cf5b90366f1f9?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "enigmatic-coder",
      "link": "https://stackoverflow.com/users/23107845/enigmatic-coder"
    },
    "is_answered": true,
    "view_count": 52,
    "accepted_answer_id": 79379052,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1737608787,
    "creation_date": 1737574007,
    "last_edit_date": 1737608787,
    "question_id": 79378992,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79378992/why-hibernate-runs-two-queries-when-passing-a-transient-entity-to-merge",
    "title": "Why hibernate runs two queries when passing a transient entity to merge?",
    "body": "<blockquote>\n<p>The JPA specification states that:If X is a new entity instance, a new\nmanaged entity instance X' is created and the state of X is copied\ninto the new managed entity instance X'.<br />\nSo I tried to understand the above from two examples below:-<br />\n<em>Case 1</em>:-</p>\n</blockquote>\n<pre><code>entityManager.getTransaction().begin();\n//let's assume we dont have a employee with id 2 in database\nEmployee e=new Employee();\ne.setId(2);\ne.setName(&quot;john&quot;);\n/*\nIf I understand correctly the below query should run just an INSERT query\nwhen context is flushed\nbut hibernate runs two queries,SELECT followed by INSERT\n*/\nentityManager.merge(e);\n// entityManager.getTransaction().commit();\n</code></pre>\n<p><em>Case 2:-</em></p>\n<pre><code>entityManager.getTransaction().begin();\n  //let's assume we have a employee with id 3 in database\n  Employee e=new Employee();\n  e.setId(3);\n  e.setName(&quot;arthur&quot;);\n  /*\n  If I understand correctly the below query should fail to run because\n  then we would have two records with same primary key when context is flushed \n  but hibernate runs two queries,SELECT followed by UPDATE\n   */\n  entityManager.merge(e);\n  // entityManager.getTransaction().commit();\n</code></pre>\n<p>I'm new to hibernate so is my understanding of merge correct and if not what am I missing? Also it seems merge works for transient entities too,is it right?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}