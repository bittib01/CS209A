{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "apache-spark",
      "apache-spark-sql"
    ],
    "owner": {
      "account_id": 13251402,
      "reputation": 65,
      "user_id": 9568810,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/s256-rj/photo.jpg",
      "display_name": "Raja Chaitanya Rekapalli",
      "link": "https://stackoverflow.com/users/9568810/raja-chaitanya-rekapalli"
    },
    "is_answered": false,
    "view_count": 394,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1724925090,
    "creation_date": 1717734203,
    "last_edit_date": 1718185019,
    "question_id": 78589935,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78589935/failed-to-instantiate-sparksession-factory-method-sparksession-cant-inv",
    "title": "Failed to instantiate [...SparkSession]: Factory method &#39;sparkSession&#39;-Can&#39;t invoke &quot;java.util.Map.get(Object)&quot; because &quot;currentValues&quot; is null",
    "body": "<p>Getting this error while trying out <strong>Apache Spark 4.0.0-preview1</strong> with <strong>Java (v17) Springboot (v3.2.5)</strong> application. A sample SparkConfig where I am getting the above error while creating 'javaSparkContext'.</p>\n<pre><code>@Configuration\npublic class SparkConfig {\n\n    @Value(&quot;${spark.app.name}&quot;)\n    private String appName;\n\n    @Value(&quot;${spark.master}&quot;)\n    private String masterUri;\n\n    @Bean\n    public SparkConf sparkConf() throws IOException {\n        var conf = new SparkConf()\n                .setAppName(appName)\n                .setMaster(masterUri);\n        return conf;\n    }\n\n    @Bean\n    public SparkSession sparkSession(JavaSparkContext sparkContext) {\n        return SparkSession.builder()\n                .sparkContext(sparkContext.sc())\n                .config(sparkContext.getConf())\n                .getOrCreate();\n    }\n\n    @Bean\n    public JavaSparkContext javaSparkContext(SparkConf sparkConf) {\n        return new JavaSparkContext(sparkConf);\n    }\n}\n</code></pre>\n<p>Could someone suggest a solution for the issue!</p>\n<p>Please find below the stack trace:</p>\n<pre><code>org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'sparkSession' defined in class path resource [com/sparktest/batchtest/config/SparkConfig.class]: Unsatisfied dependency expressed through method 'sparkSession' parameter 0: Error creating bean with name 'javaSparkContext' defined in class path resource [com/sparktest/batchtest/config/SparkConfig.class]: Failed to instantiate [org.apache.spark.api.java.JavaSparkContext]: Factory method 'javaSparkContext' threw exception with message: Cannot invoke &quot;java.util.Map.get(Object)&quot; because &quot;currentValues&quot; is null\n    at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:542) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1335) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1165) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:962) ~[spring-context-6.1.6.jar:6.1.6]\n    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624) ~[spring-context-6.1.6.jar:6.1.6]\n    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:334) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354) ~[spring-boot-3.2.5.jar:3.2.5]\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343) ~[spring-boot-3.2.5.jar:3.2.5]\n    at com.sparktest.batchtest.main(batchtest.java:31) ~[classes/:na]\nCaused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'javaSparkContext' defined in class path resource [com/sparktest/batchtest/config/SparkConfig.class]: Failed to instantiate [org.apache.spark.api.java.JavaSparkContext]: Factory method 'javaSparkContext' threw exception with message: Cannot invoke &quot;java.util.Map.get(Object)&quot; because &quot;currentValues&quot; is null\n    at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:648) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:636) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1335) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1165) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782) ~[spring-beans-6.1.6.jar:6.1.6]\n    ... 19 common frames omitted\nCaused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.apache.spark.api.java.JavaSparkContext]: Factory method 'javaSparkContext' threw exception with message: Cannot invoke &quot;java.util.Map.get(Object)&quot; because &quot;currentValues&quot; is null\n    at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:177) ~[spring-beans-6.1.6.jar:6.1.6]\n    at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:644) ~[spring-beans-6.1.6.jar:6.1.6]\n    ... 33 common frames omitted\nCaused by: java.lang.NullPointerException: Cannot invoke &quot;java.util.Map.get(Object)&quot; because &quot;currentValues&quot; is null\n    at org.apache.logging.log4j.CloseableThreadContext$Instance.putAll(CloseableThreadContext.java:170) ~[log4j-api-2.21.1.jar:na]\n    at org.apache.logging.log4j.CloseableThreadContext.putAll(CloseableThreadContext.java:100) ~[log4j-api-2.21.1.jar:na]\n    at org.apache.spark.internal.Logging.withLogContext(Logging.scala:166) ~[spark-common-utils_2.13-4.0.0-preview1.jar:4.0.0-preview1]\n    at org.apache.spark.internal.Logging.withLogContext$(Logging.scala:165) ~[spark-common-utils_2.13-4.0.0-preview1.jar:4.0.0-preview1]\n    at org.apache.spark.SparkContext.withLogContext(SparkContext.scala:85) ~[spark-core_2.13-4.0.0-preview1.jar:4.0.0-preview1]\n    at org.apache.spark.internal.Logging.logInfo(Logging.scala:182) ~[spark-common-utils_2.13-4.0.0-preview1.jar:4.0.0-preview1]\n    at org.apache.spark.internal.Logging.logInfo$(Logging.scala:179) ~[spark-common-utils_2.13-4.0.0-preview1.jar:4.0.0-preview1]\n    at org.apache.spark.SparkContext.logInfo(SparkContext.scala:85) ~[spark-core_2.13-4.0.0-preview1.jar:4.0.0-preview1]\n    at org.apache.spark.SparkContext.&lt;init&gt;(SparkContext.scala:202) ~[spark-core_2.13-4.0.0-preview1.jar:4.0.0-preview1]\n    at org.apache.spark.api.java.JavaSparkContext.&lt;init&gt;(JavaSparkContext.scala:59) ~[spark-core_2.13-4.0.0-preview1.jar:4.0.0-preview1]\n    at com.sparktest.jobengine.config.SparkConfig.javaSparkContext(SparkConfig.java:81) ~[classes/:na]\n    at com.sparktest.jobengine.config.SparkConfig$$SpringCGLIB$$0.CGLIB$javaSparkContext$0(&lt;generated&gt;) ~[classes/:na]\n    at com.sparktest.jobengine.config.SparkConfig$$SpringCGLIB$$FastClass$$1.invoke(&lt;generated&gt;) ~[classes/:na]\n    at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258) ~[spring-core-6.1.6.jar:6.1.6]\n    at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:331) ~[spring-context-6.1.6.jar:6.1.6]\n    at com.sparktest.jobengine.config.SparkConfig$$SpringCGLIB$$0.javaSparkContext(&lt;generated&gt;) ~[classes/:na]\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]\n    at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:140) ~[spring-beans-6.1.6.jar:6.1.6]\n    ... 34 common frames omitted\n</code></pre>\n<p>This error is coming when Spark Session is being created. Tried even without a config class and getting the same error!</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}