{
  "question": {
    "tags": [
      "java",
      "apache-flink",
      "flink-streaming",
      "rocksdb",
      "checkpoint"
    ],
    "owner": {
      "account_id": 15442634,
      "reputation": 11,
      "user_id": 11140717,
      "user_type": "registered",
      "profile_image": "https://lh4.googleusercontent.com/-tReuqkYrE0c/AAAAAAAAAAI/AAAAAAAAACU/k5_Bi2uMi_g/s256-rj/photo.jpg",
      "display_name": "fidodosomething",
      "link": "https://stackoverflow.com/users/11140717/fidodosomething"
    },
    "is_answered": false,
    "view_count": 702,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1714313780,
    "creation_date": 1713192466,
    "last_edit_date": 1713228812,
    "question_id": 78329234,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78329234/flink-job-keep-deploying-or-initializing",
    "title": "Flink job keep DEPLOYING or INITIALIZING",
    "body": "<p>I deploy my flink tasks based on flink-kubernetes-operator. At the same time, I set up a checkpoint, where the checkpoint directory is a mounted pvc. StateBackend uses RocksDB and is configured with incremental checkpoints. But my program will encounter some problems</p>\n<ol>\n<li>When restarting the service, some sub tasks will always be in the DEPLOYING or INITIALIZING state, as if blocked, and will no longer continue to run, while other sub tasks will be in the RUNNING state. But sometimes the task can be deleted again and it can run normally again after redeployment.\n<a href=\"https://i.sstatic.net/ryMLl.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/ryMLl.jpg\" alt=\"enter image description here\" /></a></li>\n<li>The incremental checkpoint size feels like it is continuing to grow, but I have set TTL for the custom state, and other functions are ReduceFunction. How should I check where there is a possibility of state leakage?\n<a href=\"https://i.sstatic.net/0O6UB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/0O6UB.png\" alt=\"enter image description here\" /></a></li>\n<li>Sometimes when a task is running, there will be a situation similar to blocking, and consumption will no longer continue. At the same time, checkpoint continues to fail. Is there any good troubleshooting method for me?</li>\n</ol>\n<p>flink versionï¼š1.14.4</p>\n<p>flink-kubernetes-operator version: release-1.4.0, link: <a href=\"https://github.com/apache/flink-kubernetes-operator\" rel=\"nofollow noreferrer\">https://github.com/apache/flink-kubernetes-operator</a> commit:7fc23a1;</p>\n<p>I don't know how to debug. When my job blocked,I artahs/ jstack try to looking at the thread stack, you will find that there is thread blocking; but the result of each blocking is different. sometimes will be like</p>\n<pre><code>[arthas@1]$ thread -b \n&quot;Window(TumblingEventTimeWindows(60000), EventTimeTrigger, CommonWindowReduceFunction, PassThroughWindowFunction) -&gt; Flat Map (22/72)#0&quot; Id=157 BLOCKED on java.util.jar.JarFile@449cf4a0 owned by &quot;Window(TumblingEventTimeWindows(60000), EventTimeTrigger, AppGroupTransactionEventApplyFunction) -&gt; (Sink: Unnamed, Timestamps/Watermarks -&gt; Flat Map) (31/32)#0&quot; Id=151\n    at java.util.zip.ZipFile$ZipFileInputStream.read(ZipFile.java:719)\n    -  blocked on java.util.jar.JarFile@449cf4a0\n    at java.util.zip.ZipFile$ZipFileInflaterInputStream.fill(ZipFile.java:434)\n    at java.util.zip.InflaterInputStream.read(InflaterInputStream.java:158)\n    at sun.misc.Resource.getBytes(Resource.java:124)\n    at java.net.URLClassLoader.defineClass(URLClassLoader.java:463)\n    at java.net.URLClassLoader.access$100(URLClassLoader.java:74)\n    at java.net.URLClassLoader$1.run(URLClassLoader.java:369)\n    at java.net.URLClassLoader$1.run(URLClassLoader.java:363)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at java.net.URLClassLoader.findClass(URLClassLoader.java:362)\n    at org.apache.flink.util.ChildFirstClassLoader.loadClassWithoutExceptionHandling(ChildFirstClassLoader.java:71)\n    at org.apache.flink.util.FlinkUserCodeClassLoader.loadClass(FlinkUserCodeClassLoader.java:48)\n    -  locked org.apache.flink.util.ChildFirstClassLoader@697c9014 &lt;---- but blocks 93 other threads!\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n    at org.apache.flink.runtime.execution.librarycache.FlinkUserCodeClassLoaders$SafetyNetWrapperClassLoader.loadClass(FlinkUserCodeClassLoaders.java:172)\n    at java.lang.Class.forName0(Native Method)\n    at java.lang.Class.forName(Class.java:348)\n    at org.apache.flink.util.InstantiationUtil$ClassLoaderObjectInputStream.resolveClass(InstantiationUtil.java:78)\n    at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1868)\n    at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1751)\n    at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2042)\n    at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1573)\n    at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2287)\n    at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2211)\n    at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2069)\n    at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1573)\n    at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2287)\n    at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2211)\n    at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2069)\n    at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1573)\n    at java.io.ObjectInputStream.readObject(ObjectInputStream.java:431)\n    at java.util.ArrayList.readObject(ArrayList.java:797)\n    at sun.reflect.GeneratedMethodAccessor22.invoke(Unknown Source)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1170)\n    at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2178)\n    at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2069)\n    at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1573)\n    at java.io.ObjectInputStream.readObject(ObjectInputStream.java:431)\n    at org.apache.flink.util.InstantiationUtil.deserializeObject(InstantiationUtil.java:617)\n    at org.apache.flink.util.InstantiationUtil.deserializeObject(InstantiationUtil.java:602)\n    at org.apache.flink.util.InstantiationUtil.deserializeObject(InstantiationUtil.java:589)\n    at org.apache.flink.util.InstantiationUtil.readObjectFromConfig(InstantiationUtil.java:543)\n    at org.apache.flink.streaming.api.graph.StreamConfig.getOutEdgesInOrder(StreamConfig.java:485)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.createRecordWriters(StreamTask.java:1612)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.createRecordWriterDelegate(StreamTask.java:1596)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.&lt;init&gt;(StreamTask.java:376)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.&lt;init&gt;(StreamTask.java:359)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.&lt;init&gt;(StreamTask.java:332)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.&lt;init&gt;(StreamTask.java:324)\n    at org.apache.flink.streaming.runtime.tasks.StreamTask.&lt;init&gt;(StreamTask.java:314)\n    at org.apache.flink.streaming.runtime.tasks.OneInputStreamTask.&lt;init&gt;(OneInputStreamTask.java:75)\n    at sun.reflect.GeneratedConstructorAccessor37.newInstance(Unknown Source)\n    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n    at java.lang.reflect.Constructor.newInstance(Constructor.java:423)\n    at org.apache.flink.runtime.taskmanager.Task.loadAndInstantiateInvokable(Task.java:1582)\n    at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:740)\n    at org.apache.flink.runtime.taskmanager.Task.run(Task.java:575)\n    at java.lang.Thread.run(Thread.java:748)\n</code></pre>\n<p>but sometime is other:</p>\n<pre><code>&quot;System Time Trigger for Window(TumblingEventTimeWindows(60000), EventTimeTrigger, CommonWindowReduceFunction, PassThroughWindowFunction) (32/48)#0&quot; Id=232 TIMED_WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@783b47ad\n    at sun.misc.Unsafe.park(Native Method)\n    -  waiting on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@783b47ad\n    at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1093)\n    at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:809)\n    at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n    ...\n\n\n&quot;KeyedProcess -&gt; Sink: CCLOUD_APP_SPAN_PORTRAIT_DETECT (24/32)#0&quot; Id=134 BLOCKED on org.apache.flink.util.ChildFirstClassLoader@53624f6b owned by &quot;Window(TumblingEventTimeWindows(60000), EventTimeTrigger, CommonWindowReduceFunction, PassThroughWindowFunction) (32/48)#0&quot; Id=92\n    at java.lang.Class.getDeclaredFields0(Native Method)\n    -  blocked on org.apache.flink.util.ChildFirstClassLoader@53624f6b\n    at java.lang.Class.privateGetDeclaredFields(Class.java:2583)\n    at java.lang.Class.getDeclaredField(Class.java:2068)\n    at java.io.ObjectStreamClass.getDeclaredSUID(ObjectStreamClass.java:1857)\n    at java.io.ObjectStreamClass.access$700(ObjectStreamClass.java:79)\n    at java.io.ObjectStreamClass$3.run(ObjectStreamClass.java:506)\n    at java.io.ObjectStreamClass$3.run(ObjectStreamClass.java:494)\n    at java.security.AccessController.doPrivileged(Native Method)\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}