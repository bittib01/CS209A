{
  "question": {
    "tags": [
      "java",
      "azure",
      "azure-ad-msal",
      "microsoft-entra-id"
    ],
    "owner": {
      "account_id": 2465079,
      "reputation": 3646,
      "user_id": 2148365,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/9da38693fd3d6696d529bbfa360fc4be?s=256&d=identicon&r=PG",
      "display_name": "Michiel",
      "link": "https://stackoverflow.com/users/2148365/michiel"
    },
    "is_answered": true,
    "view_count": 172,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1753691398,
    "creation_date": 1724686236,
    "last_edit_date": 1753691398,
    "question_id": 78915230,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78915230/interactive-browser-request-is-redirected-to-localhost-success-page-but-throw",
    "title": "Interactive browser request is redirected to localhost &quot;success&quot; page, but throws an exception afterwards",
    "body": "<p>I am in the process of implementing msal4j (version 1.17.0) into a desktop application. As its a public application I'm using the interactive browser request flow to obtain a token. I'm using the following setup (simplified) :</p>\n<pre class=\"lang-java prettyprint-override\"><code>var application = PublicClientApplication.builder(CLIENT_ID)\n          .authority(&quot;https://login.microsoftonline.com/&quot; + TENANT_ID)\n          .build();\n\nvar parameters =\n          InteractiveRequestParameters.builder(new URI(&quot;http://localhost/&quot;))\n              .scopes(Set.of(&quot;openid&quot;))\n              .build();\n      return app.acquireToken(parameters).join();\n</code></pre>\n<p>When the application is deployed to its environment, a Microsoft Edge browser window is opened\nwith address <code>login.microsoftonline.com/{etc}</code> . As I'm already logged in, the browser immediately redirects to <code>http://localhost:{randomPort}</code> with message:</p>\n<blockquote>\n<p>Authentication complete. You can close the browser and return to the application.</p>\n</blockquote>\n<p>However, at the same time an exception message is logged related to a connection exception:</p>\n<pre class=\"lang-java prettyprint-override\"><code>java.util.concurrent.CompletionException: com.microsoft.aad.msal4j.MsalClientException: java.net.ConnectException: Connection timed out: connect\n    at com.microsoft.aad.msal4j.AuthenticationResultSupplier.get(AuthenticationResultSupplier.java:110) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AuthenticationResultSupplier.get(AuthenticationResultSupplier.java:18) ~[some-desktop-gui.jar:?]\n    at java.util.concurrent.CompletableFuture$AsyncSupply.run(Unknown Source) ~[?:?]\n    at java.util.concurrent.CompletableFuture$AsyncSupply.exec(Unknown Source) ~[?:?]\n    at java.util.concurrent.ForkJoinTask.doExec(Unknown Source) ~[?:?]\n    at java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(Unknown Source) ~[?:?]\n    at java.util.concurrent.ForkJoinPool.scan(Unknown Source) ~[?:?]\n    at java.util.concurrent.ForkJoinPool.runWorker(Unknown Source) ~[?:?]\n    at java.util.concurrent.ForkJoinWorkerThread.run(Unknown Source) ~[?:?]\nCaused by: com.microsoft.aad.msal4j.MsalClientException: java.net.ConnectException: Connection timed out: connect\n    at com.microsoft.aad.msal4j.HttpHelper.executeHttpRequest(HttpHelper.java:56) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.executeRequest(AadInstanceDiscoveryProvider.java:299) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.sendInstanceDiscoveryRequest(AadInstanceDiscoveryProvider.java:249) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.doInstanceDiscoveryAndCache(AadInstanceDiscoveryProvider.java:360) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.getMetadataEntry(AadInstanceDiscoveryProvider.java:107) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AuthenticationResultSupplier.getAuthorityWithPrefNetworkHost(AuthenticationResultSupplier.java:39) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AcquireTokenByAuthorizationGrantSupplier.execute(AcquireTokenByAuthorizationGrantSupplier.java:59) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AcquireTokenByInteractiveFlowSupplier.acquireTokenWithAuthorizationCode(AcquireTokenByInteractiveFlowSupplier.java:270) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AcquireTokenByInteractiveFlowSupplier.execute(AcquireTokenByInteractiveFlowSupplier.java:48) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AuthenticationResultSupplier.get(AuthenticationResultSupplier.java:69) ~[some-desktop-gui.jar:?]\n    ... 8 more\nCaused by: java.net.ConnectException: Connection timed out: connect\n    at sun.nio.ch.Net.connect0(Native Method) ~[?:?]\n    at sun.nio.ch.Net.connect(Unknown Source) ~[?:?]\n    at sun.nio.ch.Net.connect(Unknown Source) ~[?:?]\n    at sun.nio.ch.NioSocketImpl.connect(Unknown Source) ~[?:?]\n    at java.net.SocksSocketImpl.connect(Unknown Source) ~[?:?]\n    at java.net.Socket.connect(Unknown Source) ~[?:?]\n    at sun.security.ssl.SSLSocketImpl.connect(Unknown Source) ~[?:?]\n    at sun.net.NetworkClient.doConnect(Unknown Source) ~[?:?]\n    at sun.net.www.http.HttpClient.openServer(Unknown Source) ~[?:?]\n    at sun.net.www.http.HttpClient.openServer(Unknown Source) ~[?:?]\n    at sun.net.www.protocol.https.HttpsClient.&lt;init&gt;(Unknown Source) ~[?:?]\n    at sun.net.www.protocol.https.HttpsClient.New(Unknown Source) ~[?:?]\n    at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.getNewHttpClient(Unknown Source) ~[?:?]\n    at sun.net.www.protocol.http.HttpURLConnection.plainConnect0(Unknown Source) ~[?:?]\n    at sun.net.www.protocol.http.HttpURLConnection.plainConnect(Unknown Source) ~[?:?]\n    at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(Unknown Source) ~[?:?]\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(Unknown Source) ~[?:?]\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(Unknown Source) ~[?:?]\n    at java.net.HttpURLConnection.getResponseCode(Unknown Source) ~[?:?]\n    at sun.net.www.protocol.https.HttpsURLConnectionImpl.getResponseCode(Unknown Source) ~[?:?]\n    at com.microsoft.aad.msal4j.DefaultHttpClient.readResponseFromConnection(DefaultHttpClient.java:121) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.DefaultHttpClient.executeHttpGet(DefaultHttpClient.java:56) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.DefaultHttpClient.send(DefaultHttpClient.java:44) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.HttpHelper.executeHttpRequestWithRetries(HttpHelper.java:153) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.HttpHelper.executeHttpRequest(HttpHelper.java:52) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.executeRequest(AadInstanceDiscoveryProvider.java:299) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.sendInstanceDiscoveryRequest(AadInstanceDiscoveryProvider.java:249) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.doInstanceDiscoveryAndCache(AadInstanceDiscoveryProvider.java:360) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AadInstanceDiscoveryProvider.getMetadataEntry(AadInstanceDiscoveryProvider.java:107) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AuthenticationResultSupplier.getAuthorityWithPrefNetworkHost(AuthenticationResultSupplier.java:39) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AcquireTokenByAuthorizationGrantSupplier.execute(AcquireTokenByAuthorizationGrantSupplier.java:59) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AcquireTokenByInteractiveFlowSupplier.acquireTokenWithAuthorizationCode(AcquireTokenByInteractiveFlowSupplier.java:270) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AcquireTokenByInteractiveFlowSupplier.execute(AcquireTokenByInteractiveFlowSupplier.java:48) ~[some-desktop-gui.jar:?]\n    at com.microsoft.aad.msal4j.AuthenticationResultSupplier.get(AuthenticationResultSupplier.java:69) ~[some-desktop-gui.jar:?]\n    ... 8 more\n</code></pre>\n<p>Which seems strange because the server has just returned a success message stating that the authentication process has completed. Does anyone know why a connection exception is being thrown, instead of receiving a token? The connection is lost when I refresh the <code>localhost:{randomPort}</code> browser address, so I am assuming that the local server has been closed after having received a valid result.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}