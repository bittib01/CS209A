{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "resttemplate",
      "java-21"
    ],
    "owner": {
      "account_id": 21705482,
      "reputation": 635,
      "user_id": 16018007,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/YzU3v.jpg?s=256",
      "display_name": "jerald jacob",
      "link": "https://stackoverflow.com/users/16018007/jerald-jacob"
    },
    "is_answered": true,
    "view_count": 1060,
    "accepted_answer_id": 78696377,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1719915218,
    "creation_date": 1715835106,
    "last_edit_date": 1715839892,
    "question_id": 78487609,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78487609/intermittent-connection-timeout-issues-in-java-21-spring-boot-3-1-6-application",
    "title": "Intermittent Connection Timeout Issues in Java 21/Spring Boot 3.1.6 Application with Multiple API Consumption",
    "body": "<p>We are experiencing intermediate connection timeout issues. I am using Java 21 and Spring Boot version 3.1.6. The application internally calls the Amadeus API to collect data. My application acts as a wrapper for these APIs. We are consuming 35+ APIs, so sometimes we encounter connection timeouts. We have integrated load tests against the Amadeus API, which consistently returns proper responses without any issues. Similar applications are also experiencing the same issue. All these applications are using Java 21, and instead of the Amadeus API, they consume other services as well.</p>\n<p>Does anyone have any idea about the issue?</p>\n<p>For your reference, I have added the RestTemplate configuration to this question. It would be very helpful for me to find the root cause of this issue.</p>\n<pre><code>@Bean(name = &quot;restTemplate&quot;)\n@Scope(scopeName = &quot;request&quot;, proxyMode = ScopedProxyMode.TARGET_CLASS)\npublic RestTemplate restTemplate(RestTemplateBuilder builder) {\n    return configureRestTemplate(builder);\n}\n\nprivate RestTemplate configureRestTemplate(RestTemplateBuilder builder) {\n    RestTemplate restTemplate = new RestTemplate(new BufferingClientHttpRequestFactory(new SimpleClientHttpRequestFactory()));\n    List&lt;ClientHttpRequestInterceptor&gt; interceptors = new ArrayList&lt;&gt;();\n    interceptors.add(new LoggingRequestInterceptor());\n    restTemplate.setInterceptors(interceptors);\n    if (CollectionUtils.isEmpty(interceptors)) {\n        interceptors = new ArrayList&lt;&gt;();\n    }\n    HttpComponentsClientHttpRequestFactory requestFactory = new HttpComponentsClientHttpRequestFactory();\n    restTemplate.setRequestFactory(requestFactory);\n    return restTemplate;\n}\n</code></pre>\n<p>The code for the API call side is as follows:</p>\n<pre><code>@Autowired\nprivate RestTemplate restTemplate;\n</code></pre>\n<p>.\n.\n.</p>\n<pre><code>private &lt;T, U&gt; U exchangeData(URI uri, T data, Class&lt;U&gt; clazz, HttpHeaders requestHeaders, HttpMethod method,\n                              boolean... errorCustomization) {\n    HttpEntity&lt;T&gt; requestEntity = new HttpEntity&lt;&gt;(data, requestHeaders);\n    ResponseEntity&lt;U&gt; response = null;\n    try {\n        response = restTemplate.exchange(uri, method, requestEntity, clazz);\n\n    } catch (RestClientException e) {\n        List&lt;ErrorModel&gt; errorDetails = new ArrayList&lt;&gt;();\n        errorDetails.add(new ErrorModel(e.getClass().getName(), e.getMessage()));\n        LOG.error(&quot;Error while calling external service&quot;, e);\n        throw applicationErrorConfig.createExternalException(ApiExternalErrorType.SERVER_INTERNAL_ERROR,\n                errorDetails);\n\n    }\n    restErrorManagerUtil.handleExternalServerErrorForComposite(data, response.getBody(), errorCustomization);\n    return response.getBody();\n}\n</code></pre>\n<p>Adding the stack traces also</p>\n<pre><code>org.springframework.web.client.ResourceAccessException: I/O error on GET request for &quot;https://xxxx**********************&quot;: Connect to https://xxxx********************** [domain/ip] failed: Operation timed out\n    at org.springframework.web.client.RestTemplate.createResourceAccessException(RestTemplate.java:888)\n    at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:868)\n    at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:764)\n    at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:646)\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(Unknown Source)\n    at java.base/java.lang.reflect.Method.invoke(Unknown Source)\n    at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)\n    at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)\n    at org.springframework.aop.support.DelegatingIntroductionInterceptor.doProceed(DelegatingIntroductionInterceptor.java:137)\n    at org.springframework.aop.support.DelegatingIntroductionInterceptor.invoke(DelegatingIntroductionInterceptor.java:124)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\n    at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:751)\n    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:703)\n    at org.springframework.web.client.RestTemplate$$SpringCGLIB$$0.exchange(&lt;generated&gt;)\n    at com.ai.loyalty.common.utils.ExtRestInvocationUtil.exchangeData(ExtRestInvocationUtil.java:115)\n    at com.ai.loyalty.common.utils.ExtRestInvocationUtil.getData(ExtRestInvocationUtil.java:107)\n    at com.ai.loyalty.common.clients.impl.LoyaltyClientImpl.getAccountSummary(LoyaltyClientImpl.java:135)\n    at com.ai.loyalty.services.impl.LoyaltyMembershipServiceImpl.getAccountSummary(LoyaltyMembershipServiceImpl.java:104)\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(Unknown Source)\n    at java.base/java.lang.reflect.Method.invoke(Unknown Source)\n    at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:343)\n    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:699)\n    at com.ai.loyalty.services.impl.LoyaltyMembershipServiceImpl$$SpringCGLIB$$0.getAccountSummary(&lt;generated&gt;)\n    at com.ai.loyalty.controllers.LoyaltyMembershipController.getAccountSummaryV3(LoyaltyMembershipController.java:411)\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(Unknown Source)\n    at java.base/java.lang.reflect.Method.invoke(Unknown Source)\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205)\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:150)\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:884)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797)\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1081)\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:974)\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)\n    at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at com.ai.loyalty.common.application.filters.JsonContentTypeValidationFilter.doFilterInternal(JsonContentTypeValidationFilter.java:44)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at com.ai.loyalty.config.CorsFilter.doFilter(CorsFilter.java:26)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at com.ai.loyalty.common.application.filters.LoggingFilter.doFilter(LoggingFilter.java:52)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)\n    at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:117)\n    at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:83)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)\n    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.oauth2.server.resource.web.authentication.BearerTokenAuthenticationFilter.doFilterInternal(BearerTokenAuthenticationFilter.java:145)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)\n    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)\n    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)\n    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\n    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)\n    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)\n    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)\n    at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)\n    at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at org.springframework.web.servlet.v6_0.OpenTelemetryHandlerMappingFilter.doFilter(OpenTelemetryHandlerMappingFilter.java:69)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n    at org.apache.catalina.valves.RemoteIpValve.invoke(RemoteIpValve.java:735)\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    at java.base/java.lang.Thread.run(Unknown Source)\nCaused by: org.apache.hc.client5.http.HttpHostConnectException: Connect to https://xxxx********************** [domain/ip] failed: Operation timed out\n    at java.base/sun.nio.ch.Net.pollConnect(Native Method)\n    at java.base/sun.nio.ch.Net.pollConnectNow(Unknown Source)\n    at java.base/sun.nio.ch.NioSocketImpl.timedFinishConnect(Unknown Source)\n    at java.base/sun.nio.ch.NioSocketImpl.connect(Unknown Source)\n    at java.base/java.net.SocksSocketImpl.connect(Unknown Source)\n    at java.base/java.net.Socket.connect(Unknown Source)\n    at org.apache.hc.client5.http.ssl.SSLConnectionSocketFactory.lambda$connectSocket$0(SSLConnectionSocketFactory.java:281)\n    at java.base/java.security.AccessController.doPrivileged(Unknown Source)\n    at org.apache.hc.client5.http.ssl.SSLConnectionSocketFactory.connectSocket(SSLConnectionSocketFactory.java:280)\n    at org.apache.hc.client5.http.ssl.SSLConnectionSocketFactory.connectSocket(SSLConnectionSocketFactory.java:240)\n    at org.apache.hc.client5.http.impl.io.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:189)\n    at org.apache.hc.client5.http.impl.io.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:450)\n    at org.apache.hc.client5.http.impl.classic.InternalExecRuntime.connectEndpoint(InternalExecRuntime.java:162)\n    at org.apache.hc.client5.http.impl.classic.InternalExecRuntime.connectEndpoint(InternalExecRuntime.java:172)\n    at org.apache.hc.client5.http.impl.classic.ConnectExec.execute(ConnectExec.java:142)\n    at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)\n    at org.apache.hc.client5.http.impl.classic.ProtocolExec.execute(ProtocolExec.java:192)\n    at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)\n    at org.apache.hc.client5.http.impl.classic.HttpRequestRetryExec.execute(HttpRequestRetryExec.java:113)\n    at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)\n    at org.apache.hc.client5.http.impl.classic.ContentCompressionExec.execute(ContentCompressionExec.java:152)\n    at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)\n    at org.apache.hc.client5.http.impl.classic.RedirectExec.execute(RedirectExec.java:116)\n    at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)\n    at org.apache.hc.client5.http.impl.classic.InternalHttpClient.doExecute(InternalHttpClient.java:170)\n    at org.apache.hc.client5.http.impl.classic.CloseableHttpClient.execute(CloseableHttpClient.java:106)\n    at org.apache.hc.client5.http.impl.classic.CloseableHttpClient.execute(CloseableHttpClient.java:55)\n    at org.springframework.http.client.HttpComponentsClientHttpRequest.executeInternal(HttpComponentsClientHttpRequest.java:93)\n    at org.springframework.http.client.AbstractBufferingClientHttpRequest.executeInternal(AbstractBufferingClientHttpRequest.java:48)\n    at org.springframework.http.client.AbstractClientHttpRequest.execute(AbstractClientHttpRequest.java:66)\n    at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:862)\n    ... 125 more\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}