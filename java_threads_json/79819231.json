{
  "question": {
    "tags": [
      "java",
      "maven",
      "tomcat",
      "package"
    ],
    "owner": {
      "account_id": 3074494,
      "reputation": 143,
      "user_id": 2604243,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/b7a8dbfe7ed687ae22c52508697498db?s=256&d=identicon&r=PG",
      "display_name": "deemon",
      "link": "https://stackoverflow.com/users/2604243/deemon"
    },
    "is_answered": true,
    "view_count": 112,
    "accepted_answer_id": 79820210,
    "answer_count": 3,
    "score": 1,
    "last_activity_date": 1763641251,
    "creation_date": 1763054641,
    "last_edit_date": 1763130213,
    "question_id": 79819231,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79819231/building-a-war-package-that-can-be-deployed-under-tomcat-and-can-be-executed-in",
    "title": "Building a WAR package, that can be deployed under Tomcat and can be executed in the CLI as well",
    "body": "<p>I would like to create a WAR package with maven, that can be deployed under Tomcat (9 or above) and also can be executed on the command line (= CLI). I already realised to make a package, that could be deployed either under Tomcat or could be executed on the CLI, but not both in the same package.\nThis <a href=\"https://spring.io/blog/2014/03/07/deploying-spring-boot-applications/\" rel=\"nofollow noreferrer\">article</a> says:</p>\n<blockquote>\n<p>This new class can now be used to run the application using embeddedd\nJetty or Tomcat, internally, and it can be deployed to any Servlet 3\ncontainer.</p>\n</blockquote>\n<p>But it didn't work for me (neither under Tomcat nor in CLI).</p>\n<p>EDIT: <a href=\"https://stackoverflow.com/questions/73278110/maven-generate-both-jar-and-war-for-the-project-using-same-pom-xml\">here</a> I found the option <code>&lt;archiveClasses&gt;</code>. With this the compiled class of My.App was put in a .JAR (under WEB-INF/lib where all the other dependencies are located) instead of putting it under WEB-INF/classes. Now the .WAR can be deployed under Tomcat, but I still can't run it with <code>java -jar</code>. The error message is: java.lang.ClassNotFoundException: My.App.</p>\n<p>Is there a solution, to extract each .JAR (under WEB-INF/lib) to the disk by running <code>java -jar</code>, then setting the classpath dynamically, and starting My.App finally from the disk ? Or am I on the wrong path ?</p>\n<p>I found a similar <a href=\"https://stackoverflow.com/questions/23868580/one-spring-boot-project-deploy-to-both-jar-or-war\">question</a>. But:</p>\n<blockquote>\n<p>That way project build was able to generate multiple deployment\nartifacts</p>\n</blockquote>\n<p>I would like to have 1 artifact, that can be deployed under Tomcat, and also can be executed with <code>java -jar</code>.</p>\n<p>I have the following project structure:</p>\n<pre><code>pom.xml\n\nsrc/main/java/My/App.java\nsrc/main/webapp/WEB-INF/config\nsrc/main/webapp/WEB-INF/web.xml\nsrc/main/webapp/doc\nsrc/main/webapp/resources\n\nsrc/test/java/My/AppTest.java\nsrc/test/config\nsrc/test/resources\n</code></pre>\n<p>In the generated  .WAR  there is the following structure:</p>\n<pre><code>WEB-INF/classes/My/App.class\nWEB-INF/config  //configs of My.App\nWEB-INF/lib  //dependencies of My.App as  .JAR\nWEB-INF/web.xml  //required by Tomcat\ndoc  //some docs accessible within the running application\nresources  //resources of My.App\n</code></pre>\n<p>This is almost good for deploying under Tomcat; the only problem is that <code>My/App.class</code> should also be in a .JAR file under <code>WEB-INF/lib</code>.</p>\n<p>I also can't start the  .WAR  in the CLI (with <code>java -jar</code>), because the JVM can't find the dependencies of <code>My/App.class</code>, even if <code>MANIFEST.MF</code> has <code>ClassPath</code> with entries e.g.:</p>\n<pre><code>WEB-INF/lib/dp1.jar\nWEB-INF/lib/dp2.jar\n</code></pre>\n<p>Can someone help me please to achieve this ?</p>\n<p>The content of <code>App.java</code> (based on the example in the article above):</p>\n<pre><code>package My;\n\nimport org.apache.catalina.Context;\nimport org.apache.catalina.LifecycleException;\nimport org.apache.catalina.Wrapper;\nimport org.apache.catalina.connector.Connector;\nimport org.apache.catalina.core.StandardVirtualThreadExecutor;\nimport org.apache.catalina.startup.Tomcat;\nimport org.apache.commons.io.FileUtils;\nimport org.apache.tomcat.util.descriptor.web.ContextEnvironment;\nimport org.apache.tomcat.util.descriptor.web.FilterDef;\nimport org.apache.tomcat.util.descriptor.web.FilterMap;\nimport org.springframework.boot.builder.SpringApplicationBuilder;\nimport org.springframework.boot.web.servlet.support.SpringBootServletInitializer;\nimport org.springframework.core.io.Resource;\nimport org.springframework.core.io.ResourceLoader;\nimport org.springframework.core.io.support.PathMatchingResourcePatternResolver;\nimport org.springframework.core.io.support.ResourcePatternResolver;\nimport java.util.logging.Logger;\n\n\npublic class App extends SpringBootServletInitializer {\n\n    private static final Logger LOGGER = Logger.getLogger(App.class.getName());\n\n\n    @Override\n    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {\n        return application.sources(App.class);\n    }\n\n    public static void main(String[] args) throws LifecycleException, UnknownHostException {\n        Tomcat tomcat = createAndConfigureTomcat();\n        tomcat.start();\n        tomcat.getServer().await();\n    }\n\n    public static Tomcat createAndConfigureTomcat() throws UnknownHostException {\n        Tomcat tomcat = new Tomcat();\n\n        String docBase = new File(System.getProperty(&quot;java.io.tmpdir&quot;) + &quot;/tomcat-&quot; + Math.random()).getAbsolutePath();\n        tomcat.setBaseDir(docBase);\n        tomcat.getHost().setAppBase(docBase);\n        tomcat.enableNaming();\n        \n        // ... etc\n    }\n}\n</code></pre>\n<p>The content of <code>pom.xml</code>:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;My.app&lt;/groupId&gt;\n    &lt;artifactId&gt;My.app&lt;/artifactId&gt;\n    &lt;version&gt;0.1&lt;/version&gt;\n    &lt;packaging&gt;war&lt;/packaging&gt;\n\n\n    &lt;properties&gt;\n        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;\n\n        &lt;spring.version&gt;7.0.0-M7&lt;/spring.version&gt;\n        &lt;snakeyaml.version&gt;2.4&lt;/snakeyaml.version&gt;\n        &lt;tomcat.version&gt;9.0.104&lt;/tomcat.version&gt;\n        \n        &lt;maven-compiler-plugin.version&gt;3.13.0&lt;/maven-compiler-plugin.version&gt;\n        &lt;maven-war-plugin.version&gt;3.4.0&lt;/maven-war-plugin.version&gt;\n        &lt;maven-jar-plugin.version&gt;3.4.2&lt;/maven-jar-plugin.version&gt;\n        &lt;jacoco.version&gt;0.8.12&lt;/jacoco.version&gt;\n    &lt;/properties&gt;\n\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;\n            &lt;version&gt;${spring.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-core&lt;/artifactId&gt;\n            &lt;version&gt;${spring.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;\n            &lt;version&gt;${spring.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-expression&lt;/artifactId&gt;\n            &lt;version&gt;${spring.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-web&lt;/artifactId&gt;\n            &lt;version&gt;${spring.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.yaml&lt;/groupId&gt;\n            &lt;artifactId&gt;snakeyaml&lt;/artifactId&gt;\n            &lt;version&gt;${snakeyaml.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;\n            &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt;\n            &lt;version&gt;${tomcat.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;\n            &lt;artifactId&gt;tomcat-embed-el&lt;/artifactId&gt;\n            &lt;version&gt;${tomcat.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;\n            &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;\n            &lt;version&gt;9.0.44&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n    \n    \n    \n    \n    &lt;build&gt;\n            &lt;plugins&gt;\n                &lt;plugin&gt;\n                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                    &lt;version&gt;${maven-compiler-plugin.version}&lt;/version&gt;\n                &lt;/plugin&gt;\n                \n                &lt;plugin&gt;\n                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                    &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;\n                    &lt;version&gt;${maven-jar-plugin.version}&lt;/version&gt;\n                &lt;/plugin&gt;\n                \n                &lt;plugin&gt;\n                    &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;\n                    &lt;version&gt;${maven-war-plugin.version}&lt;/version&gt;\n                    &lt;configuration&gt;\n                        &lt;archiveClasses&gt;true&lt;/archiveClasses&gt;\n                        &lt;webXml&gt;src/main/webapp/WEB-INF/web.xml&lt;/webXml&gt;\n                        &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;\n                        &lt;archive&gt;\n                            &lt;manifest&gt;\n                                &lt;addDefaultImplementationEntries&gt;true&lt;/addDefaultImplementationEntries&gt;\n                                &lt;addClasspath&gt;true&lt;/addClasspath&gt;\n                                &lt;!-- within the .war the dependencies are stored under  WEB-INF/lib. The ClassPath entries in MANIFEST.MF will be prefixed with this. --&gt;\n                                &lt;classpathPrefix&gt;WEB-INF/lib/&lt;/classpathPrefix&gt;\n                            &lt;/manifest&gt;\n                            &lt;manifestEntries&gt;\n                                &lt;Build-Label&gt;${project.version}&lt;/Build-Label&gt;\n                                &lt;Build-Time&gt;${maven.build.timestamp}&lt;/Build-Time&gt;\n                                &lt;!-- within the .war the compiled Java classes of My.App are stored under  WEB-INF/classes. --&gt;\n                                &lt;Class-Path&gt;WEB-INF/classes/&lt;/Class-Path&gt;\n                                &lt;Main-Class&gt;My.App&lt;/Main-Class&gt;\n                            &lt;/manifestEntries&gt;\n                        &lt;/archive&gt;\n                    &lt;/configuration&gt;\n                &lt;/plugin&gt;\n\n                &lt;plugin&gt;\n                    &lt;groupId&gt;org.jacoco&lt;/groupId&gt;\n                    &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;\n                    &lt;version&gt;${jacoco.version}&lt;/version&gt;\n                &lt;/plugin&gt;\n            &lt;/plugins&gt;\n            \n            \n            &lt;!-- location of logback.xml; used by Junit tests --&gt;\n            &lt;resources&gt;\n                &lt;resource&gt;\n                    &lt;directory&gt;src/test/config&lt;/directory&gt;\n                &lt;/resource&gt;\n            &lt;/resources&gt;\n    &lt;/build&gt;\n\n\n    &lt;profiles&gt;\n        &lt;profile&gt;\n            &lt;id&gt;coverage&lt;/id&gt;\n            &lt;build&gt;\n                &lt;plugins&gt;\n                    &lt;plugin&gt;\n                        &lt;groupId&gt;org.jacoco&lt;/groupId&gt;\n                        &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;\n                        &lt;executions&gt;\n                            &lt;execution&gt;\n                                &lt;id&gt;prepare-agent&lt;/id&gt;\n                                &lt;goals&gt;\n                                    &lt;goal&gt;prepare-agent&lt;/goal&gt;\n                                &lt;/goals&gt;\n                            &lt;/execution&gt;\n                            &lt;execution&gt;\n                                &lt;id&gt;report&lt;/id&gt;\n                                &lt;goals&gt;\n                                    &lt;goal&gt;report&lt;/goal&gt;\n                                &lt;/goals&gt;\n                            &lt;/execution&gt;\n                        &lt;/executions&gt;\n                    &lt;/plugin&gt;\n                &lt;/plugins&gt;\n            &lt;/build&gt;\n        &lt;/profile&gt;\n    &lt;/profiles&gt;\n&lt;/project&gt;\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}