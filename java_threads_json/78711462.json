{
  "question": {
    "tags": [
      "java",
      "google-cloud-platform",
      "google-cloud-storage",
      "google-cloud-datastore",
      "datastore"
    ],
    "owner": {
      "account_id": 11006755,
      "reputation": 71,
      "user_id": 8085447,
      "user_type": "registered",
      "profile_image": "https://lh6.googleusercontent.com/-7zLjd7iHYT0/AAAAAAAAAAI/AAAAAAAAPX8/17aVUuKs_Xw/s256-rj/photo.jpg",
      "display_name": "Sebastian Filip",
      "link": "https://stackoverflow.com/users/8085447/sebastian-filip"
    },
    "is_answered": false,
    "view_count": 99,
    "answer_count": 1,
    "score": 4,
    "last_activity_date": 1722289813,
    "creation_date": 1720182374,
    "question_id": 78711462,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78711462/how-to-export-a-datastore-kind-to-google-cloud-storage-that-is-from-a-different",
    "title": "How to export a Datastore Kind to Google Cloud Storage that is from a different database than (default)?",
    "body": "<p><a href=\"https://cloud.google.com/datastore/docs/reference/admin/rest/v1/projects/export\" rel=\"nofollow noreferrer\">In this documentation provided by google cloud I cannot find any property to set for datastoreId.</a></p>\n<p>I am using the code from one of the answers that was given <a href=\"https://stackoverflow.com/questions/53311984/datastore-export-logic-in-java\">to this question</a>, to export kinds that are set in the (default) database in Datastore. No ideea tho how to set it so that I can export kinds from a different database.</p>\n<pre><code>package com.google.example.datastore;\n\nimport com.google.appengine.api.appidentity.AppIdentityService;\nimport com.google.appengine.api.appidentity.AppIdentityServiceFactory;\nimport com.google.apphosting.api.ApiProxy;\nimport com.google.common.io.CharStreams;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.io.OutputStreamWriter;\nimport java.net.HttpURLConnection;\nimport java.net.URL;\nimport java.nio.charset.StandardCharsets;\nimport java.text.SimpleDateFormat;\nimport java.util.ArrayList;\nimport java.util.Date;\nimport java.util.logging.Logger;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport org.json.JSONArray;\nimport org.json.JSONObject;\nimport org.json.JSONTokener;\n\n@WebServlet(name = &quot;CloudDatastoreExport&quot;, value = &quot;/cloud-datastore-export&quot;)\npublic class CloudDatastoreExport extends HttpServlet {\n\n  private static final Logger log = Logger.getLogger(CloudDatastoreExport.class.getName());\n\n  @Override\n  public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {\n\n    // Verify outputURL parameter\n    String outputUrlPrefix = request.getParameter(&quot;output_url_prefix&quot;);\n\n    if (outputUrlPrefix == null || !outputUrlPrefix.matches(&quot;^gs://.*&quot;)) {\n      response.setStatus(HttpServletResponse.SC_CONFLICT);\n      response.setContentType(&quot;text/plain&quot;);\n      response.getWriter().println(&quot;Error: Must provide a valid output_url_prefix.&quot;);\n\n    } else {\n\n      // Get project ID\n      String projectId = ApiProxy.getCurrentEnvironment().getAppId();\n      // Remove partition information to get plain app ID\n      String appId = projectId.replaceFirst(&quot;(.*~)&quot;, &quot;&quot;);\n\n      // Get access token\n      ArrayList&lt;String&gt; scopes = new ArrayList&lt;String&gt;();\n      scopes.add(&quot;https://www.googleapis.com/auth/datastore&quot;);\n      final AppIdentityService appIdentity = AppIdentityServiceFactory.getAppIdentityService();\n      final AppIdentityService.GetAccessTokenResult accessToken =\n          appIdentity.getAccessToken(scopes);\n\n      // Read export parameters\n      // If output prefix does not end with slash, add a timestamp\n      if (!outputUrlPrefix.substring(outputUrlPrefix.length() - 1).contentEquals(&quot;/&quot;)) {\n        String timeStamp = new SimpleDateFormat(&quot;yyyyMMddHHmmss&quot;).format(new Date());\n        outputUrlPrefix = outputUrlPrefix + &quot;/&quot; + timeStamp + &quot;/&quot;;\n      }\n\n      String[] namespaces = request.getParameterValues(&quot;namespace_id&quot;);\n      String[] kinds = request.getParameterValues(&quot;kind&quot;);\n\n      // Build export request\n      JSONObject exportRequest = new JSONObject();\n      exportRequest.put(&quot;output_url_prefix&quot;, outputUrlPrefix);\n\n      JSONObject entityFilter = new JSONObject();\n\n      if (kinds != null) {\n        JSONArray kindsJSON = new JSONArray(kinds);\n        entityFilter.put(&quot;kinds&quot;, kinds);\n      }\n\n      if (namespaces != null) {\n        JSONArray namespacesJSON = new JSONArray(namespaces);\n        entityFilter.put(&quot;namespaceIds&quot;, namespacesJSON);\n      }\n\n      exportRequest.put(&quot;entityFilter&quot;, entityFilter);\n\n      URL url = new URL(&quot;https://datastore.googleapis.com/v1/projects/&quot; + appId + &quot;:export&quot;);\n      HttpURLConnection connection = (HttpURLConnection) url.openConnection();\n      connection.setDoOutput(true);\n      connection.setRequestMethod(&quot;POST&quot;);\n      connection.addRequestProperty(&quot;Content-Type&quot;, &quot;application/json&quot;);\n      connection.addRequestProperty(&quot;Authorization&quot;, &quot;Bearer &quot; + accessToken.getAccessToken());\n\n      OutputStreamWriter writer = new OutputStreamWriter(connection.getOutputStream());\n      exportRequest.write(writer);\n      writer.close();\n\n      if (connection.getResponseCode() == HttpURLConnection.HTTP_OK) {\n\n        JSONTokener exportResponseTokens = new JSONTokener(connection.getInputStream());\n        JSONObject exportResponse = new JSONObject(exportResponseTokens);\n\n        response.setContentType(&quot;text/plain&quot;);\n        response.getWriter().println(&quot;Export started:\\n&quot; + exportResponse.toString(4));\n\n      } else {\n        InputStream s = connection.getErrorStream();\n        InputStreamReader r = new InputStreamReader(s, StandardCharsets.UTF_8);\n        String errorMessage =\n            String.format(\n                &quot;got error (%d) response %s from %s&quot;,\n                connection.getResponseCode(), CharStreams.toString(r), connection.toString());\n        log.warning(errorMessage);\n        response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n        response.setContentType(&quot;text/plain&quot;);\n        response.getWriter().println(&quot;Failed to initiate export.&quot;);\n      }\n    }\n  }\n}\n</code></pre>\n<p>I was expecting to have a place in the request body or request parametrs where I could specify the datastoreId.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}