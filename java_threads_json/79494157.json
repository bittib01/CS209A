{
  "question": {
    "tags": [
      "javascript",
      "java",
      "reactjs",
      "spring"
    ],
    "owner": {
      "account_id": 38551541,
      "reputation": 11,
      "user_id": 29355758,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/3d64fc78b6fa6cde7c447b178b3d3641?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "ramil",
      "link": "https://stackoverflow.com/users/29355758/ramil"
    },
    "is_answered": false,
    "view_count": 248,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1754193883,
    "creation_date": 1741425180,
    "last_edit_date": 1741443613,
    "question_id": 79494157,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79494157/cannot-fetch-from-spring-backend-due-to-cors",
    "title": "Cannot fetch from Spring backend due to CORS",
    "body": "<p>I have a backend using Spring and a frontend using React.\nI already have many controllers and all methods work with current CORS:</p>\n<pre><code>@Configuration\npublic class Cors {\n\n    @Bean\n    public CorsFilter corsFilter() {\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        CorsConfiguration config = new CorsConfiguration();\n        config.addAllowedOrigin(&quot;http://localhost:5173&quot;);\n        config.addAllowedHeader(&quot;*&quot;);\n        config.addAllowedMethod(&quot;*&quot;);\n        config.setAllowCredentials(true);\n        source.registerCorsConfiguration(&quot;/**&quot;, config);\n        return new CorsFilter(source);\n    }\n\n}\n</code></pre>\n<p>It's worth noting that I don't use Spring Security.\nThis is my pom:</p>\n<pre><code>&lt;dependencies&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-security-crypto&lt;/artifactId&gt;\n            &lt;version&gt;6.1.4&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.postgresql&lt;/groupId&gt;\n            &lt;artifactId&gt;postgresql&lt;/artifactId&gt;\n            &lt;version&gt;42.7.2&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;version&gt;1.18.36&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n\n    &lt;/dependencies&gt;\n</code></pre>\n<p>Now I have this controller and the only method that doesn't work:</p>\n<p>Dto and controller method (<code>/edit</code> doesn't work):</p>\n<pre><code>@Builder\n@AllArgsConstructor\n@NoArgsConstructor\n@Data\n@Jacksonized\npublic class EditCommentRequest {\n    private long commentId;\n    private boolean isPublished;\n}\n\n@RestController\n@RequestMapping(&quot;/api/comment&quot;)\npublic class CommentController {\n\n    final CommentService commentService;\n\n    public CommentController(CommentService commentService) {\n        this.commentService = commentService;\n    }\n\n    @GetMapping(&quot;/get-all&quot;)\n    public ResponseEntity&lt;?&gt; getAllComments() {\n        List&lt;CommentDto&gt; comments = commentService.getAll();\n        return ResponseEntity.status(HttpStatus.OK).body(comments);\n    }\n    \n    @PostMapping(&quot;/edit&quot;)\n    public ResponseEntity&lt;?&gt; editComment(\n            @RequestBody EditCommentRequest request,\n            HttpSession session) {\n        \n        commentService.updateCommentStatus(request, (Long) session.getAttribute(USER_ID));\n        return ResponseEntity.status(HttpStatus.OK).build();\n    }\n}\n</code></pre>\n<p>The thing is that it is the <code>@PostMapping(&quot;/edit&quot;)</code> method that does not work when fetching from the frontend (all other works good, the problem exactly in this)</p>\n<p>This is fetch from React:</p>\n<pre><code>const handleSendEditCommentData = async (event) =&gt; {\n        event.preventDefault();\n\n        const requestData = {\n            commentId: data.id,\n            isPublished: isCommentShowCheckbox,\n        };\n\n        console.log(requestData);\n\n        try {\n            const response = await fetch(API_ENDPOINTS.COMMENT_EDIT, {\n                method: 'POST',\n                credentials: 'include',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify(requestData),\n            });\n\n            if (response.ok) {\n                onClose();\n                getAllData();\n                toast.success(&quot;Comment edited successfully.&quot;);\n            } else {\n                const errorData = await response.json();\n                switch (response.status) {\n                    case 401:\n                        toast.error(errorData.message || &quot;401&quot;);\n                        break;\n                    case 404:\n                        toast.error(errorData.message || &quot;404&quot;);\n                        break;\n                    case 409:\n                        toast.error(errorData.message || `409`);\n                        break;\n                    case 500:\n                        toast.error(errorData.message || &quot;500&quot;);\n                        break;\n                    default:\n                        toast.error(`Else error`);\n                        break;\n                }\n            }\n\n        } catch (error) {\n            console.error(&quot;Fetch Error:&quot;, error);\n            toast.error(&quot;catch error: &quot; + error.message);\n        }\n</code></pre>\n<p>This method is called by clicking on the button (<code>onClick={handleSendEditCommentData}</code>)\nAll data that is put in the body is: <code>commentId</code> (<code>long</code>), <code>isPublished</code> (<code>bool</code>), are put normally, <code>commentId</code> is simply an id via props, and <code>isPublished</code> is a simple bool <code>useState</code> that is set by the user.</p>\n<p>This fetch method always crashes in catch: <code>catch error: Failed to fetch</code>\nConsole log:</p>\n<pre><code>Access to fetch at 'http://localhost:21001/api/comment/edit' from origin 'http://localhost:5173' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\n\nPOST http://localhost:21001/api/comment/edit net::ERR_FAILED\n\nFetch Error: TypeError: Failed to fetch\n    at handleSendEditCommentData (EditCommentModal.jsx:29:36)\n    at HTMLUnknownElement.callCallback2 (chunk-3F5266CN.js?v=a9e8ce0e:3680:22)\n    at Object.invokeGuardedCallbackDev (chunk-3F5266CN.js?v=a9e8ce0e:3705:24)\n    at invokeGuardedCallback (chunk-3F5266CN.js?v=a9e8ce0e:3739:39)\n    at invokeGuardedCallbackAndCatchFirstError (chunk-3F5266CN.js?v=a9e8ce0e:3742:33)\n    at executeDispatch (chunk-3F5266CN.js?v=a9e8ce0e:7046:11)\n    at processDispatchQueueItemsInOrder (chunk-3F5266CN.js?v=a9e8ce0e:7066:15)\n    at processDispatchQueue (chunk-3F5266CN.js?v=a9e8ce0e:7075:13)\n    at dispatchEventsForPlugins (chunk-3F5266CN.js?v=a9e8ce0e:7083:11)\n    at chunk-3F5266CN.js?v=a9e8ce0e:7206:20\n</code></pre>\n<p>Here two requests are sent, and both of them do not receive a response, in devtools they are marked in red,</p>\n<p>FIRST - Status: CORS error, type: fetch</p>\n<pre><code>Request URL:\nhttp://localhost:21001/api/comment/edit\nReferrer Policy:\nstrict-origin-when-cross-origin\n\nRESPONE HEADERS:\nnone\n\nREQUEST HEADDERS:\ncontent-type:\napplication/json\nreferer:\nhttp://localhost:5173/\nsec-ch-ua:\n&quot;Not(A:Brand&quot;;v=&quot;99&quot;, &quot;Google Chrome&quot;;v=&quot;133&quot;, &quot;Chromium&quot;;v=&quot;133&quot;\nsec-ch-ua-mobile:\n?0\nsec-ch-ua-platform:\n&quot;Windows&quot;\nuser-agent:\nMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36\n\nPAYLOAD:\n{commentId: 5, isPublished: true}\ncommentId: 5\nisPublished: true\n</code></pre>\n<p>SECOND - Status: 401, type: preflight</p>\n<pre><code>Request URL:\nhttp://localhost:21001/api/comment/edit\nRequest Method:\nOPTIONS\nStatus Code:\n401 Unauthorized\nRemote Address:\n[::1]:21001\nReferrer Policy:\nstrict-origin-when-cross-origin\n\nRESPONE HEADERS:\nconnection:\nkeep-alive\ncontent-length:\n0\ndate:\nSat, 08 Mar 2025 08:40:32 GMT\nkeep-alive:\ntimeout=60\n\nREQUEST HEADDERS:\naccept:\n*/*\naccept-encoding:\ngzip, deflate, br, zstd\naccept-language:\nru,ru-RU;q=0.9\naccess-control-request-headers:\ncontent-type\naccess-control-request-method:\nPOST\ncache-control:\nno-cache\nconnection:\nkeep-alive\nhost:\nlocalhost:21001\norigin:\nhttp://localhost:5173\npragma:\nno-cache\nreferer:\nhttp://localhost:5173/\nsec-fetch-dest:\nempty\nsec-fetch-mode:\ncors\nsec-fetch-site:\nsame-site\nuser-agent:\nMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36\n</code></pre>\n<p>Postman response headers:</p>\n<pre><code>Vary Origin\nVary Access-Control-Request-Method\nVary Access-Control-Request-HeadersContent-Length 0\nDate Sat, 08 Mar 2025 08:59:19 GMT\nKeep-Alive timeout=60\nConnection keep-alive\n</code></pre>\n<p>The request URL is correct, I tried different options for sending fetch - it doesn't help, serializes body: JSON.stringify(requestData) in the DTO class in spring, it seems to be correct. CORS with all other methods and from other controllers and from this one works and everything is fine, but I have already messed around with this method and I just don't understand what is wrong here. And I don't use Spring Security. Also, all URL paths are correct, the data is also set correctly in the body on the frontend, the DTO on the backend also seems to be correct, HttpSession also takes the data correctly, but this is not the problem.</p>\n<p>If you need any additional information, please write.\nAnd help me solve this problem, I really have already spent a lot of time and am sitting in one place trying to figure it out. Those who know, help.</p>\n<p>It is necessary that the method does not go into catch, as if CORS blocked this method.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}