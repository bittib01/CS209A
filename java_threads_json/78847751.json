{
  "question": {
    "tags": [
      "java",
      "android",
      "kotlin",
      "sockets",
      "tcp"
    ],
    "owner": {
      "account_id": 7401043,
      "reputation": 69,
      "user_id": 5631476,
      "user_type": "registered",
      "accept_rate": 50,
      "profile_image": "https://i.sstatic.net/qkcVS.png?s=256",
      "display_name": "Mauro",
      "link": "https://stackoverflow.com/users/5631476/mauro"
    },
    "is_answered": true,
    "view_count": 230,
    "accepted_answer_id": 78932404,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1725026411,
    "creation_date": 1723111229,
    "question_id": 78847751,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78847751/why-can-i-successfully-connect-to-a-netcat-server-from-the-adb-shell-and-not-fro",
    "title": "Why can I successfully connect to a netcat server from the adb shell and not from the Android app?",
    "body": "<p>I'm trying to send a TCP message to a netcat server running on the machine where an Android device is connected.</p>\n<p>In order to do so, I'm executing the following steps on the host:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>adb reverse tcp:3000 tcp:3000\nnc -l -p 3000\n</code></pre>\n<p>By running the device shell and performing the following command:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>adb shell\n&gt; nc localhost 3000\n</code></pre>\n<p>I can receive arbitrary bytes from the device successfully.</p>\n<p>Now, I'm trying to do the same with the following simple Android activity:</p>\n<pre><code>@file:OptIn(kotlin.ExperimentalStdlibApi::class)\n\npackage tcp.connection\n\nimport android.os.Bundle\nimport android.util.Log\nimport kotlinx.coroutines.runBlocking\nimport androidx.appcompat.app.AppCompatActivity\nimport java.io.PrintWriter\nimport java.lang.Exception\nimport java.net.InetAddress\nimport java.net.InetSocketAddress\nimport java.net.Socket\n\nclass MainActivity : AppCompatActivity() {\n\n    private val TAG = &quot;[Main]&quot;\n    private val WS_DEFAULT_PORT = 3000\n    private val WS_DEFAULT_HOST = &quot;localhost&quot;\n    private val WS_DEFAULT_TIMEOUT = 10_000L\n\n    private val INTENT_KEY_WS_HOST = &quot;wsHost&quot;\n    private val INTENT_KEY_WS_PORT = &quot;wsPort&quot;\n    private val INTENT_KEY_WS_TIMEOUT = &quot;wsTimeout&quot;\n\n    private var wsHost = WS_DEFAULT_HOST\n    private var wsPort = WS_DEFAULT_PORT\n    private var wsTimeout = WS_DEFAULT_TIMEOUT\n\n    fun tcpPing() {\n        Log.d(TAG, &quot;PROBLEM - 1&quot;)\n        try {\n            // Create a socket to connect to the server\n            Log.d(TAG, &quot;PROBLEM - 2&quot;)\n            val socket = Socket()\n            Log.d(TAG, &quot;PROBLEM - 3 socket created&quot;)\n            socket.connect(InetSocketAddress(wsHost, wsPort), wsTimeout.toInt())\n            Log.d(TAG, &quot;PROBLEM - 4 socket connection estabilished&quot;)\n            // Send the message\n            val autoflush = true\n            val msg = &quot;PING\\n&quot;\n            PrintWriter(socket.getOutputStream(), autoflush).write(msg)\n            // Close the socket\n            Log.d(TAG, &quot;PROBLEM - 5 before closing&quot;)\n            socket.close()\n            Log.d(TAG, &quot;PROBLEM - 6 after closing&quot;)\n        } catch (e: Exception) {\n            e.printStackTrace()\n            Log.d(TAG, &quot;PROBLEM - 7 failed&quot;)\n        }\n    }\n\n    @OptIn(ExperimentalUnsignedTypes::class)\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // Send intent extra by adding --es &lt;param&gt; to the launch.sh\n        // script\n        if (intent.extras != null) {\n            wsHost = intent.extras!!.getString(INTENT_KEY_WS_HOST, WS_DEFAULT_HOST)\n            wsPort =\n                intent.extras!!.getString(INTENT_KEY_WS_PORT, WS_DEFAULT_PORT.toString()).toInt()\n            wsTimeout =\n                intent.extras!!.getString(INTENT_KEY_WS_TIMEOUT, WS_DEFAULT_TIMEOUT.toString())\n                    .toLong()\n        }\n\n        Log.d(TAG, &quot;Host: $wsHost&quot;)\n        Log.d(TAG, &quot;Port: $wsPort&quot;)\n        Log.d(TAG, &quot;Timeout: $wsTimeout&quot;)\n\n        val t = object : Thread() {\n            override fun run() {\n                super.run()\n                tcpPing()\n            }\n        }\n        \n        runBlocking { t.start() }\n    }\n\n    override fun onStop() {\n        super.onStop()\n    }\n}\n</code></pre>\n<p>And with these entries in the <code>AndroidManifest.xml</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;\n&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;\n</code></pre>\n<p>This is the relevant log shown on logcat:</p>\n<pre><code>08-08 11:46:42.817 13722 13722 D [Main]  : Host: localhost\n08-08 11:46:42.817 13722 13722 D [Main]  : Port: 3000\n08-08 11:46:42.817 13722 13722 D [Main]  : Timeout: 10000\n08-08 11:46:42.910 13722 13748 D [Main]  : PROBLEM - 1\n08-08 11:46:42.910 13722 13748 D [Main]  : PROBLEM - 2\n08-08 11:46:42.911 13722 13748 D [Main]  : PROBLEM - 3 socket created\n08-08 11:46:52.936 13722 13748 W System.err: java.net.SocketTimeoutException: failed to connect to localhost/127.0.0.1 (port 3000) from /127.0.0.1 (port 42064) after 10000ms                                                                                                                        \n08-08 11:46:52.938 13722 13748 W System.err:    at libcore.io.IoBridge.connectErrno(IoBridge.java:191)                                                                                                                                                                                               \n08-08 11:46:52.939 13722 13748 W System.err:    at libcore.io.IoBridge.connect(IoBridge.java:135)                                                 \n08-08 11:46:52.939 13722 13748 W System.err:    at java.net.PlainSocketImpl.socketConnect(PlainSocketImpl.java:142)                                                                                                                                                                                  \n08-08 11:46:52.940 13722 13748 W System.err:    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:390)                                                                                                                                                                      \n08-08 11:46:52.940 13722 13748 W System.err:    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:230)            \n08-08 11:46:52.941 13722 13748 W System.err:    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:212)                                                                                                                                                                        \n08-08 11:46:52.941 13722 13748 W System.err:    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:436)\n08-08 11:46:52.942 13722 13748 W System.err:    at java.net.Socket.connect(Socket.java:621)                                                                                                                                                                                                          \n08-08 11:46:52.943 13722 13748 W System.err:    at tcp.connection.MainActivity.tcpPing(MainActivity.kt:126)                                                                                                                                                                                       \n08-08 11:46:52.945 13722 13748 W System.err:    at tcp.connection.MainActivity$onCreate$t$1.run(MainActivity.kt:200)                           \n08-08 11:46:52.945 13722 13748 D [Main]  : PROBLEM - 7 failed \n</code></pre>\n<p>What am I doing wrong?</p>\n<p>Thank you in advance.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}