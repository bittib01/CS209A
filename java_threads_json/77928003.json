{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "postman",
      "multipartfile"
    ],
    "owner": {
      "account_id": 30254680,
      "reputation": 1,
      "user_id": 23186103,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/ACg8ocJIQ8eTtSvFneyPUFvhbFHEKaKjjSBO_i87fBapl1mA=k-s256",
      "display_name": "JEROME RICHARD",
      "link": "https://stackoverflow.com/users/23186103/jerome-richard"
    },
    "is_answered": false,
    "view_count": 2869,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1732875312,
    "creation_date": 1706886713,
    "last_edit_date": 1706888956,
    "question_id": 77928003,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/77928003/content-type-multipart-form-databoundary-charset-utf-8-is-not-supported-when",
    "title": "Content-Type &#39;multipart/form-data;boundary=charset=UTF-8&#39; is not supported] when using Multipartfile",
    "body": "<p>I try the upload of a user picture with the MultipartFile process but I always get the same error message of &quot;charset=UTF-8&quot; is not supported ... I tried many annotations as  @PostMapping(path=&quot;/new&quot;, consumes={MediaType.APPLICATION_JSON_UTF8_VALUE}) and others solutions I found here in SOF but nothing works!</p>\n<p>May the Spring Security configuration be faulty in this case (I assume no) ? ... I run a basic mirror project without Spring Security and it's working ...</p>\n<p>I run my tests with Postman\n<a href=\"https://i.sstatic.net/LDbTO.png\" rel=\"nofollow noreferrer\">Postman</a></p>\n<p>It seems that the entire request made with Body/form-data is rejected but if I run it with Body/raw/json (without the file) it's going perfectly!</p>\n<p>** user entity **</p>\n<pre><code>@Entity\n@Table(name=&quot;user&quot;, uniqueConstraints = {\n        @UniqueConstraint(columnNames = &quot;username&quot;),\n        @UniqueConstraint(columnNames = &quot;email&quot;)\n})\npublic class User {\n    @Id\n    @Column(name=&quot;id&quot;)\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long Id;\n    @Column(name=&quot;username&quot;)\n    private String username;\n    @Column(name=&quot;password&quot;)\n    private String password;\n    @Column(name=&quot;avatar&quot;)\n    private String avatar;\n    @Column(name=&quot;email&quot;)\n    private String email;\n    @Column(name=&quot;bio&quot;)\n    private String bio;\n    @Column(name = &quot;created_at&quot;)\n    private Date createdAt;\n    @Column(name=&quot;updated_at&quot;)\n    private Date updatedAt;\n    @ManyToMany(fetch = FetchType.LAZY)\n    @JsonIgnore\n    @JoinTable(name=&quot;user_role&quot;,\n            joinColumns = @JoinColumn(name=&quot;user_id&quot;),\n            inverseJoinColumns = @JoinColumn(name=&quot;role_id&quot;))\n    private Set&lt;Role&gt; roles = new HashSet&lt;&gt;();\n    @OneToMany(mappedBy = &quot;donor&quot;, cascade = CascadeType.ALL)\n    @JsonIgnore\n    // liste des donations par donateurs\n    private Set&lt;Donation&gt; donationsByDonor = new HashSet&lt;&gt;();\n    @OneToMany(mappedBy = &quot;beneficiary&quot;, cascade = CascadeType.ALL)\n    @JsonIgnore\n    // liste des donations par bénéficiaire\n    private Set&lt;Donation&gt; donationsByBeneficiary = new HashSet&lt;&gt;();\n    @OneToMany(mappedBy = &quot;user&quot;, cascade = CascadeType.ALL)\n    // liste des evaluations par user\n    private Set&lt;Evaluation&gt; evaluations = new HashSet&lt;&gt;();\n    @OneToMany(mappedBy = &quot;author&quot;, cascade = CascadeType.ALL)\n    @JsonIgnore\n    // Liste des pdfs par user\n    private Set&lt;Pdf&gt; pdfs = new HashSet&lt;&gt;();\n    @OneToMany(mappedBy = &quot;user&quot;, cascade = CascadeType.ALL)\n    @JsonIgnore\n    // liste des recherches par user\n    private Set&lt;Search&gt; searches = new HashSet&lt;&gt;();\n    @OneToMany(mappedBy = &quot;alertLauncher&quot;, cascade = CascadeType.ALL)\n    @JsonIgnore\n    // liste alerts par user\n    private Set&lt;Alert&gt; alertList = new HashSet&lt;&gt;();\n\n    public User() {\n    }\n\n    public User(String username, String password) {\n        this.username = username;\n        this.password = password;\n    }\n\n    public User(String username, String email, String password, String avatar) {\n        this.username = username;\n        this.email = email;\n        this.password = password;\n        this.avatar = avatar;\n    }\n\n    public User(String username, String password, String avatar, String email, String bio, Date createdAt, Date updatedAt, Set&lt;Role&gt; roles, Set&lt;Donation&gt; donationsByBeneficiary, Set&lt;Donation&gt; donationsByDonor, Set&lt;Evaluation&gt; evaluations, Set&lt;Pdf&gt; pdfs, Set&lt;Search&gt; searches, Set&lt;Alert&gt; alertList) {\n        this.username = username;\n        this.password = password;\n        this.avatar = avatar;\n        this.email = email;\n        this.bio = bio;\n        this.createdAt = createdAt;\n        this.updatedAt = updatedAt;\n        this.roles = roles;\n        this.donationsByBeneficiary = donationsByBeneficiary;\n        this.donationsByDonor = donationsByDonor;\n        this.evaluations = evaluations;\n        this.pdfs = pdfs;\n        this.searches = searches;\n        this.alertList = alertList;\n    }\n\n    public Long getId() {\n        return Id;\n    }\n\n    public void setId(Long id) {\n        Id = id;\n    }\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public String getAvatar() {\n        return avatar;\n    }\n\n    public void setAvatar(String avatar) {\n        this.avatar = avatar;\n    }\n\n    public String getEmail() {\n        return email;\n    }\n\n    public void setEmail(String email) {\n        this.email = email;\n    }\n\n    public String getBio() {\n        return bio;\n    }\n\n    public void setBio(String bio) {\n        this.bio = bio;\n    }\n\n    public Date getCreatedAt() {\n        return createdAt;\n    }\n\n    public void setCreatedAt(Date createdAt) {\n        this.createdAt = createdAt;\n    }\n\n    public Date getUpdatedAt() {\n        return updatedAt;\n    }\n\n    public void setUpdatedAt(Date updatedAt) {\n        this.updatedAt = updatedAt;\n    }\n\n    public Set&lt;Role&gt; getRoles() {\n        return roles;\n    }\n\n    public void setRoles(Set&lt;Role&gt; roles) {\n        this.roles = roles;\n    }\n\n    public Set&lt;Donation&gt; getDonationsByDonor() {\n        return donationsByDonor;\n    }\n\n    public void setDonationsByDonor(Set&lt;Donation&gt; donationsByDonor) {\n        this.donationsByDonor = donationsByDonor;\n    }\n\n    public Set&lt;Donation&gt; getDonationsByBeneficiary() {\n        return donationsByBeneficiary;\n    }\n\n    public void setDonationsByBeneficiary(Set&lt;Donation&gt; donationsByBeneficiary) {\n        this.donationsByBeneficiary = donationsByBeneficiary;\n    }\n\n    public Set&lt;Evaluation&gt; getEvaluations() {\n        return evaluations;\n    }\n\n    public void setEvaluations(Set&lt;Evaluation&gt; evaluations) {\n        this.evaluations = evaluations;\n    }\n\n    public Set&lt;Pdf&gt; getPdfs() {\n        return pdfs;\n    }\n\n    public void setPdfs(Set&lt;Pdf&gt; pdfs) {\n        this.pdfs = pdfs;\n    }\n\n    public Set&lt;Search&gt; getSearches() {\n        return searches;\n    }\n\n    public void setSearches(Set&lt;Search&gt; searches) {\n        this.searches = searches;\n    }\n\n    public Set&lt;Alert&gt; getAlertList() {\n        return alertList;\n    }\n\n    public void setAlertList(Set&lt;Alert&gt; alertList) {\n        this.alertList = alertList;\n    }\n}\n</code></pre>\n<p>**Dto from client **</p>\n<pre><code>@Data\npublic class UserDTOWayIN {\n    String username;\n    String password;\n    String avatar;\n    String email;\n    String bio;\n    Date createdAt;\n    Date updatedAt;\n    Set&lt;Role&gt; roles;\n}\n</code></pre>\n<p>**Dto to client **</p>\n<pre><code>@Data\npublic class UserDTO {\n     Long Id;\n     String username;\n     String bio;\n     Date createdAt;\n     Date updatedAt;\n     Set&lt;Role&gt; roles;\n}\n</code></pre>\n<p>**UserController with the signup endpoint **</p>\n<pre><code>@CrossOrigin(origins = &quot;http://localhost:4200&quot;, maxAge = 3600)\n@RestController\n@RequestMapping(&quot;/user&quot;)\npublic class UserController {\n    @Autowired\n    private UserService service;\n    @Autowired\n    private ModelMapper modelMapper;\n    public static String uploadDirectory = System.getProperty(&quot;user.dir&quot;)+&quot;/src/main/webapp/avatars/&quot;;\n\n    @PostMapping(path=&quot;/new&quot;, consumes={MediaType.APPLICATION_JSON_UTF8_VALUE})\n    @PreAuthorize(&quot;hasRole('ADMIN'), hasRole('USER')&quot;)\n    public ResponseEntity&lt;UserDTO&gt; saveUser(@ModelAttribute UserDTOWayIN clientDatas, @RequestParam(&quot;file&quot;)MultipartFile file) throws IOException {\n        String originalFilename = file.getOriginalFilename();\n        Path fileNameAndPath= Paths.get(uploadDirectory, originalFilename);\n        Files.write(fileNameAndPath, file.getBytes());\n        clientDatas.setAvatar(originalFilename);\n        // Conversion des datas front en DTOWayIN\n        UserDTOWayIN userDTOWayIN = modelMapper.map(clientDatas, UserDTOWayIN.class);\n        // Conversion sens DTOWayIN à Entité\n        User user = service.saveUser(userDTOWayIN);\n        // Conversion sens Entité à DTO\n        UserDTO userDTO = modelMapper.map(user, UserDTO.class);\n        return new ResponseEntity&lt;UserDTO&gt;(userDTO, HttpStatus.CREATED);\n    }\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}