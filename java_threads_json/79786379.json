{
  "question": {
    "tags": [
      "java",
      "hibernate",
      "migration",
      "hibernate-6.x"
    ],
    "owner": {
      "account_id": 4639875,
      "reputation": 1839,
      "user_id": 3760049,
      "user_type": "registered",
      "accept_rate": 86,
      "profile_image": "https://www.gravatar.com/avatar/69ed405cd4036cdf27e003ca372c6d1c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "riskop",
      "link": "https://stackoverflow.com/users/3760049/riskop"
    },
    "is_answered": true,
    "view_count": 66,
    "accepted_answer_id": 79786470,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1760694361,
    "creation_date": 1760011510,
    "question_id": 79786379,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79786379/after-migrating-to-hibernate6-lazytablegroup-cannot-be-cast-to-class-pluraltabl",
    "title": "After migrating to Hibernate6 &quot;LazyTableGroup cannot be cast to class PluralTableGroup&quot; exception",
    "body": "<p>I am migrating a project from Spring Boot 2.7.18 to Spring Boot 3, and this causes a Hibernate upgrade as well from Hibernate 5.6 to Hibernate 6.1.7.</p>\n<p>I had a rather complicated criteria query. After the migration the execution of that query results in the following exception:</p>\n<p>class org.hibernate.sql.ast.tree.from.LazyTableGroup cannot be cast to class org.hibernate.sql.ast.tree.from.PluralTableGroup (org.hibernate.sql.ast.tree.from.LazyTableGroup and\norg.hibernate.sql.ast.tree.from.PluralTableGroup are in unnamed module of loader 'app')</p>\n<pre><code>Caused by: java.lang.ClassCastException: class org.hibernate.sql.ast.tree.from.LazyTableGroup cannot be cast to class org.hibernate.sql.ast.tree.from.PluralTableGroup (org.hibernate.sql.ast.tree.from.LazyTableGroup and org.hibernate.sql.ast.tree.from.PluralTableGroup are in unnamed module of loader 'app')\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.findActualTableGroup(BaseSqmToSqlAstConverter.java:2810)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.consumeExplicitJoins(BaseSqmToSqlAstConverter.java:2763)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.consumeAttributeJoin(BaseSqmToSqlAstConverter.java:2941)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.consumeExplicitJoin(BaseSqmToSqlAstConverter.java:2775)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.lambda$consumeExplicitJoins$42(BaseSqmToSqlAstConverter.java:2759)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n    at org.hibernate.query.sqm.tree.domain.AbstractSqmFrom.visitSqmJoins(AbstractSqmFrom.java:260)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.consumeExplicitJoins(BaseSqmToSqlAstConverter.java:2755)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.consumeAttributeJoin(BaseSqmToSqlAstConverter.java:2941)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.consumeExplicitJoin(BaseSqmToSqlAstConverter.java:2775)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.lambda$consumeExplicitJoins$42(BaseSqmToSqlAstConverter.java:2759)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n    at org.hibernate.query.sqm.tree.domain.AbstractSqmFrom.visitSqmJoins(AbstractSqmFrom.java:260)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.consumeExplicitJoins(BaseSqmToSqlAstConverter.java:2755)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.consumeJoins(BaseSqmToSqlAstConverter.java:2649)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.consumeFromClauseRoot(BaseSqmToSqlAstConverter.java:2624)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n    at org.hibernate.query.sqm.tree.from.SqmFromClause.visitRoots(SqmFromClause.java:80)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.visitFromClause(BaseSqmToSqlAstConverter.java:2365)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.visitQuerySpec(BaseSqmToSqlAstConverter.java:1817)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.visitQuerySpec(BaseSqmToSqlAstConverter.java:416)\n    at org.hibernate.query.sqm.tree.select.SqmQuerySpec.accept(SqmQuerySpec.java:122)\n    at org.hibernate.query.sqm.spi.BaseSemanticQueryWalker.visitQueryPart(BaseSemanticQueryWalker.java:213)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.visitQueryPart(BaseSqmToSqlAstConverter.java:1679)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.visitSelectStatement(BaseSqmToSqlAstConverter.java:1477)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.visitSelectStatement(BaseSqmToSqlAstConverter.java:416)\n    at org.hibernate.query.sqm.tree.select.SqmSelectStatement.accept(SqmSelectStatement.java:213)\n    at org.hibernate.query.sqm.sql.BaseSqmToSqlAstConverter.translate(BaseSqmToSqlAstConverter.java:711)\n    at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.buildCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:380)\n    at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:300)\n    at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)\n    at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)\n    at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)\n    at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)\n    at org.hibernate.query.Query.getResultList(Query.java:94)\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n    at org.springframework.orm.jpa.SharedEntityManagerCreator$DeferredQueryInvocationHandler.invoke(SharedEntityManagerCreator.java:405)\n    at jdk.proxy2/jdk.proxy2.$Proxy315.getResultList(Unknown Source)\n...\n</code></pre>\n<p>For the migration I used openrewrite and manual corrections. I read the Hibernate 6 upgrade guide also ( <a href=\"https://github.com/hibernate/hibernate-orm/blob/6.0/migration-guide.adoc\" rel=\"nofollow noreferrer\">https://github.com/hibernate/hibernate-orm/blob/6.0/migration-guide.adoc</a> ).</p>\n<p>Also I inserted a trivial criteria query ( select everything from a table ) into the code just before the exception-throwing part and found that that works without problem.</p>\n<p>Googling for &quot;PluralTableGroup&quot; or &quot;LazyTableGroup&quot; didn't help me either.</p>\n<p>I would be really appreciate any help or hint regarding this!</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}