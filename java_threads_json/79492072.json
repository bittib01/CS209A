{
  "question": {
    "tags": [
      "java",
      "android",
      "android-layout",
      "android-button"
    ],
    "owner": {
      "account_id": 13060317,
      "reputation": 717,
      "user_id": 9437740,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/6yvEH.png?s=256",
      "display_name": "VanessaF",
      "link": "https://stackoverflow.com/users/9437740/vanessaf"
    },
    "is_answered": true,
    "view_count": 197,
    "accepted_answer_id": 79519352,
    "answer_count": 1,
    "score": 3,
    "last_activity_date": 1742896024,
    "creation_date": 1741345500,
    "last_edit_date": 1741962182,
    "question_id": 79492072,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79492072/button-with-repeatlistener-in-android-does-not-change-color-when-being-pressed",
    "title": "Button with RepeatListener in Android does not change color when being pressed",
    "body": "<p>I have a button in xml layout file</p>\n<pre><code> &lt;Button\n        android:id=&quot;@+id/button_heat&quot;\n        android:layout_width=&quot;0dp&quot;\n        android:layout_height=&quot;0dp&quot;\n        android:text=&quot;@string/heat&quot;\n        android:textSize=&quot;11sp&quot;\n        android:background=&quot;@drawable/heat_button_background&quot;\n        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;\n        app:layout_constraintEnd_toEndOf=&quot;parent&quot;\n        app:layout_constraintHeight_percent=&quot;0.124&quot;\n        app:layout_constraintHorizontal_bias=&quot;0.373&quot;\n        app:layout_constraintStart_toStartOf=&quot;parent&quot;\n        app:layout_constraintTop_toTopOf=&quot;parent&quot;\n        app:layout_constraintVertical_bias=&quot;0.885&quot;\n        app:layout_constraintWidth_percent=&quot;0.12&quot; /&gt;\n</code></pre>\n<p>It is attached to a repeat listener in the main java fragment file:</p>\n<pre><code>// Define and register RepeatListener on the heat button\nbinding.buttonHeat.setOnTouchListener(new RepeatListener(30, 30, this.getContext(), view -&gt; {\n    rotationAngle -= 11.0F;\n    binding.fan.setRotation(-rotationAngle);\n    currentlyActiveEventRectangleInTarget = checkPositionsOfActiveElements(true);\n\n    if (currentlyActiveEventRectangleInTarget!= lastIntervalActiveEventRectangleInTarget) {\n        if (lastIntervalActiveEventRectangleInTarget !=null &amp;&amp; lastIntervalActiveEventRectangleInTarget.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_SOLAR)) {\n            lastIntervalActiveEventRectangleInTarget.setBackground(ContextCompat.getDrawable(requireContext(), R.drawable.game_event_rectangle_solar_1));\n        }\n        if (lastIntervalActiveEventRectangleInTarget !=null &amp;&amp; lastIntervalActiveEventRectangleInTarget.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_WIND)) {\n            lastIntervalActiveEventRectangleInTarget.setBackground(ContextCompat.getDrawable(requireContext(), R.drawable.game_event_rectangle_wind_1));\n        }\n        if (lastIntervalActiveEventRectangleInTarget !=null &amp;&amp; lastIntervalActiveEventRectangleInTarget.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_GAS)) {\n            lastIntervalActiveEventRectangleInTarget.setBackground(ContextCompat.getDrawable(requireContext(), R.drawable.game_event_rectangle_gas_1));\n        }\n        if (lastIntervalActiveEventRectangleInTarget !=null &amp;&amp; lastIntervalActiveEventRectangleInTarget.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_COAL)) {\n            lastIntervalActiveEventRectangleInTarget.setBackground(ContextCompat.getDrawable(requireContext(), R.drawable.game_event_rectangle_coal_1));\n        }\n        lastIntervalActiveEventRectangleInTarget = currentlyActiveEventRectangleInTarget;\n    }\n    else {\n        if (lastIntervalActiveEventRectangleInTarget !=null &amp;&amp; lastIntervalActiveEventRectangleInTarget.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_SOLAR)) {\n            lastIntervalActiveEventRectangleInTarget.setBackground(ContextCompat.getDrawable(requireContext(), R.drawable.game_event_rectangle_solar_2));\n        }\n        if (lastIntervalActiveEventRectangleInTarget !=null &amp;&amp; lastIntervalActiveEventRectangleInTarget.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_WIND)) {\n            lastIntervalActiveEventRectangleInTarget.setBackground(ContextCompat.getDrawable(requireContext(), R.drawable.game_event_rectangle_wind_2));\n        }\n        if (lastIntervalActiveEventRectangleInTarget !=null &amp;&amp; lastIntervalActiveEventRectangleInTarget.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_GAS)) {\n            lastIntervalActiveEventRectangleInTarget.setBackground(ContextCompat.getDrawable(requireContext(), R.drawable.game_event_rectangle_gas_2));\n        }\n        if (lastIntervalActiveEventRectangleInTarget !=null &amp;&amp; lastIntervalActiveEventRectangleInTarget.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_COAL)) {\n            lastIntervalActiveEventRectangleInTarget.setBackground(ContextCompat.getDrawable(requireContext(), R.drawable.game_event_rectangle_coal_2));\n        }\n    }\n\n    // the code to execute repeatedly\n    if(heatBuilding) {\n        thermometer.changeTemperature(0.6);\n        RepeatListener.setCurrentlyActiveGameRectangle(currentlyActiveEventRectangleInTarget);\n\n    }\n\n    if (heatDHWTank) {\n        hotWaterTank.changeVolumeBar(0.6);\n        RepeatListener.setCurrentlyActiveGameRectangle(currentlyActiveEventRectangleInTarget);\n    }\n\n    lastIntervalActiveEventRectangleInTarget = currentlyActiveEventRectangleInTarget;\n    view.performClick();\n\n\n\n}));\n\nThe repeat listener looks like this\npackage com.example.game;\n\nimport android.annotation.SuppressLint;\nimport android.content.Context;\nimport android.os.Handler;\nimport android.view.MotionEvent;\nimport android.view.View;\n\nimport androidx.core.content.ContextCompat;\n\n/**\n * A class, that can be used as a TouchListener on any view (e.g. a Button).\n * It cyclically runs a clickListener, emulating keyboard-like behaviour. First\n * click is fired immediately, next one after the initialInterval, and subsequent\n * ones after the normalInterval.\n *\n * &lt;p&gt;Interval is scheduled after the onClick completes, so it has to run fast.\n * If it runs slow, it does not generate skipped onClicks. Can be rewritten to\n * achieve this.\n */\npublic class RepeatListener implements View.OnTouchListener {\n\n    private final Handler handler = new Handler();\n\n    private final int initialInterval;\n    private final int normalInterval;\n    private final View.OnClickListener clickListener;\n    private View touchedView;\n\n    private final Context context;\n\n\n\n    private static View_Game_Event_Rectangle currentlyActiveGameRectangle;\n\n\n\n    private final Runnable handlerRunnable = new Runnable() {\n        @Override\n        public void run() {\n            if(touchedView.isEnabled()) {\n                handler.postDelayed(this, normalInterval);\n                clickListener.onClick(touchedView);\n            } else {\n                // if the view was disabled by the clickListener, remove the callback\n                handler.removeCallbacks(handlerRunnable);\n                touchedView.setPressed(false);\n                touchedView = null;\n            }\n        }\n    };\n\n    /**\n     * @param initialInterval The interval after first click event\n     * @param normalInterval The interval after second and subsequent click\n     *       events\n     * @param clickListener The OnClickListener, that will be called\n     *       periodically\n     */\n    public RepeatListener(int initialInterval, int normalInterval, Context context,\n                          View.OnClickListener clickListener) {\n        if (clickListener == null)\n            throw new IllegalArgumentException(&quot;null runnable&quot;);\n        if (initialInterval &lt; 0 || normalInterval &lt; 0)\n            throw new IllegalArgumentException(&quot;negative interval&quot;);\n\n        this.initialInterval = initialInterval;\n        this.normalInterval = normalInterval;\n        this.clickListener = clickListener;\n        this.context = context;\n    }\n\n    @SuppressLint(&quot;ClickableViewAccessibility&quot;)\n    public boolean onTouch(View view, MotionEvent motionEvent) {\n        switch (motionEvent.getAction()) {\n            case MotionEvent.ACTION_DOWN:\n\n                handler.removeCallbacks(handlerRunnable);\n                handler.postDelayed(handlerRunnable, initialInterval);\n                touchedView = view;\n                touchedView.setPressed(true);\n                touchedView.setBackgroundResource(R.drawable.heat_button_background_pressed);\n                clickListener.onClick(view);\n\n                if (currentlyActiveGameRectangle !=null) {\n                    if(currentlyActiveGameRectangle.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_SOLAR)) {\n                        currentlyActiveGameRectangle.setBackground(ContextCompat.getDrawable(context, R.drawable.game_event_rectangle_solar_2));\n                    }\n                    if(currentlyActiveGameRectangle.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_WIND)) {\n                        currentlyActiveGameRectangle.setBackground(ContextCompat.getDrawable(context, R.drawable.game_event_rectangle_wind_2));\n                    }\n                    if(currentlyActiveGameRectangle.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_GAS)) {\n                        currentlyActiveGameRectangle.setBackground(ContextCompat.getDrawable(context, R.drawable.game_event_rectangle_gas_2));\n                    }\n                    if(currentlyActiveGameRectangle.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_COAL)) {\n                        currentlyActiveGameRectangle.setBackground(ContextCompat.getDrawable(context, R.drawable.game_event_rectangle_coal_2));\n                    }\n                }\n                return true;\n            case MotionEvent.ACTION_UP:\n                // Restore normal background\n                if (touchedView != null) {\n                    touchedView.setBackgroundResource(R.drawable.heat_button_background_normal);\n                    touchedView.setPressed(false); // Remove the pressed state\n                    handler.removeCallbacks(handlerRunnable);\n                }\n\n                if (currentlyActiveGameRectangle !=null) {\n                    if(currentlyActiveGameRectangle.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_SOLAR)) {\n                        currentlyActiveGameRectangle.setBackground(ContextCompat.getDrawable(context, R.drawable.game_event_rectangle_solar_1));\n                    }\n                    if(currentlyActiveGameRectangle.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_WIND)) {\n                        currentlyActiveGameRectangle.setBackground(ContextCompat.getDrawable(context, R.drawable.game_event_rectangle_wind_1));\n                    }\n                    if(currentlyActiveGameRectangle.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_GAS)) {\n                        currentlyActiveGameRectangle.setBackground(ContextCompat.getDrawable(context, R.drawable.game_event_rectangle_gas_1));\n                    }\n                    if(currentlyActiveGameRectangle.getEventType().equals(FR_Game.VIEW_EVENT_RECTANGLE_COAL)) {\n                        currentlyActiveGameRectangle.setBackground(ContextCompat.getDrawable(context, R.drawable.game_event_rectangle_coal_1));\n                    }\n                }\n                return true;\n            case MotionEvent.ACTION_CANCEL:\n                handler.removeCallbacks(handlerRunnable);\n                touchedView.setPressed(false);\n                touchedView = null;\n                return true;\n        }\n\n        return false;\n    }\n\n    public static void setCurrentlyActiveGameRectangle(View_Game_Event_Rectangle currentlyActiveGameRectangle) {\n        RepeatListener.currentlyActiveGameRectangle = currentlyActiveGameRectangle;\n    }\n\n}\n</code></pre>\n<p>and I have 3 xml drawable files:\nheat_button_background:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;selector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;\n    &lt;item android:state_pressed=&quot;true&quot;&gt;\n        &lt;layer-list&gt;\n            &lt;item&gt;\n                &lt;shape android:shape=&quot;rectangle&quot;&gt;\n                    &lt;solid android:color=&quot;#FFFFFF&quot; /&gt; &lt;!-- White when pressed --&gt;\n                    &lt;corners android:radius=&quot;8dp&quot; /&gt; &lt;!-- Rounded corners --&gt;\n                &lt;/shape&gt;\n            &lt;/item&gt;\n        &lt;/layer-list&gt;\n    &lt;/item&gt;\n    &lt;item&gt;\n        &lt;layer-list&gt;\n            &lt;item&gt;\n                &lt;shape android:shape=&quot;rectangle&quot;&gt;\n                    &lt;solid android:color=&quot;#CCCCCC&quot; /&gt; &lt;!-- Light gray when not pressed --&gt;\n                    &lt;corners android:radius=&quot;8dp&quot; /&gt; &lt;!-- Rounded corners --&gt;\n                &lt;/shape&gt;\n            &lt;/item&gt;\n        &lt;/layer-list&gt;\n    &lt;/item&gt;\n&lt;/selector&gt;\n</code></pre>\n<p>heat_button_background_normal:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;selector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;\n    &lt;item&gt;\n        &lt;layer-list&gt;\n            &lt;item&gt;\n                &lt;shape android:shape=&quot;rectangle&quot;&gt;\n                    &lt;solid android:color=&quot;#CCCCCC&quot; /&gt; &lt;!-- Light gray when not pressed --&gt;\n                    &lt;corners android:radius=&quot;8dp&quot; /&gt; &lt;!-- Rounded corners --&gt;\n                &lt;/shape&gt;\n            &lt;/item&gt;\n        &lt;/layer-list&gt;\n    &lt;/item&gt;\n&lt;/selector&gt;\n</code></pre>\n<p>heat_button_background_pressed:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;selector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;\n    &lt;item&gt;\n        &lt;layer-list&gt;\n            &lt;item&gt;\n                &lt;shape android:shape=&quot;rectangle&quot;&gt;\n                    &lt;solid android:color=&quot;#FFFFFF&quot; /&gt; &lt;!-- White when pressed --&gt;\n                    &lt;corners android:radius=&quot;8dp&quot; /&gt; &lt;!-- Rounded corners --&gt;\n                &lt;/shape&gt;\n            &lt;/item&gt;\n        &lt;/layer-list&gt;\n    &lt;/item&gt;\n&lt;/selector&gt;\n</code></pre>\n<p>Unforuantely, when pressing the button, is does not change its color or anything regarding its layout (altough the logic of the button in the game app with the repeat listener works properly). Can you think of a reason as to why this is happening? I think it might have something to do with the repeat listener as it might be refreshing the layout or something like that. But I tried a lot and could not solve the problem.</p>\n<p><strong>Reminder</strong>: Does anyone have any idea as to why this is happening?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}