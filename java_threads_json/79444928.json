{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-security",
      "oauth-2.0"
    ],
    "owner": {
      "account_id": 2617521,
      "reputation": 80,
      "user_id": 2266281,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/e32a952009ba614d02da4a60d7029490?s=256&d=identicon&r=PG",
      "display_name": "chris457",
      "link": "https://stackoverflow.com/users/2266281/chris457"
    },
    "is_answered": false,
    "view_count": 1120,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1740052551,
    "creation_date": 1739784012,
    "last_edit_date": 1739784389,
    "question_id": 79444928,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79444928/configure-spring-oauth2-authorization-server-and-resource-server-with-static-key",
    "title": "Configure Spring OAuth2 authorization server and resource server with static keys to avoid GET /oauth2/jwks requests",
    "body": "<p>Based on the Spring Tips Youtube video <a href=\"https://www.youtube.com/watch?v=Yh8t04NG_K4\" rel=\"nofollow noreferrer\">Spring Tips: The Spring Authorization Server</a> I want to simplify the setup for didactic reasons.</p>\n<p>For background: I teach Spring development. Prior to teaching Spring Security's OAuth2 support I will have shown my students a simple Jwt-based application which houses both authorization as well as the secured resources.\nAs a natural progression I want to then show how OAUth2 splits up authorization and resource hosting with its protocol.</p>\n<p>Ideally, I would want to first show how Authorization Grant Type &quot;implicit grant&quot; works, as it seems like the most natural progression. But of course with the latest OAUth2.1 standard it is no longer supported by the standard and as a result, neither by Spring Security and for good reasons.</p>\n<p>Ok, so &quot;Authorization Code&quot; type it is.</p>\n<p>This flow entails many behind-the scenes roundtrips which, for didactic reasons, I want to reduce in the first iteration of my sample project (later of course I will show how all of the many roundtrips make sense and enhance the protocol).\nIn my preceding Jwt-application I configured both <code>JwtDecoder</code> and <code>JwtEncoder</code> like so:</p>\n<pre><code>@Bean\nJwtDecoder jwtDecoder() {\n     NimbusJwtDecoder jwtDecoder = NimbusJwtDecoder.withPublicKey(jwtConfigProperties.publicKey()).build();\n     return jwtDecoder; \n}\n\n@Bean\nJwtEncoder jwtEncoder() {\n    JWK jwk = new RSAKey.Builder(jwtConfigProperties.publicKey()).privateKey(jwtConfigProperties.privateKey()).build();\n    JWKSource&lt;SecurityContext&gt; jwks = new ImmutableJWKSet&lt;&gt;(new JWKSet(jwk));\n    return new NimbusJwtEncoder(jwks);\n}\n</code></pre>\n<p>with</p>\n<pre><code>    @ConfigurationProperties(prefix = &quot;rsa&quot;)\npublic record RsaKeyProperties(RSAPublicKey publicKey, RSAPrivateKey privateKey) {\n}\n</code></pre>\n<p>and\napplication.properties entries</p>\n<pre><code>rsa.private-key= classpath:certs/privateKey.pem\nrsa.public-key= classpath:certs/publicKey.pem\n</code></pre>\n<p>Those keys are present, as is of course:</p>\n<pre><code>@SpringBootApplication\n@EnableConfigurationProperties(RsaKeyProperties.class)\npublic class Application {\n\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n}\n</code></pre>\n<p>Everything works fine.\nNow I want to reuse this code in my OAUth2 project for the authorization server (which needs the JwtEncoder) and the resource server (which needs the JwtDecoder).</p>\n<p>Since both authorization server and resource server would use matching keys in this scenario, the OAuth2 <code>GET /oauth2/jwks</code> requests (I counted 2 of them in my TCP/IP monitor) would not be needed anymore and could thus be omitted, <strong>which is exactly what I want to achieve</strong>.</p>\n<p>I am struggling with this however.</p>\n<p>Neither stackoverflow, nor web-search and in particular not AI (neither IntelliJ IDEA AI assistant nor GitHub Copilot) were of any help, so I am turning to stackoverflow for help.</p>\n<p>I gladly provide the entire configuration for all 3 server (authorization-, resource- and client-server). It is what Josh Long showed in his video (NOT what is in the accompanying GitHup-project though, apparently he enhanced that one. I really had to follow the video 1:1)</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}