{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "prometheus",
      "spring-boot-actuator",
      "spring-ws"
    ],
    "owner": {
      "account_id": 1216174,
      "reputation": 1333,
      "user_id": 1183729,
      "user_type": "registered",
      "accept_rate": 49,
      "profile_image": "https://i.sstatic.net/upztT.jpg?s=256",
      "display_name": "greengold",
      "link": "https://stackoverflow.com/users/1183729/greengold"
    },
    "is_answered": false,
    "view_count": 82,
    "answer_count": 0,
    "score": 1,
    "last_activity_date": 1716917032,
    "creation_date": 1716218929,
    "last_edit_date": 1716917032,
    "question_id": 78507470,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78507470/make-actuator-output-json-instead-of-xml",
    "title": "Make Actuator output JSON instead of XML",
    "body": "<p>I am using <code>XmlMapper</code> widely in the Spring Boot application.\nI have declared a mapper config like:</p>\n<pre><code>@Configuration\n@RequiredArgsConstructor\npublic class JacksonMapperConfig {\n\n    @Bean\n    public SimpleModule confidentialFieldJacksonModule() {\n        SimpleModule simpleModule = new SimpleModule();\n        return simpleModule;\n    }\n\n    @Bean\n    public XmlMapper getObjectMapper(SimpleModule confidentialFieldJacksonModule) {\n        XmlMapper xmlMapper = new XmlMapper();\n\n        xmlMapper.registerModule(confidentialFieldJacksonModule);\n\n        return xmlMapper;\n    }\n\n    @Bean\n    public Jackson2ObjectMapperBuilderCustomizer jsonCustomizer(SimpleModule confidentialFieldJacksonModule) {\n        return builder -&gt; builder.modules()\n                .modules(confidentialFieldJacksonModule)\n                .build();\n    }\n}\n\n</code></pre>\n<p>I also have the Actuator on the classpath, and I want to see it's output as JSON.</p>\n<p>Instead I have an unreadable xml:</p>\n<pre><code>&lt;Map&gt;&lt;_links&gt;&lt;self&gt;&lt;href&gt;https://localhost:9001/actuator&lt;/href&gt;&lt;templated&gt;false&lt;/templated&gt;&lt;/self&gt;&lt;beans&gt;&lt;href&gt;https://localhost:9001/actuator/beans&lt;/href&gt;&lt;templated&gt;false&lt;/templated&gt;&lt;/beans&gt;&lt;caches-cache&gt;&lt;href&gt;https://localhost:9001/actuator/caches/{cache}&lt;/href&gt;&lt;temp.....\n</code></pre>\n<p>I tried to declare <code>ObjectMapper</code> as a Bean like:</p>\n<pre><code>    @Bean\n    @Primary\n    public ObjectMapper getObjectMapper() {\n        return new ObjectMapper();\n    }\n</code></pre>\n<p>but application won't start:</p>\n<pre><code>***************************\nAPPLICATION FAILED TO START\n***************************\n\nDescription:\n\nParameter 0 of constructor in com.frequentis.nrdbsimulator.service.CallerInfoTypeViewService required a bean of type 'com.fasterxml.jackson.dataformat.xml.XmlMapper' that could not be found.\n\n\nAction:\n\nConsider defining a bean of type 'com.fasterxml.jackson.dataformat.xml.XmlMapper' in your configuration.\n</code></pre>\n<p>it is the WebService-enabled application with SOAP endpoints, therefore I need XmlMapper.</p>\n<p>How can I make Actuator output JSON?</p>\n<p>Thanks</p>\n<p>EDIT: adding pom parts:</p>\n<pre><code>    &lt;properties&gt;\n        &lt;java.version&gt;11&lt;/java.version&gt;\n        &lt;mapstruct.version&gt;1.5.5.Final&lt;/mapstruct.version&gt;\n        &lt;vaadin.version&gt;23.4.0&lt;/vaadin.version&gt;\n        &lt;vaadin.toggle.version&gt;1.0.2&lt;/vaadin.toggle.version&gt;\n        &lt;jackson.xml.version&gt;2.15.4&lt;/jackson.xml.version&gt;\n        &lt;jaxws-maven-plugin.version&gt;4.0.2&lt;/jaxws-maven-plugin.version&gt;\n        &lt;version.maven.assembly.plugin&gt;3.6.0&lt;/version.maven.assembly.plugin&gt;\n    &lt;/properties&gt;\n</code></pre>\n<pre><code>&lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web-services&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-cache&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.vaadin&lt;/groupId&gt;\n            &lt;artifactId&gt;vaadin-spring-boot-starter&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.vaadin&lt;/groupId&gt;\n            &lt;artifactId&gt;vaadin-lumo-theme&lt;/artifactId&gt;\n            &lt;version&gt;${vaadin.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;javax.cache&lt;/groupId&gt;\n            &lt;artifactId&gt;cache-api&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- https://mvnrepository.com/artifact/net.sf.ehcache/ehcache --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;net.sf.ehcache&lt;/groupId&gt;\n            &lt;artifactId&gt;ehcache&lt;/artifactId&gt;\n            &lt;version&gt;2.10.9.2&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-jcache&lt;/artifactId&gt;\n            &lt;version&gt;5.6.15.Final&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- https://mvnrepository.com/artifact/org.hibernate/hibernate-ehcache --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-ehcache&lt;/artifactId&gt;\n            &lt;version&gt;5.6.15.Final&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.vaadin&lt;/groupId&gt;\n            &lt;artifactId&gt;grid-renderers-collection-addon&lt;/artifactId&gt;\n            &lt;version&gt;2.7.0&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;\n            &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;\n            &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;\n            &lt;version&gt;1.13.0&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.h2database&lt;/groupId&gt;\n            &lt;artifactId&gt;h2&lt;/artifactId&gt;\n            &lt;version&gt;2.2.224&lt;/version&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- https://mvnrepository.com/artifact/org.hibernate/hibernate-envers --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-envers&lt;/artifactId&gt;\n            &lt;version&gt;5.6.15.Final&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.logback-extensions&lt;/groupId&gt;\n            &lt;artifactId&gt;logback-ext-spring&lt;/artifactId&gt;\n            &lt;version&gt;0.1.5&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- https://mvnrepository.com/artifact/org.jsoup/jsoup --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.jsoup&lt;/groupId&gt;\n            &lt;artifactId&gt;jsoup&lt;/artifactId&gt;\n            &lt;version&gt;1.17.2&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n            &lt;artifactId&gt;mapstruct&lt;/artifactId&gt;\n            &lt;version&gt;${mapstruct.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.mapstruct&lt;/groupId&gt;\n            &lt;artifactId&gt;mapstruct-processor&lt;/artifactId&gt;\n            &lt;version&gt;${mapstruct.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;wsdl4j&lt;/groupId&gt;\n            &lt;artifactId&gt;wsdl4j&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n&lt;!--        &lt;dependency&gt;--&gt;\n&lt;!--            &lt;groupId&gt;jakarta.xml.bind&lt;/groupId&gt;--&gt;\n&lt;!--            &lt;artifactId&gt;jakarta.xml.bind-api&lt;/artifactId&gt;--&gt;\n&lt;!--            &lt;version&gt;3.0.1&lt;/version&gt;--&gt;\n&lt;!--        &lt;/dependency&gt;--&gt;\n        &lt;!-- https://mvnrepository.com/artifact/javax.xml.bind/jaxb-api --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt;\n            &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt;\n            &lt;version&gt;2.3.1&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;javax.jws&lt;/groupId&gt;\n            &lt;artifactId&gt;javax.jws-api&lt;/artifactId&gt;\n            &lt;version&gt;1.1&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt;\n            &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt;\n            &lt;version&gt;2.2.12&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.glassfish.jaxb&lt;/groupId&gt;\n            &lt;artifactId&gt;jaxb-runtime&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.vaadin.olli&lt;/groupId&gt;\n            &lt;artifactId&gt;file-download-wrapper&lt;/artifactId&gt;\n            &lt;version&gt;6.0.0&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;\n            &lt;version&gt;3.14.0&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n            &lt;exclusions&gt;\n                &lt;exclusion&gt;\n                    &lt;groupId&gt;com.jayway.jsonpath&lt;/groupId&gt;\n                    &lt;artifactId&gt;json-path&lt;/artifactId&gt;\n                &lt;/exclusion&gt;\n            &lt;/exclusions&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.ws.xmlschema&lt;/groupId&gt;\n            &lt;artifactId&gt;xmlschema-core&lt;/artifactId&gt;\n            &lt;version&gt;2.2.4&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.instancio&lt;/groupId&gt;\n            &lt;artifactId&gt;instancio-core&lt;/artifactId&gt;\n            &lt;version&gt;4.5.0&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.instancio&lt;/groupId&gt;\n            &lt;artifactId&gt;instancio-junit&lt;/artifactId&gt;\n            &lt;version&gt;4.5.0&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.ws&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-ws-test&lt;/artifactId&gt;\n            &lt;version&gt;3.1.8&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n</code></pre>\n<p>weird is, that I checked some time ago and it was outputing JSON as expected. Now I have tried it and got xml...</p>\n<p>spring-boot-starter-parent: v2.7.18</p>\n<p>EDIT after migration to Spring-boot 3:</p>\n<p>so in a different branch (b/c I can't use Java 17) out of curiosity I migrated the project to Spring 3.</p>\n<p>Now it's mixed.\nWhen I go to <code>http://localhost:9001/actuator/</code> I get:</p>\n<pre><code>&lt;Map&gt;\n&lt;timestamp&gt;2024-05-28T17:15:30.620+00:00&lt;/timestamp&gt;\n&lt;status&gt;404&lt;/status&gt;\n&lt;error&gt;Not Found&lt;/error&gt;\n&lt;path&gt;/actuator/&lt;/path&gt;\n&lt;/Map&gt;\n</code></pre>\n<p>when I go to: <code>http://localhost:9001/actuator/info</code> I get proper json back:</p>\n<pre><code>{&quot;build&quot;:{&quot;artifact&quot;:&quot;nrdbsimulator&quot;,&quot;name&quot;:&quot;NRDB simulator&quot;,&quot;time&quot;:&quot;2024-05-28T16:56:45.491Z&quot;,&quot;version&quot;:&quot;1.0.1&quot;,&quot;group&quot;:&quot;com.frequentis&quot;}}\n</code></pre>\n<p>my management-related properties are:</p>\n<pre><code>management.server.address=127.0.0.1\nmanagement.server.port=9001\nmanagement.endpoints.web.exposure.include=*\nmanagement.endpoints.web.exposure.exclude=loggers\nmanagement.server.ssl.enabled=false\n</code></pre>\n<p>and I can not visit <code>http://localhost:9001/actuator/prometheus</code> too.\nI get <code>not found</code> in XML format back.</p>\n<p>I have <code>micrometer</code> dependency in my pom:</p>\n<pre><code>        &lt;dependency&gt;\n            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;\n            &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<p>Note, I have tried with Spring Boot Parent <code>v3.3.0</code> and <code>v3.2.6</code> too.</p>\n<p>And when I try to observe metric with histogram I get class not found error back, which completely doesn't make sense to me:</p>\n<pre><code>java.lang.ClassNotFoundException: io.prometheus.metrics.tracer.initializer.SpanContextSupplier\n</code></pre>\n<p>Any help on how to debug this appreciated</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}