{
  "question": {
    "tags": [
      "java",
      "android",
      "backend",
      "audio-recording"
    ],
    "owner": {
      "account_id": 23088513,
      "reputation": 13,
      "user_id": 17233299,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/AATXAJyYWNshqc_9_a_vB6DosSD66gmTEEZyOmvzjXlz=k-s256",
      "display_name": "Nebula Libro",
      "link": "https://stackoverflow.com/users/17233299/nebula-libro"
    },
    "is_answered": true,
    "view_count": 73,
    "accepted_answer_id": 79247327,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1744312015,
    "creation_date": 1733131831,
    "question_id": 79243543,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79243543/why-does-the-audiorecord-output-only-zeros",
    "title": "Why does the AudioRecord output only zeros?",
    "body": "<p>I am using Java Android AudioRecorder (Code as below). When I start recording, rms is normal value larger than 0. Several seconds after recording, rms only gets 0.0 value, which means audioBuffer is a zero buffer. How can I fix it? Thanks.</p>\n<pre><code>        recorder = new AudioRecord(MediaRecorder.AudioSource.MIC, sampleRate, channelConfig, audioFormat, bufferSize);\n        while (isRecording) {\n            int read = recorder.read(audioBuffer, 0, bufferSize);\n            if (read &gt; 0) {\n                long currentTime = System.currentTimeMillis();\n\n                // Calculate the RMS (root mean square) value of the audio buffer\n                double sum = 0;\n                for (int i = 0; i &lt; read; i += 2) {\n                    short sample = (short) ((audioBuffer[i + 1] &lt;&lt; 8) | (audioBuffer[i] &amp; 0xFF));\n                    sum += sample * sample;\n                }\n                double rms = Math.sqrt(sum / (read / 2));\n</code></pre>\n<p>And here is a more detailed version of my code:</p>\n<pre><code>    private void writeAudioDataToFile(String filePath, int bufferSize) {\n        byte[] audioBuffer = new byte[bufferSize];\n        FileOutputStream os = null;\n\n        while (isRecording) {\n            int read = recorder.read(audioBuffer, 0, bufferSize);\n            if (read &gt; 0) {\n                long currentTime = System.currentTimeMillis();\n\n                // Calculate the RMS (root mean square) value of the audio buffer\n                double sum = 0;\n                for (int i = 0; i &lt; read; i += 2) {\n                    short sample = (short) ((audioBuffer[i + 1] &lt;&lt; 8) | (audioBuffer[i] &amp; 0xFF));\n                    sum += sample * sample;\n                }\n                double rms = Math.sqrt(sum / (read / 2));\n\n                // Check if the audio level is above the silence threshold\n                if (rms &gt; SILENCE_THRESHOLD) {\n                    lastVoiceTimestamp = currentTime;\n                    Log.i(Config.TAG, &quot;Loud.&quot;);\n                    // If the output stream is null, create a new file\n                    if (os == null) {\n                        try {\n                            os = new FileOutputStream(filePath);\n                        } catch (FileNotFoundException e) {\n                            e.printStackTrace();\n                        }\n                    }\n\n                    // Write audio data to file\n                    try {\n                        os.write(audioBuffer, 0, read);\n                    } catch (IOException e) {\n                        e.printStackTrace();\n                    }\n\n                } else {\n                    Log.i(Config.TAG, &quot;Silent &quot;+ String.valueOf(rms)+&quot; &quot;+String.valueOf(recorder.getState()));\n                    // Check if silence duration has exceeded the threshold\n                    if (currentTime - lastVoiceTimestamp &gt; SILENCE_DURATION) {\n                        Log.i(Config.TAG, &quot;Silent Time Out &quot;+ String.valueOf(rms)+&quot; &quot;+ String.valueOf(lastVoiceTimestamp));\n                        // Close the current file and prepare for a new one\n                        if (os != null) {\n                            try {\n                                os.close();\n                            } catch (IOException e) {\n                                e.printStackTrace();\n                            }\n                            os = null;\n\n                            // Encode the recorded PCM data to M4A\n                            String m4aFilePath = filePath.replace(&quot;.pcm&quot;, &quot;.m4a&quot;);\n                            convertPcmToM4a(filePath, m4aFilePath);\n                            filePath = audioDir + &quot;/&quot; + &quot;record_&quot; + System.currentTimeMillis() + &quot;.pcm&quot;;\n                            // Trigger transcription and translation\n                            new Thread(() -&gt; {\n                                triggerTranscriptionAndTranslation(m4aFilePath);\n                            }).start();\n                            Log.i(Config.TAG, &quot;New audio &quot;+ filePath);\n                        }\n                    } else {\n                        // If within silence duration, continue writing silence (optional)\n                        if (os != null) {\n                            try {\n                                os.write(audioBuffer, 0, read);\n                            } catch (IOException e) {\n                                e.printStackTrace();\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        // Clean up when recording stops\n        if (os != null) {\n            try {\n                os.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            os = null;\n\n            // Encode the last recorded PCM data to M4A\n            String m4aFilePath = filePath.replace(&quot;.pcm&quot;, &quot;.m4a&quot;);\n            convertPcmToM4a(filePath, m4aFilePath);\n\n            // Trigger transcription and translation\n            new Thread(() -&gt; {\n                triggerTranscriptionAndTranslation(m4aFilePath);\n            }).start();\n        }\n    }\n</code></pre>\n<p>I have logged the rms. At the beginning it is normal value larger than 0. Then suddenly it becomes 0.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}