{
  "question": {
    "tags": [
      "java",
      "android",
      "wear-os",
      "sendmessage"
    ],
    "owner": {
      "account_id": 30421712,
      "reputation": 3,
      "user_id": 23312908,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/e256aeb42fb926640aab16b5094cfc27?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "bluered",
      "link": "https://stackoverflow.com/users/23312908/bluered"
    },
    "is_answered": true,
    "view_count": 217,
    "accepted_answer_id": 77898730,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1749465060,
    "creation_date": 1706502306,
    "question_id": 77897428,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/77897428/wearos-and-android-application-does-not-communicate",
    "title": "WearOS and Android application does not communicate",
    "body": "<p>I want to display the numbers entered in an Android app on a Wearable device, but it's not working as expected. Since MessageApi is deprecated, I'm trying to use MessageClient as a replacement, but it's not working. I've been debugging, but it seems to stop after sending the message, and there are no error logs to help me figure out the issue. If anyone has experience with developing for Wear OS devices, could you please help me?　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　\n<a href=\"https://i.sstatic.net/aK6aF.png\" rel=\"nofollow noreferrer\">enter image description here</a><a href=\"https://i.sstatic.net/CkXTe.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n<p>Android　MainActivity</p>\n<pre><code>public class MainActivity extends AppCompatActivity implements View.OnClickListener {\n    private EditText editText;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        editText = findViewById(R.id.editText);\n\n        Button sendButton = findViewById(R.id.sendButton);\n        sendButton.setOnClickListener(this);\n    }\n\n    @Override\n    public void onClick(View v) {\n        if (v.getId() == R.id.sendButton) {\n            String text = editText.getText().toString();\n            sendMessage(text);\n        }\n    }\n\n    private void sendMessage(String text) {\n        MessageClient messageClient = Wearable.getMessageClient(this);\n\n        \n        Task&lt;List&lt;Node&gt;&gt; nodeListTask = Wearable.getNodeClient(this).getConnectedNodes();\n        nodeListTask.addOnSuccessListener(nodes -&gt; {\n            \n            for (Node node : nodes) {\n                messageClient.sendMessage(node.getId(), &quot;/data_comm&quot;, text.getBytes())\n                        .addOnSuccessListener(aVoid -&gt; {\n                            \n                            Log.d(&quot;SendMessage&quot;, &quot;Message sent successfully to: &quot; + node.getDisplayName());\n                            \n                        })\n                        .addOnFailureListener(e -&gt; {\n                            \n                            Log.e(&quot;SendMessage&quot;, &quot;Failed to send message to: &quot; + node.getDisplayName(), e);\n                        });\n            }\n        }).addOnFailureListener(e -&gt; {\n            \n            Log.e(&quot;SendMessage&quot;, &quot;Failed to get connected nodes&quot;, e);\n        });\n    }\n}\n</code></pre>\n<p>wear os MainActivity</p>\n<pre><code>public class MainActivity extends Activity implements MessageClient.OnMessageReceivedListener {\n    private TextView textView;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        textView = findViewById(R.id.textView); \n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n        Wearable.getMessageClient(this).addListener(this);\n    }\n\n    @Override\n    protected void onPause() {\n        super.onPause();\n        Wearable.getMessageClient(this).removeListener(this);\n    }\n\n    @Override\n    public void onMessageReceived(@NonNull final MessageEvent messageEvent) {\n        if (messageEvent.getPath().equals(&quot;/data_comm&quot;)) {\n            runOnUiThread(() -&gt; {\n                String message = new String(messageEvent.getData());\n                textView.setText(message); \n            });\n        }\n    }\n</code></pre>\n<p>DataListenerService class</p>\n<pre><code>public class DataListenerService extends WearableListenerService {\n    private Handler handler = new Handler(Looper.getMainLooper());\n\n    @Override\n    public void onDataChanged(DataEventBuffer dataEvents) {\n        for (DataEvent event : dataEvents) {\n            if (event.getType() == DataEvent.TYPE_CHANGED) {\n                DataItem item = event.getDataItem();\n\n                if (item.getUri().getPath().equals(&quot;/data_comm&quot;)) {\n                    DataMap dataMap = DataMapItem.fromDataItem(item).getDataMap();\n                    handler.post(() -&gt; Toast.makeText(getApplicationContext(), dataMap.getString(&quot;key_data&quot;),\n                            Toast.LENGTH_SHORT).show());\n                }\n            }\n        }\n    }\n\n    @Override\n    public void onMessageReceived(MessageEvent messageEvent) {\n        if (messageEvent.getPath().equals(&quot;/data_comm_2&quot;)) {\n            handler.post(() -&gt; Toast.makeText(getApplicationContext(),\n                    new String(messageEvent.getData()),\n                    Toast.LENGTH_SHORT).show());\n        }\n    }\n</code></pre>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;\n    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;\n\n    &lt;application\n        android:allowBackup=&quot;true&quot;\n        android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;\n        android:fullBackupContent=&quot;@xml/backup_rules&quot;\n        android:icon=&quot;@mipmap/ic_launcher&quot;\n        android:label=&quot;@string/app_name&quot;\n        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;\n        android:supportsRtl=&quot;true&quot;\n        android:theme=&quot;@style/Theme.Practice_wear&quot;\n        tools:targetApi=&quot;31&quot;&gt;\n        &lt;activity\n            android:name=&quot;.MainActivity&quot;\n            android:exported=&quot;true&quot;&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;\n\n                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/activity&gt;\n\n        &lt;meta-data\n            android:name=&quot;com.google.android.gms.version&quot;\n            android:value=&quot;@integer/google_play_services_version&quot; /&gt;\n    &lt;/application&gt;\n\n&lt;/manifest&gt;\n</code></pre>\n<pre><code>&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;\n    &lt;uses-feature android:name=&quot;android.hardware.type.watch&quot; /&gt;\n\n    &lt;application\n        android:allowBackup=&quot;true&quot;\n        android:icon=&quot;@mipmap/ic_launcher&quot;\n        android:label=&quot;@string/app_name&quot;\n        android:supportsRtl=&quot;true&quot;\n        android:theme=&quot;@android:style/Theme.DeviceDefault&quot;&gt;\n\n        &lt;activity\n            android:name=&quot;.MainActivity&quot;\n            android:exported=&quot;true&quot;&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;\n                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/activity&gt;\n\n        &lt;service\n            android:name=&quot;.DataListenerService&quot;\n            android:exported=&quot;true&quot;&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=&quot;com.google.android.gms.wearable.DATA_CHANGED&quot; /&gt;\n                &lt;data android:scheme=&quot;wear&quot; android:host=&quot;*&quot; android:pathPrefix=&quot;/logData&quot; /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/service&gt;\n\n    &lt;/application&gt;\n\n    &lt;meta-data\n        android:name=&quot;com.google.android.gms.version&quot;\n        android:value=&quot;@integer/google_play_services_version&quot; /&gt;\n&lt;/manifest&gt;\n</code></pre>\n<pre><code>plugins {\n    id 'com.android.application'\n}\n\nandroid {\n    namespace 'com.websarva.wings.android.practice_wear'\n    compileSdk 33\n\n    defaultConfig {\n        applicationId &quot;com.websarva.wings.android.practice_wear&quot;\n        minSdk 26\n        targetSdk 33\n        versionCode 1\n        versionName &quot;1.0&quot;\n\n        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n}\n\ndependencies {\n\n    implementation 'androidx.appcompat:appcompat:1.6.1'\n    implementation 'com.google.android.material:material:1.5.0'\n    implementation 'androidx.constraintlayout:constraintlayout:2.1.4'\n    implementation 'com.google.android.gms:play-services-wearable:18.1.0'\n    testImplementation 'junit:junit:4.13.2'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.5'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.1'\n    implementation 'androidx.core:core:1.6.0'\n}\n</code></pre>\n<pre><code>plugins {\n    id 'com.android.application'\n}\n\nandroid {\n    namespace 'com.websarva.wings.android.wear'\n    compileSdk 33\n\n    defaultConfig {\n        applicationId &quot;com.websarva.wings.android.wear&quot;\n        minSdk 26\n        targetSdk 33\n        versionCode 1\n        versionName &quot;1.0&quot;\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n}\n\ndependencies {\n    implementation 'androidx.percentlayout:percentlayout:1.0.0'\n    implementation 'androidx.recyclerview:recyclerview:1.3.2'\n    implementation 'com.google.android.gms:play-services-wearable:18.1.0'\n    implementation 'androidx.wear:wear:1.0.0'\n    compileOnly 'com.google.android.wearable:wearable:2.5.0'\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}