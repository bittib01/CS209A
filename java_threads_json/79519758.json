{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-batch",
      "spring-kafka",
      "classnotfoundexception"
    ],
    "owner": {
      "account_id": 5588652,
      "reputation": 501,
      "user_id": 4428547,
      "user_type": "registered",
      "accept_rate": 75,
      "profile_image": "https://i.sstatic.net/z7BgN.png?s=256",
      "display_name": "Kris",
      "link": "https://stackoverflow.com/users/4428547/kris"
    },
    "is_answered": true,
    "view_count": 92,
    "accepted_answer_id": 79519925,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1742380610,
    "creation_date": 1742377063,
    "last_edit_date": 1742377780,
    "question_id": 79519758,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79519758/spring-kafka-classnotfoundexception-com-google-common-cache-cacheloader",
    "title": "Spring Kafka: ClassNotFoundException: com.google.common.cache.CacheLoader",
    "body": "<p>I write you this message because I have an error when trying to execute a Spring batch job that reads messages from a Kafka topic.</p>\n<p>This job is triggered after calling an URL in my web app.\nThe final error message says:</p>\n<blockquote>\n<p>Caused by: java.lang.ClassNotFoundException:\ncom.google.common.cache.CacheLoader</p>\n</blockquote>\n<p>So maybe I need to include other dependencies in my pom.\nI have the same error both locally on my laptop or on the acceptance environement (On Openshift) where the app is deployed.</p>\n<p>Also when the same batch is executed as a CronJob on Openshift (in another module), it works well.</p>\n<p><strong>Could you help find out which dependency I should add ?</strong></p>\n<p>Here is some relevant chunks of code that shows how I run my code:\n<strong>Controller</strong></p>\n<pre><code>@PostMapping (value = &quot;/launch-consumption&quot;, produces = MediaType.APPLICATION_JSON_VALUE)\npublic @ResponseBody ResponseEntity&lt;String&gt; consumeTopic() throws JobInstanceAlreadyCompleteException, JobExecutionAlreadyRunningException, JobParametersInvalidException, JobRestartException {\n    log.info(&quot;Received a request to launch the consumer job&quot;);\n\n    // If batch already running, send HTTP 202\n    if(service.isBatchAlreadyRunning()) {\n        return ResponseEntity.status(HttpStatus.ACCEPTED).body(BATCH_ALREADY_RUNNING);\n    }\n    asyncLaunchBatch();\n    return ResponseEntity.status(HttpStatus.OK).body(BATCH_JUST_LAUNCHED);\n}\n\n@Async\nprivate void asyncLaunchBatch() throws JobInstanceAlreadyCompleteException, JobExecutionAlreadyRunningException, JobParametersInvalidException, JobRestartException {\n    service.launchConsumerBatch();\n}\n</code></pre>\n<p><strong>The Service</strong></p>\n<pre><code>@Service\npublic class Service {\n    @Autowired\n    private JobLauncher jobLauncher;\n    @Autowired\n    @Qualifier(&quot;jobConsumer&quot;)\n    private Job job;\n    @Autowired\n    private JobExplorer jobExplorer;\n\n    public void launchConsumerBatch() throws JobInstanceAlreadyCompleteException, JobExecutionAlreadyRunningException, JobParametersInvalidException, JobRestartException {\n        // Add launch date to parameter.\n        // A job is uniquely identified by its id together with the parameters.\n        // So we add the launch date as a parameter\n        // So that we won't be blocked when launching a job multiple times.\n        JobParametersBuilder builder = new JobParametersBuilder();\n        builder.addDate(&quot;date&quot;, new Date());\n\n        jobLauncher.run(job, builder.toJobParameters());\n    }\n\n}\n</code></pre>\n<p><strong>The job:</strong></p>\n<pre><code>@Bean\npublic Job jobConsumer(\n        JobRepository jobRepository,\n        Step stepTruncateTable,\n        Step stepReadProcessWrite,\n        ReceptionSuccessDecider receptionSuccessDecider,\n        Step stepBackupLastDailyTrafics,\n        Step stepRestoreFromBackupDailyTrafics,\n        Step stepRestoreQualificationState) {\n    return new JobBuilder(JOB_NAME, jobRepository)\n            .listener(new JobListener())\n            .incrementer(new CustomIncrementer(JOB_NAME))\n            .start(stepTruncateTable)\n            .next(stepReadProcessWrite)\n            .next(receptionSuccessDecider).on(&quot;FAILED&quot;).to(stepRestoreFromBackupDailyTrafics)\n            .next(stepRestoreQualificationState)\n            .from(receptionSuccessDecider).on(&quot;COMPLETED&quot;).to(stepBackupLastDailyTrafics)\n            .next(stepRestoreQualificationState)\n            .on(&quot;COMPLETED&quot;).end()\n            .on(&quot;FAILED&quot;).fail().end()\n            .build();\n}\n</code></pre>\n<p><strong>KafkaItemReader:</strong></p>\n<pre><code>public class DailyTraficToQualifyKafkaItemReader extends KafkaItemReader&lt;String, DailyTrafficToQualify&gt; {\n\n    public DailyTraficToQualifyKafkaItemReader(Properties consumerProperties, String topicName, List&lt;Integer&gt; partitions) {\n        super(consumerProperties, topicName, partitions);\n        // Passing an empty map makes the reader start from the offset stored in Kafka\n        // for the consumer group ID.\n        // In case of a restart, offsets stored in the execution context\n        // will take precedence.\n        setPartitionOffsets(new HashMap&lt;&gt;());\n        setName(&quot;DailyTraficToQualifyReader&quot;);\n    }\n\n}\n</code></pre>\n<p>Below is my pom and then the error stack trace:</p>\n<p>Relevant content in parent pom and then module pom:</p>\n<pre><code>&lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.1.4&lt;/version&gt;\n&lt;/parent&gt;\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n     xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n     xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n&lt;artifactId&gt;module-name&lt;/artifactId&gt;\n&lt;packaging&gt;jar&lt;/packaging&gt;\n&lt;name&gt;module-name&lt;/name&gt;\n&lt;description&gt;Backend qualification&lt;/description&gt;\n&lt;!-- d√©claration de spring boot en projet parent TDC-CTR--&gt;\n&lt;parent&gt;\n    &lt;groupId&gt;com.mycompany.projectname&lt;/groupId&gt;\n    &lt;artifactId&gt;pom-parent&lt;/artifactId&gt;\n    &lt;version&gt;6.0.0.18-SNAPSHOT&lt;/version&gt;\n    &lt;relativePath&gt;../pom-parent/pom.xml&lt;/relativePath&gt;\n&lt;/parent&gt;\n\n&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.mycompany.projectname.library&lt;/groupId&gt;\n        &lt;artifactId&gt;lib-mysql&lt;/artifactId&gt;\n        &lt;version&gt;6.0.0.18-SNAPSHOT&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.mycompany.projectname.library&lt;/groupId&gt;\n        &lt;artifactId&gt;lib-swagger&lt;/artifactId&gt;\n        &lt;version&gt;6.0.0.18-SNAPSHOT&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.mycompany.projectname.library&lt;/groupId&gt;\n        &lt;artifactId&gt;lib-common&lt;/artifactId&gt;\n        &lt;version&gt;6.0.0.18-SNAPSHOT&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;!-- core dependencies --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-batch&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.apache.avro&lt;/groupId&gt;\n        &lt;artifactId&gt;avro&lt;/artifactId&gt;\n        &lt;version&gt;1.10.1&lt;/version&gt;\n        &lt;scope&gt;compile&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;io.confluent&lt;/groupId&gt;\n        &lt;artifactId&gt;kafka-avro-serializer&lt;/artifactId&gt;\n        &lt;version&gt;7.2.1&lt;/version&gt;\n        &lt;scope&gt;compile&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.batch&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-batch-core&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;!-- Spring Actuator - provides /health endpoint and some other metrics --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;!-- MySQL Dependency --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-data-jpa&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;!-- Util dependencies --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;\n        &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;\n        &lt;version&gt;2.15.2&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n        &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;jakarta.persistence&lt;/groupId&gt;\n        &lt;artifactId&gt;jakarta.persistence-api&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;!-- tests dependencies --&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.google.guava&lt;/groupId&gt;\n        &lt;artifactId&gt;guava&lt;/artifactId&gt;\n        &lt;version&gt;20.0&lt;/version&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.batch&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-batch-test&lt;/artifactId&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-kafka-test&lt;/artifactId&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.h2database&lt;/groupId&gt;\n        &lt;artifactId&gt;h2&lt;/artifactId&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n        &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n\n&lt;build&gt;\n    &lt;resources&gt;\n        &lt;resource&gt;\n            &lt;directory&gt;src/main/resources&lt;/directory&gt;\n            &lt;filtering&gt;true&lt;/filtering&gt;\n            &lt;includes&gt;\n                &lt;include&gt;**/*.properties&lt;/include&gt;\n                &lt;include&gt;**/*.json&lt;/include&gt;\n                &lt;include&gt;**/*.xml&lt;/include&gt;\n            &lt;/includes&gt;\n        &lt;/resource&gt;\n    &lt;/resources&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;\n            &lt;version&gt;3.1.0&lt;/version&gt;\n        &lt;/plugin&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n            &lt;configuration&gt;\n                &lt;source&gt;16&lt;/source&gt;\n                &lt;target&gt;16&lt;/target&gt;\n            &lt;/configuration&gt;\n        &lt;/plugin&gt;\n        &lt;!-- avro maven plugin generating java classes from idl object and avro schemas --&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.apache.avro&lt;/groupId&gt;\n            &lt;artifactId&gt;avro-maven-plugin&lt;/artifactId&gt;\n            &lt;version&gt;1.10.1&lt;/version&gt;\n            &lt;executions&gt;\n                &lt;execution&gt;\n                    &lt;phase&gt;generate-sources&lt;/phase&gt;\n                    &lt;goals&gt;\n                        &lt;goal&gt;schema&lt;/goal&gt;\n                    &lt;/goals&gt;\n                    &lt;configuration&gt;\n                        &lt;sourceDirectory&gt;${project.basedir}/src/main/resources/avro/&lt;/sourceDirectory&gt;\n                        &lt;outputDirectory&gt;${project.basedir}/target/generated-sources/&lt;/outputDirectory&gt;\n                        &lt;stringType&gt;String&lt;/stringType&gt;\n                    &lt;/configuration&gt;\n                &lt;/execution&gt;\n            &lt;/executions&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>\n\n<p>The error stack trace:</p>\n<pre><code>    ERROR o.s.batch.core.step.AbstractStep - Encountered an error executing step stepReadProcessWrite in job jobConsumer\norg.apache.kafka.common.KafkaException: Failed to construct kafka consumer\nat org.apache.kafka.clients.consumer.KafkaConsumer.&lt;init&gt;(KafkaConsumer.java:830)\nat org.apache.kafka.clients.consumer.KafkaConsumer.&lt;init&gt;(KafkaConsumer.java:665)\nat org.apache.kafka.clients.consumer.KafkaConsumer.&lt;init&gt;(KafkaConsumer.java:646)\nat org.apache.kafka.clients.consumer.KafkaConsumer.&lt;init&gt;(KafkaConsumer.java:626)\nat org.springframework.batch.item.kafka.KafkaItemReader.open(KafkaItemReader.java:168)\nat org.springframework.batch.item.support.CompositeItemStream.open(CompositeItemStream.java:124)\n...\nat java.base/java.lang.Thread.run(Thread.java:840)\n    Caused by: java.lang.NoClassDefFoundError: com/google/common/cache/CacheLoader\nat java.base/java.lang.Class.getDeclaredConstructors0(Native Method)\nat java.base/java.lang.Class.privateGetDeclaredConstructors(Class.java:3373)\nat java.base/java.lang.Class.getConstructor0(Class.java:3578)\nat java.base/java.lang.Class.getDeclaredConstructor(Class.java:2754)\nat org.springframework.kafka.support.serializer.ErrorHandlingDeserializer.setupDelegate(ErrorHandlingDeserializer.java:129)\nat org.springframework.kafka.support.serializer.ErrorHandlingDeserializer.configure(ErrorHandlingDeserializer.java:114)\nat org.apache.kafka.clients.consumer.KafkaConsumer.&lt;init&gt;(KafkaConsumer.java:717)\n... 154 common frames omitted\nCaused by: java.lang.ClassNotFoundException: com.google.common.cache.CacheLoader\nat java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)\nat java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)\nat java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:525)\n... 161 common frames omitted\no.s.batch.core.step.AbstractStep - Step: [stepReadProcessWrite] executed in 125ms\nf.l.t.u.c.batch.listener.JobListener - JobListener::afterJob() -&gt; jobExecution: jobConsumer, FAILED\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}