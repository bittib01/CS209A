{
  "question": {
    "tags": [
      "java",
      "maven",
      "quarkus",
      "discord4j"
    ],
    "owner": {
      "account_id": 18922807,
      "reputation": 75,
      "user_id": 13806537,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/bfc746d2b1d780b7a0f3d6300ba55faf?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Voxel",
      "link": "https://stackoverflow.com/users/13806537/voxel"
    },
    "is_answered": false,
    "view_count": 1142,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1757333541,
    "creation_date": 1706809475,
    "question_id": 77922326,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/77922326/java-net-unknownhostexception-failed-to-resolve-discord-com-a1-aaaa28",
    "title": "java.net.UnknownHostException: Failed to resolve &#39;discord.com&#39; [A(1), AAAA(28)] after 4 queries&quot; with discord4j in Quarkus",
    "body": "<p>I am currently following <a href=\"https://docs.discord4j.com/basic-bot-tutorial\" rel=\"nofollow noreferrer\">this</a> Guide to create my first discord bot in Java.\nI have a Quarkus Application (V3.6.6) set up with the mvn wrapper. I have added the discord4j package to my pom.xml</p>\n<pre><code>&lt;dependency&gt;\n  &lt;groupId&gt;com.discord4j&lt;/groupId&gt;\n  &lt;artifactId&gt;discord4j-core&lt;/artifactId&gt;\n  &lt;version&gt;3.2.6&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>I have created an Interface to be able to access my application properties inside my code</p>\n<pre><code>import io.smallrye.config.ConfigMapping;\n\n@ConfigMapping(prefix = &quot;discord&quot;)\npublic interface IdiscordBot {\n\n    String token();\n    String clientId();\n    String clientSecret();\n    \n}\n</code></pre>\n<p>my application.properties look like this:</p>\n<pre><code>discord.token=${DISCORD_API_TOKEN}\ndiscord.client-id=${YOUR_DISCORD_CLIENT_ID}\ndiscord.client-secret=${YOUR_DISCORD_CLIENT_SECRET}\n</code></pre>\n<p>My Actual Bot look like this</p>\n<pre><code>package bots;\n\nimport discord4j.core.DiscordClient;\nimport discord4j.core.GatewayDiscordClient;\nimport discord4j.core.event.domain.message.MessageCreateEvent;\nimport jakarta.enterprise.context.ApplicationScoped;\nimport jakarta.enterprise.event.Observes;\nimport jakarta.inject.Inject;\nimport jakarta.ws.rs.Path;\nimport io.quarkus.runtime.StartupEvent;\n\n@ApplicationScoped\n@Path(&quot;/discord&quot;)\npublic class DiscordBot {\n\n    @Inject\n    IdiscordBot discordBot;\n\n    void onStart(@Observes StartupEvent ev)\n    {\n        DiscordClient client = DiscordClient.create(discordBot.token());\n        GatewayDiscordClient gateway = client.login().block();\n    \n        gateway.on(MessageCreateEvent.class).subscribe(event -&gt; {\n                String content = event.getMessage().getContent();\n                if (&quot;!ping&quot;.equals(content)) {\n                        event.getMessage().getChannel().block().createMessage(&quot;Pong!&quot;).block();\n                    }\n                });\n            \n                gateway.onDisconnect().block();\n    }\n}\n</code></pre>\n<p>If I run this, I get:</p>\n<pre><code>2024-02-01 18:33:10,075 INFO  [dis.cor.DiscordClientBuilder] (Quarkus Main Thread) Discord4J 3.2.6 (https://discord4j.com)\n2024-02-01 18:33:10,165 WARN  [io.net.res.dns.DefaultDnsServerAddressStreamProvider] (d4j-limiter-1) Default DNS servers: [/[2001:4860:4860:0:0:0:0:8888]:53, /[2001:4860:4860:0:0:0:0:8844]:53] (Google Public DNS as a fallback)\n2024-02-01 18:33:10,268 ERROR [io.qua.run.Application] (Quarkus Main Thread) Failed to start application (with profile [dev]): java.lang.RuntimeException: Failed to start quarkus\n        at io.quarkus.runner.ApplicationImpl.doStart(Unknown Source)\n        at io.quarkus.runtime.Application.start(Application.java:101)\n        at io.quarkus.runtime.ApplicationLifecycleManager.run(ApplicationLifecycleManager.java:111)\n        at io.quarkus.runtime.Quarkus.run(Quarkus.java:71)\n        at io.quarkus.runtime.Quarkus.run(Quarkus.java:44)\n        at io.quarkus.runtime.Quarkus.run(Quarkus.java:124)\n        at io.quarkus.runner.GeneratedMain.main(Unknown Source)\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n        at io.quarkus.runner.bootstrap.StartupActionImpl$1.run(StartupActionImpl.java:113)\n        at java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: reactor.core.Exceptions$ReactiveException: java.net.UnknownHostException: Failed to resolve 'discord.com' [A(1), AAAA(28)] after 4 queries\n        at reactor.core.Exceptions.propagate(Exceptions.java:396)\n        at reactor.core.publisher.BlockingSingleSubscriber.blockingGet(BlockingSingleSubscriber.java:97)\n        at reactor.core.publisher.Mono.block(Mono.java:1742)\n        at bots.DiscordBot.onStart(DiscordBot.java:24)\n        at bots.DiscordBot_Observer_onStart_HOQkuT2M7cTKdLxHQb6PsFBzQ4I.notify(Unknown Source)\n        at io.quarkus.arc.impl.EventImpl$Notifier.notifyObservers(EventImpl.java:346)\n        at io.quarkus.arc.impl.EventImpl$Notifier.notify(EventImpl.java:328)\n        at io.quarkus.arc.impl.EventImpl.fire(EventImpl.java:82)\n        at io.quarkus.arc.runtime.ArcRecorder.fireLifecycleEvent(ArcRecorder.java:157)\n        at io.quarkus.arc.runtime.ArcRecorder.handleLifecycleEvents(ArcRecorder.java:108)\n        at io.quarkus.deployment.steps.LifecycleEventsBuildStep$startupEvent1144526294.deploy_0(Unknown Source)\n        at io.quarkus.deployment.steps.LifecycleEventsBuildStep$startupEvent1144526294.deploy(Unknown Source)\n        ... 11 more\n        Suppressed: java.lang.Exception: #block terminated with an error\n                at reactor.core.publisher.BlockingSingleSubscriber.blockingGet(BlockingSingleSubscriber.java:99)\n                ... 21 more\nCaused by: java.net.UnknownHostException: Failed to resolve 'discord.com' [A(1), AAAA(28)] after 4 queries\n        at io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:1097)\n        Suppressed: The stacktrace has been enhanced by Reactor, refer to additional information below:\nError has been observed at the following site(s):\n        *__checkpoint ? Request to GET /gateway/bot [RequestStream]\n        *__checkpoint ? Request to GET /gateway/bot [DefaultRouter]\nOriginal Stack Trace:\n                at io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:1097)\n                ...\n                at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n                at java.base/java.lang.Thread.run(Thread.java:1583)\nCaused by: io.netty.resolver.dns.DnsNameResolverException: [33311: /[2001:4860:4860:0:0:0:0:8844]:53] DefaultDnsQuestion(discord.com. IN AAAA) failed to send a query '33311' via UDP (no stack trace available)\nCaused by: java.net.SocketException: Network is unreachable: sendto\n        at java.base/sun.nio.ch.DatagramChannelImpl.send0(Native Method)\n        at io.netty.channel.socket.nio.NioDatagramChannel.doWriteMessage(NioDatagramChannel.java:297)\n        ...\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.base/java.lang.Thread.run(Thread.java:1583)\n</code></pre>\n<p>If I run nslookup discord.com or try to ping it, the commands run as expected.\nI tried setting my DNS Resolver to Google and Cloudflare, but that did not change anything.</p>\n<p>Is there a configuration missing? Is that a IPV4 / IPV6 thing. Or does this just not work with Quarkus and or Quarkus in dev mode.\nUnfortunately, I couldn't find anything that helped.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}