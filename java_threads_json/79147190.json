{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "google-cloud-vertex-ai",
      "google-gemini"
    ],
    "owner": {
      "account_id": 15940558,
      "reputation": 59,
      "user_id": 11502472,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/36c1798723546d9110c05ba866f3df36?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Oleg Sandro",
      "link": "https://stackoverflow.com/users/11502472/oleg-sandro"
    },
    "is_answered": false,
    "view_count": 706,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1733353070,
    "creation_date": 1730444850,
    "question_id": 79147190,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79147190/how-can-i-fix-the-error-using-java-spring-gemini-ai-google-cloud-vertex-ai-y",
    "title": "How can I fix the error using Java, Spring, Gemini AI, Google Cloud Vertex AI: Your default credentials were not found?",
    "body": "<p>I have created a small test project using Java and Spring Boot to integrate with Google Gemini AI.</p>\n<p>For this I added dependency to <code>google-cloud-vertexai</code> library to my <code>pom.xml</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>  &lt;dependencyManagement&gt;\n    &lt;dependencies&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;com.google.cloud&lt;/groupId&gt;\n        &lt;artifactId&gt;libraries-bom&lt;/artifactId&gt;\n        &lt;version&gt;26.49.0&lt;/version&gt;\n        &lt;scope&gt;import&lt;/scope&gt;\n        &lt;type&gt;pom&lt;/type&gt;\n      &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n  &lt;/dependencyManagement&gt;\n\n  &lt;dependencies&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;com.google.cloud&lt;/groupId&gt;\n      &lt;artifactId&gt;google-cloud-vertexai&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n  &lt;/dependencies&gt;\n</code></pre>\n<p>After that I added such simple controller:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.example.testing.controller;\n\nimport com.google.cloud.vertexai.VertexAI;\nimport com.google.cloud.vertexai.api.GenerateContentResponse;\nimport com.google.cloud.vertexai.api.PredictionServiceClient;\nimport com.google.cloud.vertexai.generativeai.GenerativeModel;\nimport com.google.cloud.vertexai.generativeai.ResponseHandler;\nimport java.io.IOException;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.RestController;\n\n@Slf4j\n@RestController\n@RequestMapping(&quot;/test&quot;)\n@RequiredArgsConstructor\npublic class TestController {\n\n  private final PredictionServiceClient predictionServiceClient;\n\n  @GetMapping\n  public ResponseEntity&lt;String&gt; test(@RequestParam String textPrompt) {\n    String projectId = &quot;vertex-ai-java-api-for-gemini&quot;;\n    String location = &quot;us-central1&quot;;\n    String modelName = &quot;gemini-1.5-flash-001&quot;;\n\n    String output = textInput(projectId, location, modelName, textPrompt);\n    return ResponseEntity.ok(output);\n  }\n\n  public String textInput(String projectId, String location, String modelName, String textPrompt) {\n    try (VertexAI vertexAI = new VertexAI(projectId, location)) {\n      GenerativeModel model = new GenerativeModel(modelName, vertexAI);\n      GenerateContentResponse response = model.generateContent(textPrompt);\n      return ResponseHandler.getText(response);\n    } catch (IOException e) {\n      String errorMessage = &quot;Error occurred: &quot; + e.getMessage();\n      log.error(errorMessage, e);\n      throw new RuntimeException(errorMessage);\n    }\n  }\n}\n\n</code></pre>\n<p>When I run my app I got the next error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>2024-11-01T08:49:51.542+02:00 ERROR 10824 --- [nio-8081-exec-4] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: java.lang.IllegalStateException: java.io.IOException: Your default credentials were not found. To set up Application Default Credentials for your environment, see https://cloud.google.com/docs/authentication/external/set-up-adc.] with root cause\n\njava.io.IOException: Your default credentials were not found. To set up Application Default Credentials for your environment, see https://cloud.google.com/docs/authentication/external/set-up-adc.\n    at com.google.auth.oauth2.DefaultCredentialsProvider.getDefaultCredentials(DefaultCredentialsProvider.java:127) ~[google-auth-library-oauth2-http-1.28.0.jar:1.28.0]\n    at com.google.auth.oauth2.GoogleCredentials.getApplicationDefault(GoogleCredentials.java:152) ~[google-auth-library-oauth2-http-1.28.0.jar:1.28.0]\n    at com.google.auth.oauth2.GoogleCredentials.getApplicationDefault(GoogleCredentials.java:124) ~[google-auth-library-oauth2-http-1.28.0.jar:1.28.0]\n    at com.google.api.gax.core.GoogleCredentialsProvider.getCredentials(GoogleCredentialsProvider.java:70) ~[gax-2.55.0.jar:2.55.0]\n    at com.google.api.gax.rpc.ClientContext.getCredentials(ClientContext.java:290) ~[gax-2.55.0.jar:2.55.0]\n    at com.google.api.gax.rpc.ClientContext.create(ClientContext.java:181) ~[gax-2.55.0.jar:2.55.0]\n    at com.google.cloud.vertexai.api.stub.GrpcPredictionServiceStub.create(GrpcPredictionServiceStub.java:295) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.google.cloud.vertexai.api.stub.PredictionServiceStubSettings.createStub(PredictionServiceStubSettings.java:323) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.google.cloud.vertexai.api.PredictionServiceClient.&lt;init&gt;(PredictionServiceClient.java:427) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.google.cloud.vertexai.api.PredictionServiceClient.create(PredictionServiceClient.java:409) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.google.cloud.vertexai.VertexAI.newPredictionServiceClient(VertexAI.java:345) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.google.common.base.Suppliers$NonSerializableMemoizingSupplier.get(Suppliers.java:200) ~[guava-33.3.1-jre.jar:na]\n    at com.google.cloud.vertexai.VertexAI.getPredictionServiceClient(VertexAI.java:334) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.google.cloud.vertexai.generativeai.GenerativeModel.generateContent(GenerativeModel.java:467) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.google.cloud.vertexai.generativeai.GenerativeModel.generateContent(GenerativeModel.java:454) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.google.cloud.vertexai.generativeai.GenerativeModel.generateContent(GenerativeModel.java:441) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.google.cloud.vertexai.generativeai.GenerativeModel.generateContent(GenerativeModel.java:429) ~[google-cloud-vertexai-1.12.0.jar:1.12.0]\n    at com.example.testing.controller.TestController.textInput(TestController.java:38) ~[classes/:na]\n    at com.example.testing.controller.TestController.test(TestController.java:31) ~[classes/:na]\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:150) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.0.11.jar:6.0.11]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:884) ~[spring-webmvc-6.0.11.jar:6.0.11]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797) ~[spring-webmvc-6.0.11.jar:6.0.11]\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.0.11.jar:6.0.11]\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1081) ~[spring-webmvc-6.0.11.jar:6.0.11]\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:974) ~[spring-webmvc-6.0.11.jar:6.0.11]\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1011) ~[spring-webmvc-6.0.11.jar:6.0.11]\n    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903) ~[spring-webmvc-6.0.11.jar:6.0.11]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564) ~[tomcat-embed-core-10.1.11.jar:6.0]\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.0.11.jar:6.0.11]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.11.jar:6.0]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.11.jar:6.0.11]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:166) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:341) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:894) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1740) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.11.jar:10.1.11]\n    at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]\n\n</code></pre>\n<p>Then I added env var <code>GOOGLE_APPLICATION_CREDENTIALS</code> with path to JSON-file with key from my Google service accout and it started working well, but what if I would like to transfer this integration to DEV env or PROD env, where I can face with DevOps issue because of JSON-file location and env var. Is there any way to avoid JSON-file and env var using and to set credentials programmatically, for instance like I set programatically projectId or region location in my code example?</p>\n<p>If you know a way to use Gemini AI from the Java app and avoid authentication it will be also very helpful knowledge.</p>\n<p>Thank you in advance!</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}