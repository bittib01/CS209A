{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "hibernate",
      "csv"
    ],
    "owner": {
      "account_id": 19688836,
      "reputation": 61,
      "user_id": 14414280,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GhV9Xra3DRIHlfGCd5n2kKUiGfXo-1Ml_1PG4kn4Q=k-s256",
      "display_name": "Gwendal",
      "link": "https://stackoverflow.com/users/14414280/gwendal"
    },
    "is_answered": true,
    "view_count": 151,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1742568276,
    "creation_date": 1742547009,
    "last_edit_date": 1742568276,
    "question_id": 79524942,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79524942/problem-saving-jpa-records-from-a-csv-file-in-springboot-row-was-updated-or-de",
    "title": "Problem saving JPA records from a csv file in SpringBoot - Row was updated or deleted by another transaction (or unsaved-value mapping was incorrect)",
    "body": "<p>I'm trying to make a small test project where I have News(Blog posts) and people can react to them. I wanted to be able to load articles from a csv file and it turned out to be more complicated than I had anticipated.</p>\n<p>Here is my News class</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.cloakstudio.apiwyldernews.model;\n\nimport com.fasterxml.jackson.annotation.JsonManagedReference;\nimport jakarta.persistence.*;\nimport jakarta.validation.constraints.NotBlank;\nimport lombok.AllArgsConstructor;\nimport lombok.Getter;\nimport lombok.NoArgsConstructor;\nimport lombok.Setter;\nimport org.hibernate.validator.constraints.URL;\n\nimport java.util.ArrayList;\nimport java.util.Date;\nimport java.util.List;\nimport java.util.Set;\n\nimport java.util.stream.Collectors;\n@Getter\n@Setter\n@Entity\n@Table(name = &quot;News&quot;)\n@NoArgsConstructor\n@AllArgsConstructor\npublic class News {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @NotBlank(message = &quot;Update type cannot be empty&quot;)\n    @Column(name = &quot;update_type&quot;)\n    private String updateType;\n\n    @Column(name = &quot;created_at&quot;)\n    private Date createdAt;\n\n    @NotBlank(message = &quot;Title cannot be empty&quot;)\n    @Column(columnDefinition = &quot;TEXT&quot;)\n    private String title;\n\n    @NotBlank(message = &quot;Intro cannot be empty&quot;)\n    @Column(columnDefinition = &quot;TEXT&quot;)\n    private String intro;\n\n    @NotBlank(message = &quot;Thumbnail url cannot be empty&quot;)\n    @URL(message = &quot;Thumbnail url must be a valid url&quot;)\n    @Column(name = &quot;thumbnail_url&quot;)\n    private String thumbnailUrl;\n\n    @NotBlank(message = &quot;Image url cannot be empty&quot;)\n    @URL(message = &quot;Image url must be a valid url&quot;)\n    @Column(name = &quot;image_url&quot;)\n    private String imageUrl;\n\n    @NotBlank(message = &quot;Description cannot be empty&quot;)\n    @Column(columnDefinition = &quot;TEXT&quot;)\n    private String description;\n\n    @Column(name = &quot;news_id&quot;)\n    private Long newsId;\n\n    private int snaps;\n\n    private String location;\n\n    @JsonManagedReference\n    @OneToMany(mappedBy=&quot;news&quot;, cascade = CascadeType.ALL)\n    Set&lt;NewsReactions&gt; newsReactions;\n\n    public News(String updateType, String title, String intro, String thumbnailUrl, String imageUrl, String description, String location) {\n        this.updateType = updateType;\n        this.title = title;\n        this.intro = intro;\n        this.thumbnailUrl = thumbnailUrl;\n        this.imageUrl = imageUrl;\n        this.description = description;\n        this.location = location;\n    }\n  //...\n}\n</code></pre>\n<p>And here is the csv file I'm trying to import</p>\n<pre class=\"lang-none prettyprint-override\"><code>id,updateType,createdAt,title,intro,thumbnailUrl,imageUrl,description,newsId,snaps,location\n1,Guide,2025-03-18T09:03:59.046+00:00,How to do cool tricks,In this guide you will learn how to do cool tricks like import a csv file in java,https://media.fromsoftware.jp/eldenring/resources/images/movieandimages/screenshot/thumb/10.jpg,https://media.fromsoftware.jp/eldenring/resources/images/movieandimages/screenshot/4k/10.jpg,Importing a csv file is a very useful feature to test your application,0,0,My personal computer\n\n</code></pre>\n<p>Here is the CSVObjectLoader class</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.cloakstudio.apiwyldernews.loader;\n\nimport com.fasterxml.jackson.databind.MappingIterator;\nimport com.fasterxml.jackson.dataformat.csv.CsvMapper;\nimport com.fasterxml.jackson.dataformat.csv.CsvSchema;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.core.io.ClassPathResource;\nimport org.springframework.stereotype.Component;\n\nimport java.io.File;\nimport java.util.Collections;\nimport java.util.List;\n\n@Component\npublic class CSVObjectLoader {\n    private static final Logger logger = LoggerFactory.getLogger(CSVObjectLoader.class);\n\n    public &lt;T&gt; List&lt;T&gt; loadObjectList(Class&lt;T&gt; type, String filename) {\n        try {\n            // The schema is based on the first row\n            CsvSchema bootstrapSchema = CsvSchema.emptySchema().withHeader();\n            CsvMapper mapper = new CsvMapper();\n            // Get the file from the class path\n            File file = new ClassPathResource(filename).getFile();\n            // Read the values\n            MappingIterator&lt;T&gt; readValues = mapper.reader(type).with(bootstrapSchema).readValues(file);\n            return readValues.readAll();\n        } catch(Exception e) {\n            logger.error(&quot;An error has occurred while trying to read the following file : &quot; + filename, e);\n            return Collections.emptyList();\n        }\n    }\n}\n</code></pre>\n<p>InitialDataLoader class</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.cloakstudio.apiwyldernews.loader;\n\nimport com.cloakstudio.apiwyldernews.model.News;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\nimport java.util.List;\n\n@Component\npublic class InitialDataLoader {\n    @Autowired\n    CSVObjectLoader csvObjectLoader;\n\n    String NEWS_FILE = &quot;newsList.csv&quot;;\n\n    public List&lt;News&gt; getNews() {\n        return csvObjectLoader.loadObjectList(News.class, NEWS_FILE);\n    }\n}\n</code></pre>\n<p>InitialDataSetupService class</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.cloakstudio.apiwyldernews.loader;\n\nimport com.cloakstudio.apiwyldernews.model.News;\nimport com.cloakstudio.apiwyldernews.repository.NewsRepository;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class InitialDataSetupService {\n\n    @Autowired\n    NewsRepository newsRepository;\n\n    public void setupNews(News news) {\n        if(!newsRepository.existsById(news.getId())) {\n            newsRepository.save(news);\n        }\n    }\n}\n</code></pre>\n<p>InitialDataSetup class</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.cloakstudio.apiwyldernews.loader;\n\nimport com.cloakstudio.apiwyldernews.model.News;\nimport jakarta.annotation.PostConstruct;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Date;\nimport java.util.List;\n\n@Component\npublic class InitialDataSetup {\n    @Autowired\n    InitialDataLoader initialDataLoader;\n\n    @Autowired\n    InitialDataSetupService initialDataSetupService;\n\n    @PostConstruct\n    private void setupData() {\n        setupInitialData();\n    }\n\n    public void setupInitialData() {\n        List&lt;News&gt; newsList = initialDataLoader.getNews();\n        for(News news : newsList) {\n            initialDataSetupService.setupNews(news);\n        }\n    }\n}\n</code></pre>\n<p>And I'm getting the following error in the console :</p>\n<pre><code>2025-03-21T09:23:30.786+01:00 ERROR 14519 --- [apiwyldernews] [           main] o.s.boot.SpringApplication               : Application run failed\n\norg.springframework.beans.factory.BeanCreationException: Error creating bean with name 'initialDataSetup': Invocation of init method failed\n    at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:222) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:423) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1804) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:346) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.instantiateSingleton(DefaultListableBeanFactory.java:1155) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingleton(DefaultListableBeanFactory.java:1121) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:1056) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:987) ~[spring-context-6.2.3.jar:6.2.3]\n    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627) ~[spring-context-6.2.3.jar:6.2.3]\n    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.4.3.jar:3.4.3]\n    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752) ~[spring-boot-3.4.3.jar:3.4.3]\n    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439) ~[spring-boot-3.4.3.jar:3.4.3]\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:318) ~[spring-boot-3.4.3.jar:3.4.3]\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1361) ~[spring-boot-3.4.3.jar:3.4.3]\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1350) ~[spring-boot-3.4.3.jar:3.4.3]\n    at com.cloakstudio.apiwyldernews.ApiwyldernewsApplication.main(ApiwyldernewsApplication.java:10) ~[classes/:na]\nCaused by: org.springframework.orm.ObjectOptimisticLockingFailureException: Row was updated or deleted by another transaction (or unsaved-value mapping was incorrect): [com.cloakstudio.apiwyldernews.model.News#1]\n    at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:325) ~[spring-orm-6.2.3.jar:6.2.3]\n    at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:244) ~[spring-orm-6.2.3.jar:6.2.3]\n    at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.translateExceptionIfPossible(AbstractEntityManagerFactoryBean.java:560) ~[spring-orm-6.2.3.jar:6.2.3]\n    at org.springframework.dao.support.ChainedPersistenceExceptionTranslator.translateExceptionIfPossible(ChainedPersistenceExceptionTranslator.java:61) ~[spring-tx-6.2.3.jar:6.2.3]\n    at org.springframework.dao.support.DataAccessUtils.translateIfNecessary(DataAccessUtils.java:343) ~[spring-tx-6.2.3.jar:6.2.3]\n    at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:160) ~[spring-tx-6.2.3.jar:6.2.3]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.3.jar:6.2.3]\n    at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:165) ~[spring-data-jpa-3.4.3.jar:3.4.3]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.3.jar:6.2.3]\n    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223) ~[spring-aop-6.2.3.jar:6.2.3]\n    at jdk.proxy2/jdk.proxy2.$Proxy144.save(Unknown Source) ~[na:na]\n    at com.cloakstudio.apiwyldernews.loader.InitialDataSetupService.setupNews(InitialDataSetupService.java:27) ~[classes/:na]\n    at com.cloakstudio.apiwyldernews.loader.InitialDataSetup.setupInitialData(InitialDataSetup.java:35) ~[classes/:na]\n    at com.cloakstudio.apiwyldernews.loader.InitialDataSetup.setupData(InitialDataSetup.java:22) ~[classes/:na]\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]\n    at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMethod.invoke(InitDestroyAnnotationBeanPostProcessor.java:457) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMetadata.invokeInitMethods(InitDestroyAnnotationBeanPostProcessor.java:401) ~[spring-beans-6.2.3.jar:6.2.3]\n    at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:219) ~[spring-beans-6.2.3.jar:6.2.3]\n    ... 20 common frames omitted\nCaused by: org.hibernate.StaleObjectStateException: Row was updated or deleted by another transaction (or unsaved-value mapping was incorrect): [com.cloakstudio.apiwyldernews.model.News#1]\n    at org.hibernate.event.internal.DefaultMergeEventListener.entityIsDetached(DefaultMergeEventListener.java:426) ~[hibernate-core-6.6.8.Final.jar:6.6.8.Final]\n    at org.hibernate.event.internal.DefaultMergeEventListener.merge(DefaultMergeEventListener.java:214) ~[hibernate-core-6.6.8.Final.jar:6.6.8.Final]\n    at org.hibernate.event.internal.DefaultMergeEventListener.doMerge(DefaultMergeEventListener.java:152) ~[hibernate-core-6.6.8.Final.jar:6.6.8.Final]\n    at org.hibernate.event.internal.DefaultMergeEventListener.onMerge(DefaultMergeEventListener.java:136) ~[hibernate-core-6.6.8.Final.jar:6.6.8.Final]\n    at org.hibernate.event.internal.DefaultMergeEventListener.onMerge(DefaultMergeEventListener.java:89) ~[hibernate-core-6.6.8.Final.jar:6.6.8.Final]\n    at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:127) ~[hibernate-core-6.6.8.Final.jar:6.6.8.Final]\n    at org.hibernate.internal.SessionImpl.fireMerge(SessionImpl.java:854) ~[hibernate-core-6.6.8.Final.jar:6.6.8.Final]\n    at org.hibernate.internal.SessionImpl.merge(SessionImpl.java:840) ~[hibernate-core-6.6.8.Final.jar:6.6.8.Final]\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]\n    at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:320) ~[spring-orm-6.2.3.jar:6.2.3]\n    at jdk.proxy2/jdk.proxy2.$Proxy141.merge(Unknown Source) ~[na:na]\n    at org.springframework.data.jpa.repository.support.SimpleJpaRepository.save(SimpleJpaRepository.java:639) ~[spring-data-jpa-3.4.3.jar:3.4.3]\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]\n    at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:359) ~[spring-aop-6.2.3.jar:6.2.3]\n    at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277) ~[spring-data-commons-3.4.3.jar:3.4.3]\n    at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170) ~[spring-data-commons-3.4.3.jar:3.4.3]\n    at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158) ~[spring-data-commons-3.4.3.jar:3.4.3]\n    at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:515) ~[spring-data-commons-3.4.3.jar:3.4.3]\n    at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:284) ~[spring-data-commons-3.4.3.jar:3.4.3]\n    at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:752) ~[spring-data-commons-3.4.3.jar:3.4.3]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.3.jar:6.2.3]\n    at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:174) ~[spring-data-commons-3.4.3.jar:3.4.3]\n    at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:149) ~[spring-data-commons-3.4.3.jar:3.4.3]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.3.jar:6.2.3]\n    at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:69) ~[spring-data-commons-3.4.3.jar:3.4.3]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.3.jar:6.2.3]\n    at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.3.jar:6.2.3]\n    at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.3.jar:6.2.3]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.3.jar:6.2.3]\n    at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:138) ~[spring-tx-6.2.3.jar:6.2.3]\n    ... 33 common frames omitted\n\nDisconnected from the target VM, address: '127.0.0.1:59353', transport: 'socket'\n\nProcess finished with exit code 1\n</code></pre>\n<p>I'm using the following tutorial in order to load the csv <a href=\"https://www.baeldung.com/spring-app-setup-with-csv-files\" rel=\"nofollow noreferrer\">Baeldung tutorial</a></p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}