{
  "question": {
    "tags": [
      "java",
      "android",
      "oop",
      "memory",
      "crash"
    ],
    "owner": {
      "account_id": 12401738,
      "reputation": 3,
      "user_id": 9038668,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/-ZOLDQbJzI7A/AAAAAAAAAAI/AAAAAAAAABQ/9SZTrBiyLeU/s256-rj/photo.jpg",
      "display_name": "CodingHell2312x",
      "link": "https://stackoverflow.com/users/9038668/codinghell2312x"
    },
    "is_answered": true,
    "view_count": 484,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1727342553,
    "creation_date": 1704673342,
    "last_edit_date": 1704674607,
    "question_id": 77775508,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/77775508/android-app-crashes-on-image-selection-button-click",
    "title": "Android app crashes on image selection button click",
    "body": "<p>App crashes once Gallery/Camera buttons is clicked:</p>\n<pre><code>java.lang.RuntimeException: Could not copy bitmap to parcel blob.\n    at android.graphics.Bitmap.nativeWriteToParcel(Native Method)\n    at android.graphics.Bitmap.writeToParcel(Bitmap.java:2157)\n    at android.os.Parcel.writeParcelable(Parcel.java:2538)\n    at android.os.Parcel.writeValue(Parcel.java:2439)\n    at android.os.Parcel.writeValue(Parcel.java:2316)\n    at android.os.Parcel.writeArrayMapInternal(Parcel.java:1265)\n    at android.os.BaseBundle.writeToParcelInner(BaseBundle.java:1802)\n    at android.os.Bundle.writeToParcel(Bundle.java:1362)\n    at android.os.Parcel.writeBundle(Parcel.java:1334)\n    at android.os.Parcel.writeValue(Parcel.java:2433)\n    at android.os.Parcel.writeValue(Parcel.java:2323)\n    at android.os.Parcel.writeSparseArray(Parcel.java:1422)\n    at android.os.Parcel.writeValue(Parcel.java:2463)\n    at android.os.Parcel.writeValue(Parcel.java:2316)\n    at android.os.Parcel.writeArrayMapInternal(Parcel.java:1265)\n    at android.os.BaseBundle.writeToParcelInner(BaseBundle.java:1802)\n    at android.os.Bundle.writeToParcel(Bundle.java:1362)\n    at android.os.Parcel.writeBundle(Parcel.java:1334)\n    at android.os.Parcel.writeValue(Parcel.java:2433)\n    at android.os.Parcel.writeValue(Parcel.java:2323)\n    at android.os.Parcel.writeArrayMapInternal(Parcel.java:1265)\n    at android.os.BaseBundle.writeToParcelInner(BaseBundle.java:1802)\n    at android.os.Bundle.writeToParcel(Bundle.java:1362)\n    at android.os.Parcel.writeBundle(Parcel.java:1334)\n    at android.os.Parcel.writeValue(Parcel.java:2433)\n    at android.os.Parcel.writeValue(Parcel.java:2323)\n    at android.os.Parcel.writeArrayMapInternal(Parcel.java:1265)\n    at android.os.BaseBundle.writeToParcelInner(BaseBundle.java:1802)\n    at android.os.Bundle.writeToParcel(Bundle.java:1362)\n    at android.os.Parcel.writeBundle(Parcel.java:1334)\n    at android.os.Parcel.writeValue(Parcel.java:2433)\n    at android.os.Parcel.writeValue(Parcel.java:2323)\n    at android.os.Parcel.writeArrayMapInternal(Parcel.java:1265)\n    at android.os.BaseBundle.writeToParcelInner(BaseBundle.java:1802)\n    at android.os.Bundle.writeToParcel(Bundle.java:1362)\n    at android.os.Parcel.writeTypedObject(Parcel.java:2157)\n    at android.app.IActivityClientController$Stub$Proxy.activityStopped(IActivityClientController.java:1257)\n    at android.app.ActivityClient.activityStopped(ActivityClient.java:99)\n    at android.app.servertransaction.PendingTransactionActions$StopInfo.run(PendingTransactionActions.java:143)\n    at android.os.Handler.handleCallback(Handler.java:942)\n    at android.os.Handler.dispatchMessage(Handler.java:99)\n    at android.os.Looper.loopOnce(Looper.java:210)\n    at android.os.Looper.loop(Looper.java:299)\n    at android.app.ActivityThread.main(ActivityThread.java:8247)\n    at java.lang.reflect.Method.invoke(Native Method)\n    at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:559)\n    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:954)\n\n</code></pre>\n<p>My app basically gets user inputs(string/int values and multiple image Uri) and construct a Record instance, where this instance is 8 arguments, each argument is a different class type that has multiple attributes along with a unique image Uri array.\nUser input is divided to 3 phases, each phase happens in a different Fragment</p>\n<ol>\n<li>fragment1 takes 3 arguments (user inputs) Record(A,B,C)</li>\n<li>fragment2 takes 2 arguments Record(A,B,C,D) using setters of course, so far no crashes the log of record.tostring is populated as intended.</li>\n<li>fragment3 app crashes when any gallery/button is clicked\n<a href=\"https://i.sstatic.net/wsBjr.jpg\" rel=\"nofollow noreferrer\">Fragment3</a></li>\n</ol>\n<ul>\n<li>Memory usage is max 250mb which is fine?</li>\n<li>App doesn't crash on android emulator but tested multiple modern android devices and they all crashed</li>\n</ul>\n<pre><code>        if (result.getResultCode() == Activity.RESULT_OK) {\n            Intent data = result.getData();\n            if (data != null &amp;&amp; data.getExtras() != null) {\n                Bitmap imageBitmap = (Bitmap) data.getExtras().get(&quot;data&quot;);\n                if (imageBitmap != null) {\n                    Uri capturedImageUri = getImageUri(requireContext(), imageBitmap);\n                    handleGalleryOrCameraResult(capturedImageUri, requestCode);\n                } else {\n                    // Handle when the imageBitmap is null\n                }\n            }\n        }\n    }\n\n        private void handleGalleryOrCameraResult(Uri selectedImageUri,int requestCode) {\n        // Use the appropriate list based on the current scenario\n        List&lt;Uri&gt; imageList;\n        TextView imageCounter;\n        RecyclerView recyclerView;\n\n        // Determine the scenario based on your logic\n        // For example, you can use a flag to identify whether it's for container, lock, or item\n\n        switch (requestCode) {\n            case 7: // Container\n                imageList = DamageGoodImageUris;\n                imageCounter = DamageGoodImageCounter;\n                recyclerView = DamageGoodRecyclerView;\n                break;\n            case 8: // Lock\n                imageList = HeatImageUris;\n                imageCounter = HeatImageCounter;\n                recyclerView = HeatRecyclerView;\n                break;\n\n            default:\n                return;\n        }\n\n        // Add the selected image URI to the respective model's image list\n        if (selectedImageUri != null) {\n            imageList.add(selectedImageUri);\n        }\n\n        // Update the RecyclerView with the new image list\n        setupRecyclerView(recyclerView, imageList, imageCounter);\n    }\n        // Helper method to get Uri from Bitmap\n    private Uri getImageUri(Context context, Bitmap bitmap) {\n        ByteArrayOutputStream bytes = new ByteArrayOutputStream();\n        bitmap.compress(Bitmap.CompressFormat.JPEG, 100, bytes);\n        String path = MediaStore.Images.Media.insertImage(context.getContentResolver(), bitmap, &quot;Title&quot;, null);\n        return Uri.parse(path);\n    }\n</code></pre>\n<p>Viewmodel didn't work</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}