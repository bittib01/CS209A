{
  "question": {
    "tags": [
      "java",
      "vlc",
      "codec",
      "windows-11",
      "vlcj"
    ],
    "owner": {
      "account_id": 7241428,
      "reputation": 73,
      "user_id": 5524891,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/3027212953534c9c6f641b13dffd9f9e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Bate",
      "link": "https://stackoverflow.com/users/5524891/bate"
    },
    "is_answered": true,
    "view_count": 205,
    "accepted_answer_id": 79491654,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1741337072,
    "creation_date": 1736601212,
    "last_edit_date": 1741337072,
    "question_id": 79348154,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79348154/videoplayer-stop-causes-jvm-crash-under-windows-11-certain-video-codecs-only",
    "title": "videoplayer.stop() causes JVM crash under Windows 11 (certain video codecs only)",
    "body": "<p>After migrating my Java vlcj application to my new Windows 11 machine, the program crashes on calling <code>vlcjplayer.stop()</code>. I am using vlcj 4.8.2 in combination with VLC 3.0.21. I am shipping my own Oracle JRE, the version is 17.0.12.</p>\n<p>This is the relevant part of the code I am calling (where <code>stop()</code> is being called from a button <code>ActionListener</code> and <code>vlcPlayer</code> is of the type <code>EmbeddedMediaPlayer</code>):</p>\n<pre><code>public void stop() {\n    submit(() -&gt; vlcPlayer.stop());// new since vlcj-4: callback to VLC from a separate thread!\n}\n\npublic void submit (final Runnable runnable) {\n    vlcPlayer.submit(runnable);\n}\n</code></pre>\n<p><strong>Some side facts:</strong></p>\n<ol>\n<li>The exact same code is running fine on Windows 10! Same Java version, same VLC version, same version of vlcj, same build!</li>\n<li>The problem only occurs for certain videos encodings: <code>mp4</code>, <code>mkv</code>, ..., whereas older <code>mpeg2</code> videos do not cause the issue!</li>\n<li>When I play the problematic videos using the official vlcj test application, the crashes do not occur! I compared the respective code sections, but could not find a real difference in the way the stop method is being invoked</li>\n<li>The issue seems not to be connected to my specific personal system setup. It occurs on any Windows 11 machine I have run my application on so far</li>\n</ol>\n<p>The VLC logfile does not contain any errors. The process just crashes while logs are being written to it. I was searching the Windows event viewer for errors and I could find the respective error events. Here is how they look like (it's in German unfortunately):</p>\n<pre class=\"lang-none prettyprint-override\"><code>Fehlerhafter Anwendungsname: java.exe, Version: 17.0.12.0, Zeitstempel: 0x31da67d3\nFehlerhafter Modulname: libdirect3d11_filters_plugin.dll, Version: 3.0.21.0, Zeitstempel: 0x0075006c\nAusnahmecode: 0xc0000005\nFehleroffset: 0x000000000000155a\nFehlerhafte Prozess-ID: 0x1E5C\nFehlerhafte Anwendungsstartzeit: 0x1DB641EF886AD0F\nFehlerhafter Anwendungspfad: D:\\Java_Programme\\Jukebox\\jre-17.0.12\\bin\\java.exe\nFehlerhafter Modulpfad: C:\\Program Files\\VideoLAN\\VLC\\plugins\\d3d11\\libdirect3d11_filters_plugin.dll\nBerichts-ID: a6019a38-7882-422c-bafa-2b1fa2bd6f7c\nVollst√§ndiger Name des fehlerhaften Pakets: \nFehlerhafte paketbezogene Anwendungs-ID: \n</code></pre>\n<p>I have tried various things like setting the video output to <code>opengl</code> instead of <code>direct3d11</code>, and I have also changed the respective settings in native VLC, but with no effect. Somehow I cannot get my player to use another video output module. On the other hand, I would not want to force users to make manual changes to these kind of settings anyways. I am not into video codecs, the whole native library stuff and the depths of VLC at all. I have been struggling with this for a couple of days now and don't see what could be wrong.</p>\n<p>If the issue is with my Java code, then why does it run on my old Windows 10 machine and with older codecs? If the issue is with VLC and the installed codecs, then why does the crash not happen when I run the vlcj test application? I have installed the latest GPU drivers and I have a clean and fresh Windows 11 installation.</p>\n<p>I managed to capture a screenshot of an error message VLC logs to the console. (1) is where I call <code>vlcplayer.stop()</code>, (2) is when the vlcj event handler receives the <code>stopped()</code> event. In between the native VLC throws an error (that leads to the crash, obviously):</p>\n<p><a href=\"https://i.sstatic.net/fQ8xoH6t.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/fQ8xoH6t.png\" alt=\"enter image description here\" /></a></p>\n<p>Working code example:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import java.awt.BorderLayout;\nimport java.awt.Dimension;\nimport java.awt.event.ActionEvent;\nimport java.awt.event.ActionListener;\n\nimport javax.swing.JButton;\nimport javax.swing.JFileChooser;\nimport javax.swing.JFrame;\nimport javax.swing.JPanel;\nimport javax.swing.border.EtchedBorder;\n\nimport uk.co.caprica.vlcj.filefilters.swing.SwingFileFilterFactory;\nimport uk.co.caprica.vlcj.player.component.EmbeddedMediaPlayerComponent;\n\n/**\n * @author Oender\n */\npublic class VLCJTest extends JFrame {\n\n    private static final long serialVersionUID = 1L;\n    private EmbeddedMediaPlayerComponent playerComponent;\n    \n    /**\n     * Constructor\n     */\n    public VLCJTest() {\n\n        super.setTitle(&quot;VLCJ Test (fixed)&quot;);\n        super.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n\n        playerComponent = new EmbeddedMediaPlayerComponent();\n        initComponents();\n    }\n\n\n    /**\n     * Initialize &amp; arrange components\n     */\n    private void initComponents() {\n\n        final JPanel content = new JPanel (new BorderLayout());\n        content.setPreferredSize (new Dimension(400,300));\n        \n        final JPanel buttonPanel = new JPanel();\n        buttonPanel.setBorder(new EtchedBorder());\n        \n        final JButton openButton = new JButton(&quot;Open&quot;);\n        openButton.setFocusable(false);\n\n        final JButton stopButton = new JButton(&quot;Stop Video&quot;);\n        stopButton.setFocusable(false);\n\n        // attach ActionListener\n        openButton.setActionCommand(&quot;Open&quot;);\n        openButton.addActionListener(new ActionListener() { \n            public void actionPerformed (ActionEvent e) {\n                final JFileChooser chooser = new JFileChooser();\n                chooser.setFileFilter(SwingFileFilterFactory.newMediaFileFilter());\n                final int state = chooser.showOpenDialog(null);\n                if (state == JFileChooser.APPROVE_OPTION) {\n                    playerComponent.mediaPlayer().media().play(chooser.getSelectedFile().getPath());\n                }\n            }\n        });\n\n        // attach ActionListener\n        stopButton.setActionCommand(&quot;Stop&quot;);\n        stopButton.addActionListener(new ActionListener() {\n            public void actionPerformed (ActionEvent e) {\n                playerComponent.mediaPlayer().controls().stop();\n            }\n        });\n        \n        buttonPanel.add(openButton);\n        buttonPanel.add(stopButton);\n        \n        content.add(buttonPanel, BorderLayout.NORTH);\n        content.add(playerComponent, BorderLayout.CENTER);\n        \n        super.setContentPane(content);\n        super.pack();\n        super.setVisible(true);\n    }\n\n    /**\n     * @param args\n     */\n    public static void main (String[] args) {\n        new VLCJTest().setVisible(true);\n    }\n}\n\nCode example that causes the crash:\n\n```java\nimport java.awt.BorderLayout;\nimport java.awt.Canvas;\nimport java.awt.Dimension;\nimport java.awt.GridLayout;\nimport java.awt.event.ActionEvent;\nimport java.awt.event.ActionListener;\n\nimport javax.swing.JButton;\nimport javax.swing.JFileChooser;\nimport javax.swing.JFrame;\nimport javax.swing.JPanel;\nimport javax.swing.border.EtchedBorder;\n\nimport com.sun.jna.NativeLibrary;\n\nimport uk.co.caprica.vlcj.factory.MediaPlayerFactory;\nimport uk.co.caprica.vlcj.filefilters.swing.SwingFileFilterFactory;\n\nimport uk.co.caprica.vlcj.player.embedded.EmbeddedMediaPlayer;\nimport uk.co.caprica.vlcj.player.embedded.videosurface.ComponentVideoSurface;\n\n/**\n * @author Oender\n */\npublic class VLCJTest extends JFrame {\n\n    private static final long serialVersionUID = 1L;\n    private EmbeddedMediaPlayer player;\n    \n    /**\n     * Constructor\n     */\n    public VLCJTest() {\n\n        super.setTitle(&quot;VLCJ Test (crash)&quot;);\n        super.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n        final Canvas videoCanvas = new Canvas();\n\n        player = initPlayer(videoCanvas);\n        initComponents(videoCanvas);\n    }\n    \n\n    /**\n     * Initialize &amp; arrange components\n     * @param videoCanvas\n     */\n    private void initComponents (final Canvas videoCanvas) {\n\n        final JPanel content = new JPanel (new BorderLayout());\n        content.setPreferredSize (new Dimension(400,300));\n        \n        final JPanel buttonPanel = new JPanel();\n        buttonPanel.setBorder(new EtchedBorder());\n        \n        final JButton openButton = new JButton(&quot;Open&quot;);\n        openButton.setFocusable(false);\n\n        final JButton stopButton = new JButton(&quot;Stop Video&quot;);\n        stopButton.setFocusable(false);\n\n        // attach ActionListener\n        openButton.setActionCommand(&quot;Open&quot;);\n        openButton.addActionListener(new ActionListener() { \n            public void actionPerformed (ActionEvent e) {\n                final JFileChooser chooser = new JFileChooser();\n                chooser.setFileFilter(SwingFileFilterFactory.newMediaFileFilter());\n                final int state = chooser.showOpenDialog(null);\n                if (state == JFileChooser.APPROVE_OPTION) {\n                    player.media().play(chooser.getSelectedFile().getPath());\n                }\n            }\n        });\n\n        // attach ActionListener\n        stopButton.setActionCommand(&quot;Stop&quot;);\n        stopButton.addActionListener(new ActionListener() {\n            public void actionPerformed (ActionEvent e) {\n                player.controls().stop();\n            }\n        });\n        \n        buttonPanel.add(openButton);\n        buttonPanel.add(stopButton);\n\n        content.add(buttonPanel, BorderLayout.NORTH);\n        content.add(videoCanvas, BorderLayout.CENTER);\n        \n        super.setContentPane(content);\n        super.pack();\n        super.setVisible(true);\n    }\n\n    /**\n     * create the EmbeddedMediaPlayer\n     * @param canvas\n     * @return\n     */\n    private EmbeddedMediaPlayer initPlayer (final Canvas canvas) {\n\n        final MediaPlayerFactory factory = new MediaPlayerFactory();\n        final ComponentVideoSurface videoSurface = factory.videoSurfaces().newVideoSurface(canvas);\n\n        final EmbeddedMediaPlayer mPlayer = factory.mediaPlayers().newEmbeddedMediaPlayer();\n        mPlayer.videoSurface().set(videoSurface);\n        mPlayer.video().setAdjustVideo(true);\n        return mPlayer;\n    }\n\n    /**\n     * @param args\n     */\n    public static void main (String[] args) {\n        \n        NativeLibrary.addSearchPath(&quot;libvlc&quot;, &quot;C:\\\\Program Files\\\\VideoLAN\\\\VLC&quot;);\n        new VLCJTest().setVisible(true);\n    }\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}