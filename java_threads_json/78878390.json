{
  "question": {
    "tags": [
      "java",
      "session",
      "open-liberty",
      "jboss-weld",
      "weld-se"
    ],
    "owner": {
      "account_id": 11721897,
      "reputation": 65,
      "user_id": 8580602,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/d19abd77fe1312f3b58432dc3a43230d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Mark Hunt",
      "link": "https://stackoverflow.com/users/8580602/mark-hunt"
    },
    "is_answered": true,
    "view_count": 149,
    "accepted_answer_id": 78887847,
    "answer_count": 1,
    "score": 3,
    "last_activity_date": 1726744441,
    "creation_date": 1723799371,
    "last_edit_date": 1724049611,
    "question_id": 78878390,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78878390/openliberty-database-session-replication-org-jboss-weld-module-web-httpsession",
    "title": "OpenLiberty Database Session Replication - org.jboss.weld.module.web.HttpSessionBean$SerializableProxy - ClassNotFoundException",
    "body": "<p>I'm using OpenLiberty 24.0.0.6 configured with session replication. The application uses JSF with PrimeFaces. Some of my business objects are store in the HTTP session (via. @SessionScoped annotation of the CDI package).</p>\n<p>When the session is deserialized I get the following error (taken from the ffdc log):</p>\n<pre><code>Exception = java.lang.ClassNotFoundException\nSource = com.ibm.ws.session.SessionLoader.loadObject\nprobeid = 82\nStack Dump = java.lang.ClassNotFoundException: org.jboss.weld.module.web.HttpSessionBean$SerializableProxy\n    at com.ibm.ws.classloading.internal.UnifiedClassLoader.findClass(UnifiedClassLoader.java:167)\n    at com.ibm.ws.classloading.internal.ThreadContextClassLoader.findClass(ThreadContextClassLoader.java:145)\n    at com.ibm.ws.classloading.internal.UnifiedClassLoader.loadClass0(UnifiedClassLoader.java:141)\n    at com.ibm.ws.classloading.internal.UnifiedClassLoader$Delegation.loadClass(UnifiedClassLoader.java:87)\n    at com.ibm.ws.classloading.internal.UnifiedClassLoader.loadClass(UnifiedClassLoader.java:106)\n    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:527)\n    at com.ibm.ws.serialization.DeserializationObjectInputStream.loadClass(DeserializationObjectInputStream.java:64)\n    at com.ibm.ws.serialization.internal.DeserializationObjectInputStreamImpl.loadClass(DeserializationObjectInputStreamImpl.java:50)\n    at com.ibm.ws.serialization.DeserializationObjectInputStream.resolveClass(DeserializationObjectInputStream.java:135)\n    at com.ibm.ws.serialization.DeserializationObjectInputStream.resolveClass(DeserializationObjectInputStream.java:173)\n    at java.base/java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:2003)\n    at java.base/java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1870)\n    at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2201)\n    at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1687)\n    at java.base/java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2496)\n    at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2390)\n    at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2228)\n    at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1687)\n    at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:489)\n    at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:447)\n    at java.base/java.util.Hashtable.readHashtable(Hashtable.java:1315)\n    at java.base/java.util.Hashtable.readObject(Hashtable.java:1259)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:566)\n    at java.base/java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1046)\n    at java.base/java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2357)\n    at java.base/java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2228)\n    at java.base/java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1687)\n    at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:489)\n    at java.base/java.io.ObjectInputStream.readObject(ObjectInputStream.java:447)\n    at com.ibm.ws.session.utils.SessionLoader.loadObject(SessionLoader.java:64)\n    at com.ibm.ws.session.store.db.DatabaseHashMap.getValue(DatabaseHashMap.java:1615)\n</code></pre>\n<p>The server is responding:</p>\n<pre><code>[15.08.24, 16:03:13:605 MESZ] 0000007c com.ibm.ws.session.WASSession                                E SESN0051E: Attempting to deserialize a session object from the backend resulted in a ClassNotFoundException..\n[15.08.24, 16:03:13:605 MESZ] 0000007c com.ibm.ws.session.WASSession                                E ID: n3KSj82AVIMrmIK9ZH8A0WH\n[15.08.24, 16:03:13:605 MESZ] 0000007c com.ibm.ws.session.WASSession                                E Exception: \njava.lang.ClassNotFoundException: org.jboss.weld.module.web.HttpSessionBean$SerializableProxy\n</code></pre>\n<p>My configuration in the OL:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;server&gt;\n    &lt;!-- https://openliberty.io/docs/latest/create-session-table.html --&gt;\n    &lt;library id=&quot;SessionDriverLib&quot;&gt;\n        &lt;fileset dir=&quot;${shared.resource.dir}/session&quot; includes=&quot;*.jar&quot;/&gt;\n    &lt;/library&gt;\n\n    &lt;dataSource id=&quot;SessionDS&quot;&gt;\n        &lt;jdbcDriver libraryRef=&quot;SessionDriverLib&quot; /&gt;\n        &lt;properties.postgresql serverName=&quot;${postgres_server}&quot;\n                               portNumber=&quot;5432&quot;\n                               databaseName=&quot;httpSession&quot;\n                               user=&quot;session_user&quot;\n                               password=&quot;***&quot;/&gt;\n    &lt;/dataSource&gt;\n\n    &lt;httpSessionDatabase\n            id=&quot;SessionDB&quot;\n            dataSourceRef=&quot;SessionDS&quot;\n            tableName=&quot;sessions&quot;/&gt;\n    &lt;httpSession storageRef=&quot;SessionDB&quot; cloneId=&quot;${clone_id}&quot;/&gt;\n\n&lt;/server&gt;\n</code></pre>\n<p>And we are using the following features:</p>\n<pre><code>  &lt;featureManager&gt;\n    &lt;feature&gt;javaee-8.0&lt;/feature&gt;\n    &lt;feature&gt;microProfile-3.3&lt;/feature&gt;\n    &lt;feature&gt;monitor-1.0&lt;/feature&gt;\n    &lt;feature&gt;sessionDatabase-1.0&lt;/feature&gt;\n  &lt;/featureManager&gt;\n</code></pre>\n<p>I logged out the content of the HTTP session and I was wondering that a WELD proxy is part of the session:</p>\n<pre><code>attribute name: \nWELD_S#F_WELD%AbstractBuiltInBean%web_war_exploded#twl-web%HttpSession\n\nattribute value (from toString())\nBean: ForwardingBean null for WELD%AbstractBuiltInBean%web_war_exploded#web%HttpSession; Instance: org.jboss.weld.module.web.HttpSessionBean$SerializableProxy@1bbaee59; CreationalContext: org.jboss.weld.contexts.CreationalContextImpl@27396b8a\n</code></pre>\n<p>I have no idea, why WELD is storing such a proxy class in the session.\nBtw. some content is stored in the database.</p>\n<p>All the objects stored in the HTTP session are serializable. If not I think I would get an NotSerializableExcpeption (which is not in the logs or traces)</p>\n<p>I was looking for the serialized data in the database and found the proxy class.</p>\n<p>There are no WELD dependencies in the application (meaning the application war). The classpath look ok to me.</p>\n<p>If you need more information, let me know.</p>\n<p>Any ideas are welcome. :-)</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}