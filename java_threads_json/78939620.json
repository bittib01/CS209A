{
  "question": {
    "tags": [
      "java",
      "apache-kafka",
      "apache-kafka-streams"
    ],
    "owner": {
      "account_id": 31152726,
      "reputation": 1,
      "user_id": 24083755,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/1ee540938fcc211684daf7e54cac0244?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Yoni Weisberg",
      "link": "https://stackoverflow.com/users/24083755/yoni-weisberg"
    },
    "is_answered": false,
    "view_count": 64,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1735498584,
    "creation_date": 1725266923,
    "question_id": 78939620,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78939620/in-kafka-streams-kgroupedtable-aggregate-should-the-adder-and-subtractor-return",
    "title": "In Kafka Streams KGroupedTable.aggregate, should the adder and subtractor return a new immutable aggregator on every call?",
    "body": "<p>I want to aggregate KTable entries to a Map of Sets (e.g. <code>Map&lt;Set&lt;String&gt;&gt;</code>), so in the aggregate function I need to provide <code>adder</code> and <code>subtractor</code>, which look like this:</p>\n<pre><code>(key, value, map) -&gt; {\n  map.computeIfAbsent(key, k -&gt; new HashSet&lt;&gt;()).add(value);\n  return map;\n},\n(key, value, map) -&gt; {\n  map.computeIfAbsent(key, k -&gt; new HashSet&lt;&gt;()).remove(value)\n  return map;\n}\n</code></pre>\n<p>My question is: Is it OK to return the map as is, or should the aggregator be an immutable object, which force me to deep clone the entire map of sets on every call?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}