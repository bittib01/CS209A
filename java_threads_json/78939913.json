{
  "question": {
    "tags": [
      "java",
      "android",
      "logging",
      "log4j"
    ],
    "owner": {
      "account_id": 8460842,
      "reputation": 674,
      "user_id": 6346653,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/PZC16.jpg?s=256",
      "display_name": "nick_j_white",
      "link": "https://stackoverflow.com/users/6346653/nick-j-white"
    },
    "is_answered": true,
    "view_count": 178,
    "accepted_answer_id": 78997163,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1728375986,
    "creation_date": 1725271474,
    "last_edit_date": 1728375986,
    "question_id": 78939913,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78939913/android-log4j-logging-from-compiled-dependency-not-working",
    "title": "Android log4j logging from compiled dependency not working",
    "body": "<p>I am building a java class which will include various logging statements, and wish to compile this into a dependency which will be used by an Android application\n(and separately in standalone java/desktop applications)</p>\n<p>The class looks like this:</p>\n<pre><code>package com.example.shared;\n\nimport org.apache.logging.log4j.LogManager;\nimport org.apache.logging.log4j.Logger;\n\npublic class ExampleClass {\n\n    public static Logger logger = LogManager.getLogger(ExampleClass.class);\n    \n    public ExampleClass(){}\n    \n    public void printMessages(){\n        logger.error(&quot;This is an error message from ExampleClass!&quot;);\n        logger.warn(&quot;This is a warn message from ExampleClass!&quot;);\n        logger.info(&quot;This is an info message from ExampleClass!&quot;);\n        logger.debug(&quot;This is a debug message from ExampleClass!&quot;);\n        logger.trace(&quot;This is a trace message from ExampleClass!&quot;);\n    }\n}\n</code></pre>\n<p>The dependency will be compiled with maven, with pom.xml as follows:</p>\n<pre><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;com.example&lt;/groupId&gt;\n    &lt;artifactId&gt;shared&lt;/artifactId&gt;\n    &lt;version&gt;1.0.0&lt;/version&gt;\n    &lt;name&gt;Shared&lt;/name&gt;\n    \n    &lt;properties&gt;\n        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;\n        &lt;java.version&gt;1.8&lt;/java.version&gt;\n    &lt;/properties&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n          &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n          &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;\n          &lt;version&gt;2.20.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n          &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;\n          &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;\n          &lt;version&gt;2.20.0&lt;/version&gt;\n        &lt;/dependency&gt;\n  &lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre>\n<p>To use this in my android project, I have enabled local maven repositories and imported the artefact along with log4j api/core and an android runtime implementation:</p>\n<p>app/build.gradle</p>\n<pre><code>plugins {\n    id 'com.android.application'\n}\n\nandroid {\n    compileSdk 34\n    buildToolsVersion &quot;30.0.3&quot;\n\n    defaultConfig {\n        applicationId &quot;com.example.android&quot;\n        minSdk 26\n        targetSdk 34\n        versionCode 1\n        versionName &quot;1.0&quot;\n\n        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n\n    packagingOptions {\n        resources.excludes.add(&quot;META-INF/*&quot;)\n        resources.excludes.add(&quot;serviceAccountKey*.json&quot;)\n    }\n}\n\ndependencies {\n\n    implementation 'androidx.appcompat:appcompat:1.6.1'\n    implementation 'com.google.android.material:material:1.12.0'\n    implementation 'androidx.constraintlayout:constraintlayout:2.1.4'\n\n    implementation 'com.example:shared:1.0.0'\n\n    implementation 'org.apache.logging.log4j:log4j-api:2.20.0'\n    implementation 'org.apache.logging.log4j:log4j-core:2.20.0'\n    runtimeOnly 'com.celeral:log4j2-android:1.0.0'\n}\n</code></pre>\n<p>The log4j configuration I am trying to use (which should only print INFO lines) is provided in app/src/main/assets/log4j2.xml:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Configuration status=&quot;INFO&quot;&gt;\n    &lt;Appenders&gt;\n        &lt;Console name=&quot;console&quot; target=&quot;SYSTEM_OUT&quot;&gt;\n            &lt;PatternLayout pattern=&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n&quot; /&gt;\n        &lt;/Console&gt;\n    &lt;/Appenders&gt;\n\n    &lt;Loggers&gt;\n        &lt;Root level=&quot;INFO&quot;&gt;\n            &lt;AppenderRef ref=&quot;console&quot; /&gt;\n        &lt;/Root&gt;\n    &lt;/Loggers&gt;\n&lt;/Configuration&gt;\n</code></pre>\n<p>My android application main activity is setup as below:</p>\n<pre><code>package com.example.android;\n\nimport androidx.appcompat.app.AppCompatActivity;\n\nimport android.os.Bundle;\n\nimport org.apache.logging.log4j.Logger;\nimport org.apache.logging.log4j.LogManager;\n\nimport com.example.shared.ExampleClass;\n\npublic class MainActivity extends AppCompatActivity {\n\n    public static Logger logger = LogManager.getLogger(MainActivity.class);\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        //Test logging from dependency\n        ExampleClass ec = new ExampleClass();\n        ec.printMessages();\n    }\n}\n</code></pre>\n<p>However, when I attempt to run my application and test the logging statements, the configuration is ignored and all logging levels are printed:</p>\n<pre><code>E/ExampleClass: This is an error message from ExampleClass!\nW/ExampleClass: This is a warn message from ExampleClass!\nI/ExampleClass: This is an info message from ExampleClass!\nD/ExampleClass: This is a debug message from ExampleClass!\nV/ExampleClass: This is a trace message from ExampleClass!\n</code></pre>\n<p>But if I remove <code>runtimeOnly 'com.celeral:log4j2-android:1.0.0'</code> from app/build.gradle, I am met with the error below:</p>\n<pre><code>W/System.err: ERROR StatusLogger Unable to load services for service class org.apache.logging.log4j.spi.Provider\nW/System.err:  java.lang.NoSuchMethodError: No static method metafactory(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite; in class Ljava/lang/invoke/LambdaMetafactory; or its super classes (declaration of 'java.lang.invoke.LambdaMetafactory' appears in /apex/com.android.art/javalib/core-oj.jar)\nW/System.err:     at org.apache.logging.log4j.util.ServiceLoaderUtil.callServiceLoader(ServiceLoaderUtil.java:110)\nW/System.err:     at org.apache.logging.log4j.util.ServiceLoaderUtil$ServiceLoaderSpliterator.&lt;init&gt;(ServiceLoaderUtil.java:146)\nW/System.err:     at org.apache.logging.log4j.util.ServiceLoaderUtil.loadClassloaderServices(ServiceLoaderUtil.java:101)\nW/System.err:     at org.apache.logging.log4j.util.ServiceLoaderUtil.loadServices(ServiceLoaderUtil.java:83)\nW/System.err:     at org.apache.logging.log4j.util.ServiceLoaderUtil.loadServices(ServiceLoaderUtil.java:77)\nW/System.err:     at org.apache.logging.log4j.util.ProviderUtil.&lt;init&gt;(ProviderUtil.java:67)\nW/System.err:     at org.apache.logging.log4j.util.ProviderUtil.lazyInit(ProviderUtil.java:145)\nW/System.err:     at org.apache.logging.log4j.util.ProviderUtil.hasProviders(ProviderUtil.java:129)\nW/System.err:     at org.apache.logging.log4j.LogManager.&lt;clinit&gt;(LogManager.java:90)\nW/System.err:     at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:598)\nW/System.err:     at com.example.android.MainActivity.&lt;clinit&gt;(MainActivity.java:14)\nW/System.err:     at java.lang.Class.newInstance(Native Method)\nW/System.err:     at android.app.AppComponentFactory.instantiateActivity(AppComponentFactory.java:95)\nW/System.err:     at androidx.core.app.CoreComponentFactory.instantiateActivity(CoreComponentFactory.java:44)\nW/System.err:     at android.app.Instrumentation.newActivity(Instrumentation.java:1253)\nW/System.err:     at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3353)\nW/System.err:     at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3601)\nW/System.err:     at android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:85)\nW/System.err:     at android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:135)\nW/System.err:     at android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:95)\nW/System.err:     at android.app.ActivityThread$H.handleMessage(ActivityThread.java:2066)\nW/System.err:     at android.os.Handler.dispatchMessage(Handler.java:106)\nW/System.err:     at android.os.Looper.loop(Looper.java:223)\nW/System.err:     at android.app.ActivityThread.main(ActivityThread.java:7656)\nW/System.err:     at java.lang.reflect.Method.invoke(Native Method)\nW/System.err:     at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\nW/System.err:     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\n</code></pre>\n<p>Although I do get the error line printed:</p>\n<pre><code>W/System.err: ERROR ExampleClass This is an error message from ExampleClass!\n</code></pre>\n<p>Why does this not work as required?</p>\n<p>Update 1: Someone has voted to close this as &quot;Needs more focus&quot;. There is only one problem requiring an answer - I have amended the last statement to reflect this,</p>\n<p>Final edit:</p>\n<p>After the update to log4j v2.24.1 (and the removal of celeral log4j2-android runtime dependency) it is clearer now what has been happening.</p>\n<p>Log4j has been unable to find/resolve the configuration provided in the assets directory, and thus no loggers are defined. By default, the loggers I attempt to use are set to Level.ERROR, hence why the single error line:</p>\n<pre><code>W/System.err: ERROR ExampleClass This is an error message from ExampleClass!\n</code></pre>\n<p>was still being logged. The previous log4j-android, when in use, would simply forward everything to android Log class, which logs all levels in the console (not what I wanted).</p>\n<p>The issue I am left trying to resolve is why the configuration won't load</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}