{
  "question": {
    "tags": [
      "java",
      "performance",
      "garbage-collection"
    ],
    "owner": {
      "account_id": 34183435,
      "reputation": 11,
      "user_id": 26430249,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/8e897e867043169eb87a534c4906e02b?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Sankareswari M",
      "link": "https://stackoverflow.com/users/26430249/sankareswari-m"
    },
    "is_answered": false,
    "view_count": 59,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1729024894,
    "creation_date": 1721378857,
    "question_id": 78768408,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78768408/how-to-tune-gc-for-applications-maintaining-large-amount-of-cache-data",
    "title": "How to Tune GC for applications maintaining large amount of cache data?",
    "body": "<p>We are running Spring boot restapi application in Production. Suddenly process is not accepting any requests and we couldn't see logs also. Process got hung. We are using G1GC .We are maintaining internal cache using Concurrenthashmap .We feel that Cache might took lot of heap space. We don't want to delete data in Cache and at the same time I want to tune GC.</p>\n<p>Please find the VM arguments below :\n-Xms5000m -Xmx8000m -Xss300m -XX:MetaspaceSize=1000M -XX:MaxMetaspaceSize=1000M -XX:G1HeapRegionSize=1000M -XX:+UseG1GC -XX:-DisableExplicitGC -verbose:gc -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintGCDetails -XX:+PrintAdaptiveSizePolicy -Xloggc:HOME/logs/GC.log</p>\n<p>We can increase the heap size but the data will be added into the cache at the runtime . So increasing heapsize might not be a permenant solution.</p>\n<p>please find GC logs snippets here. This is what we could found in GClogs when the process hung.</p>\n<pre><code>393875.584: [G1Ergonomics (Concurrent Cycles) initiate concurrent cycle, reason: concurrent cycle initiation requested]\n2024-06-18T15:45:22.390+0200: 393875.584: [GC pause (G1 Evacuation Pause) (young) (initial-mark) 393875.584: [G1Ergonomics (CSet Construction) start choosing CSet, _pending_cards: 0, predicted base time: 5.59 ms, remaining time: 194.41 ms, target pause time: 200.00 ms]\n 393875.584: [G1Ergonomics (CSet Construction) add young regions to CSet, eden: 0 regions, survivors: 0 regions, predicted young region time: 0.00 ms]\n 393875.584: [G1Ergonomics (CSet Construction) finish choosing CSet, eden: 0 regions, survivors: 0 regions, old: 0 regions, predicted pause time: 5.59 ms, target pause time: 200.00 ms]\n 393875.590: [G1Ergonomics (Heap Sizing) attempt heap expansion, reason: recent GC overhead higher than threshold after GC, recent GC overhead: 99.98 %, threshold: 10.00 %, uncommitted: 0 bytes, calculated expansion amount: 0 bytes (20.00 %)]\n, 0.0058720 secs]\n   [Parallel Time: 5.3 ms, GC Workers: 8]\n      [GC Worker Start (ms): Min: 393875584.5, Avg: 393875584.6, Max: 393875584.6, Diff: 0.1]\n      [Ext Root Scanning (ms): Min: 4.5, Avg: 4.7, Max: 4.8, Diff: 0.2, Sum: 37.2]\n      [Update RS (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0]\n         [Processed Buffers: Min: 0, Avg: 0.1, Max: 1, Diff: 1, Sum: 1]\n      [Scan RS (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0]\n      [Code Root Scanning (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0]\n      [Object Copy (ms): Min: 0.2, Avg: 0.2, Max: 0.3, Diff: 0.1, Sum: 1.8]\n      [Termination (ms): Min: 0.0, Avg: 0.2, Max: 0.2, Diff: 0.2, Sum: 1.5]\n         [Termination Attempts: Min: 1, Avg: 1.0, Max: 1, Diff: 0, Sum: 8]\n      [GC Worker Other (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0]\n      [GC Worker Total (ms): Min: 5.0, Avg: 5.1, Max: 5.1, Diff: 0.1, Sum: 40.5]\n      [GC Worker End (ms): Min: 393875589.6, Avg: 393875589.6, Max: 393875589.6, Diff: 0.1]\n   [Code Root Fixup: 0.0 ms]\n   [Code Root Purge: 0.0 ms]\n   [Clear CT: 0.1 ms]\n   [Other: 0.5 ms]\n      [Choose CSet: 0.0 ms]\n      [Ref Proc: 0.2 ms]\n      [Ref Enq: 0.0 ms]\n      [Redirty Cards: 0.1 ms]\n      [Humongous Register: 0.0 ms]\n      [Humongous Reclaim: 0.0 ms]\n      [Free CSet: 0.0 ms]\n   [Eden: 0.0B(384.0M)-&gt;0.0B(384.0M) Survivors: 0.0B-&gt;0.0B Heap: 7937.7M(8000.0M)-&gt;7937.7M(8000.0M)]\n [Times: user=0.02 sys=0.00, real=0.01 secs] \n2024-06-18T15:45:22.396+0200: 393875.590: [GC concurrent-root-region-scan-start]\n2024-06-18T15:45:22.396+0200: 393875.590: [GC concurrent-root-region-scan-end, 0.0000293 secs]\n2024-06-18T15:45:22.396+0200: 393875.590: [GC concurrent-mark-start]\n 393875.591: [G1Ergonomics (Heap Sizing) attempt heap expansion, reason: allocation request failed, allocation request: 24 bytes]\n 393875.591: [G1Ergonomics (Heap Sizing) expand the heap, requested expansion amount: 33554432 bytes, attempted expansion amount: 33554432 bytes]\n 393875.591: [G1Ergonomics (Heap Sizing) did not expand the heap, reason: heap already fully expanded]\n2024-06-18T15:45:22.397+0200: 393875.591: [Full GC (Allocation Failure) \n</code></pre>\n<p>I want to fix this GC issue.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}