{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "log4j2"
    ],
    "owner": {
      "account_id": 111627,
      "reputation": 351,
      "user_id": 294792,
      "user_type": "registered",
      "accept_rate": 86,
      "profile_image": "https://www.gravatar.com/avatar/3bd1110483f64ce5b79e025f3f057059?s=256&d=identicon&r=PG",
      "display_name": "Striker",
      "link": "https://stackoverflow.com/users/294792/striker"
    },
    "is_answered": true,
    "view_count": 109,
    "accepted_answer_id": 79850726,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1766320759,
    "creation_date": 1766082122,
    "last_edit_date": 1766320759,
    "question_id": 79850596,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79850596/spring-boot-and-log4j-database-appender-problems",
    "title": "Spring Boot and Log4J database appender problems",
    "body": "<p>We have a situation where we need to write the logs from an app running in multiple pods on an OpenShift project to the database so I slapped together a quick database logging POC with log4j2, and got it working. They won't let me setup any type of log aggregation like ELK or Graylog so this is what I need to do, and it works surprisingly well....kind of, until I needed to use Spring Boot.</p>\n<p><strong>log4j2.xml:</strong></p>\n<pre><code>&lt;Configuration status=&quot;debug&quot;&gt;\n    &lt;Appenders&gt;\n        &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;\n            &lt;PatternLayout pattern=&quot;%d{yyyy-MM-dd HH:mm:ss.SS} %p %c.%M:%L - %m%n&quot; /&gt;\n        &lt;/Console&gt;\n        &lt;JDBC name=&quot;Database&quot; tableName=&quot;CSPI_LOGS&quot; bufferSize=&quot;100&quot;&gt;\n            &lt;ConnectionFactory class=&quot;com.cspi.ConnectionFactory&quot; method=&quot;getDatabaseConnection&quot;/&gt;\n            &lt;Column name=&quot;SERVER&quot; literal=&quot;'${sys:jvm.name}'&quot; /&gt;\n            &lt;Column name=&quot;FACILITY&quot; pattern=&quot;%marker&quot; /&gt;\n            &lt;Column name=&quot;LOG_TIME&quot; isEventTimestamp=&quot;true&quot; /&gt;\n            &lt;Column name=&quot;LOG_LEVEL&quot; pattern=&quot;%level&quot; /&gt;\n            &lt;Column name=&quot;CODE_LOC&quot; pattern=&quot;%c.%M:%L&quot; /&gt;\n            &lt;Column name=&quot;THREAD&quot; pattern=&quot;[%t:%tid]&quot;/&gt;\n            &lt;Column name=&quot;MESSAGE&quot; pattern=&quot;%message&quot; /&gt;\n            &lt;Column name=&quot;EXCEPTION&quot; pattern=&quot;%ex{full}&quot; /&gt;\n        &lt;/JDBC&gt;\n    &lt;/Appenders&gt;\n    &lt;Loggers&gt;\n        &lt;root level=&quot;error&quot;&gt;\n            &lt;AppenderRef ref=&quot;Console&quot;/&gt;\n        &lt;/root&gt;\n        &lt;logger name=&quot;org&quot; level=&quot;warn&quot; additivity=&quot;false&quot;&gt;&lt;/logger&gt;\n        &lt;Logger name=&quot;com.cspi&quot; level=&quot;debug&quot; additivity=&quot;false&quot;&gt;\n            &lt;AppenderRef ref=&quot;Database&quot;/&gt;\n            &lt;AppenderRef ref=&quot;Console&quot;/&gt;\n        &lt;/Logger&gt;\n    &lt;/Loggers&gt;\n&lt;/Configuration&gt; \n</code></pre>\n<p>Spring Boot app has been problematic, I've excluded the logback logging in the pom.</p>\n<p><strong>pom.xml:</strong></p>\n<pre><code>&lt;properties&gt;\n    &lt;java.version&gt;21&lt;/java.version&gt;\n&lt;/properties&gt;\n&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-quartz&lt;/artifactId&gt;\n        &lt;exclusions&gt;\n            &lt;exclusion&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;\n            &lt;/exclusion&gt;\n        &lt;/exclusions&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-webmvc&lt;/artifactId&gt;\n        &lt;exclusions&gt;\n            &lt;exclusion&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;\n            &lt;/exclusion&gt;\n        &lt;/exclusions&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;\n        &lt;scope&gt;provided&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;\n        &lt;exclusions&gt;\n            &lt;exclusion&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;\n            &lt;/exclusion&gt;\n        &lt;/exclusions&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.oracle.database.jdbc&lt;/groupId&gt;\n        &lt;artifactId&gt;ojdbc8&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;\n&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n</code></pre>\n<p>The log4j2.xml file is the same with minor changes:</p>\n<pre><code>&lt;Loggers&gt;\n    &lt;root level=&quot;error&quot;&gt;\n        &lt;AppenderRef ref=&quot;Console&quot;/&gt;\n    &lt;/root&gt;\n    &lt;Logger name=&quot;com.cspi&quot; level=&quot;debug&quot; additivity=&quot;false&quot;&gt;\n        &lt;AppenderRef ref=&quot;Database&quot;/&gt;\n    &lt;/Logger&gt;\n&lt;/Loggers&gt;\n</code></pre>\n<p>Nothing is getting logged to the database unless I use just root:</p>\n<pre><code>&lt;Loggers&gt;\n    &lt;root level=&quot;debug&quot;&gt;\n        &lt;AppenderRef ref=&quot;Database&quot;/&gt;\n        &lt;AppenderRef ref=&quot;Console&quot;/&gt;\n    &lt;/root&gt;\n&lt;/Loggers&gt;\n</code></pre>\n<p>If I add the console appender to it's own logger, I can see the logs in the console, but they don't appear in the database.</p>\n<pre><code>&lt;Loggers&gt;\n    &lt;root level=&quot;error&quot;&gt;\n        &lt;AppenderRef ref=&quot;Console&quot;/&gt;\n    &lt;/root&gt;\n    &lt;Logger name=&quot;com.cspi&quot; level=&quot;debug&quot; additivity=&quot;false&quot;&gt;\n        &lt;AppenderRef ref=&quot;Database&quot;/&gt;\n        &lt;AppenderRef ref=&quot;Console&quot;/&gt;\n    &lt;/Logger&gt;\n&lt;/Loggers&gt;\n</code></pre>\n<p>The dependency tree looks like this:</p>\n<pre><code>    [INFO] +- org.springframework.boot:spring-boot-starter-quartz:jar:4.0.0:compile\n    [INFO] |  +- org.springframework.boot:spring-boot-starter:jar:4.0.0:compile\n    [INFO] |  |  +- org.springframework.boot:spring-boot-autoconfigure:jar:4.0.0:compile\n    [INFO] |  |  +- jakarta.annotation:jakarta.annotation-api:jar:3.0.0:compile\n    [INFO] |  |  \\- org.yaml:snakeyaml:jar:2.5:compile\n    [INFO] |  \\- org.springframework.boot:spring-boot-quartz:jar:4.0.0:compile\n    [INFO] |     +- org.springframework.boot:spring-boot-transaction:jar:4.0.0:compile\n    [INFO] |     |  +- org.springframework.boot:spring-boot-persistence:jar:4.0.0:compile\n    [INFO] |     |  \\- org.springframework:spring-tx:jar:7.0.1:compile\n    [INFO] |     +- org.quartz-scheduler:quartz:jar:2.5.1:compile\n    [INFO] |     |  \\- jakarta.xml.bind:jakarta.xml.bind-api:jar:4.0.4:runtime\n    [INFO] |     |     \\- jakarta.activation:jakarta.activation-api:jar:2.1.4:runtime\n    [INFO] |     \\- org.springframework:spring-context-support:jar:7.0.1:compile\n    [INFO] |        +- org.springframework:spring-beans:jar:7.0.1:compile\n    [INFO] |        +- org.springframework:spring-context:jar:7.0.1:compile\n    [INFO] |        \\- org.springframework:spring-core:jar:7.0.1:compile\n    [INFO] |           +- commons-logging:commons-logging:jar:1.3.5:compile\n    [INFO] |           \\- org.jspecify:jspecify:jar:1.0.0:compile\n    [INFO] +- org.springframework.boot:spring-boot-starter-webmvc:jar:4.0.0:compile\n    [INFO] |  +- org.springframework.boot:spring-boot-starter-jackson:jar:4.0.0:compile\n    [INFO] |  |  \\- org.springframework.boot:spring-boot-jackson:jar:4.0.0:compile\n    [INFO] |  |     \\- tools.jackson.core:jackson-databind:jar:3.0.2:compile\n    [INFO] |  |        +- com.fasterxml.jackson.core:jackson-annotations:jar:2.20:compile\n    [INFO] |  |        \\- tools.jackson.core:jackson-core:jar:3.0.2:compile\n    [INFO] |  +- org.springframework.boot:spring-boot-http-converter:jar:4.0.0:compile\n    [INFO] |  |  +- org.springframework.boot:spring-boot:jar:4.0.0:compile\n    [INFO] |  |  \\- org.springframework:spring-web:jar:7.0.1:compile\n    [INFO] |  |     \\- io.micrometer:micrometer-observation:jar:1.16.0:compile\n    [INFO] |  |        \\- io.micrometer:micrometer-commons:jar:1.16.0:compile\n    [INFO] |  \\- org.springframework.boot:spring-boot-webmvc:jar:4.0.0:compile\n    [INFO] |     +- org.springframework.boot:spring-boot-servlet:jar:4.0.0:compile\n    [INFO] |     \\- org.springframework:spring-webmvc:jar:7.0.1:compile\n    [INFO] |        +- org.springframework:spring-aop:jar:7.0.1:compile\n    [INFO] |        \\- org.springframework:spring-expression:jar:7.0.1:compile\n    [INFO] +- org.springframework.boot:spring-boot-starter-tomcat:jar:4.0.0:provided\n    [INFO] |  +- org.springframework.boot:spring-boot-starter-tomcat-runtime:jar:4.0.0:provided\n    [INFO] |  |  +- org.springframework.boot:spring-boot-web-server:jar:4.0.0:provided\n    [INFO] |  |  +- org.apache.tomcat.embed:tomcat-embed-core:jar:11.0.14:provided\n    [INFO] |  |  +- org.apache.tomcat.embed:tomcat-embed-el:jar:11.0.14:provided\n    [INFO] |  |  \\- org.apache.tomcat.embed:tomcat-embed-websocket:jar:11.0.14:provided\n    [INFO] |  \\- org.springframework.boot:spring-boot-tomcat:jar:4.0.0:provided\n    [INFO] +- org.springframework.boot:spring-boot-starter-jdbc:jar:4.0.0:compile\n    [INFO] |  +- org.springframework.boot:spring-boot-jdbc:jar:4.0.0:compile\n    [INFO] |  |  +- org.springframework.boot:spring-boot-sql:jar:4.0.0:compile\n    [INFO] |  |  \\- org.springframework:spring-jdbc:jar:7.0.1:compile\n    [INFO] |  \\- com.zaxxer:HikariCP:jar:7.0.2:compile\n    [INFO] |     \\- org.slf4j:slf4j-api:jar:2.0.17:compile\n    [INFO] +- com.oracle.database.jdbc:ojdbc8:jar:23.9.0.25.07:compile\n    [INFO] \\- org.springframework.boot:spring-boot-starter-log4j2:jar:4.0.0:compile\n    [INFO]    +- org.apache.logging.log4j:log4j-slf4j2-impl:jar:2.25.2:compile\n    [INFO]    |  \\- org.apache.logging.log4j:log4j-api:jar:2.25.2:compile\n    [INFO]    +- org.apache.logging.log4j:log4j-core:jar:2.25.2:compile\n    [INFO]    \\- org.apache.logging.log4j:log4j-jul:jar:2.25.2:compile&lt;/pre&gt;\n</code></pre>\n<p>Any ideas on what's going on here?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}