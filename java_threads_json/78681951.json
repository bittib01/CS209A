{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "google-sheets",
      "google-sheets-api"
    ],
    "owner": {
      "account_id": 33319734,
      "reputation": 1,
      "user_id": 25798430,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/ab9d2629d8e1ef3de80ff537cc745f2e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Sreenitti Sankar",
      "link": "https://stackoverflow.com/users/25798430/sreenitti-sankar"
    },
    "is_answered": false,
    "view_count": 430,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1722591971,
    "creation_date": 1719570726,
    "question_id": 78681951,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78681951/google-sheets-api-v4-getting-429-resource-has-been-exhausted-e-g-check-quo",
    "title": "Google sheets API v4 - Getting 429 [ Resource has been exhausted (e.g. check quota) ] during spreadsheet creation",
    "body": "<p>I am trying to create a google sheet using java springboot. Even though my request quota hasn't exceeded, i'm getting the 429 Too many requests exception.</p>\n<p>Error image : (<a href=\"https://i.sstatic.net/m1axt0Ds.png\" rel=\"nofollow noreferrer\">https://i.sstatic.net/m1axt0Ds.png</a>)\nThis is my code :</p>\n<pre><code>\nimport com.google.api.client.auth.oauth2.Credential;\nimport com.google.api.client.extensions.java6.auth.oauth2.AuthorizationCodeInstalledApp;\nimport com.google.api.client.extensions.jetty.auth.oauth2.LocalServerReceiver;\nimport com.google.api.client.googleapis.auth.oauth2.GoogleAuthorizationCodeFlow;\nimport com.google.api.client.googleapis.auth.oauth2.GoogleClientSecrets;\nimport com.google.api.client.googleapis.javanet.GoogleNetHttpTransport;\nimport com.google.api.client.http.javanet.NetHttpTransport;\nimport com.google.api.client.json.JsonFactory;\nimport com.google.api.client.json.gson.GsonFactory;\nimport com.google.api.client.util.store.FileDataStoreFactory;\nimport com.google.api.services.sheets.v4.Sheets;\nimport com.google.api.services.sheets.v4.SheetsScopes;\nimport com.google.api.services.sheets.v4.model.Spreadsheet;\nimport com.google.api.services.sheets.v4.model.SpreadsheetProperties;\nimport com.google.api.services.sheets.v4.model.ValueRange;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.InputStreamReader;\nimport java.security.GeneralSecurityException;\nimport java.util.Collections;\nimport java.util.List;\n\npublic class SheetsQuickstart {\n    private static final String APPLICATION_NAME = &quot;Google Sheets API Java Quickstart&quot;;\n    private static final JsonFactory JSON_FACTORY = GsonFactory.getDefaultInstance();\n    private static final String TOKENS_DIRECTORY_PATH = &quot;tokens&quot;;\n    \n    private static final List&lt;String&gt; SCOPES =\n            Collections.singletonList(SheetsScopes.SPREADSHEETS);\n    private static final String GOOGLE_APPLICATION_CREDENTIALS = &quot;/google-sheets-client-secret.json&quot;;\n    \n    private static Credential getCredentials(final NetHttpTransport HTTP_TRANSPORT)\n            throws IOException {\n        // Load client secrets.\n        InputStream in = SheetsQuickstart.class.getResourceAsStream(GOOGLE_APPLICATION_CREDENTIALS);\n        if (in == null) {\n            throw new FileNotFoundException(&quot;Resource not found: &quot; + GOOGLE_APPLICATION_CREDENTIALS);\n        }\n        GoogleClientSecrets clientSecrets =\n                GoogleClientSecrets.load(JSON_FACTORY, new InputStreamReader(in));\n\n        GoogleAuthorizationCodeFlow flow = new GoogleAuthorizationCodeFlow.Builder(\n                HTTP_TRANSPORT, JSON_FACTORY, clientSecrets, SCOPES)\n                .setDataStoreFactory(new FileDataStoreFactory(new java.io.File(TOKENS_DIRECTORY_PATH)))\n                .setAccessType(&quot;offline&quot;)\n                .build();\n        LocalServerReceiver receiver = new LocalServerReceiver.Builder().setPort(8888).build();\n        return new AuthorizationCodeInstalledApp(flow, receiver).authorize(&quot;user&quot;);\n    }\n    public static void getData() throws GeneralSecurityException, IOException {\n\n        final NetHttpTransport HTTP_TRANSPORT = GoogleNetHttpTransport.newTrustedTransport();\n        final String spreadsheetId = &quot;1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms&quot;;\n        final String range = &quot;Class Data!A2:E&quot;;\n        Sheets service =\n                new Sheets.Builder(HTTP_TRANSPORT, JSON_FACTORY, getCredentials(HTTP_TRANSPORT))\n                        .setApplicationName(APPLICATION_NAME)\n                        .build();\n        ValueRange response = service.spreadsheets().values()\n                .get(spreadsheetId, range)\n                .execute();\n        List&lt;List&lt;Object&gt;&gt; values = response.getValues();\n        if (values == null || values.isEmpty()) {\n            System.out.println(&quot;No data found.&quot;);\n        } else {\n            System.out.println(&quot;Name, Major&quot;);\n            for (List row : values) {\n                // Print columns A and E, which correspond to indices 0 and 4.\n                System.out.printf(&quot;%s, %s\\n&quot;, row.get(0), row.get(4));\n            }\n        }\n    }\n    public static String createSpreadsheet(String title) throws IOException, GeneralSecurityException {\n\n        final NetHttpTransport HTTP_TRANSPORT = GoogleNetHttpTransport.newTrustedTransport();\n\n        Sheets service = new Sheets.Builder(new NetHttpTransport(),\n                JSON_FACTORY,\n                getCredentials(HTTP_TRANSPORT))\n                .setApplicationName(&quot;Sheets samples&quot;)\n                .build();\n\n        Spreadsheet spreadsheet = new Spreadsheet()\n                .setProperties(new SpreadsheetProperties()\n                        .setTitle(title));\n        spreadsheet = service.spreadsheets().create(spreadsheet)\n                .setFields(&quot;spreadsheetId&quot;)\n                .execute();\n        System.out.println(&quot;Spreadsheet ID: &quot; + spreadsheet.getSpreadsheetId());\n\n        return spreadsheet.getSpreadsheetId();\n    }\n    public static void main(String... args) throws IOException, GeneralSecurityException {\n\n        getData();\n        createSpreadsheet(&quot;hi&quot;);\n    }\n}\n</code></pre>\n<p>This is the <a href=\"https://i.sstatic.net/cvW1mAgY.png\" rel=\"nofollow noreferrer\">cloud console request metrics </a> and the <a href=\"https://i.sstatic.net/XAMzegcg.png\" rel=\"nofollow noreferrer\">quota and limits image</a> for reference.</p>\n<p>Here, we can see that there have only been 8 <strong>createSpreadsheet</strong> requests and 9 get requests.<br />\nAnother thing to make note of is that all the 9 getValues requests were successful but all the 8 <strong>createSpreadsheet</strong> requests failed with this error.</p>\n<pre><code>Exception in thread &quot;main&quot; com.google.api.client.googleapis.json.GoogleJsonResponseException: 429 Too Many Requests\n{\n  &quot;code&quot;: 429,\n  &quot;errors&quot;: [\n    {\n      &quot;domain&quot;: &quot;global&quot;,\n      &quot;message&quot;: &quot;Resource has been exhausted (e.g. check quota).&quot;,\n      &quot;reason&quot;: &quot;rateLimitExceeded&quot;\n    }\n  ],\n  &quot;message&quot;: &quot;Resource has been exhausted (e.g. check quota).&quot;,\n  &quot;status&quot;: &quot;RESOURCE_EXHAUSTED&quot;\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}