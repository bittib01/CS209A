{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "spring-mvc",
      "spring-security"
    ],
    "owner": {
      "account_id": 10317503,
      "reputation": 35,
      "user_id": 7611400,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/fe306de8a78bed79d3a32a28b7bbad41?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "rahul soni",
      "link": "https://stackoverflow.com/users/7611400/rahul-soni"
    },
    "is_answered": true,
    "view_count": 78,
    "accepted_answer_id": 79129260,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1737435264,
    "creation_date": 1729953828,
    "last_edit_date": 1729964953,
    "question_id": 79128771,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79128771/springboot-not-triggering-custom-authentication-for-my-loaduserbyusername-method",
    "title": "Springboot not triggering custom authentication for my loaduserbyusername method",
    "body": "<p>I was implementing an authentication mechanism for my app.\nSo, if the user is admin and correct username and password is provided, then user should be authenticated and home page should be displayed to the admin. But in my case, even when correct username and password is provided, even in that case the control is redirected to login page instead of home page.</p>\n<p>Below are the further details:-</p>\n<p>login page:-</p>\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n  &lt;meta charset=&quot;UTF-8&quot;&gt;\n  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;\n  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;\n  &lt;title&gt;Login &amp; Registration Form | CoderGirl&lt;/title&gt;\n  &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div class=&quot;container&quot;&gt;\n    &lt;input type=&quot;checkbox&quot; id=&quot;check&quot;&gt;\n    &lt;div class=&quot;login form&quot;&gt;\n      &lt;header&gt;Login&lt;/header&gt;\n      &lt;form action=&quot;/home&quot; method=&quot;POST&quot;&gt;\n        &lt;input type=&quot;text&quot; name=&quot;username&quot; placeholder=&quot;Enter your email&quot; required&gt;\n        &lt;input type=&quot;password&quot; name=&quot;password&quot; placeholder=&quot;Enter your password&quot; required&gt;\n        &lt;a href=&quot;#&quot;&gt;Forgot password?&lt;/a&gt;\n        &lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;Login&quot;&gt;\n      &lt;/form&gt;\n      &lt;div class=&quot;signup&quot;&gt;\n        &lt;span class=&quot;signup&quot;&gt;Don't have an account?\n         &lt;label for=&quot;check&quot;&gt;Signup&lt;/label&gt;\n        &lt;/span&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;registration form&quot;&gt;\n      &lt;header&gt;Signup&lt;/header&gt;\n      &lt;form action=&quot;/register&quot; method=&quot;POST&quot;&gt;\n        &lt;input type=&quot;text&quot; name=&quot;username&quot; placeholder=&quot;Enter your email&quot; required&gt;\n        &lt;input type=&quot;password&quot; name=&quot;password&quot; placeholder=&quot;Create a password&quot; required&gt;\n        &lt;input type=&quot;password&quot; name=&quot;confirmPassword&quot; placeholder=&quot;Confirm your password&quot; required&gt;\n        &lt;input type=&quot;submit&quot; class=&quot;button&quot; value=&quot;Signup&quot;&gt;\n      &lt;/form&gt;\n      &lt;div class=&quot;signup&quot;&gt;\n        &lt;span class=&quot;signup&quot;&gt;Already have an account?\n         &lt;label for=&quot;check&quot;&gt;Login&lt;/label&gt;\n        &lt;/span&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>home page:-</p>\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n  &lt;meta charset=&quot;UTF-8&quot;&gt;\n  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;\n  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;\n  &lt;title&gt;Product Management&lt;/title&gt;\n  &lt;link rel=&quot;stylesheet&quot; href=&quot;home_style.css&quot;&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div class=&quot;container&quot;&gt;\n    &lt;h1&gt;Welcome to the Product Management System&lt;/h1&gt;\n    &lt;div class=&quot;button-container&quot;&gt;\n      &lt;button class=&quot;action-button&quot; onclick=&quot;window.location.href='/add-product'&quot;&gt;Add Product&lt;/button&gt;\n      &lt;button class=&quot;action-button&quot; onclick=&quot;window.location.href='/remove-product'&quot;&gt;Remove Product&lt;/button&gt;\n      &lt;button class=&quot;action-button&quot; onclick=&quot;window.location.href='/modify-product'&quot;&gt;Modify Product&lt;/button&gt;\n      &lt;button class=&quot;action-button&quot; onclick=&quot;window.location.href='/view-product'&quot;&gt;View Product&lt;/button&gt;\n    &lt;/div&gt;\n    &lt;a href=&quot;/logout&quot; class=&quot;logout-button&quot;&gt;Logout&lt;/a&gt;\n  &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>controller:-</p>\n<pre><code>@Controller\npublic class LoginController {\n\n    @Autowired\n    private UserService userService;\n    \n    @Autowired\n    private CustomUserDetailsService customservice;\n\n    @Autowired\n    private PasswordEncoder passwordEncoder;\n    \n    @GetMapping(&quot;/login&quot;)\n    public String loginPage() {\n        return &quot;index&quot;; // Render the login.html page\n    }\n    \n    @GetMapping(&quot;/logout&quot;)\n    public String logoutPage() {\n        return &quot;index&quot;; // Render the logout.html page\n    }\n\n    @PostMapping(&quot;/home&quot;)\n    public String login(@RequestParam String username, @RequestParam String password) {\n        // Retrieve user from the database\n        System.out.println(&quot;login endpoint&quot;);\n        User user = userService.findByUsername(username);\n      \n        Iterator&lt;Role&gt; iterator = user.getRoles().iterator();\n        while (iterator.hasNext()) {\n            Role fruit = iterator.next();\n            System.out.println(fruit.getRoleName());\n        }\n        \n        if (user != null &amp;&amp; passwordEncoder.matches(password, user.getPassword())) {\n            System.out.println(&quot;authentication complete&quot;);\n            return &quot;home&quot;;  // Password matches, redirect to home\n        } else {\n            System.out.println(&quot;authentication incomplete&quot;);\n            return &quot;index&quot;;  // Invalid login, return to login page\n        }\n    }\n    }\n</code></pre>\n<p>This is my security config:-</p>\n<pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {\n\n    @Autowired\n    private CustomUserDetailsService customUserDetailsService; // Inject the custom user details service\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        System.out.println(&quot;inside password encoder&quot;);\n        return new BCryptPasswordEncoder(); // Passwords should be hashed using BCrypt\n    }\n\n    @Bean\n    public DaoAuthenticationProvider authenticationProvider() {\n        System.out.println(&quot;inside authentication provider&quot;);\n        DaoAuthenticationProvider authProvider = new DaoAuthenticationProvider();\n        authProvider.setUserDetailsService(customUserDetailsService); // Use injected CustomUserDetailsService\n        authProvider.setPasswordEncoder(passwordEncoder()); // Set password encoder\n        return authProvider;\n    }\n\n    @Bean\n    public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {\n        System.out.println(&quot;inside authentication manager&quot;);\n        return authenticationConfiguration.getAuthenticationManager();\n    }\n\n    \n    \n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        System.out.println(&quot;inside securityFilterChain&quot;);\n        http\n            .authorizeHttpRequests()\n            .requestMatchers(&quot;/css/**&quot;, &quot;/js/**&quot;, &quot;/images/**&quot;, &quot;/static/**&quot;).permitAll()\n            .requestMatchers(&quot;/login&quot;, &quot;/register&quot;, &quot;*.css&quot;).permitAll() // Public access to login and register\n            .requestMatchers(&quot;/add-product&quot;, &quot;/modify-product&quot;, &quot;/remove-product&quot;).hasRole(&quot;ADMIN&quot;) // Restrict product modification to ADMIN roles\n            .requestMatchers(&quot;/view-product&quot;).authenticated() // Requires users to be authenticated\n            .anyRequest().authenticated() // All other requests need to be authenticated\n            .and()\n            .formLogin()\n                .loginPage(&quot;/login&quot;)\n                .defaultSuccessUrl(&quot;/home&quot;, true) // Redirect to home after login\n                .failureUrl(&quot;/login&quot;) \n            .and()\n            .logout()\n                .logoutSuccessUrl(&quot;/logout&quot;) // Redirect after logout\n                .permitAll()\n            .and()\n            .sessionManagement() // Configure session management\n                .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED) // Default policy\n                .maximumSessions(1) // Limit the number of concurrent sessions per user\n                .expiredUrl(&quot;/login?expired&quot;) // Redirect to login page if session expires\n            .and()\n            .and()\n            .csrf().disable(); // Disable CSRF for non-browser clients or API access\n\n        return http.build();\n    }\n}\n</code></pre>\n<p>custom userdetailservice:-</p>\n<pre><code>@Service\npublic class CustomUserDetailsService implements UserDetailsService {\n\n    @Autowired\n    private UserRepository userRepository;\n\n    public CustomUserDetailsService() {\n        System.out.println(&quot;CustomUserDetailsService has been initialized.&quot;);\n    }\n    \n    \n    // Map roles to authorities, adding 'ROLE_' prefix\n    private Collection&lt;? extends GrantedAuthority&gt; mapRolesToAuthorities(Collection&lt;Role&gt; roles) {\n        return roles.stream()\n                    .map(role -&gt; new SimpleGrantedAuthority(role.getRoleName()))\n                    .collect(Collectors.toList());\n    }\n\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        System.out.println(&quot;inside loaduserbyusername custom user&quot;);\n        User user = userRepository.findByUsername(username);\n        System.out.println(&quot;User is &quot;+user.getUsername() +&quot; and password is &quot;+user.getPassword());\n        if (user == null) {\n            throw new UsernameNotFoundException(&quot;User not found&quot;);\n        }\n        org.springframework.security.core.userdetails.User springUser = new org.springframework.security.core.userdetails.User(\n                user.getUsername(),\n                user.getPassword(),\n                mapRolesToAuthorities(user.getRoles())\n        );\n        System.out.println(&quot;Spring Security User Details: &quot;);\n        System.out.println(&quot;Username: &quot; + springUser.getUsername());\n        System.out.println(&quot;Password: &quot; + springUser.getPassword());\n        System.out.println(&quot;Authorities: &quot; + springUser.getAuthorities());\n        return springUser;\n\n    }\n}\n</code></pre>\n<p>logs:-</p>\n<pre><code>  .   ____          _            __ _ _\n /\\\\ / ___'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\\n( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\\n \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )\n  '  |____| .__|_| |_|_| |_\\__, | / / / /\n =========|_|==============|___/=/_/_/_/\n :: Spring Boot ::                (v3.1.0)\n\n2024-10-26T20:07:44.105+05:30  INFO 19060 --- [  restartedMain] com.example.webapp.Dia1Application       : Starting Dia1Application using Java 17.0.3 with PID 19060 (C:\\Users\\Admin\\eclipse-workspace\\dia-1\\target\\classes started by Admin in workspace\\dia-1)\n2024-10-26T20:07:44.162+05:30  INFO 19060 --- [  restartedMain] com.example.webapp.Dia1Application       : No active profile set, falling back to 1 default profile: &quot;default&quot;\n2024-10-26T20:07:44.458+05:30  INFO 19060 --- [  restartedMain] o.s.b.devtools.restart.ChangeableUrls    : The Class-Path manifest attribute in C:\\Users\\Admin\\.m2\\repository\\com\\oracle\\database\\jdbc\\ojdbc8\\19.8.0.0\\ojdbc8-19.8.0.0.jar referenced one or more files that do not exist: file:/C:/Userscom/oracle/database/jdbc/ojdbc8/19.8.0.0/oraclepki.jar\n2024-10-26T20:07:44.459+05:30  INFO 19060 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable\n2024-10-26T20:07:44.460+05:30  INFO 19060 --- [  restartedMain] .e.DevToolsPropertyDefaultsPostProcessor : For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'\n2024-10-26T20:07:47.352+05:30  INFO 19060 --- [  restartedMain] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.\n2024-10-26T20:07:47.948+05:30  INFO 19060 --- [  restartedMain] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 367 ms. Found 3 JPA repository interfaces.\n2024-10-26T20:07:51.595+05:30  INFO 19060 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)\n2024-10-26T20:07:51.642+05:30  INFO 19060 --- [  restartedMain] o.apache.catalina.core.StandardService   : Starting service [Tomcat]\n2024-10-26T20:07:51.643+05:30  INFO 19060 --- [  restartedMain] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.8]\n2024-10-26T20:07:51.957+05:30  INFO 19060 --- [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext\n2024-10-26T20:07:51.959+05:30  INFO 19060 --- [  restartedMain] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 7497 ms\n2024-10-26T20:07:52.995+05:30  INFO 19060 --- [  restartedMain] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]\n2024-10-26T20:07:53.414+05:30  INFO 19060 --- [  restartedMain] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.2.2.Final\n2024-10-26T20:07:53.428+05:30  INFO 19060 --- [  restartedMain] org.hibernate.cfg.Environment            : HHH000406: Using bytecode reflection optimizer\n2024-10-26T20:07:54.294+05:30  INFO 19060 --- [  restartedMain] o.h.b.i.BytecodeProviderInitiator        : HHH000021: Bytecode provider name : bytebuddy\n2024-10-26T20:07:55.194+05:30  INFO 19060 --- [  restartedMain] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer\n2024-10-26T20:07:55.295+05:30  INFO 19060 --- [  restartedMain] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...\n2024-10-26T20:07:56.818+05:30  INFO 19060 --- [  restartedMain] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection oracle.jdbc.driver.T4CConnection@567f88b3\n2024-10-26T20:07:56.826+05:30  INFO 19060 --- [  restartedMain] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.\n2024-10-26T20:07:58.454+05:30  INFO 19060 --- [  restartedMain] org.hibernate.orm.dialect                : HHH035001: Using dialect: org.hibernate.dialect.OracleDialect, version: 21.0\n2024-10-26T20:07:59.957+05:30  INFO 19060 --- [  restartedMain] o.h.b.i.BytecodeProviderInitiator        : HHH000021: Bytecode provider name : bytebuddy\n2024-10-26T20:08:04.301+05:30  INFO 19060 --- [  restartedMain] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]\n2024-10-26T20:08:04.329+05:30  INFO 19060 --- [  restartedMain] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'\nCustomUserDetailsService has been initialized.\ninside password encoder\n2024-10-26T20:08:06.758+05:30  WARN 19060 --- [  restartedMain] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning\ninside authentication provider\ninside securityFilterChain\n2024-10-26T20:08:07.257+05:30  INFO 19060 --- [  restartedMain] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page template: index\n2024-10-26T20:08:08.083+05:30  INFO 19060 --- [  restartedMain] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@7beeb809, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@1250ad26, org.springframework.security.web.context.SecurityContextHolderFilter@f1c53e8, org.springframework.security.web.header.HeaderWriterFilter@5e21c003, org.springframework.security.web.authentication.logout.LogoutFilter@6af304cf, org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter@47bc56f1, org.springframework.security.web.session.ConcurrentSessionFilter@576c970f, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@2ad56bcf, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5378e4fd, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@377e7a43, org.springframework.security.web.session.SessionManagementFilter@1454bc00, org.springframework.security.web.access.ExceptionTranslationFilter@7b40484, org.springframework.security.web.access.intercept.AuthorizationFilter@107f250f]\ninside authentication manager\n2024-10-26T20:08:09.118+05:30  INFO 19060 --- [  restartedMain] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729\n2024-10-26T20:08:09.257+05:30  INFO 19060 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''\n2024-10-26T20:08:09.300+05:30  INFO 19060 --- [  restartedMain] com.example.webapp.Dia1Application       : Started Dia1Application in 27.13 seconds (process running for 30.667)\nHibernate: select r1_0.role_id,r1_0.role_name from roles r1_0 where r1_0.role_name=?\nHibernate: select u1_0.user_id,u1_0.password,u1_0.user_name from users u1_0 where u1_0.user_name=?\nHibernate: select r1_0.user_id,r1_1.role_id,r1_1.role_name from user_roles r1_0 join roles r1_1 on r1_1.role_id=r1_0.role_id where r1_0.user_id=?\n2024-10-26T20:08:29.660+05:30  INFO 19060 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'\n2024-10-26T20:08:29.661+05:30  INFO 19060 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'\n2024-10-26T20:08:29.671+05:30  INFO 19060 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 7 ms\n2024-10-26T20:08:29.708+05:30 DEBUG 19060 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Securing POST /home\n2024-10-26T20:08:29.747+05:30 DEBUG 19060 --- [nio-8080-exec-1] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext\n2024-10-26T20:08:29.887+05:30 DEBUG 19060 --- [nio-8080-exec-1] o.s.s.w.s.HttpSessionRequestCache        : Saved request http://localhost:8080/home?continue to session\n2024-10-26T20:08:29.892+05:30 DEBUG 19060 --- [nio-8080-exec-1] o.s.s.web.DefaultRedirectStrategy        : Redirecting to http://localhost:8080/login\n2024-10-26T20:08:29.974+05:30 DEBUG 19060 --- [nio-8080-exec-2] o.s.security.web.FilterChainProxy        : Securing GET /login\n2024-10-26T20:08:29.975+05:30 DEBUG 19060 --- [nio-8080-exec-2] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext\n2024-10-26T20:08:29.981+05:30 DEBUG 19060 --- [nio-8080-exec-2] o.s.security.web.FilterChainProxy        : Secured GET /login\n2024-10-26T20:08:31.829+05:30 DEBUG 19060 --- [nio-8080-exec-3] o.s.security.web.FilterChainProxy        : Securing GET /style.css\n2024-10-26T20:08:31.829+05:30 DEBUG 19060 --- [nio-8080-exec-3] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext\n2024-10-26T20:08:31.866+05:30 DEBUG 19060 --- [nio-8080-exec-3] o.s.security.web.FilterChainProxy        : Secured GET /style.css\n</code></pre>\n<p>roles table details:-</p>\n<pre><code>ROLE_ID   ROLE_NAME\n1         ROLE_ADMIN\n</code></pre>\n<p>so, i have added the logs as well inside loaduserbyusername, but those logs are not generating during app startup or on successful login. could anyone help like what's going wrong.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}