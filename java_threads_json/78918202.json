{
  "question": {
    "tags": [
      "java",
      "spring",
      "sap-cap"
    ],
    "owner": {
      "account_id": 35192642,
      "reputation": 3,
      "user_id": 27041669,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/80f27aa53abb59638817e0d267901745?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "sahana",
      "link": "https://stackoverflow.com/users/27041669/sahana"
    },
    "is_answered": false,
    "view_count": 351,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1742198016,
    "creation_date": 1724751974,
    "last_edit_date": 1741154718,
    "question_id": 78918202,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78918202/cap-unable-to-fetch-the-entity-fields-of-a-composite-entity-in-com-sap-cds-ql-p",
    "title": "CAP: Unable to fetch the entity fields of a composite entity in com.sap.cds.ql.Predicate via CQL query",
    "body": "<p>I have a db entity called ProtestTypeConfigurations as shown below.</p>\n<pre><code>entity ProtestTypeConfigurations : cuid, managed {\n    finder                       : DataType.finder;\n    protestCategory                : ProtestCategory;\n    code                             : DataType.Code;\n    description                      : localized DataType.Description;  \n    individualProtestType          : DataType.Flag default false;\n    malCategory                     : MalCategory;protestTypeToMarAreaMappings\n    protestTypeToMarAreaMappings : Composition of many protestTypeToMarAreaMappings\n                                           on ProtestTypeToMarAreaMappings.protestTypeConfiguration = $self;\n    isActive                         : Boolean default true;\n}\n}\n</code></pre>\n<p>Here we have a composite relation to ** protestTypeToMarAreaMappings** which has <code>salesOrganization</code>, <code>distributionchannel</code> and <code>division</code> fields under it as shown below.</p>\n<pre><code>entity protestTypeToMarAreaMappings : cuid, managed {\n    salesOrganization          : SalesOrganization;\n    distributionChannel        : DistributionChannel;\n    division                   : Division;\n    protestTypeConfiguration : ProtestTypeConfiguration;\n}\n</code></pre>\n<p>Now I would want to query the <strong>sales/distribution/division</strong> using predicates as shown below.</p>\n<pre><code>\n         Predicate predicateSalesArea = CQL.get(ProtestTypeToMarAreaMappings.SALES_ORGANIZATION_ID).eq(salesOrganization)\n                .and(CQL.get(ProtestTypeToMarAreaMappings.DISTRIBUTION_CHANNEL_ID).isNull()\n                        .and(CQL.get(ProtestTypeToMarAreaMappings.DIVISION_ID).isNull()))\n                .or(CQL.get(ProtestTypeToMarAreaMappings.SALES_ORGANIZATION_ID).eq(salesOrganization)\n                        .and(CQL.get(ProtestTypeToMarAreaMappings.DISTRIBUTION_CHANNEL_ID).eq(distributionChannel)\n                                .and(CQL.get(ProtestTypeToMarAreaMappings.DIVISION_ID).isNull())))\n                .or(CQL.get(ProtestTypeToMarAreaMappings.SALES_ORGANIZATION_ID).eq(salesOrganization)\n                        .and(CQL.get(ProtestTypeToMarAreaMappings.DISTRIBUTION_CHANNEL_ID).eq(distributionChannel)\n                                .and(CQL.get(ProtestTypeToMarAreaMappings.DIVISION_ID).eq(division))));\n        \n        Predicate predicate = CQL.get(ProtestTypeConfigurations.IS_ACTIVE).eq(true)\n                  .and(CQL.get(ProtestTypeConfigurations.PROTEST_CATEGORY_CODE).eq(protestCategoryCode))\n                  .and(CQL.get(ProtestTypeConfigurations.PROTEST_TYPE_TO_SALES_AREA_MAPPINGS).isNull()).or(predicateSalesArea);\n        \n    if(code!=null || description!=null) {\n            \n            predicate.and(CQL.get(ProtestTypeConfigurations.CODE).contains(code).and(CQL.get(ProtestTypeConfigurations.DESCRIPTION).contains(description)));\n        }\n            \n            \n        CqnSelect select=Select.from(ProtestTypeConfigurations_.class)\n                        .columns(a-&gt;a.ID(),b-&gt;b.code(),c-&gt;c.description(),\n                                e-&gt;e.protestTypeToMarAreaMappings().salesOrganization_ID(),\n                                f-&gt;f.protestTypeToMarAreaMappings().distributionChannel_ID(),\n                                g-&gt;g.protestTypeToMarAreaMappings().division_ID(),\n                                h-&gt;h.individualProtestType(),\n                                i-&gt;i.malCategory_ID()).where(predicate);\n\nfilteredResult=db.run(select);\n</code></pre>\n<p>When I run this query I get error as below.</p>\n<pre><code>No element with name 'salesOrganization_ID' in 'CustomerConfigurationService.ProtestTypeConfigurations' (service 'PersistenceService$Default', event 'READ', entity 'CustomerConfigurationService.ProtestTypeConfigurations')\n    at com.sap.cds.services.impl.ServiceImpl.dispatch(ServiceImpl.java:256) ~[cds-services-impl-2.10.1.jar:na]\n    at com.sap.cds.services.impl.ServiceImpl.emit(ServiceImpl.java:177) ~[cds-services-impl-2.10.1.jar:na]\n    at com.sap.cds.services.ServiceDelegator.emit(ServiceDelegator.java:33) ~[cds-services-api-2.10.1.jar:na]\n    at com.sap.cds.services.utils.services.AbstractCqnService.run(AbstractCqnService.java:53) ~[cds-services-utils-2.10.1.jar:na]\n    at com.sap.cds.services.utils.services.AbstractCqnService.run(AbstractCqnService.java:43) ~[cds-services-utils-2.10.1.jar:na]\n    at com.sap.ic.cmh.configuration.persistency.ProtestTypeConfigurationDao.getAllComplaintsWithWildCharacter(ProtestTypeConfigurationDao.java:179) ~[classes/:na]\n    at jdk.internal.reflect.GeneratedMethodAccessor33.invoke(Unknown Source) ~[na:na]\n</code></pre>\n<p>I am unable to fetch the composite entity fields,How can I achieve this using predicates.\nCan anybody please help me here?</p>\n<p>However I can achieve this using CQN query as shown below.</p>\n<pre><code>        filteredResult = db\n                .run(Select.from(ProtestTypeConfigurations_.class)\n                        .columns(a-&gt;a.ID(),b-&gt;b.code(),c-&gt;c.description(),\n                                e-&gt;e.protestTypeToSalesAreaMappings().salesOrganization_ID(),\n                                f-&gt;f.protestTypeToSalesAreaMappings().distributionChannel_ID(),\n                                g-&gt;g.protestTypeToSalesAreaMappings().division_ID(),\n                                h-&gt;h.individualComplaintType(),\n                                i-&gt;i.itemCategory_ID())\n                        .where(d-&gt;d.isActive().eq(true).and(d.protestCategory_code().eq(protestCategoryCode).and(d.code().contains(code).or(d.description().contains(description))).and(not(d.protestTypeToSalesAreaMappings().exists())\n                                .or(d.protestTypeToSalesAreaMappings().salesOrganization_ID().eq(salesOrganization)\n                                        .and(d.protestTypeToSalesAreaMappings().distributionChannel_ID().isNull()\n                                                .and(d.protestTypeToSalesAreaMappings().division_ID().isNull())))\n                                .or(d.protestTypeToSalesAreaMappings().salesOrganization_ID().eq(salesOrganization)\n                                        .and(d.protestTypeToSalesAreaMappings().distributionChannel_ID().eq(distributionChannel)\n                                                .and(d.protestTypeToSalesAreaMappings().division_ID().isNull())))\n                                .or(d.protestTypeToSalesAreaMappings().salesOrganization_ID().eq(salesOrganization)\n                                        .and(d.protestTypeToSalesAreaMappings().distributionChannel_ID().eq(distributionChannel)\n                                                .and(d.protestTypeToSalesAreaMappings().division_ID().eq(division))))))));\n</code></pre>\n<p>But for my scenario, I would need to modify the query as per certain conditions, hence using above query I end up having multiple if else block with almost same query with slight modification of fields. Hence, we decided to go with predicates. But we are unable to achieve this.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}