{
  "question": {
    "tags": [
      "java",
      "gradle",
      "intellij-idea",
      "java-test-fixtures"
    ],
    "owner": {
      "account_id": 2637951,
      "reputation": 4841,
      "user_id": 3014199,
      "user_type": "registered",
      "accept_rate": 79,
      "profile_image": "https://www.gravatar.com/avatar/72332b0ac6ee78bc829c378c6c747e0e?s=256&d=identicon&r=PG",
      "display_name": "peer",
      "link": "https://stackoverflow.com/users/3014199/peer"
    },
    "is_answered": true,
    "view_count": 789,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1733843553,
    "creation_date": 1732289788,
    "last_edit_date": 1733068629,
    "question_id": 79215647,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79215647/intellij-cannot-resolve-classes-from-test-fixtures",
    "title": "Intellij cannot resolve classes from test fixtures",
    "body": "<p>I have a gradle project with several submodules such as <code>core</code> and <code>adapter</code>. I generate custom assertj asserts for some classes in <code>core</code>. In order to use these asserts in <code>core</code> but also in <code>adapter</code> I use the java-test-fixtures plugin. This works fine with gradle. the projects build and the tests run through. Even with the green play button in intelliJ at the side of test classes and methods the tests work. However IntelliJ itself cannot resolve the classes in the test-fixtures folder.</p>\n<p><a href=\"https://i.sstatic.net/YF2sowPx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/YF2sowPx.png\" alt=\"an image of a test where the generated assert is marked red\" /></a></p>\n<p>The static import is marked red with <code>Cannot resolve symbol 'Assertions'</code>\nThe custom method <code>hasFoo</code> is also marked red with <code>Cannot resolve method 'hasFoo' in 'ObjectAssert'</code>.<br />\nThe problem with this is that I cannot comfortably write tests like this, because I do not get code completion. And I can never be sure if the tests compile unless I run them.</p>\n<p>Since everything works in gradle I assume that I have configured everything correctly in gradle and the problem is with IntelliJ which seems to ignore my generated testfixtures folder when highlighting my code.</p>\n<p>I would like to understand why IntelliJ cannot resolve the classes when gradle evidently can. And of course how to fix this. Ideally, I do not want to change the gradle config for my IDE (idea plugin for instance), but if there is no other way I'm open to it.</p>\n<h1>Details</h1>\n<h2>Gradle setup</h2>\n<pre><code>$ gradle -q projects\nRoot project 'my-project'\n+--- Project ':application'\n|    +--- Project ':application:adapter'\n|    \\--- Project ':application:core'\n\\--- Project ':bootstrap'\n\n$ cat settings.gradle\nrootProject.name = &quot;my-project&quot;\ninclude(&quot;bootstrap&quot;)\ninclude(&quot;application:adapter&quot;)\ninclude(&quot;application:core&quot;)\n</code></pre>\n<p>I haven't explicitly defined a testfixtures subproject, because as far as I can tell, I don't need to.</p>\n<p>Relevant parts of the build.gradle of <code>core</code>:</p>\n<pre><code>plugins {\n    ...\n    id(&quot;org.assertj.generator&quot;) version &quot;1.1.0&quot;\n    id(&quot;java-test-fixtures&quot;)\n}\n\nsourceSets {\n    main {\n        assertJ {\n            packages {//package for which to generate asserts\n                include(&quot;de.company.myproject.application.core.domain.tests&quot;)\n            }\n\n            //where the asserts are written\n            outputDir = file(&quot;src/testFixtures/java&quot;)\n        }\n    }\n}\n\n//ensure asserts are generated before test fixtures are compiled\ntasks.named(&quot;compileTestFixturesJava&quot;) {\n    dependsOn(&quot;:application:core:generateAssertJ&quot;)\n}\n\ndependencies {\n    testFixturesApi(&quot;org.assertj:assertj-core:3.25.1&quot;)\n}\n</code></pre>\n<p>Relevant parts of the build.gradle of <code>adapter</code>:</p>\n<pre><code>dependencies {\n    implementation(project(&quot;:application:core&quot;))\n    testImplementation(testFixtures(project(&quot;:application:core&quot;)))\n}\n</code></pre>\n<h2>IntelliJ config</h2>\n<p>I am using: IntelliJ IDEA 2024.1.5 (Ultimate Edition) on the actual code base where I cannot update to a newer version. I have since managed to reproduce this in a smaller project on a different machine with IntelliJ (up to) 2024.3 (Community Edition)</p>\n<p>I have noticed this problem from the start ~5 month ago. =&gt; It's not connected to a recent patch. If it used to work with IntelliJ, then before I tried it.</p>\n<p>Project tree:\n<a href=\"https://i.sstatic.net/oTwyD5hA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/oTwyD5hA.png\" alt=\"Image of the project tree\" /></a>\nThe project tree shows the testFixtures as a sibling to main and test in core. its child <code>java</code> is <code>test sources root</code>.\nI'm not sure what this should look like but it looks like IntelliJ is generally aware of the folder.</p>\n<p>Looking at the module settings, we see that testFixtures is recognized as a module.</p>\n<p><a href=\"https://i.sstatic.net/Wijb18mw.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/Wijb18mw.png\" alt=\"module settings showing testFixtures folder as a module\" /></a></p>\n<p>It also seems to be a dependency of <code>adapter.test</code>:\n<a href=\"https://i.sstatic.net/x5QCzbiI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/x5QCzbiI.png\" alt=\"module settings showing testFixtures as a dependency of adapter.test\" /></a></p>\n<h1>Minimal Reproducible Example</h1>\n<p>I managed to compile an MRE: <a href=\"https://github.com/timo-a/debug-microservice/tree/stacko/79215647\" rel=\"nofollow noreferrer\">https://github.com/timo-a/debug-microservice/tree/stacko/79215647</a></p>\n<h1>Solution attempts:</h1>\n<h2>IntelliJ suggestion: add dependency to module</h2>\n<p>Intellij suggests <code>Add dependency on module 'my-project.application.core.test'</code>.\nWhen I click on it something must happen because the suggestion goes away, but the problem does not. After I work through &quot;Repair IDE&quot; the suggestion is back again.</p>\n<h2>Refresh/Reimport actions</h2>\n<p>This is not an error that occurs with time, but from the very start.\nSo, deleting the <code>.idea</code> folder and reimporting the project does not work. Neither does &quot;Repair IDE&quot; with includes e.g. invalidate caches and restart.</p>\n<h2>Using the idea plugin</h2>\n<p>adding</p>\n<pre><code>plugins {\n    ...\n    idea\n}\n\nidea {\n    module {\n        testSourceDirs += file('src/testFixtures/java')\n        testResourceDirs += file('src/testFixtures/resources')\n    }\n}\n</code></pre>\n<p>to the build.gradle.kts of core does not work due to ambiguity of <code>+=</code> and then also because of deprecations. Adding</p>\n<pre><code>idea {\n    module {\n        testSources.from(file(&quot;src/testFixtures/java&quot;))\n        testResources.from(file(&quot;src/testFixtures/resources&quot;))\n    }\n}\n</code></pre>\n<p>compiles, but IntelliJ still cannot resolve the classes from testFixtures.</p>\n<p>Adding</p>\n<pre><code>idea {\n    module {\n        testSources.from(file(&quot;../core/src/testFixtures/java&quot;))\n        testResources.from(file(&quot;../core/src/testFixtures/resources&quot;))\n    }\n}\n</code></pre>\n<p>to the build.gradle.kts of <strong>adapter</strong> seems to do the trick, however there is one warning:</p>\n<blockquote>\n<p>Duplicate content roots detected</p>\n<p>Path [[...]/debug-microservice/application/core/src/testFixtures/resources] of module [my-project.application.adapter.test] was removed from modules [my-project.application.core.testFixtures]&quot; Also 1 more path was deduplicated. See idea log for details</p>\n</blockquote>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}