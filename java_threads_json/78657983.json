{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "multithreading"
    ],
    "owner": {
      "account_id": 19901035,
      "reputation": 1,
      "user_id": 14581028,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/b044fa4329a79cada92e5fd9d13f4cde?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Help out",
      "link": "https://stackoverflow.com/users/14581028/help-out"
    },
    "is_answered": true,
    "view_count": 79,
    "answer_count": 1,
    "score": -1,
    "last_activity_date": 1719139017,
    "creation_date": 1719126332,
    "last_edit_date": 1719127044,
    "question_id": 78657983,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78657983/duplicate-orderid-generation-in-multi-threading-environment",
    "title": "Duplicate OrderId Generation in multi threading environment",
    "body": "<p>code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>  List&lt;Future&lt;Void&gt;&gt; processFutures = new ArrayList&lt;&gt;();\n  for (BulkOrderData readData : bulkOrderDataList) {\n\n\n processFutures.add(processExcutorService.submit(() -&gt; {\n\n                        try {\n                            PushOrderDataResponse placeOrderResponse=bulkPushOrderTransactionalService.pushOrderData(readData, productRefMap.get(readData.getItemData().get(0).getProductReference()), countryCode);\n                            readData.setOrderId(placeOrderResponse.getOrderId() != null ? String.valueOf(placeOrderResponse.getOrderId()) : &quot;NA&quot;);\n                            readData.setUploadRemark(placeOrderResponse.getMessage());\n                            // return null;\n\n                        }\n                        catch (Exception e)\n                        {\n\n                            readData.setOrderId(null);\n                            readData.setUploadRemark(&quot;Error we got during placing this order, Please connect to technical team&quot;);\n\n                            logger.error(&quot;Error we got during push order in databse&quot;,e);\n\n                        }\n                        return null;\n\n\n                    }));\n//code....\n}}\n</code></pre>\n<p>it is the code showing from where i am calling my method pushOrderData(//argument) in separate class  asa this method is called by multiple thread.</p>\n<pre class=\"lang-java prettyprint-override\"><code>//data saving class\n\n\n@Service\npublic class BulkPushOrderTransactionalService {\n\n\n//method for saving \n @Transactional(rollbackFor = Exception.class )\n    public synchronized PushOrderDataResponse  pushOrderData(BulkOrderData orderData, CassandraApiResponseReader cassandraApiResponseReader, String countryCode) throws Exception {\n\n            int startOrderId = 100001;\n            Integer resMaxOrderIdRes=0;\n            try {\n                resMaxOrderIdRes = orderRepository.findOrderIdByOrderSource();\n                //resMaxOrderIdRes = generateOrderId();\n\n\n            }\n             catch (Exception e)\n            {\n\n                    throw new RuntimeException(&quot;Transaction failed in saving &quot;, e);\n\n\n\n            }\n\n           if(resMaxOrderIdRes!=null &amp;&amp; resMaxOrderIdRes!=0)\n            {\n                startOrderId=resMaxOrderIdRes;\n\n            }\n\n\n//new order id created by getting max order id firstly \n\n            newOrderId=startOrderId+1;\n\n            CustomerOrderDao customerOrderDao=new CustomerOrderDao();\n            customerOrderDao.setOrderId(newOrderId);\n           \n\n            //more data setting\n\n\n             ///saving data corrosponding to new order id \n\n            try{\n                orderRepository.save(customerOrderDao);\n                //orderDataService.sa\n                // veOrder(customerOrderDao);\n\n\n            }\n            catch (Exception e)\n            {\n\n                e.printStackTrace();\n                logger.error(&quot;error in saving data in customer order table{}&quot;, e);\n                response.setCode(404);\n                response.setMessage(&quot;Error we got during placing this order, Please connect to technical team&quot;);\n                response.setStatus(&quot;error&quot;);\n                throw new RuntimeException(&quot;Transaction failed in saving customer item history&quot;, e);\n\n\n\n            }\n\n\n// 4 more dao call where i am saving data\n\n}}\n</code></pre>\n<p>As you see in code i am trying to save data in database, and data is of size 500 and i am calling that push method that save data to database from multithreaded environment so inside push method i am firstly fetching max orderId(let say from order table) then add one to it to make new orderID and save data to database for that  new orderId (let say firstly in order table from where i get max orderId) and saving data in 4 5 other tables also.</p>\n<p>the problem i am facing is i am getting duplicate orderid as it is called by multiple thread and same orderId from table(order) read by multiple thread and make new orderId by adding one.</p>\n<p>as i marked method synchronized but problem not solved</p>\n<p>i do not want to make orderId unique in database i am using mysql data base.</p>\n<p>if i am doing it without multi-threading it is taking 2.5 to 3 minutes to  save 500 record with multi-threading 10-12 second but problem is of duplicate orderid</p>\n<p>reading 500 data from csv file with more than 35 theader (column)</p>\n<p>I need an application level solution.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}