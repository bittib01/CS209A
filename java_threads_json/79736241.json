{
  "question": {
    "tags": [
      "java",
      "virtual-threads"
    ],
    "owner": {
      "account_id": 31951,
      "reputation": 1948,
      "user_id": 88105,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/fe1c8df60629cd08b4ac37f19dcb2bde?s=256&d=identicon&r=PG",
      "display_name": "Jaromir Hamala",
      "link": "https://stackoverflow.com/users/88105/jaromir-hamala"
    },
    "is_answered": false,
    "view_count": 203,
    "answer_count": 0,
    "score": 2,
    "last_activity_date": 1755286312,
    "creation_date": 1755246766,
    "last_edit_date": 1755258365,
    "question_id": 79736241,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79736241/do-virtual-threads-cause-heap-allocations-and-gc-pressure-when-their-stack-grows",
    "title": "Do virtual threads cause heap allocations and GC pressure when their stack grows?",
    "body": "<p>I'm working with Java's virtual threads and trying to fully understand their memory management implications, specifically regarding their stacks.</p>\n<p>My current understanding is that a virtual thread's stack is not a single, contiguous block of memory like a traditional platform thread's stack. Instead, it's stored as an object (or a series of objects) on the Java heap. When a virtual thread needs to run, its stack is &quot;mounted&quot; onto a carrier (platform) thread. When it blocks, it's &quot;unmounted.&quot;</p>\n<p>This leads to my core question: What happens when a virtual thread's call stack grows beyond the capacity of its current stack chunk?</p>\n<p>For example, consider a virtual thread executing a deeply recursive method or a long chain of method calls. Its stack depth will increase.</p>\n<ul>\n<li>Does the JVM handle this by allocating a new, larger stack chunk object on the heap and copying the contents of the old, smaller chunk into it?</li>\n<li>If so, does the old stack chunk become garbage?</li>\n</ul>\n<p>My concern is that in an application with a very high number of virtual threads that have fluctuating stack depths, this process of growing stacks could lead to significant heap allocation churn and put pressure on the Garbage Collector.</p>\n<p>Could this &quot;stack resizing&quot; process become a hidden source of heap allocations and GC overhead that we need to be mindful of when designing systems with virtual threads?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}