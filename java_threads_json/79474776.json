{
  "question": {
    "tags": [
      "java",
      "hibernate",
      "session",
      "transactions",
      "payara"
    ],
    "owner": {
      "account_id": 20374460,
      "reputation": 31,
      "user_id": 14945970,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/3751b8a97e2f3ca0c88a0625effa35fc?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "DocU",
      "link": "https://stackoverflow.com/users/14945970/docu"
    },
    "is_answered": false,
    "view_count": 72,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1744628338,
    "creation_date": 1740727364,
    "last_edit_date": 1741012691,
    "question_id": 79474776,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79474776/how-do-i-start-a-new-session-transaction-for-each-object-in-a-job-with-a-for-loo",
    "title": "How do I start a new session/transaction for each object in a job with a for-loop?",
    "body": "<p>I am using Java EE, not Spring, in a Payara environment.</p>\n<p>I have a job which goes through a list of objects called &quot;position&quot;. For each position, a  complex algorithm is run, which makes several calculations and changes some objects.</p>\n<p>This job with the for-loop is either started by the user clicking a button or by a bean, which starts the job at a certain time.</p>\n<p>Something like this:</p>\n<pre><code>public void processPositions(){\n   for(Position position : shortPositions){\n       try{\n           for(Trade trade : borrowTrades){\n        \n               for(TradeEvent event : futureEvents){\n                   cancelEvent(event);\n               } // end for event\n        \n               closeTrade(trade);\n           } // end for trade\n       }catch(){\n          // handle exception here\n       }\n   } // end for position\n}\n</code></pre>\n<p>My problem is now, that, if a problem occurs when one position is processed, Hibernate rolls back the transaction, which is ok.</p>\n<p>However, when the next position is taken, the run stops with the exception <code>javax.ejb.EJBTransactionRolledbackException: Client's transaction aborted</code>.</p>\n<p>In principle, I would like to handle the changes for each position (and other corresponding objects) as a single transaction / session, which is independent from the others.</p>\n<p>How can I achieve this?</p>\n<p>I am a newbie to Hibernate. Without Hibernate, I would open a new transaction when I take the next position object in the loop. I would update/insert/delete the corresponding objects which are related to my position object by the use of SQL and in the end, I would commit everything or rollback. Then I would open a new transaction when taking the next object.\nHowever Hibernate is hiding this from the user. I believe that the call for processPositions is done within a session having a transaction. And if this transaction is rollbacked, it is used up. My question is how can I start a new transaction and make all the EntityManagers in the repositories use this new transaction when a persistent object is updated.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}