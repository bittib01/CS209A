{
  "question": {
    "tags": [
      "java",
      "gatling",
      "gatling-java"
    ],
    "owner": {
      "account_id": 8915876,
      "reputation": 4246,
      "user_id": 6654475,
      "user_type": "registered",
      "accept_rate": 100,
      "profile_image": "https://i.sstatic.net/360Vn.png?s=256",
      "display_name": "Francislainy Campos",
      "link": "https://stackoverflow.com/users/6654475/francislainy-campos"
    },
    "is_answered": true,
    "view_count": 478,
    "accepted_answer_id": 78748831,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1725897433,
    "creation_date": 1720182804,
    "last_edit_date": 1725897433,
    "question_id": 78711493,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78711493/how-to-execute-each-java-gatling-request-with-different-dynamically-updated-valu",
    "title": "How to execute each Java Gatling request with different dynamically updated values for the same virtual user?",
    "body": "<p>I have this Java Gatling simulation:</p>\n<pre><code>package com.mycompany.performancetests;\n\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.mycompany.openapi.Notification;\nimport io.gatling.javaapi.core.ChainBuilder;\nimport io.gatling.javaapi.core.ScenarioBuilder;\nimport io.gatling.javaapi.core.Simulation;\nimport io.gatling.javaapi.http.HttpProtocolBuilder;\n\nimport static io.gatling.javaapi.core.CoreDsl.*;\nimport static io.gatling.javaapi.http.HttpDsl.*;\n\npublic class MySimulation extends Simulation {\n    private final HttpProtocolBuilder httpProtocol = http\n            .disableFollowRedirect()\n            .baseUrl(BASE_URL)\n            .acceptHeader(&quot;application/json&quot;);\n       \n    private final ScenarioBuilder mainScn = scenario(&quot;MainScenario&quot;)\n            .exec(getStatus())\n            .exec(postStatus())\n            );\n\n     private static ChainBuilder getStatus() {\n        return exec(http(&quot;GetStatus&quot;)\n                .get(session -&gt; API_PATH + &quot;/notifications/00000000-0000-6000-7000-000000000000/status&quot;)\n                .check(status().is(200))\n                .check(jsonPath(&quot;$[0].id&quot;).notNull())\n                .check(jsonPath(&quot;$[0].modelVersion&quot;).notNull().saveAs(&quot;modelVersion&quot;))\n        );\n    }\n\n    private static ChainBuilder postStatus() {\n        return exec(session -&gt; {\n            // Retrieve the current modelVersion from the session\n            String currentModelVersion = session.getString(&quot;modelVersion&quot;);\n            // Increment the modelVersion by 1\n            int incrementedModelVersion = Integer.parseInt(currentModelVersion) + 1;\n            // Update the session with the incremented modelVersion\n            session.set(&quot;modelVersion&quot;, String.valueOf(incrementedModelVersion));\n            return session;\n        }).exec(http(&quot;PostStatus&quot;)\n                .post(session -&gt; API_PATH + &quot;/notifications/00000000-0000-6000-7000-000000000000/status&quot;)\n                .header(&quot;Content-Type&quot;, &quot;application/json&quot;)\n                .header(&quot;Accept&quot;, &quot;application/json&quot;)\n                .body(StringBody(session -&gt; &quot;&quot;&quot;\n                {\n                   &quot;comment&quot;:&quot;&quot;,\n                   &quot;fiFlaggedStatus&quot;:&quot;FLAGGED&quot;,\n                   &quot;investigationAssessment&quot;:&quot;WORTHY&quot;,\n                   &quot;investigationStatus&quot;:&quot;COMPLETED&quot;,\n                   &quot;panRiskScore&quot;:986,\n                   &quot;modelVersion&quot;:&quot;%s&quot;,\n                   &quot;created&quot;:&quot;2026-07-02T08:20:38.814Z&quot;,\n                   &quot;id&quot;:&quot;&quot;\n                }\n                &quot;&quot;&quot;.formatted(session.getString(&quot;modelVersion&quot;))))\n                .check(status().is(200))\n                .check(jsonPath(&quot;$.modelVersion&quot;).saveAs(&quot;modelVersion&quot;)) // Add this line\n                .check(jsonPath(&quot;$.id&quot;).notNull()));\n    }\n\n    {\n        setUp(mainScn.injectOpen(atOnceUsers(2))).protocols(httpProtocol); \n    }\n}\n\n</code></pre>\n<p>which generates the following sequence of curl requests:</p>\n<pre><code>curl -X GET &quot;https://myurl/00000000-0000-6000-7000-000000000000/status&quot; \\\n -H &quot;accept: application/json&quot; \\\n\ncurl -X POST &quot;https://myurl/00000000-0000-6000-7000-000000000000/status&quot; \\\n -H &quot;accept: application/json&quot; \\\n -H &quot;Content-Type: application/json&quot; \\\n --data-binary '{&quot;comment&quot;:&quot;&quot;,&quot;fiFlaggedStatus&quot;:&quot;FLAGGED&quot;,&quot;investigationAssessment&quot;:&quot;WORTHY&quot;,&quot;investigationStatus&quot;:&quot;COMPLETED&quot;,&quot;panRiskScore&quot;:986,&quot;modelVersion&quot;:&quot;1&quot;,&quot;created&quot;:&quot;2026-07-02T08:20:38.814Z&quot;,&quot;id&quot;:&quot;&quot;}'\n\ncurl -X POST &quot;https://myurl/00000000-0000-6000-7000-000000000000/status&quot; \\\n -H &quot;accept: application/json&quot; \\\n -H &quot;Content-Type: application/json&quot; \\\n --data-binary '{&quot;comment&quot;:&quot;&quot;,&quot;fiFlaggedStatus&quot;:&quot;FLAGGED&quot;,&quot;investigationAssessment&quot;:&quot;WORTHY&quot;,&quot;investigationStatus&quot;:&quot;COMPLETED&quot;,&quot;panRiskScore&quot;:986,&quot;modelVersion&quot;:&quot;1&quot;,&quot;created&quot;:&quot;2026-07-02T08:20:38.814Z&quot;,&quot;id&quot;:&quot;&quot;}'\n</code></pre>\n<p>However, I need the post status to be executed with different model versions (incremented by 1 integer between requests), so that it won't fail with a 409 conflict.\nFor the initial value, it should add 1 on top of what is already in the database, which is retrieved as part of the get status api. This value is subsequently also part of the response for the post status request. However, as it can be seen by the curl requests, the two post requests are being executed both with the same model version and I'm not sure what to do to bypass that.</p>\n<p>Thank you.</p>\n<p><strong>Update</strong></p>\n<p>Tried the below simulation using Atomic increment, but am still facing the issue as the requests don't seem to be executed in the expected order (post status with model version as 1 being called after post status with model version as 2)</p>\n<pre><code>import io.gatling.javaapi.core.ChainBuilder;\nimport io.gatling.javaapi.core.ScenarioBuilder;\nimport io.gatling.javaapi.core.Simulation;\nimport io.gatling.javaapi.http.HttpProtocolBuilder;\n\nimport java.util.concurrent.atomic.AtomicInteger;\n\nimport static io.gatling.javaapi.core.CoreDsl.*;\nimport static io.gatling.javaapi.http.HttpDsl.http;\nimport static io.gatling.javaapi.http.HttpDsl.status;\n\npublic class MySimulation extends Simulation {\n    private static final String BASE_URL = &quot;myurl&quot;;\n    private static final String CID = &quot;125283&quot;;\n    private static final String ICAS = &quot;31931,5655,20929,9529,31627&quot;;\n    private static final String API_PATH = &quot;/notifications/00000000-0000-6000-7000-000000000000/status&quot;;\n\n    // Initialize atomic counter\n    private static final AtomicInteger atomicModelVersion = new AtomicInteger();\n\n    private final HttpProtocolBuilder httpProtocol = http\n            .disableFollowRedirect()\n            .baseUrl(BASE_URL)\n            .acceptHeader(&quot;application/json&quot;);\n\n    private final ScenarioBuilder mainScn = scenario(&quot;MainScenario&quot;)\n            .exec(getStatus())\n            .exec(pause(1))\n            .exec(postStatus());\n\n    private static ChainBuilder getStatus() {\n        return exec(http(&quot;GetStatus&quot;)\n                .get(API_PATH)\n                .check(status().is(200))\n                .check(jsonPath(&quot;$[0].id&quot;).notNull())\n                .check(jsonPath(&quot;$[0].modelVersion&quot;).optional().saveAs(&quot;modelVersion&quot;))\n        ).exec(session -&gt; {\n            // Retrieve the modelVersion from the session\n            String modelVersionStr = session.getString(&quot;modelVersion&quot;);\n            // Set modelVersion to 1 if it is null or empty\n            int initialModelVersion = (modelVersionStr == null || modelVersionStr.isEmpty()) ? 0 : Integer.parseInt(modelVersionStr);\n            // Set the atomic counter to the initial model version\n            atomicModelVersion.set(initialModelVersion);\n            return session.set(&quot;modelVersion&quot;, String.valueOf(initialModelVersion));\n        });\n    }\n\n    private static ChainBuilder postStatus() {\n        return exec(session -&gt; {\n            // Get the current modelVersion\n            int currentModelVersion = atomicModelVersion.get();\n            // Update the session with the current modelVersion\n            session = session.set(&quot;modelVersion&quot;, String.valueOf(currentModelVersion));\n            // Increment the atomic counter for the next request\n            atomicModelVersion.incrementAndGet();\n            return session;\n        }).exec(http(&quot;PostStatus&quot;)\n                .post(API_PATH)\n                .header(&quot;Content-Type&quot;, &quot;application/json&quot;)\n                .header(&quot;Accept&quot;, &quot;application/json&quot;)\n                .body(StringBody(session -&gt; &quot;&quot;&quot;\n                {\n                   &quot;comment&quot;:&quot;&quot;,\n                   &quot;fiFlaggedStatus&quot;:&quot;FLAGGED&quot;,\n                   &quot;investigationAssessment&quot;:&quot;WORTHY&quot;,\n                   &quot;investigationStatus&quot;:&quot;COMPLETED&quot;,\n                   &quot;panRiskScore&quot;:986,\n                   &quot;modelVersion&quot;:&quot;%s&quot;,\n                   &quot;id&quot;:&quot;&quot;\n                }\n                &quot;&quot;&quot;.formatted(session.getString(&quot;modelVersion&quot;))))\n                .check(status().is(200))\n                .check(jsonPath(&quot;$.modelVersion&quot;).saveAs(&quot;modelVersion&quot;))\n                .check(jsonPath(&quot;$.id&quot;).notNull()));\n    }\n\n    {\n        setUp(mainScn.injectOpen(atOnceUsers(2))).protocols(httpProtocol);\n    }\n}\n\n\ncurl -X GET &quot;https://myurl/00000000-0000-6000-7000-000000000000/status&quot; \\\n -H &quot;accept: application/json&quot; \\\n\ncurl -X GET &quot;https://myurl/00000000-0000-6000-7000-000000000000/status&quot; \\\n -H &quot;accept: application/json&quot; \\\n\ncurl -X POST &quot;https://myurl/00000000-0000-6000-7000-000000000000/status&quot; \\\n -H &quot;accept: application/json&quot; \\\n -H &quot;Content-Type: application/json&quot; \\\n --data-binary '{&quot;comment&quot;:&quot;&quot;,&quot;fiFlaggedStatus&quot;:&quot;FLAGGED&quot;,&quot;investigationAssessment&quot;:&quot;WORTHY&quot;,&quot;investigationStatus&quot;:&quot;COMPLETED&quot;,&quot;panRiskScore&quot;:986,&quot;modelVersion&quot;:&quot;2&quot;,&quot;id&quot;:&quot;&quot;}'\n\ncurl -X POST &quot;https://myurl/00000000-0000-6000-7000-000000000000/status&quot; \\\n -H &quot;accept: application/json&quot; \\\n -H &quot;Content-Type: application/json&quot; \\\n --data-binary '{&quot;comment&quot;:&quot;&quot;,&quot;fiFlaggedStatus&quot;:&quot;FLAGGED&quot;,&quot;investigationAssessment&quot;:&quot;WORTHY&quot;,&quot;investigationStatus&quot;:&quot;COMPLETED&quot;,&quot;panRiskScore&quot;:986,&quot;modelVersion&quot;:&quot;1&quot;,&quot;id&quot;:&quot;&quot;}'\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}