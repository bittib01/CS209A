{
  "question": {
    "tags": [
      "java",
      "ssl",
      "httpclient",
      "java-11",
      "handshake"
    ],
    "owner": {
      "account_id": 31652365,
      "reputation": 1,
      "user_id": 24471138,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/ab6f3a3b75551d97f374722d88634d06?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "winmor",
      "link": "https://stackoverflow.com/users/24471138/winmor"
    },
    "is_answered": false,
    "view_count": 149,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1714998071,
    "creation_date": 1713450314,
    "last_edit_date": 1714998071,
    "question_id": 78348248,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78348248/incorrect-inner-plaintext-no-content-type-in-ssl-communication",
    "title": "&quot;Incorrect inner plaintext: no content type&quot; in SSL communication",
    "body": "<p>Multiple computers works with the same application. And every day after few hour of work small part of them have a problem with handshake to external services.</p>\n<pre><code>javax.net.ssl.SSLHandshakeException: Incorrect inner plaintext: no content type\n        at java.base/sun.security.ssl.Alert.createSSLException(Alert.java:131)\n        at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:326)\n        at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:269)\n        at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:264)\n        at java.base/sun.security.ssl.SSLTransport.decode(SSLTransport.java:129)\n        at java.base/sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1144)\n        at java.base/sun.security.ssl.SSLSocketImpl.readHandshakeRecord(SSLSocketImpl.java:1055)\n        at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:395)\n        at java.base/sun.security.ssl.SSLSocketImpl.ensureNegotiated(SSLSocketImpl.java:709)\n        at java.base/sun.security.ssl.SSLSocketImpl$AppOutputStream.write(SSLSocketImpl.java:962)\n        at java.base/java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:81)\n        at java.base/java.io.BufferedOutputStream.write(BufferedOutputStream.java:122)\n        at java.base/java.io.FilterOutputStream.write(FilterOutputStream.java:108)\n        at org.apache.commons.httpclient.WireLogOutputStream.write(WireLogOutputStream.java:85)\n        at org.apache.commons.httpclient.methods.StringRequestEntity.writeRequest(StringRequestEntity.java:149)\n        at org.apache.commons.httpclient.methods.EntityEnclosingMethod.writeRequestBody(EntityEnclosingMethod.java:495)\n        at org.apache.commons.httpclient.HttpMethodBase.writeRequest(HttpMethodBase.java:1973)\n        at org.apache.commons.httpclient.HttpMethodBase.execute(HttpMethodBase.java:993)\n        at org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:397)\n        at org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:170)\n        at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:396)\n        at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:324)\n        ...\nCaused by: javax.crypto.BadPaddingException: Incorrect inner plaintext: no content type\n        at java.base/sun.security.ssl.SSLCipher$T13GcmReadCipherGenerator$GcmReadCipher.decrypt(SSLCipher.java:1924)\n        at java.base/sun.security.ssl.SSLSocketInputRecord.decodeInputRecord(SSLSocketInputRecord.java:262)\n        at java.base/sun.security.ssl.SSLSocketInputRecord.decode(SSLSocketInputRecord.java:190)\n        at java.base/sun.security.ssl.SSLTransport.decode(SSLTransport.java:108)\n        ... 24 common frames omitted\n</code></pre>\n<p>I've prepared tcpdump during problem and without problem, packets looks good. I don't know why error occured. Search in heapdump did not help.</p>\n<p>The problem disappears after application restart.</p>\n<p>Additional information:</p>\n<ul>\n<li>application running on OpenJDK 11.0.7</li>\n<li>OS openSUSE 15.2</li>\n<li>problem occurs only on machines with old/weak CPU other machines never had a problem</li>\n<li>problem detected only for service with TLS 1.3</li>\n<li>when problem occured every request for TLS 1.3 failed</li>\n<li>old apache.commons.httpclient and newest CloseableHttpClient has problem (same stack inside java)</li>\n</ul>\n<p>Does anyone know a similar problem? What else could I check to find a solution?</p>\n<p>Additional information:</p>\n<p>After run JavaFlightRecorder problem with plaintext diseapear. I'dont know why.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}