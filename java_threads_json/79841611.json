{
  "question": {
    "tags": [
      "java",
      "java-8",
      "heap-memory",
      "profiling",
      "method-reference"
    ],
    "owner": {
      "account_id": 10595663,
      "reputation": 5182,
      "user_id": 7804477,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/jMY74.jpg?s=256",
      "display_name": "Gautham M",
      "link": "https://stackoverflow.com/users/7804477/gautham-m"
    },
    "is_answered": true,
    "view_count": 241,
    "closed_date": 1765296111,
    "accepted_answer_id": 79841612,
    "answer_count": 1,
    "score": 6,
    "last_activity_date": 1765712354,
    "creation_date": 1765264017,
    "question_id": 79841611,
    "link": "https://stackoverflow.com/questions/79841611/java-map-computeifabsent-consuming-high-memory",
    "closed_reason": "Duplicate",
    "title": "Java Map.computeIfAbsent consuming high memory",
    "body": "<p>I had written a method to update a <code>HashMap</code>, provided an <code>int</code> id value (ex: client id) as key, the method would check if the key is available in the map, if not it would create an entry and associate a new <code>ArrayList</code> for the key. If available, then it would return the existing list. Initially, I wrote the method using <code>map.containsKey</code> combined with <code>map.put</code>.</p>\n<pre><code>if(map.containsKey(id)) {\n    return map.get(id);\n} else {\n    List&lt;CustomObject&gt; list = new ArrayList&lt;&gt;();\n    map.put(id, list);\n    return list;\n}\n</code></pre>\n<p>The above was working fine, later I thought of refactoring it to use <code>computeIfAbsent</code> which would do the above same thing.\nHence I changed the method as</p>\n<pre><code>return map.computeIfAbsent(id, ArrayList::new);\n</code></pre>\n<p>Even though I expected it to work, I encountered an unexpected heap memory consumption during performance testing. Any idea why the new code is consuming a lot of heap memory.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}