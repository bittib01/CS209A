{
  "question": {
    "tags": [
      "java",
      "android",
      "push-notification",
      "android-notifications"
    ],
    "owner": {
      "account_id": 35439137,
      "reputation": 1,
      "user_id": 27203104,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/0e12e0378c6d7f40749e8754b03b841e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Cra ck",
      "link": "https://stackoverflow.com/users/27203104/cra-ck"
    },
    "is_answered": false,
    "view_count": 182,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1743625392,
    "creation_date": 1725529067,
    "last_edit_date": 1725530433,
    "question_id": 78952326,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78952326/media-player-notification-created-with-foreground-service-not-showing-on-lock-sc",
    "title": "Media player notification created with foreground service not showing on lock screen (Android 13, SDK 34)",
    "body": "<ol>\n<li><p>Called from HomeActivity</p>\n<p>This is the part where the service function is called from the main activity. It is called differently depending on the version.</p>\n<pre class=\"lang-java prettyprint-override\"><code>Intent serviceIntent = new Intent(HomeActivity.this, MyService.class);\nif (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {\n    startForegroundService(serviceIntent);\n} else {\n    startService(serviceIntent);\n}\n</code></pre>\n</li>\n<li><p>MyService Class</p>\n<p>The <code>NotificationManager.IMPORTANCE_HIGH</code> is specified. The <code>setLockscreenVisibility(Notification.VISIBILITY_PUBLIC)</code> is set.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class MyService extends Service {\n    private static final String CHANNEL_ID = &quot;TTS_NOTI&quot;;\n    private static final int NOTIFICATION_ID = 999;\n\n    @Override\n    public IBinder onBind(Intent intent) {\n        return null;\n    }\n\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        createNotificationChannel();\n        showTTSNotification();  // Create notification\n        return START_STICKY;\n    }\n\n    private void createNotificationChannel() {\n        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {\n            NotificationChannel channel = new NotificationChannel(\n                    CHANNEL_ID,\n                    &quot;TTS Notifications&quot;,\n                    NotificationManager.IMPORTANCE_HIGH\n            );\n            channel.setDescription(&quot;Notifications for TTS control&quot;);\n            channel.setLockscreenVisibility(Notification.VISIBILITY_PUBLIC);\n            NotificationManager manager = getSystemService(NotificationManager.class);\n            manager.createNotificationChannel(channel);\n        }\n    }\n\n    private void showTTSNotification() {\n        // MediaSession setup\n        MediaSessionCompat mediaSession = new MediaSessionCompat(this, &quot;TTS_MediaSession&quot;);\n        mediaSession.setActive(true);\n\n        // Set large icon\n        Bitmap largeIcon = BitmapFactory.decodeResource(getResources(), R.drawable.icon);\n\n        // Create intent to bring the app to the foreground\n        Intent notificationIntent = new Intent(this, HomeActivity.class);\n        PendingIntent pendingIntent = PendingIntent.getActivity(this, 0, notificationIntent, PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);\n\n        // Create NotificationCompat.Builder\n        NotificationCompat.Builder builder = new NotificationCompat.Builder(this, CHANNEL_ID)\n                .setSmallIcon(R.drawable.icon)\n                .setLargeIcon(largeIcon)\n                .setContentTitle(&quot;Song Title&quot;)\n                .setContentText(&quot;Artist Name&quot;)\n                .setContentIntent(pendingIntent)\n                .setPriority(NotificationCompat.PRIORITY_MAX)\n                .setOngoing(true)\n                .setCategory(NotificationCompat.CATEGORY_SERVICE)\n                .setVisibility(NotificationCompat.VISIBILITY_PUBLIC)\n                .setStyle(new MediaStyle().setMediaSession(mediaSession.getSessionToken())\n                        .setShowActionsInCompactView(0, 1, 2))\n                .addAction(new NotificationCompat.Action(R.drawable.play_prev, &quot;Previous&quot;, getPendingIntent(&quot;PREVIOUS&quot;)))\n                .addAction(new NotificationCompat.Action(R.drawable.play, &quot;Play&quot;, getPendingIntent(&quot;PLAY_PAUSE&quot;)))\n                .addAction(new NotificationCompat.Action(R.drawable.play_next, &quot;Next&quot;, getPendingIntent(&quot;NEXT&quot;)));\n\n        // Run the service in the foreground\n        startForeground(NOTIFICATION_ID, builder.build());\n    }\n\n    private PendingIntent getPendingIntent(String action) {\n        Intent intent = new Intent(this, NotificationReceiver.class);\n        intent.setAction(action);\n        return PendingIntent.getBroadcast(this, 0, intent, PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);\n    }\n\n    @Override\n    public void onDestroy() {\n        super.onDestroy();\n        Log.e(&quot;MyService&quot;, &quot;Service destroyed&quot;);\n    }\n}\n</code></pre>\n</li>\n<li><p>Parts written in AndroiManifest.xml</p>\n<p>And I have added the necessary permissions in the <code>AndroidManifest</code>.</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;uses-permission android:name=&quot;android.permission.ACCESS_NOTIFICATION_POLICY&quot; /&gt;\n&lt;uses-permission android:name=&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot; /&gt;\n&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;\n&lt;uses-permission android:name=&quot;android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK&quot; /&gt;\n\n\n&lt;serviceandroid:name=&quot;.etc.MyService&quot;\nandroid:foregroundServiceType=&quot;mediaPlayback&quot;\nandroid:permission=&quot;android.permission.FOREGROUND_SERVICE&quot;/&gt;\n&lt;receiver android:name=&quot;.etc.NotificationReceiver&quot;/&gt;\n</code></pre>\n</li>\n</ol>\n<p>I have searched extensively on Google but have not found a solution. I would greatly appreciate any links or information that you could provide.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}