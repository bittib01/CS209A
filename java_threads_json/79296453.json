{
  "question": {
    "tags": [
      "java",
      "google-cloud-platform",
      "google-cloud-storage"
    ],
    "owner": {
      "account_id": 6770704,
      "reputation": 407,
      "user_id": 5214137,
      "user_type": "registered",
      "accept_rate": 100,
      "profile_image": "https://graph.facebook.com/1001197146568710/picture?type=large",
      "display_name": "Akshansh Jain",
      "link": "https://stackoverflow.com/users/5214137/akshansh-jain"
    },
    "is_answered": true,
    "view_count": 290,
    "accepted_answer_id": 79308710,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1735189967,
    "creation_date": 1734679508,
    "last_edit_date": 1734684908,
    "question_id": 79296453,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79296453/getting-403-from-gcp-metadata-server",
    "title": "Getting 403 from GCP metadata server",
    "body": "<p>I'm using GCP storage to upload a file and return it's signed/public URL.</p>\n<p>I'm getting below error when trying to signUrl after uploading my file to gcp storage.</p>\n<pre><code>Caused by: java.io.IOException: Unexpected Error code 403 trying to get service accounts from Compute Engine metadata: This metadata endpoint is concealed for ?recursive calls\n\n    at com.google.auth.oauth2.ComputeEngineCredentials.getDefaultServiceAccount(ComputeEngineCredentials.java:383)\n    at com.google.auth.oauth2.ComputeEngineCredentials.getAccount(ComputeEngineCredentials.java:336)\n    ... 18 common frames omitted\n</code></pre>\n<p>This is specifically when service-account call goes to gcp metadata.</p>\n<pre><code>com.google.auth.oauth2.ComputeEngineCredentials#getDefaultServiceAccount\n</code></pre>\n<pre><code>HttpResponse response = getMetadataResponse(getServiceAccountsUrl());\n</code></pre>\n<p>My GCP java library version is 1.80.0.</p>\n<p>Not able to find this error anywhere.</p>\n<p>Let me know if any further details are required here.</p>\n<p>EDIT 1:</p>\n<p>This is a minimal version of the actual code, gist of what is happening.</p>\n<pre><code>int ttlInMinutes = 5;\nString objectName = &quot;object-name&quot;;\nString bucket = &quot;some-bucket&quot;;\nStorage storage = StorageOptions.getDefaultInstance().getService();\nBlobInfo blobinfo = BlobInfo.newBuilder(BlobId.of(bucket, objectName)).build();\nURL url = storage.signUrl(blobinfo, ttlInMinutes, TimeUnit.MINUTES, withV4Signature());\n</code></pre>\n<p>At this point, I get the mentioned error.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}