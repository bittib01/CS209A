{
  "question": {
    "tags": [
      "java",
      "android",
      "imageview",
      "android-gps"
    ],
    "owner": {
      "account_id": 33105380,
      "reputation": 13,
      "user_id": 25665044,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/522f1eb24536980f1edb5f5de9ef49e7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "player45899",
      "link": "https://stackoverflow.com/users/25665044/player45899"
    },
    "is_answered": true,
    "view_count": 257,
    "accepted_answer_id": 78652520,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1733468393,
    "creation_date": 1718974374,
    "question_id": 78652474,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78652474/how-to-extract-gps-coordinates-from-an-imageview-in-android-studio",
    "title": "How to extract gps coordinates from an ImageView in Android Studio",
    "body": "<p>I have an android app in which I want to display the GPS Coordinates of an ImageView, that I get from the users image uploads. My Code looks like the following:</p>\n<pre><code>package com.example.app;\n\nimport android.Manifest;\nimport android.annotation.SuppressLint;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.content.pm.PackageManager;\nimport android.graphics.Bitmap;\nimport android.location.Location;\nimport android.location.LocationListener;\nimport android.location.LocationManager;\nimport androidx.exifinterface.media.ExifInterface;\nimport android.net.Uri;\nimport android.os.Build;\nimport android.os.Bundle;\nimport android.provider.MediaStore;\nimport android.util.Log;\nimport android.view.View;\nimport android.widget.ArrayAdapter;\nimport android.widget.Button;\nimport android.widget.ImageView;\nimport android.widget.Spinner;\nimport android.widget.TextView;\nimport android.widget.Toast;\n\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.core.app.ActivityCompat;\nimport androidx.core.content.ContextCompat;\n\nimport com.drew.imaging.ImageMetadataReader;\nimport com.drew.imaging.ImageProcessingException;\nimport com.drew.lang.Rational;\nimport com.drew.metadata.Directory;\nimport com.drew.metadata.Metadata;\nimport com.drew.metadata.Tag;\nimport com.drew.metadata.exif.GpsDirectory;\nimport com.example.java_lib.client.Client;\n\nimport java.io.ByteArrayOutputStream;\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.util.Arrays;\n\npublic class MainActivity extends AppCompatActivity implements LocationListener {\n\n    private static final String TAG = &quot;MainActivity&quot;;\n    private static final int REQUEST_LOCATION_PERMISSION = 1;\n\n    Button uploadButton, cameraButton, analyzeButton;\n    TextView result;\n    ImageView image;\n    Bitmap bitmap;\n    double[] gpsCoordinates = null;\n\n    private LocationManager locationManager;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        askForPermission();\n\n        Spinner spinner = findViewById(R.id.spinner_drop);\n        ArrayAdapter&lt;CharSequence&gt; adapter = ArrayAdapter.createFromResource(\n                this,\n                R.array.LMMs,\n                android.R.layout.simple_spinner_item\n        );\n        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);\n        spinner.setAdapter(adapter);\n        uploadButton = findViewById(R.id.uploadButton);\n        cameraButton = findViewById(R.id.cameraButton);\n        analyzeButton = findViewById(R.id.analyzeButton);\n        result = findViewById(R.id.result);\n        image = findViewById(R.id.imageView2);\n\n        uploadButton.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                Intent intent = new Intent();\n                intent.setAction(Intent.ACTION_GET_CONTENT);\n                intent.setType(&quot;image/*&quot;);\n                startActivityForResult(intent, 1);\n            }\n        });\n\n        cameraButton.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                if (ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\n                    ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.ACCESS_FINE_LOCATION}, REQUEST_LOCATION_PERMISSION);\n                } else {\n                    getLocationAndCaptureImage();\n                }\n            }\n        });\n\n        analyzeButton.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                if (bitmap != null) {\n                    new Thread(new Runnable() {\n                        @Override\n                        public void run() {\n                            sendImageAndCoordinatesToServer(bitmap, gpsCoordinates);\n                        }\n                    }).start();\n                } else {\n                    runOnUiThread(new Runnable() {\n                        @Override\n                        public void run() {\n                            Toast.makeText(MainActivity.this, &quot;No image available. Please select or capture an image first.&quot;, Toast.LENGTH_SHORT).show();\n                        }\n                    });\n                }\n            }\n        });\n\n        locationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE);\n    }\n\n    private void getLocationAndCaptureImage() {\n        try {\n            locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 0, 0, this);\n            Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);\n            startActivityForResult(intent, 2);\n        } catch (SecurityException e) {\n            e.printStackTrace();\n        }\n    }\n\n    @Override\n    public void onLocationChanged(@NonNull Location location) {\n        gpsCoordinates = new double[]{location.getLatitude(), location.getLongitude()};\n        locationManager.removeUpdates(this);\n    }\n\n    void askForPermission() {\n        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {\n            if (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED ||\n                    checkSelfPermission(Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\n                ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.CAMERA, Manifest.permission.ACCESS_FINE_LOCATION}, 2);\n            }\n        }\n    }\n\n    @SuppressLint(&quot;MissingSuperCall&quot;)\n    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\n        if (requestCode == 2) {\n            if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] != PackageManager.PERMISSION_GRANTED) {\n                this.askForPermission();\n            }\n        } else if (requestCode == REQUEST_LOCATION_PERMISSION) {\n            if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {\n                getLocationAndCaptureImage();\n            } else {\n                Toast.makeText(this, &quot;Location permission is required to capture GPS data&quot;, Toast.LENGTH_SHORT).show();\n            }\n        }\n    }\n\n    @Override\n    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {\n        if (requestCode == 1 &amp;&amp; resultCode == RESULT_OK &amp;&amp; data != null) {\n            Uri uri = data.getData();\n            result.setText(uri.toString());\n            try {\n                bitmap = MediaStore.Images.Media.getBitmap(this.getContentResolver(), uri);\n                image.setImageBitmap(bitmap);\n\n                // Speichern Sie das Bitmap in einer Datei\n                File savedImageFile = saveBitmapToFile(bitmap);\n                if (savedImageFile != null) {\n                    String filePath = savedImageFile.getAbsolutePath();\n                    gpsCoordinates = extractGPSData(filePath);\n                    result.setText(&quot;Latitude: &quot; + gpsCoordinates[0] + &quot;, Longitude: &quot; + gpsCoordinates[1]);\n                } else {\n                    result.setText(&quot;Failed to save image.&quot;);\n                }\n            } catch (IOException e) {\n                throw new RuntimeException(e);\n            }\n        } else if (requestCode == 2 &amp;&amp; resultCode == RESULT_OK &amp;&amp; data != null) {\n            bitmap = (Bitmap) data.getExtras().get(&quot;data&quot;);\n            image.setImageBitmap(bitmap);\n\n            // Speichern Sie das Bitmap in einer Datei\n            File savedImageFile = saveBitmapToFile(bitmap);\n            if (savedImageFile != null) {\n                String filePath = savedImageFile.getAbsolutePath();\n                try {\n                    gpsCoordinates = extractGPSData(filePath);\n                } catch (IOException e) {\n                    throw new RuntimeException(e);\n                }\n                result.setText(&quot;Latitude: &quot; + gpsCoordinates[0] + &quot;, Longitude: &quot; + gpsCoordinates[1]);\n            } else {\n                result.setText(&quot;Failed to save image.&quot;);\n            }\n        }\n        super.onActivityResult(requestCode, resultCode, data);\n    }\n\n\n\n\n    private double[] extractGPSData(String filePath) throws IOException {\n        File imageFile = new File(filePath);\n        Metadata metadata = null;\n        try {\n            metadata = ImageMetadataReader.readMetadata(imageFile);\n        } catch (ImageProcessingException e) {\n            throw new RuntimeException(e);\n        }\n\n        // Log all metadata for debugging purposes\n        for (com.drew.metadata.Directory directory : metadata.getDirectories()) {\n            for (com.drew.metadata.Tag tag : directory.getTags()) {\n                Log.d(&quot;Metadata&quot;, directory.getName() + &quot; - &quot; + tag.getTagName() + &quot; - &quot; + tag.getDescription());\n            }\n        }\n\n        GpsDirectory gpsDirectory = metadata.getFirstDirectoryOfType(GpsDirectory.class);\n        double[] gpsCoordinates = new double[2];\n\n        if (gpsDirectory != null) {\n            Rational[] latitudes = gpsDirectory.getRationalArray(GpsDirectory.TAG_LATITUDE);\n            Rational[] longitudes = gpsDirectory.getRationalArray(GpsDirectory.TAG_LONGITUDE);\n            String latRef = gpsDirectory.getString(GpsDirectory.TAG_LATITUDE_REF);\n            String lonRef = gpsDirectory.getString(GpsDirectory.TAG_LONGITUDE_REF);\n\n            Log.d(&quot;GPS Data&quot;, &quot;Latitudes: &quot; + Arrays.toString(latitudes));\n            Log.d(&quot;GPS Data&quot;, &quot;Longitudes: &quot; + Arrays.toString(longitudes));\n            Log.d(&quot;GPS Data&quot;, &quot;Latitude Ref: &quot; + latRef);\n            Log.d(&quot;GPS Data&quot;, &quot;Longitude Ref: &quot; + lonRef);\n\n            if (latitudes != null &amp;&amp; longitudes != null &amp;&amp; latRef != null &amp;&amp; lonRef != null) {\n                double latitude = convertToDegree(latitudes);\n                if (latRef.equals(&quot;S&quot;)) {\n                    latitude = -latitude;\n                }\n                double longitude = convertToDegree(longitudes);\n                if (lonRef.equals(&quot;W&quot;)) {\n                    longitude = -longitude;\n                }\n                gpsCoordinates[0] = latitude;\n                gpsCoordinates[1] = longitude;\n                Log.d(&quot;GPS Data&quot;, &quot;Latitude: &quot; + latitude + &quot;, Longitude: &quot; + longitude);\n            } else {\n                Log.d(&quot;GPS Data&quot;, &quot;GPS data not found or incomplete.&quot;);\n                result.setText(&quot;No GPS data found.&quot;);\n            }\n        } else {\n            Log.d(&quot;GPS Data&quot;, &quot;GPS directory not found.&quot;);\n            result.setText(&quot;No GPS data found.&quot;);\n        }\n\n        return gpsCoordinates;\n    }\n\n\n\n    private double convertToDegree(Rational[] rationalArray) {\n        double degrees = rationalArray[0].doubleValue();\n        double minutes = rationalArray[1].doubleValue();\n        double seconds = rationalArray[2].doubleValue();\n        return degrees + (minutes / 60.0) + (seconds / 3600.0);\n    }\n\n\n\n    private double[] extractGPSDataFromBitmap(Bitmap bitmap) throws IOException {\n        File file = new File(getExternalFilesDir(null), &quot;temp_image.jpg&quot;);\n        try (FileOutputStream fos = new FileOutputStream(file)) {\n            bitmap.compress(Bitmap.CompressFormat.JPEG, 100, fos);\n        }\n        return extractGPSData(String.valueOf(Uri.fromFile(file)));\n    }\n\n    private void sendImageAndCoordinatesToServer(Bitmap bitmap, double[] gpsCoordinates) {\n        try {\n            ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();\n            bitmap.compress(Bitmap.CompressFormat.JPEG, 100, byteArrayOutputStream);\n            byte[] imageBytes = byteArrayOutputStream.toByteArray();\n           // new Client(imageBytes, gpsCoordinates).start();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    private String getFilePathFromUri(Uri uri) {\n        String filePath = null;\n        try {\n            InputStream inputStream = getContentResolver().openInputStream(uri);\n            File tempFile = createTempFileFrom(inputStream);\n            filePath = tempFile.getAbsolutePath();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return filePath;\n    }\n\n    private File createTempFileFrom(InputStream inputStream) throws IOException {\n        File tempFile = File.createTempFile(&quot;temp_image&quot;, &quot;.jpg&quot;, getCacheDir());\n        tempFile.deleteOnExit();\n        try (FileOutputStream out = new FileOutputStream(tempFile)) {\n            byte[] buffer = new byte[1024];\n            int bytesRead;\n            while ((bytesRead = inputStream.read(buffer)) != -1) {\n                out.write(buffer, 0, bytesRead);\n            }\n        }\n        return tempFile;\n    }\n\n    private File saveBitmapToFile(Bitmap bitmap) {\n        File tempFile = null;\n        try {\n            tempFile = File.createTempFile(&quot;temp_image&quot;, &quot;.jpg&quot;, getCacheDir());\n            tempFile.deleteOnExit();\n            FileOutputStream out = new FileOutputStream(tempFile);\n            bitmap.compress(Bitmap.CompressFormat.JPEG, 100, out);\n            out.close();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return tempFile;\n    }\n\n\n}\n</code></pre>\n<p>The problem I now have is, that the &quot;extractGPSData(String filePath)&quot; function doesn't return me the GPS Coordinates, because if you look into the logcats metadata of an uploaded image, you'll see, that the metadata for the pictures are 0.0. Is this a problem from my side or how could I extract the GPS Coordinates of an uploaded image. Thank you very much!</p>\n<p>I tried the method I currently have to extract the GPS coordinates. I also tried getting the latitude and longtitude from another stackoverflow post:</p>\n<pre><code>ExifInterface exif = new ExifInterface(filepath);\nexif.getAttribute(ExifInterface.TAG_GPS_LATITUDE);\nexif.getAttribute(ExifInterface.TAG_GPS_LATITUDE_REF);\nexif.getAttribute(ExifInterface.TAG_GPS_LONGITUDE);\nexif.getAttribute(ExifInterface.TAG_GPS_LONGITUDE_REF);\n</code></pre>\n<p>I'm a bit confused.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}