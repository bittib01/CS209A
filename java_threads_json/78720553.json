{
  "question": {
    "tags": [
      "java",
      "reactjs",
      "authentication",
      "vaadin",
      "tsx"
    ],
    "owner": {
      "account_id": 30235973,
      "reputation": 1,
      "user_id": 23172296,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/ACg8ocKJ7EUmOPJHhvQsWcoYEm2fL2eorDoOrhpEvglvPI-x=k-s256",
      "display_name": "Ninoslol Ninoslol",
      "link": "https://stackoverflow.com/users/23172296/ninoslol-ninoslol"
    },
    "is_answered": false,
    "view_count": 220,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1722945723,
    "creation_date": 1720437748,
    "last_edit_date": 1722945723,
    "question_id": 78720553,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78720553/redirection-after-a-successful-login-in-vaadin-application",
    "title": "Redirection after a successful login in vaadin application",
    "body": "<p>This is my :<code> login.tsx</code></p>\n<pre><code>import { ViewConfig } from '@vaadin/hilla-file-router/types.js';\nimport { useSignal } from '@vaadin/hilla-react-signals';\nimport { LoginI18n, LoginOverlay, LoginOverlayElement } from '@vaadin/react-components/LoginOverlay.js';\nimport { useAuth } from 'Frontend/util/auth.js';\n\nexport const config: ViewConfig = {\n  menu: { exclude: true },\n};\n\nconst loginI18n: LoginI18n = {\n  ...new LoginOverlayElement().i18n,\n  header: { title: 'RiconTrans Login', description: '' },\n};\n\nexport default function LoginView() {\n  const { login } = useAuth();\n  const loginError = useSignal(false);\n\n  return (\n    &lt;LoginOverlay\n      opened\n      error={loginError.value}\n      noForgotPassword\n      i18n={loginI18n}\n      onLogin={async ({ detail: { username, password } }) =&gt; {\n        const { defaultUrl, error, redirectUrl } = await login(username, password);\n\n        if (error) {\n          loginError.value = true;\n        } else {\n          const url = redirectUrl ?? defaultUrl ?? '/Main';  // Ensure the path starts with '/'\n          const path = new URL(url, document.baseURI).pathname;\n          document.location.href = path;  \n        }\n      }}\n    /&gt;\n  );\n}\n</code></pre>\n<p>);\n}</p>\n<p>serving as the view of logging in, and here is my security package:</p>\n<p><code>AuthenticatedUser</code>:</p>\n<pre><code>package com.ricontrans.application.security;\n\nimport com.ricontrans.application.data.User;\nimport com.ricontrans.application.data.UserRepository;\nimport com.ricontrans.application.services.UserService;\nimport com.vaadin.flow.spring.security.AuthenticationContext;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.stereotype.Component;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport java.util.Optional;\n\n@Component\npublic class AuthenticatedUser {\n\n    private static final Logger logger = LoggerFactory.getLogger(AuthenticatedUser.class);\n\n    private final UserService userService;\n    private final AuthenticationContext authenticationContext;\n    public AuthenticatedUser(AuthenticationContext authenticationContext, UserService userService) {\n        this.userService = userService;\n        this.authenticationContext = authenticationContext;\n    }\n\n    @Transactional\n    public Optional&lt;Object&gt; get() {\n        logger.info(&quot;Attempting to get authenticated user.&quot;);\n        Optional&lt;Object&gt; user = authenticationContext.getAuthenticatedUser(UserDetails.class)\n                .map(userDetails -&gt; {\n                    logger.info(&quot;Authenticated user found: {}&quot;, userDetails.getUsername());\n                    \n                    // Call your custom findByUsername method from UserService\n                    Optional&lt;User&gt; foundUser = UserService.findByUsername(userDetails.getUsername());\n\n                    if (foundUser.isPresent()) {\n                        return (Object) foundUser.get(); // Cast User to Object\n                    } else {\n                        return Optional.empty();\n                    }\n                });\n\n\n        user.ifPresentOrElse(\n                u -&gt; logger.info(&quot;User retrieved from repository: {}&quot;, u),\n                () -&gt; logger.warn(&quot;No user found in repository.&quot;)\n        );\n\n        return user;\n    }\n\n    public Optional&lt;UserDetails&gt; getCurrentUserDetails() {\n        logger.info(&quot;Attempting to get current user details from security context.&quot;);\n        org.springframework.security.core.Authentication authentication = SecurityContextHolder.getContext().getAuthentication();\n        if (authentication != null &amp;&amp; authentication.getPrincipal() instanceof UserDetails) {\n            UserDetails userDetails = (UserDetails) authentication.getPrincipal();\n            logger.info(&quot;Current user details found: {}&quot;, userDetails.getUsername());\n            return Optional.of(userDetails);\n        }\n        logger.info(&quot;No user details found in security context.&quot;);\n        return Optional.empty();\n    }\n\n    public void logout() {\n        logger.info(&quot;Logging out user.&quot;);\n        authenticationContext.logout();\n    }\n}\n</code></pre>\n<p><code>SecurityConfiguration</code>:</p>\n<pre><code>package com.ricontrans.application.security;\n\nimport com.vaadin.flow.spring.security.VaadinWebSecurity;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.web.util.matcher.AntPathRequestMatcher;\n@EnableWebSecurity\n@Configuration\npublic class SecurityConfiguration extends VaadinWebSecurity {\n\n    private static final Logger logger = LoggerFactory.getLogger(SecurityConfiguration.class);\n    private static final String LOGIN_FAILURE_URL = &quot;/login?error&quot;;\n    private static final String SUCCESS_URL = &quot;/Main&quot;;\n    private static final String LOGIN_URL = &quot;/login&quot;;\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        logger.debug(&quot;Configuring HTTP security.&quot;);\n\n        http.authorizeHttpRequests(authorize -&gt; {\n            logger.debug(&quot;Permitting all requests to /images/*.png&quot;);\n            authorize.requestMatchers(new AntPathRequestMatcher(&quot;/images/*.png&quot;)).permitAll();\n        });\n\n        // Icons from the line-awesome addon\n        http.authorizeHttpRequests(authorize -&gt; {\n            logger.debug(&quot;Permitting all requests to /line-awesome/**/*.svg&quot;);\n            authorize.requestMatchers(new AntPathRequestMatcher(&quot;/line-awesome/**/*.svg&quot;)).permitAll();\n        });\n\n        // Set custom success and failure handlers\n        http.formLogin()\n            .loginPage(LOGIN_URL)\n            .successForwardUrl(SUCCESS_URL)\n            .failureUrl(LOGIN_FAILURE_URL)\n            .permitAll();\n\n        super.configure(http);\n        logger.debug(&quot;Setting login view to /login&quot;);\n        setLoginView(http, LOGIN_URL);\n    }\n}\n\n\n    // Set custom success and failure handlers\n    http.formLogin()\n        .loginPage(LOGIN_URL)\n        .successForwardUrl(SUCCESS_URL)\n        .failureUrl(LOGIN_FAILURE_URL)\n        .permitAll();\n\n    super.configure(http);\n    logger.debug(&quot;Setting login view to /login&quot;);\n    setLoginView(http, LOGIN_URL);\n}\n</code></pre>\n<p><code>UserDetailsServiceImpl</code></p>\n<pre><code>package com.ricontrans.application.security;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nimport com.ricontrans.application.data.User;\nimport com.ricontrans.application.data.UserRepository;\nimport com.ricontrans.application.services.UserService;\n\nimport java.util.List;\nimport java.util.Set;\nimport java.util.stream.Collectors;\n\nimport com.ricontrans.application.data.Role;\n\n@Service\npublic class UserDetailsServiceImpl implements UserDetailsService {\n\n    private static final Logger logger = LoggerFactory.getLogger(UserDetailsServiceImpl.class);\n    private final UserRepository userRepository;\n    private final PasswordEncoder passwordEncoder;\n\n    @Autowired\n    public UserDetailsServiceImpl(UserRepository userRepository, PasswordEncoder passwordEncoder) {\n        this.userRepository = userRepository;\n        this.passwordEncoder = passwordEncoder;\n    }\n\n    @Override\n    @Transactional\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n          logger.info(&quot;Attempting to load user by username: {}&quot;, username);\n          try {\n              User user = UserService.findByUsername(username)\n                      .orElseThrow(() -&gt; new UsernameNotFoundException(&quot;No user present with username: &quot; + username));\n\n              logger.info(&quot;User found: {}&quot;, username);\n              Set&lt;Role&gt; roles = UserService.findRolesByUserId(user.getId());\n              List&lt;GrantedAuthority&gt; authorities = roles.stream()\n                      .map(role -&gt; new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.getRoleName()))\n                      .collect(Collectors.toList());\n\n              logger.info(&quot;Assigning roles to user: {}&quot;, authorities);\n              logger.info(&quot;user.getUsername(): {}&quot;, user.getUsername());\n              logger.info(&quot;user.getHashedPassword()&quot;, user.getHashedPassword());\n              return new org.springframework.security.core.userdetails.User(user.getUsername(),\n                      user.getHashedPassword(), authorities);\n          } catch (Exception e) {\n              logger.error(&quot;Error loading user by username: {}. Exception: {}&quot;, username, e.getMessage(), e);\n              throw e;\n          }\n      }\n\n    private static List&lt;GrantedAuthority&gt; getAuthorities(User user) {\n        return user.getRoles().stream()\n                .map(role -&gt; new SimpleGrantedAuthority(&quot;ROLE_&quot; + role))\n                .collect(Collectors.toList());\n    }\n}\n</code></pre>\n<p>I also have a user service file for my database queyring .From the logging of my user named &quot;qq&quot;</p>\n<pre><code>2024-07-08 14:11:52 INFO  c.r.a.security.AuthenticatedUser - Authenticated user found: qq\n2024-07-08 14:11:52 INFO  c.r.application.services.UserService - Attempting to find user by username: qq\n2024-07-08 14:11:52 INFO  c.r.application.services.UserService - User found by username 'qq': com.ricontrans.application.data.User@11\n2024-07-08 14:11:52 INFO  c.r.a.security.AuthenticatedUser - User retrieved from repository: com.ricontrans.application.data.User@11\n2024-07-08 14:11:52 INFO  c.r.a.security.AuthenticatedUser - Attempting to get authenticated user.\n2024-07-08 14:11:52 INFO  c.r.a.security.AuthenticatedUser - Authenticated user found: qq\n2024-07-08 14:11:52 INFO  c.r.application.services.UserService - Attempting to find user by username: qq\n2024-07-08 14:11:52 INFO  c.r.application.services.UserService - User found by username 'qq': com.ricontrans.application.data.User@11\n2024-07-08 14:11:52 INFO  c.r.a.security.AuthenticatedUser - User retrieved from repository: com.ricontrans.application.data.User@11\n</code></pre>\n<p>everything seems correct but the problem is :\nThat the redirection to <code>/Main</code> never happens, it just redirects to the root route, where all the user is authenticated because he can visit all the views needing permission. Also everything i tried to show a notification after a successful login never happens.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}