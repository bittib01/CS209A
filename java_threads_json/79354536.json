{
  "question": {
    "tags": [
      "java",
      "javafx",
      "taskbar",
      "java-ffm"
    ],
    "owner": {
      "account_id": 8877206,
      "reputation": 241,
      "user_id": 6628911,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/4076075907310368328fd2750c80d99f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Petr Å techm&#252;ller",
      "link": "https://stackoverflow.com/users/6628911/petr-%c5%a0techm%c3%bcller"
    },
    "is_answered": true,
    "view_count": 203,
    "accepted_answer_id": 79361641,
    "answer_count": 2,
    "score": 7,
    "last_activity_date": 1737806720,
    "creation_date": 1736847486,
    "last_edit_date": 1737806720,
    "question_id": 79354536,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79354536/how-to-manage-taskbar-from-javafx-via-native-code-in-linux",
    "title": "How to manage taskbar from JavaFX, via native code in Linux",
    "body": "<p>I'm trying get more experience with the new <a href=\"https://openjdk.org/jeps/454\" rel=\"nofollow noreferrer\">Foreign Function &amp; Memory API</a> in Java 22+. The best way how to learn a new API is by using it in a project.</p>\n<p>My project's goal is to report on the <a href=\"https://en.m.wikipedia.org/wiki/Taskbar\" rel=\"nofollow noreferrer\">taskbar</a> the progress of some long-running task. As far as I know, there is no &quot;native&quot; support of this in JavaFX. There are some libraries like\n<a href=\"https://github.com/Dansoftowner/FXTaskbarProgressBar\" rel=\"nofollow noreferrer\"><em>FXTaskbarProgressBar</em></a> which serves the purpose, but only for Windows OS. And it is using the &quot;old&quot; <a href=\"https://en.m.wikipedia.org/wiki/Java_Native_Interface\" rel=\"nofollow noreferrer\">Java Native Interface (JNI)</a>.</p>\n<p>After a short research, I found a simple <a href=\"https://en.wikipedia.org/wiki/Go_(programming_language)\" rel=\"nofollow noreferrer\">Go</a> library\n<a href=\"https://github.com/bibelin/taskbar\" rel=\"nofollow noreferrer\"><em>taskbar</em></a>. This library inspired me to try porting to Java for JavaFX.</p>\n<p>First I used <code>jextract</code> to get java bindings to native library calls:</p>\n<pre class=\"lang-bash prettyprint-override\"><code>jextract --output target/generated-sources/jextract -t &quot;taskbar_test.gen&quot; --include-function &quot;XOpenDisplay&quot; --include-function &quot;XChangeProperty&quot; --include-function &quot;XFlush&quot; --include-function &quot;XCloseDisplay&quot; /usr/include/X11/Xlib.h\n</code></pre>\n<p>Then I created a simple application to simulate long running process\nwhere I try to update progress on taskbar by calling method\n&quot;XChangeProperty&quot; which I found in documentation of X11:\n<a href=\"https://www.x.org/releases/X11R7.7/doc/libX11/libX11/libX11.html#XChangeProperty\" rel=\"nofollow noreferrer\">https://www.x.org/releases/X11R7.7/doc/libX11/libX11/libX11.html#XChangeProperty</a></p>\n<p>Unfortunately this does not work. The program does not crash,\ntask is running on background, but no update on taskbar is happening.</p>\n<p>Here is the code I created:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package taskbar_test;\n\nimport com.sun.glass.ui.Window;\nimport javafx.application.Application;\nimport javafx.concurrent.Task;\nimport javafx.scene.Scene;\nimport javafx.scene.control.Button;\nimport javafx.scene.layout.VBox;\nimport javafx.stage.Stage;\nimport taskbar_test.gen.Xlib_h;\n\nimport java.lang.foreign.Arena;\nimport java.lang.foreign.MemorySegment;\nimport java.lang.foreign.ValueLayout;\n\npublic class AppLinuxXlib extends Application {\n\n    @Override\n    public void start(Stage primaryStage) {\n        Button startButton = new Button(&quot;Start Long Running Task&quot;);\n\n        startButton.setOnAction(event -&gt; {\n            final long rawHandle = Window.getWindows().getFirst().getRawHandle();\n            System.out.println(rawHandle);\n            // Create a long-running task\n            Task&lt;Void&gt; longTask = new Task&lt;&gt;() {\n                @Override\n                protected Void call() throws Exception {\n                    System.out.println(&quot;Started&quot;);\n\n                    try (var arena = Arena.ofConfined()) {\n                        var NET_WM_XAPP_PROGRESS = arena.allocateFrom(&quot;NET_WM_XAPP_PROGRESS&quot;);\n//                        var NET_WM_XAPP_PROGRESS_PULSE = arena.allocateFrom(&quot;NET_WM_XAPP_PROGRESS_PULSE&quot;);\n\n                        MemorySegment x11Session = Xlib_h.XOpenDisplay(MemorySegment.NULL);\n                        System.out.println(x11Session);\n\n                        // Prepare the progress data\n                        MemorySegment initData = arena.allocateFrom(ValueLayout.JAVA_INT, 0);\n                        Xlib_h.XChangeProperty(x11Session,                    // display\n                                MemorySegment.ofAddress(rawHandle).address(), // window\n                                NET_WM_XAPP_PROGRESS.address(),               // property\n                                6,                                            // type\n                                32,                                           // format\n                                0,                                            // mode PropModeReplace=0\n                                initData,                                     // data\n                                1);                                           // nelements\n                        Xlib_h.XFlush(x11Session);\n\n                        System.out.println(&quot;Countdown started&quot;);\n\n                        // Set the taskbar progress\n                        for (int i = 0; i &lt;= 100; i+=20) {\n                            // Simulate work\n                            Thread.sleep(500);\n                            System.out.println(i);\n                            MemorySegment progressData = arena.allocateFrom(ValueLayout.JAVA_INT, i);\n                            // Update taskbar progress\n                            // https://www.x.org/releases/X11R7.7/doc/libX11/libX11/libX11.html#XChangeProperty\n                            Xlib_h.XChangeProperty(x11Session,                    // display\n                                    MemorySegment.ofAddress(rawHandle).address(), // window\n                                    NET_WM_XAPP_PROGRESS.address(),               // property\n                                    6,                                            // type\n                                    32,                                           // format\n                                    0,                                            // mode PropModeReplace=0\n                                    progressData,                                 // data\n                                    1);                                           // nelements\n                            Xlib_h.XFlush(x11Session);\n                        }\n                        System.out.println(&quot;Finished&quot;);\n                        Xlib_h.XCloseDisplay(x11Session);\n\n                    } catch (Throwable ex) {\n                        ex.printStackTrace();\n                    }\n                    return null;\n                }\n            };\n\n            // Start the task in a new thread\n            new Thread(longTask).start();\n        });\n\n        VBox vbox = new VBox(10, startButton);\n        Scene scene = new Scene(vbox, 300, 200);\n        primaryStage.setScene(scene);\n        primaryStage.setTitle(&quot;Taskbar Progress Example Linux&quot;);\n        primaryStage.show();\n    }\n\n    public static void main(String[] args) {\n        launch(args);\n    }\n}\n</code></pre>\n<p>What am I doing wrong and what is the correct direction with how to make the implementation work?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}