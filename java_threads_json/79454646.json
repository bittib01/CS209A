{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "aws-lambda",
      "log4j",
      "aws-sam-cli"
    ],
    "owner": {
      "account_id": 16245629,
      "reputation": 95,
      "user_id": 11730842,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/4c250f1f71a56c9e4a4e451f2a40cc7e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Erik B.",
      "link": "https://stackoverflow.com/users/11730842/erik-b"
    },
    "is_answered": false,
    "view_count": 416,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1740145895,
    "creation_date": 1740057589,
    "last_edit_date": 1740145895,
    "question_id": 79454646,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79454646/log4j-slf4j2-impl-cannot-be-present-with-log4j-to-slf4j-aws-lambda-spring-boot",
    "title": "log4j-slf4j2-impl cannot be present with log4j-to-slf4j (AWS Lambda, Spring-Boot, log4j2)",
    "body": "<p>I'm trying to run a Spring Boot project and aws lambda at the same time.\nAccording to <a href=\"https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/logging-slf4j.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/logging-slf4j.html</a> , the following dependency should be included to make it work:\n<code>implementation(&quot;org.apache.logging.log4j:log4j-slf4j2-impl:VERSION&quot;)</code>.\nHowever, when including the dependency I get the following issue/error from my SAM CLI</p>\n<pre><code>SLF4J(W): Class path contains multiple SLF4J providers.\nSLF4J(W): Found provider [org.apache.logging.slf4j.SLF4JServiceProvider@3c09711b]\nSLF4J(W): Found provider [ch.qos.logback.classic.spi.LogbackServiceProvider@5cc7c2a6]\nSLF4J(W): See https://www.slf4j.org/codes.html#multiple_bindings for an explanation.\nSLF4J(I): Actual provider is of type [org.apache.logging.slf4j.SLF4JServiceProvider@3c09711b]\nError loading class playground.WebhookEntry: java.lang.ExceptionInInitializerError\njava.lang.ExceptionInInitializerError\n    at java.base/java.lang.Class.forName0(Native Method)\n    at java.base/java.lang.Class.forName(Unknown Source)\n    at java.base/java.lang.Class.forName(Unknown Source)\nCaused by: org.apache.logging.log4j.LoggingException: log4j-slf4j2-impl cannot be present with log4j-to-slf4j\n    at org.apache.logging.slf4j.Log4jLoggerFactory.validateContext(Log4jLoggerFactory.java:67)\n    at org.apache.logging.slf4j.Log4jLoggerFactory.newLogger(Log4jLoggerFactory.java:49)\n    at org.apache.logging.slf4j.Log4jLoggerFactory.newLogger(Log4jLoggerFactory.java:32)\n    at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getLogger(AbstractLoggerAdapter.java:52)\n    at org.apache.logging.slf4j.Log4jLoggerFactory.getLogger(Log4jLoggerFactory.java:32)\n    at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:432)\n    at org.apache.logging.slf4j.SLF4JLoggerContext.createLogger(SLF4JLoggerContext.java:57)\n    at org.apache.logging.slf4j.SLF4JLoggerContext.getLogger(SLF4JLoggerContext.java:51)\n    at org.apache.logging.slf4j.SLF4JLoggerContext.getLogger(SLF4JLoggerContext.java:40)\n    at org.apache.logging.log4j.spi.LoggerContext.getLogger(LoggerContext.java:46)\n    at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:555)\n    at playground.WebhookEntry.&lt;clinit&gt;(WebhookEntry.java:15)\n    ... 3 more\n</code></pre>\n<p>I already tried to exclude <code>log4j-to-slf4j</code> from all the spring dependencies via: <br></p>\n<pre><code>implementation(&quot;some.spring.dependency:version) {\n        exclude(group = &quot;org.apache.logging.log4j&quot;, module = &quot;log4j-to-slf4j&quot;)\n    }\n</code></pre>\n<p>However, this only resulted in Spring throwing errors instead. I also checked what happens if I do not use the <strong>org.apache.logging.log4j:log4j-slf4j2-impl</strong> dependency. The result is the usage of standard logging or in other words ignoring my log4j2.xml, therefore making a trace log level or policy impossible. <br>\nIs there any way to make spring and aws lambdas compatible with the log4j2 logging? And by compatible I mean a way that both (Spring and aws) make use of my log4j2.xml config file.</p>\n<p>The minimum code to reproduce the error is the following:<br>\n<strong>Lambda Entry Point:</strong></p>\n<pre><code>package playground;\n\nimport com.amazonaws.services.lambda.runtime.Context;\nimport com.amazonaws.services.lambda.runtime.RequestStreamHandler;\nimport org.apache.logging.log4j.LogManager;\nimport org.apache.logging.log4j.Logger;\n\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.OutputStream;\n\n    public class WebhookEntry implements RequestStreamHandler {\n\n        private static final Logger LOGGER = LogManager.getLogger(WebhookEntry.class);\n\n        @Override\n        public void handleRequest(InputStream input, OutputStream output, Context context) throws IOException {\n            LOGGER.trace(&quot;RECEIVED TRACE MESSAGE&quot;);\n            LOGGER.info(&quot;RECEIVED INFO MESSAGE&quot;);\n        }\n}\n\n</code></pre>\n<p><strong>Spring App Class:</strong></p>\n<pre><code>package playground;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class SpringApp {\n    public static void main(String[] args) {\n        SpringApplication.run(SpringApp.class, args);\n    }\n}\n</code></pre>\n<p><strong>build.gradle.kts:</strong></p>\n<pre><code>plugins {\n    id(&quot;java&quot;)\n    id(&quot;org.springframework.boot&quot;) version &quot;3.4.1&quot;\n    id(&quot;io.spring.dependency-management&quot;) version &quot;1.0.11.RELEASE&quot;\n}\n\nrepositories {\n    mavenCentral()\n}\n\ndependencies {\n    testImplementation(platform(&quot;org.junit:junit-bom:5.10.0&quot;))\n    testImplementation(&quot;org.junit.jupiter:junit-jupiter&quot;)\n\n    implementation(&quot;org.springframework.boot:spring-boot-starter&quot;)\n    implementation(&quot;org.springframework.boot:spring-boot-starter-web&quot;)\n    implementation(&quot;org.springframework.boot:spring-boot-starter-security&quot;)\n    implementation(&quot;org.springframework.boot:spring-boot-starter-validation&quot;)\n    implementation(&quot;org.springframework.boot:spring-boot-starter-actuator&quot;)\n\n    // AWS\n    implementation(&quot;com.amazonaws:aws-lambda-java-core:1.2.3&quot;)\n    implementation(&quot;com.amazonaws:aws-lambda-java-events:3.14.0&quot;)\n    implementation(&quot;software.amazon.awssdk:sqs:2.30.17&quot;)\n    runtimeOnly(&quot;com.amazonaws:aws-lambda-java-log4j2:1.6.0&quot;)\n\n    // Logging\n    implementation(&quot;org.apache.logging.log4j:log4j-core:2.24.3&quot;)\n    implementation(&quot;org.apache.logging.log4j:log4j-slf4j2-impl:2.24.3&quot;)\n}\n\n</code></pre>\n<p><strong>log4j2.xml:</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;Configuration status=&quot;WARN&quot;&gt;\n    &lt;Appenders&gt;\n        &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;\n            &lt;PatternLayout pattern=&quot;%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1} - %m%n&quot;/&gt;\n        &lt;/Console&gt;\n\n        &lt;RollingFile name=&quot;RollingFile&quot; fileName=&quot;logs/app.log&quot;\n                     filePattern=&quot;logs/app-%d{yyyy-MM-dd}.log&quot;&gt;\n            &lt;PatternLayout pattern=&quot;%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1} - %m%n&quot;/&gt;\n            &lt;Policies&gt;\n                &lt;TimeBasedTriggeringPolicy interval=&quot;1&quot; modulate=&quot;true&quot;/&gt;\n            &lt;/Policies&gt;\n        &lt;/RollingFile&gt;\n    &lt;/Appenders&gt;\n\n    &lt;Loggers&gt;\n        &lt;Root level=&quot;TRACE&quot;&gt;\n            &lt;AppenderRef ref=&quot;Console&quot;/&gt;\n            &lt;AppenderRef ref=&quot;RollingFile&quot;/&gt;\n        &lt;/Root&gt;\n    &lt;/Loggers&gt;\n&lt;/Configuration&gt;\n\n</code></pre>\n<p>I've had a look at the post suggested by Piotr P. Karwasz: <a href=\"https://stackoverflow.com/questions/59629214/caused-by-org-apache-logging-log4j-loggingexception-log4j-slf4j-impl-cannot-be\">Caused by: org.apache.logging.log4j.LoggingException: log4j-slf4j-impl cannot be present with log4j-to-slf4j</a></p>\n<p>I tried to solve the issue by the approaches which are mentioned there. However the result is the same as if I would simply exclude <code>log4j-to-slf4j</code>\ndependency, which I already tried as stated above. Perhaps I should include the resulting error here as well:</p>\n<pre><code>2025-02-21T13:38:18.815452773Z main ERROR Unable to create file logs/app.log java.io.IOException: Could not create directory /var/task/logs\n    at org.apache.logging.log4j.core.util.FileUtils.mkdir(FileUtils.java:129)\n    at org.apache.logging.log4j.core.util.FileUtils.makeParentDirs(FileUtils.java:143)\n    at org.apache.logging.log4j.core.appender.rolling.RollingFileManager$RollingFileManagerFactory.createManager(RollingFileManager.java:863)\n    at org.apache.logging.log4j.core.appender.rolling.RollingFileManager$RollingFileManagerFactory.createManager(RollingFileManager.java:844)\n    at org.apache.logging.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:146)\n    at org.apache.logging.log4j.core.appender.OutputStreamManager.getManager(OutputStreamManager.java:112)\n    at org.apache.logging.log4j.core.appender.rolling.RollingFileManager.getFileManager(RollingFileManager.java:307)\n    at org.apache.logging.log4j.core.appender.RollingFileAppender$Builder.build(RollingFileAppender.java:144)\n    at org.apache.logging.log4j.core.appender.RollingFileAppender$Builder.build(RollingFileAppender.java:65)\n    at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:124)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:1180)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1099)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1091)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:695)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:270)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:319)\n    at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:673)\n    at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:762)\n    at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:784)\n    at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:300)\n    at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:153)\n    at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:46)\n    at org.apache.logging.log4j.LogManager.getContext(LogManager.java:138)\n    at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:555)\n    at de.trinext.ih_nf_mapper.aws.WebhookEntry.&lt;clinit&gt;(WebhookEntry.java:28)\n    at java.base/java.lang.Class.forName0(Native Method)\n    at java.base/java.lang.Class.forName(Unknown Source)\n    at java.base/java.lang.Class.forName(Unknown Source)\n    at com.amazonaws.services.lambda.runtime.api.client.HandlerInfo.fromString(HandlerInfo.java:34)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.findRequestHandler(AWSLambda.java:116)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.startRuntime(AWSLambda.java:215)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.startRuntime(AWSLambda.java:190)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.main(AWSLambda.java:180)\n\n2025-02-21T13:38:18.838210717Z main ERROR Could not create plugin of type class org.apache.logging.log4j.core.appender.RollingFileAppender for element RollingFile: java.lang.IllegalStateException: ManagerFactory [org.apache.logging.log4j.core.appender.rolling.RollingFileManager$RollingFileManagerFactory@306f16f3] unable to create manager for [logs/app.log] with data [org.apache.logging.log4j.core.appender.rolling.RollingFileManager$FactoryData@702b8b12[pattern=logs/app-%d{yyyy-MM-dd}.log, append=true, bufferedIO=true, bufferSize=8192, policy=CompositeTriggeringPolicy(policies=[TimeBasedTriggeringPolicy(nextRolloverMillis=0, interval=1, modulate=true)]), strategy=DefaultRolloverStrategy(min=1, max=7, useMax=true), advertiseURI=null, layout=%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1} - %m%n, filePermissions=null, fileOwner=null]] java.lang.IllegalStateException: ManagerFactory [org.apache.logging.log4j.core.appender.rolling.RollingFileManager$RollingFileManagerFactory@306f16f3] unable to create manager for [logs/app.log] with data [org.apache.logging.log4j.core.appender.rolling.RollingFileManager$FactoryData@702b8b12[pattern=logs/app-%d{yyyy-MM-dd}.log, append=true, bufferedIO=true, bufferSize=8192, policy=CompositeTriggeringPolicy(policies=[TimeBasedTriggeringPolicy(nextRolloverMillis=0, interval=1, modulate=true)]), strategy=DefaultRolloverStrategy(min=1, max=7, useMax=true), advertiseURI=null, layout=%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1} - %m%n, filePermissions=null, fileOwner=null]]\n    at org.apache.logging.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:148)\n    at org.apache.logging.log4j.core.appender.OutputStreamManager.getManager(OutputStreamManager.java:112)\n    at org.apache.logging.log4j.core.appender.rolling.RollingFileManager.getFileManager(RollingFileManager.java:307)\n    at org.apache.logging.log4j.core.appender.RollingFileAppender$Builder.build(RollingFileAppender.java:144)\n    at org.apache.logging.log4j.core.appender.RollingFileAppender$Builder.build(RollingFileAppender.java:65)\n    at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:124)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:1180)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1099)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1091)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:695)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:270)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:319)\n    at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:673)\n    at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:762)\n    at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:784)\n    at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:300)\n    at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:153)\n    at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:46)\n    at org.apache.logging.log4j.LogManager.getContext(LogManager.java:138)\n    at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:555)\n    at de.trinext.ih_nf_mapper.aws.WebhookEntry.&lt;clinit&gt;(WebhookEntry.java:28)\n    at java.base/java.lang.Class.forName0(Native Method)\n    at java.base/java.lang.Class.forName(Unknown Source)\n    at java.base/java.lang.Class.forName(Unknown Source)\n    at com.amazonaws.services.lambda.runtime.api.client.HandlerInfo.fromString(HandlerInfo.java:34)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.findRequestHandler(AWSLambda.java:116)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.startRuntime(AWSLambda.java:215)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.startRuntime(AWSLambda.java:190)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.main(AWSLambda.java:180)\n\n2025-02-21T13:38:18.839409423Z main ERROR Unable to invoke factory method in class org.apache.logging.log4j.core.appender.RollingFileAppender for element RollingFile: java.lang.IllegalStateException: No factory method found for class org.apache.logging.log4j.core.appender.RollingFileAppender java.lang.IllegalStateException: No factory method found for class org.apache.logging.log4j.core.appender.RollingFileAppender\n    at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.findFactoryMethod(PluginBuilder.java:268)\n    at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:140)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:1180)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1099)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1091)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:695)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:270)\n    at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:319)\n    at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:673)\n    at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:762)\n    at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:784)\n    at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:300)\n    at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:153)\n    at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:46)\n    at org.apache.logging.log4j.LogManager.getContext(LogManager.java:138)\n    at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:555)\n    at de.trinext.ih_nf_mapper.aws.WebhookEntry.&lt;clinit&gt;(WebhookEntry.java:28)\n    at java.base/java.lang.Class.forName0(Native Method)\n    at java.base/java.lang.Class.forName(Unknown Source)\n    at java.base/java.lang.Class.forName(Unknown Source)\n    at com.amazonaws.services.lambda.runtime.api.client.HandlerInfo.fromString(HandlerInfo.java:34)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.findRequestHandler(AWSLambda.java:116)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.startRuntime(AWSLambda.java:215)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.startRuntime(AWSLambda.java:190)\n    at com.amazonaws.services.lambda.runtime.api.client.AWSLambda.main(AWSLambda.java:180)\n</code></pre>\n<p>According to this documentation: <a href=\"https://docs.spring.io/spring-boot/how-to/logging.html#howto.logging.log4j\" rel=\"nofollow noreferrer\">https://docs.spring.io/spring-boot/how-to/logging.html#howto.logging.log4j</a></p>\n<p>I also tried to replace the ch.qos.logback.classic.spi.LogbackServiceProvider (ch.qos.logback:logback-classic) with the log4j-slf4j-impl via build.gradle.kts addition:</p>\n<pre><code>    modules {\n        module(&quot;ch.qos.logback:logback-classic&quot;) {\n            replacedBy(&quot;org.apache.logging.log4j:log4j-slf4j-impl&quot;, &quot;fix conflict&quot;)\n        }\n    }\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}