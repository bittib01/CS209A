{
  "question": {
    "tags": [
      "java",
      "adobe",
      "aem",
      "sling",
      "exporter"
    ],
    "owner": {
      "account_id": 10912397,
      "reputation": 71,
      "user_id": 8021357,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/nHpQ5.jpg?s=256",
      "display_name": "Stefanos Karakasis",
      "link": "https://stackoverflow.com/users/8021357/stefanos-karakasis"
    },
    "is_answered": false,
    "view_count": 225,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1724747734,
    "creation_date": 1713878171,
    "question_id": 78372661,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78372661/aem-page-exporter-doesnt-include-components-with-multifields",
    "title": "AEM Page Exporter - Doesn&#39;t include components with multifields",
    "body": "<p>I'm trying to export a page with the default model exporter of AEM. This page contains multiple components and some of them have multifields. When I visit homepage.model.json the JSON doesn't have the multifields.</p>\n<pre><code>carousel: {\n    :type: &quot;mysite/components/public/carousel&quot;,\n    title: &quot;Test title&quot;\n}\n</code></pre>\n<p>I've searched everywhere for a solution. Everywhere on the internet they suggest to make an Exporter for my component:</p>\n<pre><code>@Model(adaptables = Resource.class,\n        defaultInjectionStrategy = DefaultInjectionStrategy.OPTIONAL,\n        resourceType = {&quot;mysite/components/public/carousel&quot;})\n@Exporter(name = &quot;jackson&quot;, extensions = &quot;json&quot;)\n\npublic class CarouselModelImpl implements CarouselModel, ComponentModel {\n\n...\n@Getter\n    private List&lt;CarouselBean&gt; slides;\n...\n</code></pre>\n<p>So when I visit</p>\n<p>homepage/jcr:content/carousel.model.json I get the correct JSON:</p>\n<pre><code>{\n    title: &quot;Test title&quot;,\n    slides: [\n    {\n        title: &quot;slide title 1&quot;,\n        description: null,\n        ctaLabel: &quot;cta label&quot;,\n        ctaLink: &quot;#&quot;,\n        image: &quot;/content/dam/mysite/Rectangle 2.png&quot;\n    },\n    {\n        title: &quot;slide title 2&quot;,\n        description: null,\n        ctaLabel: &quot;cta label&quot;,\n        ctaLink: &quot;#&quot;,\n        image: &quot;/content/dam/mysite/image.png&quot;\n    }\n    ],\n}\n</code></pre>\n<p>But when I visit the homepage.model.json it's still not included:</p>\n<pre><code>carousel: {\n    :type: &quot;mysite/components/public/carousel&quot;,\n    title: &quot;Test title&quot;\n}\n</code></pre>\n<p>So from what I understand I have 2 options:</p>\n<ol>\n<li><p>To make a Page Exporter and have a lot of custom code.</p>\n</li>\n<li><p>Accept that I can't have a page with all the JSON data that I want.</p>\n</li>\n</ol>\n<p>I tried to make a custom Page Exporter with the logic to iterate all the children and sub-children in order to get the correct JSON with minimal code. I try to get the Exporter Models for each component, but the modelFactory is <code>null</code>.</p>\n<pre><code>@Model(adaptables = Resource.class,\n        defaultInjectionStrategy = DefaultInjectionStrategy.OPTIONAL,\n        resourceType = {&quot;mysite/components/public/structure/public-page&quot;})\n@Exporter(name = &quot;jackson&quot;, extensions = &quot;json&quot;)\npublic class PageExporterServlet {\n\n    private static final Logger log = LoggerFactory.getLogger(PageUtils.class);\n\n    @Reference\n    private ModelFactory modelFactory;\n\n    @Reference\n    private SlingScriptHelper slingScriptHelper;\n\n    @Self\n    private Resource resource;\n\n    @Getter\n    private String myTitle = &quot;Test&quot;;\n\n    @Getter\n    Map&lt;String, Object&gt; pageData = new HashMap&lt;&gt;();\n\n    @PostConstruct\n    // PostConstructs are called after all the injection has occurred, but before the Model object is returned for use.\n    protected void init() {\n        try {\n            processResource(resource, pageData);\n        } catch (Exception e) {\n            log.debug(e.getMessage());\n        }\n    }\n\n    private void processResource(Resource resource, Map&lt;String, Object&gt; pageData) {\n        if (resource != null) {\n            Iterable&lt;Resource&gt; childResources = resource.getChildren();\n            for (Resource childResource : childResources) {\n                ComponentModel componentModel = (ComponentModel) modelFactory.getModelFromResource(childResource);\n                if (componentModel != null) {\n                    pageData.put(childResource.getPath(), componentModel.getData());\n                } else {\n                    // If the resource is not a component, recursively process its children\n                    processResource(childResource, pageData);\n                }\n            }\n        }\n    }\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}