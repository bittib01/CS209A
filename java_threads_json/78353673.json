{
  "question": {
    "tags": [
      "java",
      "sockets",
      "encryption",
      "java-io",
      "objectoutputstream"
    ],
    "owner": {
      "account_id": 24904977,
      "reputation": 1,
      "user_id": 18775171,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/AATXAJyxo0ueOtVpKQmGaKXne9r14dZ9tbLIx8-Vus6Z=k-s256",
      "display_name": "SmoothBren",
      "link": "https://stackoverflow.com/users/18775171/smoothbren"
    },
    "is_answered": false,
    "view_count": 56,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1717019561,
    "creation_date": 1713529888,
    "last_edit_date": 1717019561,
    "question_id": 78353673,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78353673/objectinputstream-stuck-at-initialization-when-creating-one-on-both-client-and-s",
    "title": "ObjectInputStream Stuck at Initialization when creating one on both Client and Server",
    "body": "<p><code>ObjectInputStream</code> will initialize just fine when only creating an <code>ObjectInputStream</code> on the Client Side and an <code>ObjectOutputStream</code> on the server side, but when then creating the <code>ObjectInputStream</code> on the Server side, the execution just halts indefinitely. What could cause this?</p>\n<p>Below is a simple example to reproduce the issue:</p>\n<pre><code>package Server;\n\nimport javax.crypto.*;\nimport javax.crypto.spec.IvParameterSpec;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.io.*;\nimport java.net.ServerSocket;\nimport java.net.Socket;\n\npublic class SimpleServer {\n    public static void main(String[] args) throws Exception {\n        int port = 5000;\n        ServerSocket serverSocket = new ServerSocket(port);\n        System.out.println(&quot;Server started. Waiting for connection...&quot;);\n        Socket clientSocket = serverSocket.accept();\n        System.out.println(&quot;Client connected.&quot;);\n\n        // Hardcoded key and IV\n        byte[] keyBytes = &quot;1234567890123456&quot;.getBytes();\n        byte[] ivBytes = &quot;1234567890123456&quot;.getBytes();\n        SecretKey key = new SecretKeySpec(keyBytes, &quot;AES&quot;);\n        IvParameterSpec iv = new IvParameterSpec(ivBytes);\n\n        // Setup Cipher and Streams\n        Cipher cipher_enc = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);\n        cipher_enc.init(Cipher.ENCRYPT_MODE, key, iv);\n        Cipher cipher_dec = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);\n        cipher_dec.init(Cipher.DECRYPT_MODE, key, iv);\n        CipherOutputStream cipher_encOut = new CipherOutputStream(clientSocket.getOutputStream(), cipher_enc);\n        CipherInputStream cipher_decIn = new CipherInputStream(clientSocket.getInputStream(), cipher_dec);\n\n        System.out.println(&quot;Ciphers initialized.&quot;);\n        ObjectOutputStream objOut = new ObjectOutputStream(cipher_encOut);\n        System.out.println(&quot;ObjectOutputStream initialized.&quot;);\n        objOut.writeObject(&quot;Hello from Server!&quot;);\n        objOut.flush();\n\n        //REMOVING THIS BLOCK WILL MAKE THE CODE WORK JUST FINE\n        ObjectInputStream objIn = new ObjectInputStream(cipher_decIn);\n        String message = (String) objIn.readObject();\n        System.out.println(&quot;Message from server: &quot; + message);\n\n        objOut.close();\n        objIn.close();\n        clientSocket.close();\n        serverSocket.close();\n        System.out.println(&quot;Server finished.&quot;);\n    }\n}\n</code></pre>\n<pre><code>package Server;\n\nimport javax.crypto.*;\nimport javax.crypto.spec.IvParameterSpec;\nimport javax.crypto.spec.SecretKeySpec;\nimport java.io.*;\nimport java.net.Socket;\n\npublic class SimpleClient {\n    public static void main(String[] args) throws Exception {\n        String host = &quot;localhost&quot;;\n        int port = 5000;\n        Socket socket = new Socket(host, port);\n        System.out.println(&quot;Connected to server.&quot;);\n\n        // Hardcoded key and IV\n        byte[] keyBytes = &quot;1234567890123456&quot;.getBytes();\n        byte[] ivBytes = &quot;1234567890123456&quot;.getBytes();\n        SecretKey key = new SecretKeySpec(keyBytes, &quot;AES&quot;);\n        IvParameterSpec iv = new IvParameterSpec(ivBytes);\n\n        // Setup Cipher and Streams\n        Cipher cipher_enc = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);\n        cipher_enc.init(Cipher.ENCRYPT_MODE, key, iv);\n        Cipher cipher_dec = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);\n        cipher_dec.init(Cipher.DECRYPT_MODE, key, iv);\n        CipherInputStream cipher_decIn = new CipherInputStream(socket.getInputStream(), cipher_dec);\n        CipherOutputStream cipher_encOut = new CipherOutputStream(socket.getOutputStream(), cipher_enc);\n\n        System.out.println(&quot;Ciphers initialized.&quot;);\n        ObjectInputStream objIn = new ObjectInputStream(cipher_decIn);\n        System.out.println(&quot;ObjectInputStream initialized.&quot;);\n        String message = (String) objIn.readObject();      \n        System.out.println(&quot;Message from server: &quot; + message);\n\n\n        //REMOVING THIS BLOCK WILL MAKE THE CODE WORK JUST FINE\n        ObjectOutputStream objOut = new ObjectOutputStream(cipher_encOut);\n        objOut.writeObject(&quot;Hello from Server!&quot;);\n        objOut.flush();\n\n        objIn.close();\n        objOut.close();\n        socket.close();\n        System.out.println(&quot;Client disconnected.&quot;);\n    }\n}\n</code></pre>\n<p>In the example, the second <code>ObjectInputStream</code> should be initialized after the first message was sent, but somehow adding the marked code blocks actually breaks the code above it. I've tried initializing all streams before sending any type of data, but that also doesn't work. It might just be a fundamental misunderstanding about how these should behave, but I'm at the end of my rope. I'm almost certain that the problem has to do with the second <code>ObjectOutputStreams</code> header not arriving properly, maybe because of the <code>CipherStreams</code> Blocks or something, but I just can't figure it out.</p>\n<p>Solution: Replace Block Cipher with Stream Cipher, Block Cipher causes Issues with the Header Transmission.\nEx.: use `AES/CTR/NoPadding</p>\n<p>Edit: <a href=\"https://stackoverflow.com/questions/14110986/new-objectinputstream-blocks\">new ObjectInputStream() blocks</a> does not at all have anything to do with the issue. The <code>OutputStream</code> does get initialized and should send the required header, the problem appears to me to be that the header doesn't get sent or arrive properly because of the underlying <code>CipherInputStream</code>/<code>CipherOutputStream</code>.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}