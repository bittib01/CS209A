{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "testing",
      "junit",
      "resttemplate"
    ],
    "owner": {
      "account_id": 42010562,
      "reputation": 23,
      "user_id": 30553141,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/416c732cee9b926e2e1fc7633dcf00da?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "user30553141",
      "link": "https://stackoverflow.com/users/30553141/user30553141"
    },
    "is_answered": true,
    "view_count": 155,
    "accepted_answer_id": 79627388,
    "answer_count": 1,
    "score": 2,
    "last_activity_date": 1747580225,
    "creation_date": 1747376227,
    "last_edit_date": 1747521186,
    "question_id": 79624582,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79624582/when-performing-integration-tests-for-springboot-app-with-resttemplate-why-are",
    "title": "When performing integration tests for Springboot app with RestTemplate, why are not all returned values set?",
    "body": "<p>I have a Springboot API that includes a model class <code>Payment</code>, a <code>@Service</code> class <code>PaymentService</code>, as well as a JPA repository, controller, and some utility classes. I have integration tests that mostly work using junit, h2 in-memory db, and <code>RestTemplate</code>. When I run the test to, for example, create a new payment, the <code>@Service</code> class runs, does the business logic, saves the new object in the in-memory database, sets a few more fields, and then returns the created  object.</p>\n<p>My test:</p>\n<pre><code>@SpringBootTest(webEnvironment=SpringBootTest.WebEnvironment.RANDOM_PORT)                                                                                                                                                                                      \n@FieldDefaults(level=AccessLevel.PRIVATE)                                                                                                                                                                                                                      \npublic class PaymentControllerCreateTest {                                                                                                                                                                                                                     \n                                                                                                                                                                                                                                                               \n        @LocalServerPort                                                                                                                                                                                                                                       \n        int port;                                                                                                                                                                                                                                              \n                                                                                                                                                                                                                                                               \n        String baseUrl = &quot;http://localhost&quot;;                                                                                                                                                                                                                   \n                                                                                                                                                                                                                                                               \n        static RestTemplate restTemplate = null;                                                                                                                                                                                                               \n                                                                                                                                                                                                                                                               \n        @BeforeAll                                                                                                                                                                                                                                             \n        public static void init() {                                                                                                                                                                                                                            \n                restTemplate = new RestTemplate();                                                                                                                                                                                                             \n                restTemplate.getMessageConverters().add(new MappingJackson2HttpMessageConverter());                                                                                                                                                            \n        }                                                                                                                                                                                                                                                      \n                                                                                                                                                                                                                                                               \n        @BeforeEach                                                                                                                                                                                                                                            \n        public void setup() {                                                                                                                                                                                                                                  \n                baseUrl += &quot;:&quot; + port + &quot;/payment&quot;;                                                                                                                                                                                                            \n        }                                                                                                                                                                                                                                                      \n                                                                                                                                                                                                                                                               \n        @Test                                                                                                                                                                                                                                                  \n        @Sql(statements=&quot;delete from payment_line_items&quot;, executionPhase=Sql.ExecutionPhase.AFTER_TEST_METHOD)                                                                                                                                                 \n        @Sql(statements=&quot;delete from payment&quot;, executionPhase=Sql.ExecutionPhase.AFTER_TEST_METHOD)                                                                                                                                                            \n        public void testCreateBasicPayment() throws Exception {                                                                                                                                                                                                \n            headers.setContentType(MediaType.APPLICATION_JSON);                                         \n            headers.set(&quot;Authorization&quot;, &quot;token&quot;);                                                      \n            HttpEntity&lt;Payment&gt; entity = new HttpEntity&lt;&gt;(payment, headers);                            \n            ResponseEntity&lt;Payment&gt; response = restTemplate.postForEntity(baseUrl, entity, Payment.class);                                                                                                          \n            assert response.getStatusCode().is2xxSuccessful();                                          \n            Payment created = response.getBody(); \n    \n            // these assertions pass, but amount and currency code are set in the POSTed object                                                      \n            assert created.getCardInfo() == null;                                                       \n            assert created.getAmount().compareTo(payment.getAmount()) == 0;                             \n            assert created.getCurrencyCode().equals(payment.getCurrencyCode());                         \n    \n            // these assertions fail, and the fields are either autogenerated or set in the service\n            assert created.getId() != null;\n            assert created.getTransId() != null;                                                                                                                                                                                                            \n        }\n}\n</code></pre>\n<p>Relevant bits of Payment class:</p>\n<pre><code>@Entity @Table(name=&quot;payment&quot;)                                                                              \n@JsonInclude(Include.NON_NULL)                                                                              \n@Data                                                                                                       \n@FieldDefaults(level=AccessLevel.PRIVATE)                                                                   \n@JsonIgnoreProperties({&quot;hibernateLazyInitializer&quot;, &quot;handler&quot;})                                              \npublic class Payment {\n\n        @Id                                                                                                 \n        @GeneratedValue                                                                                     \n        @JsonProperty(access=Access.READ_ONLY)                                                                                                                                                                 \n        UUID id;\n\n        @JsonProperty(access=Access.READ_ONLY)                                                              \n        String transId;\n\n        @NotNull\n        @JsonSerialize(using=BigDecimalSerializer.class)\n        BigDecimal amount;\n\n        @NotNull\n        String currencyCode;\n\n    ...\n\n}\n</code></pre>\n<p>Simplified <code>@Service</code> class:</p>\n<pre><code>@Service                                                                                                   \n@NoArgsConstructor                                                                                         \npublic class PaymentService {                                                                              \n                                                                                                                                              \n        @Autowired                                                                                         \n        PaymentRepository repository;                                                                                                                                                                                                    \n                                                                                                           \n        public Payment createPayment(Payment payment) {                                                                                                     \n                // do business logic, submit payment, etc.\n                payment.setTransId(tid);\n                payment.setCardInfo(null); // set payment info to null so it isn't included in response          \n                                                               \n                return repository.saveAndFlush(payment);\n        }\n}\n</code></pre>\n<p>I can verify that the code in the <code>@Service</code> class is running (via print statements and other ways related to the specific business logic). However, the returned object from <code>restTemplate.postForEntity()</code> is missing some fields, namely all those that are set by the <code>@Service</code> code and <code>@GeneratedValue</code> fields. Everything works as expected when running manual tests using curl. How can I get the correct object to be returned from the <code>restTemplate.postForEntity()</code>?</p>\n<p>MRE for the issue: <a href=\"https://github.com/honreir/SO-79624582-mre\" rel=\"nofollow noreferrer\">https://github.com/honreir/SO-79624582-mre</a></p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}