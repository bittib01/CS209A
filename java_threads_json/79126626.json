{
  "question": {
    "tags": [
      "java",
      "selenium-webdriver",
      "google-chrome-devtools"
    ],
    "owner": {
      "account_id": 15035374,
      "reputation": 74,
      "user_id": 10851973,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/75ec4f9cd462bf6e10956cd31980c299?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "felixoben",
      "link": "https://stackoverflow.com/users/10851973/felixoben"
    },
    "is_answered": true,
    "view_count": 105,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1747065678,
    "creation_date": 1729874881,
    "last_edit_date": 1747065678,
    "question_id": 79126626,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79126626/java-selenium-devtools-v127",
    "title": "Java Selenium DevTools v127",
    "body": "<p>At the moment I am working in java on a web scraper with selenium and I want to add javascript code before loading any website so that I can override some methods... I wanted to use DevTools but unfortunately I have no effect with addScriptToEvaluateOnNewDocument... But this code works somehow, so I assume the DevTools dependencies are correct.</p>\n<pre><code>devTools.send(Emulation.setDeviceMetricsOverride(\n                500,  // width\n                600,  // height\n                50,   // deviceScaleFactor\n                true,  // mobile\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty()\n            ));\n</code></pre>\n<p>Complete Test Code:</p>\n<pre><code>String driverpath = Main.configuration.getString(&quot;browser.chromedriver&quot;);\n            String browserpath = Main.configuration.getString(&quot;browser.chromebrowser&quot;);\n\n            if(driverpath != null &amp;&amp; !driverpath.isBlank()){\n                System.setProperty(\n                    &quot;webdriver.chrome.driver&quot;,\n                    driverpath\n                );\n                System.setProperty(\n                &quot;webdriver.gecko.driver&quot;,\n                driverpath\n                );\n            }\n                \n            ChromeOptions options = new ChromeOptions();\n\n            if(headless){\n                Main.printf(&quot;Chrome headless&quot;);\n                options.addArguments(&quot;--headless&quot;);\n            }\n            options.addArguments(&quot;--disable-search-engine-choice-screen&quot;);\n            options.addArguments(&quot;--disable-dev-shm-usage&quot;); // overcome limited resource problems\n            options.addArguments(&quot;start-maximized&quot;); // open Browser in maximized mode\n            options.addArguments(&quot;disable-infobars&quot;); // disabling infobars\n            options.addArguments(&quot;--disable-extensions&quot;); // disabling extensions\n            options.addArguments(&quot;--disable-gpu&quot;); // applicable to windows os only\n            options.addArguments(&quot;--no-sandbox&quot;); // Bypass OS security model\n            if(browserpath != null &amp;&amp; !browserpath.isBlank()){\n                options.setBinary(browserpath);\n            }\n\n            Main.printf(&quot;Start Chromedriver...&quot;);\n            this.driver = new ChromeDriver(options);\n\n\n            DevTools devTools = ((HasDevTools) driver).getDevTools();\n\n\n            devTools.createSession();\n\n            \n            devTools.send(Emulation.setDeviceMetricsOverride(\n                500,  // width\n                600,  // height\n                50,   // deviceScaleFactor\n                true,  // mobile\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty(),\n                Optional.empty()\n            ));\n            \n\n            String script = &quot;window.was_here=true; console.log('Script executed');&quot;;\n\n            ScriptIdentifier identifier = devTools\n                    .send(Page.addScriptToEvaluateOnNewDocument(script, // source\n                            Optional.empty(), // worldName\n                            Optional.of(false), // includeCommandLineAPI\n                            Optional.of(false) // runImmediately\n            ));\n            System.err.println(String.format(\n                    &quot;Method Page.addScriptToEvaluateOnNewDocument result: %s&quot;, identifier));\n\n            driver.navigate().to(&quot;https://intoli.com/blog/not-possible-to-block-chrome-headless/chrome-headless-test.html&quot;);\n            try {\n                Thread.sleep(100); // nur zum Test, für sichtbare Effekte\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n\n            Object d = getJSExecutor().executeScript(&quot;return window.was_here&quot;);\n            if(d != null){\n                boolean data = (Boolean) d;\n                Main.printf(&quot;Scraper&quot;, &quot;DATA:&quot;+(data ? &quot;T&quot; : &quot;F&quot;));\n            }else Main.printf(&quot;Scraper&quot;, &quot;D IS NULL!!&quot;);\n\n            devTools.send(Page.removeScriptToEvaluateOnNewDocument(identifier));\n\n            try {\n                Thread.sleep(500000); // nur zum Test, für sichtbare Effekte\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n\n            driver.quit();\n            System.exit(0);\n\n            Main.printf(&quot;Chromedriver started :)&quot;);\n</code></pre>\n<p>Maven Selenium Dependencies:</p>\n<ul>\n<li>selenium-java:4.25.0</li>\n<li>selenium-devtools-v127:4.25.0</li>\n</ul>\n<p>Chrome Browser: GoogleChromePortable64_127.0.6533.120_online\n<br>\nChrome Driver: v127 (<a href=\"https://datatoolbar.com/downloads/Drivers/chrome.127/\" rel=\"nofollow noreferrer\">https://datatoolbar.com/downloads/Drivers/chrome.127/</a>)</p>\n<p>Can any one tell me why my test code is not working, I copied the test from <a href=\"https://github.com/sergueik/selenium_cdp/blob/master/src/test/java/com/github/sergueik/selenium/ChromeDevToolsInjectedScriptTest.java\" rel=\"nofollow noreferrer\">this project</a></p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}