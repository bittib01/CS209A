{
  "question": {
    "tags": [
      "java",
      "sql-server",
      "spring-boot",
      "hibernate"
    ],
    "owner": {
      "account_id": 1801257,
      "reputation": 9460,
      "user_id": 1639556,
      "user_type": "registered",
      "accept_rate": 79,
      "profile_image": "https://i.sstatic.net/MDuWh.jpg?s=256",
      "display_name": "Leos Literak",
      "link": "https://stackoverflow.com/users/1639556/leos-literak"
    },
    "is_answered": true,
    "view_count": 85,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1745736481,
    "creation_date": 1745404376,
    "last_edit_date": 1745487046,
    "question_id": 79588393,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79588393/sqlhelper-missing-during-datasource-set-up",
    "title": "SqlHelper missing during DataSource set up",
    "body": "<p>I am creating a spring data source manually because of retrieving a password from a vault.</p>\n<pre><code>@Bean\nDataSource dataSource() {\n    var password = getSecret(secretName);\n    final var dataSource = new SQLServerDataSource();\n    dataSource.setURL(dataSourceProperties.getUrl());\n    dataSource.setUser(dataSourceProperties.getUsername());\n    dataSource.setPassword(password);\n    return dataSource;\n}\n</code></pre>\n<p>This works well, but I am fine tuning JDBC URL parameters and the connection fails at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcIsolationDelegate#delegateWork. That's fine, the trouble is that I dont get the actual error but NPE because sqlExceptioNHelper is null</p>\n<pre><code>java.lang.NullPointerException: Cannot invoke &quot;org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(java.sql.SQLException, String)&quot; because the return value of &quot;org.hibernate.resource.transaction.backend.jdbc.internal.JdbcIsolationDelegate.sqlExceptionHelper()&quot; is null\n    at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcIsolationDelegate.delegateWork(JdbcIsolationDelegate.java:116) ~[hibernate-core-6.5.2.Final.jar:6.5.2.Final]\n    at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.getJdbcEnvironmentUsingJdbcMetadata(JdbcEnvironmentInitiator.java:290) ~[hibernate-core-6.5.2.Final.jar:6.5.2.Final]\n</code></pre>\n<p>This is caused by a constructor receiving <code>transactionCoordinatorOwner.jdbcServices</code> having <code>jdbcEnvironment</code> set to null.</p>\n<p>My question is how to initialize <code>jdbcEnvironment</code> properly? Spring Boot 3.2.x &amp; MS SQL JDBC driver 10.2.x.</p>\n<p>To be concrete, the bean is created without an error and there is no issue with <code>getSecret()</code>. The only difference is in JDBC URL.</p>\n<ul>\n<li>When I set the URL to trust the host certificate, the applications\nworks.</li>\n<li>When I remove that parameter and the trust store is not set\nup correctly, the spring will fail moments later after the bean is\ncreated during data source introspection.</li>\n</ul>\n<p>The problem I want to solve is the NPE thrown when the real cause SQLException should be logged. I want to solve <code>jdbcEnvironment == null</code>.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}