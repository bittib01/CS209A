{
  "question": {
    "tags": [
      "java",
      "spring",
      "google-cloud-platform",
      "google-cloud-pubsub"
    ],
    "owner": {
      "account_id": 10907310,
      "reputation": 2956,
      "user_id": 8017666,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/060a3fb01bb1beff4162ee106c51fefd?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "SRJ",
      "link": "https://stackoverflow.com/users/8017666/srj"
    },
    "is_answered": false,
    "view_count": 170,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1715418633,
    "creation_date": 1712238157,
    "question_id": 78274280,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78274280/gcp-pubsub-authorisation-issue-in-java-using-service-account",
    "title": "GCP PubSub Authorisation Issue In Java Using Service Account",
    "body": "<p>I am facing below issue while publishing messages to various topics from one java service.</p>\n<blockquote>\n<p>exception is com.google.api.gax.rpc.PermissionDeniedException:\nio.grpc.StatusRuntimeException: PERMISSION_DENIED: User not authorized\nto perform this\naction.\\ncom.google.cloud.spring.pubsub.core.PubSubDeliveryException:\nPublishing to\nprojects/testing-development/topics/testing-bacd-testing-1 topic\nfailed.; nested exception is\ncom.google.api.gax.rpc.PermissionDeniedException:\nio.grpc.StatusRuntimeException: PERMISSION_DENIED: User not authorized\nto perform this action.\\n\\tat\ncom.google.cloud.spring.pubsub.core.publisher.PubSubPublisherTemplate$1.onFailure(PubSubPublisherTemplate.java:111)\\n\\tat\ncom.google.api.core.ApiFutures$1.onFailure(ApiFutures.java:68)\\n\\tat\ncom.google.common.util.concurrent.Futures$CallbackListener.run(Futures.java:1074)\\n\\tat\ncom.google.common.util.concurrent.DirectExecutor.execute(DirectExecutor.java:30)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.executeListener(AbstractFuture.java:1213)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.complete(AbstractFuture.java:983)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.setException(AbstractFuture.java:771)\\n\\tat\ncom.google.api.core.AbstractApiFuture$InternalSettableFuture.setException(AbstractApiFuture.java:95)\\n\\tat\ncom.google.api.core.AbstractApiFuture.setException(AbstractApiFuture.java:77)\\n\\tat\ncom.google.api.core.SettableApiFuture.setException(SettableApiFuture.java:52)\\n\\tat\ncom.google.cloud.pubsub.v1.Publisher$OutstandingBatch.onFailure(Publisher.java:545)\\n\\tat\ncom.google.cloud.pubsub.v1.Publisher$OutstandingBatch.access$1600(Publisher.java:512)\\n\\tat\ncom.google.cloud.pubsub.v1.Publisher$3.onFailure(Publisher.java:488)\\n\\tat\ncom.google.api.core.ApiFutures$1.onFailure(ApiFutures.java:68)\\n\\tat\ncom.google.common.util.concurrent.Futures$CallbackListener.run(Futures.java:1074)\\n\\tat\ncom.google.common.util.concurrent.DirectExecutor.execute(DirectExecutor.java:30)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.executeListener(AbstractFuture.java:1213)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.complete(AbstractFuture.java:983)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.setException(AbstractFuture.java:771)\\n\\tat\ncom.google.api.gax.retrying.BasicRetryingFuture.handleAttempt(BasicRetryingFuture.java:200)\\n\\tat\ncom.google.api.gax.retrying.CallbackChainRetryingFuture$AttemptCompletionListener.handle(CallbackChainRetryingFuture.java:135)\\n\\tat\ncom.google.api.gax.retrying.CallbackChainRetryingFuture$AttemptCompletionListener.run(CallbackChainRetryingFuture.java:117)\\n\\tat\ncom.google.common.util.concurrent.DirectExecutor.execute(DirectExecutor.java:30)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.executeListener(AbstractFuture.java:1213)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.complete(AbstractFuture.java:983)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.setException(AbstractFuture.java:771)\\n\\tat\ncom.google.api.core.AbstractApiFuture$InternalSettableFuture.setException(AbstractApiFuture.java:95)\\n\\tat\ncom.google.api.core.AbstractApiFuture.setException(AbstractApiFuture.java:77)\\n\\tat\ncom.google.api.gax.grpc.GrpcExceptionCallable$ExceptionTransformingFuture.onFailure(GrpcExceptionCallable.java:97)\\n\\tat\ncom.google.api.core.ApiFutures$1.onFailure(ApiFutures.java:68)\\n\\tat\ncom.google.common.util.concurrent.Futures$CallbackListener.run(Futures.java:1074)\\n\\tat\ncom.google.common.util.concurrent.DirectExecutor.execute(DirectExecutor.java:30)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.executeListener(AbstractFuture.java:1213)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.complete(AbstractFuture.java:983)\\n\\tat\ncom.google.common.util.concurrent.AbstractFuture.setException(AbstractFuture.java:771)\\n\\tat\nio.grpc.stub.ClientCalls$GrpcFuture.setException(ClientCalls.java:563)\\n\\tat\nio.grpc.stub.ClientCalls$UnaryStreamToFuture.onClose(ClientCalls.java:533)\\n\\tat\nio.grpc.internal.DelayedClientCall$DelayedListener$3.run(DelayedClientCall.java:463)\\n\\tat\nio.grpc.internal.DelayedClientCall$DelayedListener.delayOrExecute(DelayedClientCall.java:427)\\n\\tat\nio.grpc.internal.DelayedClientCall$DelayedListener.onClose(DelayedClientCall.java:460)\\n\\tat\nio.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:553)\\n\\tat\nio.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:68)\\n\\tat\nio.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInternal(ClientCallImpl.java:739)\\n\\tat\nio.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:718)\\n\\tat\nio.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)\\n\\tat\nio.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:123)\\n\\tat\njava.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\\n\\tat\njava.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\\n\\tat\njava.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\\n\\tat\njava.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat\njava.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat\njava.base/java.lang.Thread.run(Thread.java:833)\\nCaused by:\ncom.google.api.gax.rpc.PermissionDeniedException:\nio.grpc.StatusRuntimeException: PERMISSION_DENIED: User not authorized\nto perform this action.\\n\\tat\ncom.google.api.gax.rpc.ApiExceptionFactory.createException(ApiExceptionFactory.java:55)\\n\\tat\ncom.google.api.gax.grpc.GrpcApiExceptionFactory.create(GrpcApiExceptionFactory.java:72)\\n\\tat\ncom.google.api.gax.grpc.GrpcApiExceptionFactory.create(GrpcApiExceptionFactory.java:60)\\n\\t...\n24 common frames omitted\\nCaused by: io.grpc.StatusRuntimeException:\nPERMISSION_DENIED: User not authorized to perform this action.\\n\\tat\nio.grpc.Status.asRuntimeException(Status.java:535)\\n\\t... 16 common\nframes omitted\\n&quot;,&quot;context&quot;:&quot;default&quot;}</p>\n</blockquote>\n<h2>My Setup</h2>\n<p>We are trying to publish to many topics from one java service.\nWe have created</p>\n<ul>\n<li>topics1 =&gt; using a wrapper library over <code>spring-cloud-gcp-pubsub</code> and using it to publish to some of the topics</li>\n<li>topics2 =&gt; using <code>spring-cloud-gcp-pubsub</code> directly to publish to other topics and this is behind a conditional property.</li>\n</ul>\n<p>We are seeing above error for all the topics in topics1 when conditional property for topics2 is enabled.</p>\n<h2>Attempts</h2>\n<ul>\n<li>There was library version mismatch, fixed it.</li>\n<li>Tried to run it locally with minimal setup and it is working fine.</li>\n<li>Checked permissions of service account being used and it has all the required permissions.</li>\n<li>Enabled pubsub auditing as well to find out but pubsub doesn't log Publish API calls.</li>\n</ul>\n<p>I would like to find out what is this user who is not authorised. Is there some access_token invalidation happening ?</p>\n<p>Thanks in advance.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}