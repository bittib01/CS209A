{
  "question": {
    "tags": [
      "java",
      "authentication",
      "validation",
      "keycloak",
      "registration"
    ],
    "owner": {
      "account_id": 20345409,
      "reputation": 556,
      "user_id": 14923466,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/865b05399928d13f544e520660c7805d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Alex_Pap",
      "link": "https://stackoverflow.com/users/14923466/alex-pap"
    },
    "is_answered": true,
    "view_count": 1609,
    "accepted_answer_id": 78914814,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1755352686,
    "creation_date": 1724419196,
    "question_id": 78906127,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78906127/keycloak-custom-registration-flow-fails-with-kc-services0013-failed-authentica",
    "title": "Keycloak Custom Registration Flow Fails with &quot;KC-SERVICES0013: Failed authentication: java.lang.NullPointerException&quot; Error",
    "body": "<p>I am following <a href=\"https://www.globalblogzone.com/a-step-by-step-guide-on-keycloak-custom-registration-flow/\" rel=\"nofollow noreferrer\">this guide</a> and trying to create my custom registration flow in Keycloak using two forms and custom templates. Below I am providing the code of the authenticator factory for the first form. The second form uses the same code with the only changes that taking place are the <code>PROVIDER_ID</code>, <code>getDisplayType()</code> method and the return type of the <code>render()</code> method which is <code>form.createForm(&quot;register2.ftl&quot;);</code>. The Keycloak version I am using is 24.0.1.</p>\n<p>I have:</p>\n<ul>\n<li>Build my application and copied the JAR file into <code>providers</code> folder</li>\n<li>Added my custom <code>.ftl</code> template files into the <code>themes</code> folder</li>\n<li>Executed the command <code>bin/kc.bat start-dev --debug</code></li>\n<li>Used <code>--debug</code> in order to expose the debug port and then use breakpoints in my application</li>\n</ul>\n<pre class=\"lang-java prettyprint-override\"><code>public class FirstCustomFormAuthenticatorFactory implements FormAuthenticatorFactory, FormAuthenticator  {\n\n    private static final String PROVIDER_ID = &quot;register-form1&quot;;\n    private static final AuthenticationExecutionModel.Requirement[] REQUIREMENT_CHOICES = {\n            AuthenticationExecutionModel.Requirement.REQUIRED\n    };\n\n    @Override\n    public String getDisplayType() {\n        return &quot;Registration Form 1&quot;;\n    }\n\n    @Override\n    public String getReferenceCategory() {\n        return &quot;&quot;;\n    }\n\n    @Override\n    public boolean isConfigurable() {\n        return false;\n    }\n\n    @Override\n    public AuthenticationExecutionModel.Requirement[] getRequirementChoices() {\n        return REQUIREMENT_CHOICES;\n    }\n\n    @Override\n    public boolean isUserSetupAllowed() {\n        return false;\n    }\n\n    @Override\n    public String getHelpText() {\n        return &quot;&quot;;\n    }\n\n    @Override\n    public List&lt;ProviderConfigProperty&gt; getConfigProperties() {\n        return List.of();\n    }\n\n    @Override\n    public FormAuthenticator create(KeycloakSession keycloakSession) {\n        return this;\n    }\n\n    @Override\n    public void init(Config.Scope scope) {\n\n    }\n\n    @Override\n    public void postInit(KeycloakSessionFactory keycloakSessionFactory) {\n\n    }\n\n    @Override\n    public void close() {\n\n    }\n\n    @Override\n    public String getId() {\n        return PROVIDER_ID;\n    }\n\n    @Override\n    public Response render(FormContext context, LoginFormsProvider form) {\n        RegisterBean rb = new RegisterBean(new MultivaluedHashMap&lt;&gt;(), context.getSession());\n        form.setAttribute(&quot;register&quot;, rb);\n        return form.createForm(&quot;register.ftl&quot;);\n    }\n}\n\n</code></pre>\n<p>Keycloak server starts without any errors. Afterwards:</p>\n<ul>\n<li>I go to http://localhost:8080/admin/myRealm/console</li>\n<li>I begin the registration flow of the first form by entering the credentials needed</li>\n</ul>\n<p>When submitting the form I am getting the next error:</p>\n<pre><code>KC-SERVICES0013: Failed authentication: java.lang.NullPointerException: Cannot invoke &quot;org.keycloak.authentication.FormAuthenticator.render(org.keycloak.authentication.FormContext, org.keycloak.forms.login.LoginFormsProvider)&quot; because &quot;this.formAuthenticator&quot; is null\n        at org.keycloak.authentication.FormAuthenticationFlow.renderForm(FormAuthenticationFlow.java:307)\n        at org.keycloak.authentication.FormAuthenticationFlow.processFlow(FormAuthenticationFlow.java:285)\n        at org.keycloak.authentication.DefaultAuthenticationFlow.processSingleFlowExecutionModel(DefaultAuthenticationFlow.java:377)\n        at org.keycloak.authentication.DefaultAuthenticationFlow.processFlow(DefaultAuthenticationFlow.java:246)\n        at org.keycloak.authentication.DefaultAuthenticationFlow.processAction(DefaultAuthenticationFlow.java:133)\n        at org.keycloak.authentication.AuthenticationProcessor.authenticationAction(AuthenticationProcessor.java:987)\n        at org.keycloak.services.resources.LoginActionsService.processFlow(LoginActionsService.java:364)\n        at org.keycloak.services.resources.LoginActionsService.processRegistration(LoginActionsService.java:724)\n        at org.keycloak.services.resources.LoginActionsService.registerRequest(LoginActionsService.java:780)\n        at org.keycloak.services.resources.LoginActionsService.processRegister(LoginActionsService.java:758)\n        at org.keycloak.services.resources.LoginActionsService$quarkusrestinvoker$processRegister_707378c0de357d574c0a2e1d6056afe7606ab5ff.invoke(Unknown Source)\n        at org.jboss.resteasy.reactive.server.handlers.InvocationHandler.handle(InvocationHandler.java:29)\n        at io.quarkus.resteasy.reactive.server.runtime.QuarkusResteasyReactiveRequestContext.invokeHandler(QuarkusResteasyReactiveRequestContext.java:141)\n        at org.jboss.resteasy.reactive.common.core.AbstractResteasyReactiveContext.run(AbstractResteasyReactiveContext.java:147)\n        at io.quarkus.vertx.core.runtime.VertxCoreRecorder$14.runWith(VertxCoreRecorder.java:582)\n        at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2513)\n        at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1538)\n        at org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:29)\n        at org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:29)\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.base/java.lang.Thread.run(Thread.java:857)\n</code></pre>\n<p>I am not entirely sure what's causing the issue, as seen in my logs. Do you have any suggestions aa what I am doing wrong?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}