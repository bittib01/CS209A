{
  "question": {
    "tags": [
      "java",
      "hibernate",
      "caching",
      "one-to-one"
    ],
    "owner": {
      "account_id": 31474750,
      "reputation": 31,
      "user_id": 24297481,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/5e37e1723e34001cf6d5dd3e2502e2c3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Kitret",
      "link": "https://stackoverflow.com/users/24297481/kitret"
    },
    "is_answered": true,
    "view_count": 89,
    "accepted_answer_id": 79842543,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1765360594,
    "creation_date": 1765205713,
    "last_edit_date": 1765255425,
    "question_id": 79841090,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79841090/hibernate-onetoone-mapping-is-unable-to-use-l2-cache-when-mapping-returns-no-ob",
    "title": "Hibernate @oneToOne mapping is unable to use L2 cache when mapping returns no Object",
    "body": "<p>I have 2 JPA classes with bi-directional onetoOne mapping :</p>\n<pre><code>@Entity\n@Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)\npublic class Person {\n\n    @Column(name = &quot;\\&quot;Name\\&quot;&quot;)\n    private String name;\n\n    // bi-directional one-to-one association to CarDetails\n    @OneToOne(cascade = CascadeType.ALL, optional = true, fetch = FetchType.EAGER, orphanRemoval = true, mappedBy = &quot;owner&quot;)\n    private CarDetails carDetails;\n\n    public String getName() {\n        return this.name;\n    }\n\n    public void setName(String name) {\n        return this.name=name;\n    }\n\n    public CarDetails getCarDetails() {\n        return this.carDetails;\n    }\n\n    public CarDetails setCarDetails(CarDetails carDetails) {\n        if (carDetails == null) {\n            if (this.carDetails != null) {\n                this.carDetails.setOwner(null);\n            }\n        }\n        else {\n            carDetails.setOwner(this);\n        }\n        this.carDetails = carDetails;\n        return this;\n    }\n\n}\n\n\n@Entity\n@Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)\npublic class CarDetails {\n\n    @Column(name = &quot;\\&quot;RegistrationNumber\\&quot;&quot;)\n    private String registrationNumber;\n\n    // bi-directional one-to-one association to Person\n    @OneToOne(cascade = CascadeType.ALL, optional = false, fetch = FetchType.LAZY)\n    @PrimaryKeyJoinColumn\n    private Person owner;\n\n\n    public String getRegistrationNumber() {\n        return this.registrationNumber;\n    }\n\n    public void setRegistrationNumber(String registrationNumber) {\n        return this.registrationNumber=registrationNumber;\n    }\n\n    public Person getOwner() {\n        return this.owner;\n    }\n\n    public void setOwner(Person owner) {\n        this.owner = owner;\n    }\n\n}\n</code></pre>\n<p>I have enable L2 cache for Hibernate and also enable hibernate sql logs to see what queries are being executed to DB using :</p>\n<pre><code>&lt;property name=&quot;hibernate.generate_statistics&quot; value=&quot;true&quot; /&gt;\n&lt;property name=&quot;hibernate.show_sql&quot; value=&quot;true&quot; /&gt;\n</code></pre>\n<p>I do em.find() for Person and expect that once the person entity is returned, the carDetails is also cached in the L2 cache and no more queries will be produced as we will get cache hits. But in the case where the person doesn't own any cars I am seeing that every time I access the carDetails a new query is fired to DB instead of storing that no carDetails were returned earlier.</p>\n<p>I also read <a href=\"https://docs.hibernate.org/orm/6.4/userguide/html_single/#caching-collection\" rel=\"nofollow noreferrer\">hibernate-docs-collection-cache</a>, since collections are not automatically cached I have also tried :</p>\n<pre><code>    @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)\n    // bi-directional one-to-one association to CarDetails\n    @OneToOne(cascade = CascadeType.ALL, optional = true, fetch = FetchType.EAGER, orphanRemoval = true, mappedBy = &quot;owner&quot;)\n    private CarDetails carDetails;\n</code></pre>\n<p>Using this the relationship should be cached but I still see that query hits the DB, in hibernate logs. Is there a way to fix this?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}