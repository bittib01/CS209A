{
  "question": {
    "tags": [
      "java",
      "apache-spark",
      "quarkus"
    ],
    "owner": {
      "account_id": 23552027,
      "reputation": 101,
      "user_id": 17594589,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/862bdce4ff666f15dd9c322ffe6097ab?s=256&d=identicon&r=PG",
      "display_name": "PowerfullDeveloper",
      "link": "https://stackoverflow.com/users/17594589/powerfulldeveloper"
    },
    "is_answered": false,
    "view_count": 620,
    "protected_date": 1730454244,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1730798495,
    "creation_date": 1709574970,
    "question_id": 78103230,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78103230/how-to-create-sparksession-in-quarkus-app",
    "title": "How to create SparkSession in Quarkus App?",
    "body": "<p>I'm trying to create simple Quarkus application with Apache Spark, to then later deploy it on kubernetes cluster. Application is starting with no errors (quarkus dev mode) but for some reason it can't create SparkSession (also no errors here, app just hangs when I invoke rest endpoint that uses SparkSession).</p>\n<p>In below code, when I write &quot;return sparkSessionBean.toString();&quot; in ExampleResource &quot;hello&quot; method, it runs correctly, but when I try to &quot;return sparkSessionBean.getSpark().toString();&quot; the request hangs forever, no errors.</p>\n<p>When I run the same code in standalone application with main method (without Quarkus), it runs correctly (creates SparkSession and executes some job).</p>\n<p>I've tested this on Quarkus 3.5.3 and 3.8.1 + Spark 3.5.0 + Java 17.</p>\n<p>Is there any problem with using Spark with Quarkus?</p>\n<p>Resource:</p>\n<pre><code>package com.example;\n\nimport jakarta.inject.Inject;\nimport jakarta.ws.rs.GET;\nimport jakarta.ws.rs.Path;\nimport jakarta.ws.rs.Produces;\nimport jakarta.ws.rs.core.MediaType;\n\n@Path(&quot;/hello&quot;)\npublic class ExampleResource {\n\n    @Inject\n    SparkSessionBean sparkSessionBean;\n\n    @GET\n    @Produces(MediaType.TEXT_PLAIN)\n    public String hello() {\n        return sparkSessionBean.getSpark().toString();\n    }\n}\n</code></pre>\n<p>SparkSessionBean:</p>\n<pre><code>package com.example;\n\nimport jakarta.enterprise.context.ApplicationScoped;\nimport org.apache.spark.sql.SparkSession;\n\n@ApplicationScoped\npublic class SparkSessionBean {\n    private static final String WAREHOUSE_PATH = &quot;s3a://iceberg&quot;;\n    private SparkSession spark;\n\n    public SparkSession getSpark() {\n        if (spark == null) {\n            spark = SparkSession.builder()\n                    .appName(&quot;Java Spark Iceberg Example&quot;)\n                    .master(&quot;local&quot;)\n                    .config(&quot;spark.ui.enabled&quot;, &quot;false&quot;)\n\n                    //Filesystem (MinIO) config\n                    .config(&quot;fs.s3a.impl&quot;, &quot;org.apache.hadoop.fs.s3a.S3AFileSystem&quot;)\n                    .config(&quot;fs.s3a.endpoint&quot;, &quot;http://localhost:9000&quot;)\n                    .config(&quot;fs.s3a.access.key&quot;, &quot;key123&quot;)\n                    .config(&quot;fs.s3a.secret.key&quot;, &quot;secret123&quot;)\n                    .config(&quot;fs.s3a.path.style.access&quot;, &quot;true&quot;)\n                    .config(&quot;spark.sql.warehouse.dir&quot;, WAREHOUSE_PATH)\n\n                    //Nessie catalog config\n                    .config(&quot;spark.jars.packages&quot;, &quot;org.apache.iceberg:iceberg-spark-runtime-3.5_2.13:1.3.0,org.projectnessie.nessie-integrations:nessie-spark-extensions-3.5_2.13:0.77.1&quot;)\n                    .config(&quot;spark.sql.extensions&quot;, &quot;org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions,org.projectnessie.spark.extensions.NessieSparkSessionExtensions&quot;)\n                    .config(&quot;spark.sql.catalog.nessie&quot;, &quot;org.apache.iceberg.spark.SparkCatalog&quot;)\n                    .config(&quot;spark.sql.catalog.nessie.catalog-impl&quot;, &quot;org.apache.iceberg.nessie.NessieCatalog&quot;)\n                    .config(&quot;spark.sql.catalog.nessie.authentication.type&quot;, &quot;NONE&quot;)\n                    .config(&quot;spark.sql.catalog.nessie.uri&quot;, &quot;http://localhost:19120/api/v1&quot;)\n                    .config(&quot;spark.sql.catalog.nessie.ref&quot;, &quot;main&quot;)\n                    .config(&quot;spark.sql.defaultCatalog&quot;, &quot;nessie&quot;)\n                    .config(&quot;spark.sql.catalog.nessie.warehouse&quot;, WAREHOUSE_PATH)\n                    .getOrCreate();\n        }\n        return spark;\n    }\n}\n</code></pre>\n<p>pom.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;\n&lt;project xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;\n         xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;com.example&lt;/groupId&gt;\n    &lt;artifactId&gt;quarkus-spark&lt;/artifactId&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n    &lt;properties&gt;\n        &lt;compiler-plugin.version&gt;3.12.1&lt;/compiler-plugin.version&gt;\n        &lt;maven.compiler.release&gt;17&lt;/maven.compiler.release&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;\n        &lt;quarkus.platform.artifact-id&gt;quarkus-bom&lt;/quarkus.platform.artifact-id&gt;\n        &lt;quarkus.platform.group-id&gt;io.quarkus.platform&lt;/quarkus.platform.group-id&gt;\n        &lt;quarkus.platform.version&gt;3.8.1&lt;/quarkus.platform.version&gt;\n        &lt;skipITs&gt;true&lt;/skipITs&gt;\n        &lt;surefire-plugin.version&gt;3.2.5&lt;/surefire-plugin.version&gt;\n        &lt;spark.version&gt;3.5.0&lt;/spark.version&gt;\n        &lt;iceberg.version&gt;1.4.3&lt;/iceberg.version&gt;\n        &lt;hadoop.version&gt;3.3.4&lt;/hadoop.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;${quarkus.platform.group-id}&lt;/groupId&gt;\n                &lt;artifactId&gt;${quarkus.platform.artifact-id}&lt;/artifactId&gt;\n                &lt;version&gt;${quarkus.platform.version}&lt;/version&gt;\n                &lt;type&gt;pom&lt;/type&gt;\n                &lt;scope&gt;import&lt;/scope&gt;\n            &lt;/dependency&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n    &lt;dependencies&gt;\n        &lt;!-- QUARKUS --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-arc&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-resteasy-reactive&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.quarkus&lt;/groupId&gt;\n            &lt;artifactId&gt;quarkus-junit5&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.rest-assured&lt;/groupId&gt;\n            &lt;artifactId&gt;rest-assured&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;!-- SPARK --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n            &lt;artifactId&gt;spark-core_2.13&lt;/artifactId&gt;\n            &lt;version&gt;${spark.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;\n            &lt;artifactId&gt;spark-sql_2.13&lt;/artifactId&gt;\n            &lt;version&gt;${spark.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- ICEBERG --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.iceberg&lt;/groupId&gt;\n            &lt;artifactId&gt;iceberg-spark-runtime-3.5_2.13&lt;/artifactId&gt;\n            &lt;version&gt;${iceberg.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- HADOOP --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;\n            &lt;artifactId&gt;hadoop-aws&lt;/artifactId&gt;\n            &lt;version&gt;${hadoop.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- OTHER --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.antlr&lt;/groupId&gt;\n            &lt;artifactId&gt;antlr4-runtime&lt;/artifactId&gt;\n            &lt;version&gt;4.9.3&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;\n            &lt;artifactId&gt;connect-api&lt;/artifactId&gt;\n            &lt;version&gt;3.2.3&lt;/version&gt;\n        &lt;/dependency&gt;\n&lt;/dependencies&gt;\n&lt;build&gt;\n&lt;plugins&gt;\n    &lt;plugin&gt;\n        &lt;groupId&gt;${quarkus.platform.group-id}&lt;/groupId&gt;\n        &lt;artifactId&gt;quarkus-maven-plugin&lt;/artifactId&gt;\n        &lt;version&gt;${quarkus.platform.version}&lt;/version&gt;\n        &lt;extensions&gt;true&lt;/extensions&gt;\n        &lt;executions&gt;\n            &lt;execution&gt;\n                &lt;goals&gt;\n                    &lt;goal&gt;build&lt;/goal&gt;\n                    &lt;goal&gt;generate-code&lt;/goal&gt;\n                    &lt;goal&gt;generate-code-tests&lt;/goal&gt;\n                &lt;/goals&gt;\n            &lt;/execution&gt;\n        &lt;/executions&gt;\n    &lt;/plugin&gt;\n    &lt;plugin&gt;\n        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n        &lt;version&gt;${compiler-plugin.version}&lt;/version&gt;\n        &lt;configuration&gt;\n            &lt;compilerArgs&gt;\n                &lt;arg&gt;-parameters&lt;/arg&gt;\n            &lt;/compilerArgs&gt;\n        &lt;/configuration&gt;\n    &lt;/plugin&gt;\n    &lt;plugin&gt;\n        &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;\n        &lt;version&gt;${surefire-plugin.version}&lt;/version&gt;\n        &lt;configuration&gt;\n            &lt;systemPropertyVariables&gt;\n                &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;\n                &lt;maven.home&gt;${maven.home}&lt;/maven.home&gt;\n            &lt;/systemPropertyVariables&gt;\n        &lt;/configuration&gt;\n    &lt;/plugin&gt;\n    &lt;plugin&gt;\n        &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;\n        &lt;version&gt;${surefire-plugin.version}&lt;/version&gt;\n        &lt;executions&gt;\n            &lt;execution&gt;\n                &lt;goals&gt;\n                    &lt;goal&gt;integration-test&lt;/goal&gt;\n                    &lt;goal&gt;verify&lt;/goal&gt;\n                &lt;/goals&gt;\n            &lt;/execution&gt;\n        &lt;/executions&gt;\n        &lt;configuration&gt;\n            &lt;systemPropertyVariables&gt;\n                &lt;native.image.path&gt;${project.build.directory}/${project.build.finalName}-runner\n                &lt;/native.image.path&gt;\n                &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;\n                &lt;maven.home&gt;${maven.home}&lt;/maven.home&gt;\n            &lt;/systemPropertyVariables&gt;\n        &lt;/configuration&gt;\n    &lt;/plugin&gt;\n&lt;/plugins&gt;\n&lt;/build&gt;\n&lt;profiles&gt;\n&lt;profile&gt;\n    &lt;id&gt;native&lt;/id&gt;\n    &lt;activation&gt;\n        &lt;property&gt;\n            &lt;name&gt;native&lt;/name&gt;\n        &lt;/property&gt;\n    &lt;/activation&gt;\n    &lt;properties&gt;\n        &lt;skipITs&gt;false&lt;/skipITs&gt;\n        &lt;quarkus.package.type&gt;native&lt;/quarkus.package.type&gt;\n    &lt;/properties&gt;\n&lt;/profile&gt;\n&lt;/profiles&gt;\n&lt;/project&gt;\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}