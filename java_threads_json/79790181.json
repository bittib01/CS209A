{
  "question": {
    "tags": [
      "java",
      "javafx",
      "drag-and-drop"
    ],
    "owner": {
      "account_id": 12506291,
      "reputation": 821,
      "user_id": 9103039,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/TqlDK.jpg?s=256",
      "display_name": "Starnec",
      "link": "https://stackoverflow.com/users/9103039/starnec"
    },
    "is_answered": true,
    "view_count": 195,
    "answer_count": 1,
    "score": 5,
    "last_activity_date": 1760701632,
    "creation_date": 1760446079,
    "question_id": 79790181,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79790181/change-the-preview-icons-of-the-dragged-files-when-the-source-is-the-os-file-sys",
    "title": "Change the preview icons of the dragged files when the source is the OS file system or another application",
    "body": "<h2>Intro</h2>\n<p>When dragging item(s) from another application into the <code>DnD</code> Node in <code>JavaFX</code> The operating system or the source application handles the visual display of the dragged item(s) since it is the source of the file(s) being dragged.</p>\n<p>This is the case with this app: the user has the ability to drag and drop specific categories of files, and these files are only accepted based on their extensions (<code>.png</code>, <code>.jpeg</code>, etc., for images).</p>\n<h2>The code</h2>\n<p>The interface <code>DragAndDropBehavior</code> has a single method <code>handleDroppedFiles(List&lt;File&gt; files)</code>, which will handle the files after they are dropped.</p>\n<pre><code>import java.io.File;\nimport java.util.List;\n\npublic interface DragAndDropBehavior {\n    void handleDroppedFiles(List&lt;File&gt; files);\n}\n</code></pre>\n<p>The <code>BaseDropController</code> class implements <code>DragAndDropBehavior</code>. Its method <code>hasAllowedExtension(File f, String... extensions)</code> returns true only if the file's extension matches one of the specified extensions. The <code>notifyError(String message)</code> method prints an <code>error message</code> if an issue occurs.</p>\n<pre><code>import java.io.File;\n\npublic abstract class BaseDropController implements DragAndDropBehavior {\n    protected boolean hasAllowedExtension(File f, String... extensions) {\n        var name = f.getName().toLowerCase();\n        for (var ext : extensions)\n            if (name.endsWith(ext))\n                return true;\n\n        return false;\n    }\n    protected void notifyError(String message) {\n        System.err.println(message);\n    }\n}\n</code></pre>\n<p>The <code>ImageDropController</code> extends the <code>BaseDropController</code>, thus implementing the <code>handleDroppedFiles(List&lt;File&gt; files)</code> method from the <code>DragAndDropBehavior</code> interface. <code>handleDroppedFiles</code> is simply a handler used when files are dropped.</p>\n<pre><code>import java.io.File;\nimport java.util.List;\n\npublic class ImageDropController extends BaseDropController {\n    @Override\n    public void handleDroppedFiles(List&lt;File&gt; files) {\n        var image = files.stream().filter(f -&gt; hasAllowedExtension(f, &quot;.png&quot;, &quot;.jpg&quot;, &quot;.jpeg&quot;, &quot;.webp&quot;)).findFirst();\n        image.ifPresentOrElse(\n                file -&gt; {\n                    System.out.println(&quot;Dropped file: &quot; + file.getAbsoluteFile());\n                },\n                () -&gt; notifyError(&quot;No image file found.&quot;)\n        );\n    }\n}\n</code></pre>\n<p>The <code>DragAndDropPane</code> extends <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/layout/StackPane.html\" rel=\"noreferrer\">StackPane</a>. It represents the area where file(s) should be dragged and dropped. <code>ObjectProperty&lt;Set&lt;String&gt;&gt; acceptedExtensions</code> and <code>ObjectProperty&lt;Consumer&lt;List&lt;File&gt;&gt;&gt; onFilesDropped</code> both specify the accepted extensions and the handler for the files when they are dropped. Both will be set by their respective setter based on the type of files that should be dragged and dropped.</p>\n<pre><code>import javafx.beans.property.*;\nimport javafx.geometry.Pos;\nimport javafx.scene.control.Label;\nimport javafx.scene.image.Image;\nimport javafx.scene.image.ImageView;\nimport javafx.scene.input.*;\nimport javafx.scene.layout.StackPane;\n\nimport java.io.File;\nimport java.util.List;\nimport java.util.Objects;\nimport java.util.Set;\nimport java.util.function.Consumer;\n\npublic final class DragAndDropPane extends StackPane {\n    private final ObjectProperty&lt;Set&lt;String&gt;&gt; acceptedExtensions = new SimpleObjectProperty&lt;&gt;();\n    private final ObjectProperty&lt;Consumer&lt;List&lt;File&gt;&gt;&gt; onFilesDropped = new SimpleObjectProperty&lt;&gt;();\n    private final BooleanProperty highlight = new SimpleBooleanProperty(false);\n\n    public DragAndDropPane() {\n        getStyleClass().add(&quot;drop-pane&quot;);\n\n        var label = new Label(&quot;Drop files here&quot;);\n        setAlignment(label, Pos.CENTER);\n        getChildren().add(label);\n\n        setOnDragOver(e -&gt; {\n            if (e.getGestureSource() != this &amp;&amp; e.getDragboard().hasFiles()) {\n                if (acceptsAny(e.getDragboard().getFiles())) {\n                    e.acceptTransferModes(TransferMode.MOVE);\n                    highlight.set(true);\n                }\n            }\n            e.consume();\n        });\n\n        setOnDragExited(e -&gt; {\n            highlight.set(false);\n            e.consume();\n        });\n\n        setOnDragDropped(e -&gt; {\n            var dragBoard = e.getDragboard();\n            boolean success = false;\n            if (dragBoard.hasFiles() &amp;&amp; acceptsAny(dragBoard.getFiles())) {\n                var handler = getOnFilesDropped();\n                if (handler != null)\n                    handler.accept(dragBoard.getFiles());\n                success = true;\n            }\n            e.setDropCompleted(success);\n            e.consume();\n        });\n\n        highlight.addListener((_, _, hi) -&gt;\n                pseudoClassStateChanged(javafx.css.PseudoClass.getPseudoClass(&quot;active&quot;), hi));\n    }\n\n    private boolean acceptsAny(List&lt;File&gt; files) {\n        var extensions = getAcceptedExtensions();\n        if (extensions == null || extensions.isEmpty())\n            return true;\n        return files.stream().anyMatch(file -&gt;\n                extensions.stream().anyMatch(extension -&gt; file.getName().toLowerCase().endsWith(extension.toLowerCase()))\n        );\n    }\n\n    public void setAcceptedExtensions(Set&lt;String&gt; extensions) {\n        acceptedExtensions.set(extensions);\n    }\n\n    public void setOnFilesDropped(Consumer&lt;List&lt;File&gt;&gt; c) {\n        onFilesDropped.set(c);\n    }\n\n    public Set&lt;String&gt; getAcceptedExtensions() {\n        return acceptedExtensions.get();\n    }\n\n    public ObjectProperty&lt;Set&lt;String&gt;&gt; acceptedExtensionsProperty() {\n        return acceptedExtensions;\n    }\n\n    public Consumer&lt;List&lt;File&gt;&gt; getOnFilesDropped() {\n        return onFilesDropped.get();\n    }\n\n    public ObjectProperty&lt;Consumer&lt;List&lt;File&gt;&gt;&gt; onFilesDroppedProperty() {\n        return onFilesDropped;\n    }\n}\n</code></pre>\n<p>The <code>ImageDropView</code> simply contains the draggable area and the preview section for dropped files. It loads the appropriate <code>FXML</code> file (<code>ImageDropView</code> in this case) and binds the elements to its fields. It then uses the <code>ImageDropController</code> to set the handler when files are dropped to the <code>DragAndDropPane</code> with <code>drop.setOnFilesDropped(controller::handleDroppedFiles)</code>.</p>\n<pre><code>import javafx.fxml.FXML;\nimport javafx.fxml.FXMLLoader;\nimport javafx.scene.Parent;\nimport javafx.scene.layout.StackPane;\n\nimport java.io.IOException;\nimport java.util.Set;\n\npublic final class ImageDropView {\n    private final Parent root;\n    @FXML\n    private DragAndDropPane drop;\n    @FXML\n    private StackPane preview;\n\n    private final ImageDropController controller = new ImageDropController();\n\n    public ImageDropView() {\n        try {\n            var loader = new FXMLLoader(getClass().getResource(&quot;ImageDropView.fxml&quot;));\n            loader.setController(this);\n            this.root = loader.load();\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n        drop.setAcceptedExtensions(Set.of(&quot;.png&quot;, &quot;.jpg&quot;, &quot;.jpeg&quot;, &quot;.webp&quot;));\n        drop.setOnFilesDropped(controller::handleDroppedFiles);\n    }\n\n    public Parent getRoot() {\n        return root;\n    }\n}\n</code></pre>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n\n&lt;?import javafx.scene.control.*?&gt;\n&lt;?import javafx.scene.layout.*?&gt;\n\n&lt;?import test.DragAndDropPane?&gt;\n&lt;VBox spacing=&quot;16&quot; xmlns=&quot;http://javafx.com/javafx&quot; xmlns:fx=&quot;http://javafx.com/fxml&quot;&gt;\n    &lt;Label text=&quot;Import Image&quot;/&gt;\n    &lt;DragAndDropPane fx:id=&quot;drop&quot; prefHeight=&quot;150&quot; style=&quot;-fx-background-color: #55ff00;&quot;/&gt;\n    &lt;StackPane fx:id=&quot;preview&quot; prefHeight=&quot;300&quot; style=&quot;-fx-background-color: #00dfff; -fx-background-radius: 8;&quot;/&gt;\n&lt;/VBox&gt;\n</code></pre>\n<p>The <code>DropViewFactory</code> class creates and returns the root element of the specified <code>MediaType</code>.</p>\n<pre><code>import javafx.scene.Parent;\n\npublic final class DropViewFactory {\n    public static Parent create(MediaType type) {\n        return switch (type) {\n            case IMAGE -&gt; new ImageDropView().getRoot();\n            case VIDEO -&gt; new VideoDropView().getRoot();\n        };\n    }\n}\n</code></pre>\n<pre><code>public enum MediaType {IMAGE, VIDEO}\n</code></pre>\n<p>These are the <code>Main Controller</code> and the <code>Main</code> classes respectively</p>\n<pre><code>import javafx.fxml.FXML;\nimport javafx.scene.Scene;\nimport javafx.scene.layout.BorderPane;\nimport javafx.stage.Modality;\nimport javafx.stage.Stage;\n\npublic class MainController {\n    @FXML\n    private BorderPane root;\n\n    public void openImageDialog() {\n        open(MediaType.IMAGE, &quot;Import Image&quot;);\n    }\n\n    public void openVideoDialog() {\n        open(MediaType.VIDEO, &quot;Import Video&quot;);\n    }\n\n    private void open(MediaType type, String title) {\n        var stage = new Stage();\n        stage.setTitle(title);\n        stage.initModality(Modality.APPLICATION_MODAL);\n        stage.setScene(new Scene(DropViewFactory.create(type), 900, 600));\n        stage.show();\n    }\n}\n</code></pre>\n<pre><code>import javafx.application.Application;\nimport javafx.stage.Stage;\nimport test.MainController;\n\npublic class Main extends Application {\n    @Override\n    public void start(Stage primaryStage) {\n        MainController mainController = new MainController();\n        mainController.openImageDialog();\n    }\n}\n</code></pre>\n<h2>What I want to do</h2>\n<p>When the file(s) are dragged onto the <code>DragAndDropPane</code>, the system sets the icon of the file(s). For example, if four files are dragged, the system will display the form with reduced opacity. I want to replace the icons with a single icon that displays the number of elements being dragged at the bottom-right corner.</p>\n<p>In those two similar questions (<a href=\"https://stackoverflow.com/questions/71732537/is-it-possible-to-change-the-white-file-icon-that-appears-when-dragging-a-node-w\">post1</a>, <a href=\"https://stackoverflow.com/questions/79679350/why-does-dragboardsetdragview-shrink-my-image-and-how-can-i-control-its-size\">post2</a>), both want the same thing, but both have a draggable element coming from within the JavaFX application. Also, in the <a href=\"https://openjfx.io/javadoc/25/javafx.graphics/javafx/scene/input/Dragboard.html#setDragView%28javafx.scene.image.Image%29\" rel=\"noreferrer\">setDragView</a> docs, it works only if the element's source is coming from the app.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}