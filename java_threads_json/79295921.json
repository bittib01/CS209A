{
  "question": {
    "tags": [
      "java",
      "gradle"
    ],
    "owner": {
      "account_id": 38608625,
      "reputation": 19,
      "user_id": 28861526,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/9216c6e43c85e40c309db57ed1396a8d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Nick Mate",
      "link": "https://stackoverflow.com/users/28861526/nick-mate"
    },
    "is_answered": false,
    "view_count": 52,
    "closed_date": 1734711911,
    "answer_count": 0,
    "score": 1,
    "last_activity_date": 1736206072,
    "creation_date": 1734653951,
    "last_edit_date": 1736206072,
    "question_id": 79295921,
    "link": "https://stackoverflow.com/questions/79295921/why-do-i-get-the-error-java-lang-securityexception-unknown-calling-package-nam",
    "closed_reason": "Duplicate",
    "title": "Why do I get the error &quot;java.lang.SecurityException: Unknown calling package name &#39;com.google.android.gms&#39;&quot;?",
    "body": "<p>Its been almost a month since i can not find an answer to my issue.\nBuilding the APK will result in success when it comes down to signing into firebase.\nThe issues happen only when i sign it and upload it to my private testers.\nI will get an exception api:10 after trying to login.\nThe worry is that i always get <code>Failed to get service from broker.  (Ask Gemini) java.lang.SecurityException: Unknown calling package name 'com.google.android.gms'.</code>\nEvery time.</p>\n<p>here is my build gradle:app with some changes to hide sensitive data.</p>\n<pre><code>plugins {\n    id(&quot;com.android.application&quot;)\n    id(&quot;com.google.gms.google-services&quot;) // Correct Google Services plugin\n    id(&quot;com.google.firebase.appdistribution&quot;) version &quot;5.0.0&quot;\n\n}\n\nandroid {\n    namespace = &quot;com.XX.XX&quot;\n    compileSdk = 34\n\n    defaultConfig {\n        applicationId = &quot;com.XX.XX&quot;\n        minSdk = 33\n        targetSdk = 36\n        versionCode = 22\n        versionName = &quot;2.4&quot;\n    }\n\n    signingConfigs {\n        create(&quot;release&quot;) {\n            storeFile = file(&quot;C:/XX/release.keystore&quot;)\n            storePassword = &quot;XX&quot;\n            keyAlias = &quot;XX&quot;\n            keyPassword = &quot;XX&quot;\n        }\n    }\n\n\n    buildTypes {\n        getByName(&quot;release&quot;) {\n            signingConfig = signingConfigs.getByName(&quot;release&quot;)\n            isMinifyEnabled = false\n            proguardFiles(\n                getDefaultProguardFile(&quot;proguard-android-optimize.txt&quot;),\n                &quot;proguard-rules.pro&quot;\n            )\n        }\n    }\n\n    compileOptions {\n        sourceCompatibility = JavaVersion.VERSION_11\n        targetCompatibility = JavaVersion.VERSION_11\n    }\n}\n\ndependencies {\n    implementation(libs.play.services.location)\n    implementation(libs.appcompat.v160)\n    implementation(libs.material.v180)\n    implementation(libs.activity.v172)\n    implementation(libs.constraintlayout.v214)\n\n    // Firebase BOM to manage versions\n    implementation(platform(libs.firebase.bom))\n    implementation(libs.google.firebase.analytics)\n    implementation(libs.com.google.firebase.firebase.messaging)\n    implementation(libs.google.firebase.firestore)\n    implementation(libs.com.google.firebase.firebase.auth)\n    implementation(libs.play.services.auth)\n    implementation(libs.play.services.location)\n\n    // Testing dependencies\n    testImplementation(libs.junit)\n    androidTestImplementation(libs.junit.v115)\n    androidTestImplementation(libs.espresso.core.v351)\n}\n\n</code></pre>\n<p>my settings.gradle</p>\n<pre><code>pluginManagement {\n    repositories {\n        google {\n            content {\n                includeGroupByRegex(&quot;com\\\\.android.*&quot;)\n                includeGroupByRegex(&quot;com\\\\.google.*&quot;)\n                includeGroupByRegex(&quot;androidx.*&quot;)\n            }\n        }\n        mavenCentral()\n        gradlePluginPortal()\n    }\n}\n\ndependencyResolutionManagement {\n    repositories {\n        google()\n        mavenCentral()\n        maven { url = uri(&quot;https://jitpack.io&quot;) } // Include Jitpack if necessary\n    }\n}\n\nrootProject.name = &quot;XX&quot;\ninclude(&quot;:app&quot;)\n</code></pre>\n<p>my build.gradle</p>\n<pre><code>// Top-level build file where you can add configuration options common to all sub-projects/modules.\nplugins {\n    //alias(libs.plugins.android.application) apply false\n    id(&quot;com.android.application&quot;) version &quot;8.7.3&quot; apply false\n    id(&quot;com.google.gms.google-services&quot;) version &quot;4.4.2&quot; apply false\n    id(&quot;com.google.firebase.appdistribution&quot;) version &quot;5.0.0&quot; apply false\n\n\n}\n</code></pre>\n<p>and my main activity.</p>\n<pre><code>package com.XX.XX;\n\nimport android.Manifest;\nimport android.content.Intent;\nimport android.content.pm.PackageManager;\nimport android.os.Build;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.view.View;\nimport android.widget.TextView;\nimport android.widget.Toast;\n\nimport androidx.annotation.Nullable;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.core.app.ActivityCompat;\nimport androidx.core.content.ContextCompat;\n\nimport com.google.android.gms.auth.api.signin.GoogleSignIn;\nimport com.google.android.gms.auth.api.signin.GoogleSignInAccount;\nimport com.google.android.gms.auth.api.signin.GoogleSignInClient;\nimport com.google.android.gms.auth.api.signin.GoogleSignInOptions;\nimport com.google.android.gms.common.ConnectionResult;\nimport com.google.android.gms.common.GoogleApiAvailability;\nimport com.google.android.gms.common.SignInButton;\nimport com.google.android.gms.common.api.ApiException;\nimport com.google.android.gms.tasks.Task;\nimport com.google.firebase.FirebaseApp;\nimport com.google.firebase.analytics.FirebaseAnalytics;\nimport com.google.firebase.auth.FirebaseAuth;\nimport com.google.firebase.auth.FirebaseUser;\nimport com.google.firebase.auth.GoogleAuthProvider;\nimport com.google.firebase.firestore.DocumentReference;\nimport com.google.firebase.firestore.FirebaseFirestore;\nimport com.google.firebase.messaging.FirebaseMessaging;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class MainActivity extends AppCompatActivity {\n\n    private static final String TAG = &quot;MainActivity&quot;;\n    private FirebaseAuth mAuth;\n    private FirebaseFirestore db;\n    private SignInButton googleSignInButton;\n    private TextView authStatusTextView;\n    private FirebaseAnalytics mFirebaseAnalytics;\n    int GOOGLE_SIGN_IN = 10210;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        mFirebaseAnalytics = FirebaseAnalytics.getInstance(this);\n        Log.d(TAG, &quot;MainActivity Created&quot;);\n\n        // Check for Google Play services\n        GoogleApiAvailability googleApiAvailability = GoogleApiAvailability.getInstance();\n        int resultCode = googleApiAvailability.isGooglePlayServicesAvailable(this);\n        if (resultCode != ConnectionResult.SUCCESS) {\n            if (googleApiAvailability.isUserResolvableError(resultCode)) {\n                googleApiAvailability.getErrorDialog(this, resultCode, 9000).show();\n            } else {\n                Log.e(TAG, &quot;Google Play Services not available.&quot;);\n                finish(); // Or handle the error appropriately\n                return;\n            }\n        }\n\n        FirebaseApp.initializeApp(this);\n        mAuth = FirebaseAuth.getInstance();\n        db = FirebaseFirestore.getInstance();\n\n        googleSignInButton = findViewById(R.id.googleSignInButton);\n        authStatusTextView = findViewById(R.id.authStatusTextView);\n        googleSignInButton.setOnClickListener(v -&gt; signInWithGoogle());\n\n        checkNotificationPermission();\n        checkCurrentUser();\n    }\n\n    private void checkCurrentUser() {\n        FirebaseUser currentUser = mAuth.getCurrentUser();\n        if (currentUser != null) {\n            authStatusTextView.setText(&quot;Logged in as: &quot; + currentUser.getDisplayName());\n            googleSignInButton.setVisibility(View.GONE);\n            checkFCMToken(currentUser.getUid());\n        } else {\n            authStatusTextView.setText(&quot;Not logged in&quot;);\n            googleSignInButton.setVisibility(View.VISIBLE);\n        }\n    }\n\n    private void checkNotificationPermission() {\n        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.TIRAMISU) {\n            if (ContextCompat.checkSelfPermission(this, Manifest.permission.POST_NOTIFICATIONS) != PackageManager.PERMISSION_GRANTED) {\n                ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.POST_NOTIFICATIONS}, 1001);\n            } else {\n                subscribeToGlobalTopic();\n            }\n        } else {\n            subscribeToGlobalTopic();\n        }\n    }\n\n    @Override\n    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {\n        super.onRequestPermissionsResult(requestCode, permissions, grantResults);\n        if (requestCode == 1001 &amp;&amp; grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {\n            subscribeToGlobalTopic();\n        } else {\n            showToast(&quot;Notification permission required for updates.&quot;);\n        }\n    }\n\n    private void signInWithGoogle() {\n        GoogleSignInOptions gso = new GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)\n                .requestIdToken(getString(R.string.default_web_client_id))\n                .requestEmail()\n                .build();\n        GoogleSignInClient googleSignInClient = GoogleSignIn.getClient(this, gso);\n        googleSignInClient.signOut();\n        Intent signInIntent = googleSignInClient.getSignInIntent();\n        startActivityForResult(signInIntent, GOOGLE_SIGN_IN);\n    }\n\n    @Override\n    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {\n        super.onActivityResult(requestCode, resultCode, data);\n        if (requestCode == GOOGLE_SIGN_IN) {\n            Task&lt;GoogleSignInAccount&gt; task = GoogleSignIn.getSignedInAccountFromIntent(data);\n            handleSignInResult(task);\n        }\n    }\n\n    private void handleSignInResult(Task&lt;GoogleSignInAccount&gt; task) {\n        try {\n            GoogleSignInAccount account = task.getResult(ApiException.class);\n            firebaseAuthWithGoogle(account.getIdToken());\n        } catch (ApiException e) {\n            Log.w(TAG, &quot;Google sign-in failed&quot;, e);\n            showToast(&quot;Authentication Failed.&quot; + e);\n        } catch (Throwable throwable) {\n            throwable.printStackTrace();\n        }\n    }\n\n    private void firebaseAuthWithGoogle(String idToken) {\n        mAuth.signInWithCredential(GoogleAuthProvider.getCredential(idToken, null))\n                .addOnCompleteListener(this, task -&gt; {\n                    if (task.isSuccessful()) {\n                        checkCurrentUser();\n                    } else {\n                        showToast(&quot;Authentication Failed.&quot;);\n                    }\n                });\n    }\n\n    private void checkFCMToken(String userId) {\n        DocumentReference docRef = db.collection(&quot;users&quot;).document(userId);\n        docRef.get().addOnCompleteListener(task -&gt; {\n            if (task.isSuccessful() &amp;&amp; task.getResult() != null) {\n                if (task.getResult().exists()) {\n                    if (!task.getResult().contains(&quot;fcm_token&quot;)) { // Check for *absence* of token\n                        getFCMToken();\n                    } else {\n                        subscribeToGlobalTopic();\n                    }\n                } else {\n                    getFCMToken();\n                }\n            } else {\n                Log.w(TAG, &quot;Error checking FCM token&quot;, task.getException());\n            }\n        });\n    }\n\n\n    private void subscribeToGlobalTopic() {\n        FirebaseMessaging.getInstance().subscribeToTopic(&quot;global&quot;)\n                .addOnCompleteListener(task -&gt; {\n                    if (!task.isSuccessful()) {\n                        Log.w(TAG, &quot;Subscribe to global topic failed&quot;, task.getException());\n                    }\n                });\n    }\n\n    private void getFCMToken() {\n        FirebaseMessaging.getInstance().getToken().addOnCompleteListener(task -&gt; {\n            if (task.isSuccessful() &amp;&amp; task.getResult() != null) {\n                String token = task.getResult();\n                saveTokenToFirestore(token);\n            } else {\n                Log.w(TAG, &quot;Fetching FCM token failed&quot;, task.getException());\n            }\n        });\n    }\n\n    private void saveTokenToFirestore(String token) {\n        FirebaseUser user = mAuth.getCurrentUser();\n        if (user != null) {\n            Map&lt;String, Object&gt; data = new HashMap&lt;&gt;();\n            data.put(&quot;fcm_token&quot;, token);\n            db.collection(&quot;users&quot;).document(user.getUid())\n                    .set(data)\n                    .addOnFailureListener(e -&gt; Log.w(TAG, &quot;Saving FCM token failed&quot;, e));\n        }\n    }\n\n    private void showToast(String message) {\n        Toast.makeText(this, message, Toast.LENGTH_SHORT).show();\n    }\n}`\n</code></pre>\n<p>My google json is correct and matches the firebase + google oath.\nI am getting insane. I would love some help</p>\n<p>Tried everything but the error never went away.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}