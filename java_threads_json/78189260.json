{
  "question": {
    "tags": [
      "java",
      "spring-webflux",
      "reactive-programming",
      "project-reactor"
    ],
    "owner": {
      "account_id": 104347,
      "reputation": 5043,
      "user_id": 279028,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/5e602f09c236726798cfa09f4e9f9ad1?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Andrei",
      "link": "https://stackoverflow.com/users/279028/andrei"
    },
    "is_answered": false,
    "view_count": 344,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1713380883,
    "creation_date": 1710877372,
    "last_edit_date": 1710951566,
    "question_id": 78189260,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78189260/enhancing-mono-with-information-for-error-handling",
    "title": "Enhancing mono with information for error handling",
    "body": "<p>We are using <code>Mono</code> to handle calling REST services and I would like to enhance the exception handling by adding some extra information, to be used in case an exception has to be thrown.</p>\n<p>Roughly, the code we have is of this form:</p>\n<pre><code>public ResultType callSomeService(Object param) {\n   return addTimeoutAndRetryToMono(getMonoForServiceCall(param)).block();\n}\n</code></pre>\n<p>The <code>addTimeoutAndRetryToMono</code> is a function that takes and returns a <code>Mono</code> and adds timeout, retry and error mapping. It is in the error map it defines that we throw, for instance, a <code>TimeoutException</code>.</p>\n<p>I would like to enhance the exception being thrown by the <code>callSomeService</code> function with information regarding the service being called. For example, I would like to throw a custom exception with a message like &quot;Timeout while calling {some path}&quot;.</p>\n<p>Unfortunately, the &quot;path&quot; information is available only in the <code>getMonoForServiceCall</code>, which is generated based on an OpenAPI specification.</p>\n<p>I have simplified the functions mentioned above to this:</p>\n<pre><code>Mono&lt;T&gt; getMonoForServiceCall(Object param) {\n   ....\n   // webClient comes from spring-webflux\n   // prepareRequest handles the http method, path, query params, etc., fairly boiler-plate stuff\n   ...\n   WebClient.RequestBodySpec requestBuilder = prepareRequest(webClient, path, param);\n\n   return requestBuilder.retrieve().bodyToMono(returnType);\n}\n</code></pre>\n<p>and</p>\n<pre><code>Mono&lt;T&gt; addTimeoutAndRetryToMono(Mono&lt;T&gt; mono) {\n  return mono.timeout(Duration.ofSeconds(10))\n             .onErrorMap(t -&gt; handleExceptions(t));\n}\n\nThrowable handleExceptions(Throwable t) {\n  return new RestClientException(&quot;Here I would like to have the path of the API being called&quot;);\n}\n</code></pre>\n<p>The simplest way would be to pass the &quot;path&quot; information around, catch and throw the custom exception in <code>callSomeService</code>, but there are quite a lot of these methods and it does feel &quot;dirty&quot;.</p>\n<p>I tried to use <code>contextWrite</code> in <code>getMonoForService</code>, adding the &quot;path&quot; to the context, but I can't seem to make it available in the error map.</p>\n<p>The ideal sort of change would be done at the level of <code>getMonoForService</code> (where I have access to the path and other relevant fields) and <code>addTimeoutAndRetryToMono</code> (which is adding the error map), since these are in one of shared libraries and would result in a cleaner solution. The <code>getMonoForServiceCall</code> function should continue to return a <code>Mono&lt;T&gt;</code>.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}