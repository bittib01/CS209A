{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "jpa",
      "junit",
      "spring-data-jpa"
    ],
    "owner": {
      "account_id": 14455597,
      "reputation": 385,
      "user_id": 10441916,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/e3abc4f9eeb0133de6b9371d7e7490c2?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "harunaga",
      "link": "https://stackoverflow.com/users/10441916/harunaga"
    },
    "is_answered": true,
    "view_count": 1939,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1741005589,
    "creation_date": 1716000533,
    "question_id": 78498519,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78498519/how-to-mock-a-repository-with-spring-data-jpa-specification",
    "title": "How to mock a repository with Spring Data JPA + Specification",
    "body": "<p>There is a basic CRUD API, and I want to test the UserServiseImpl.java class in its Service layer. In UserServiseImpl, entities are retrieved with</p>\n<blockquote>\n<p>userRepository.findAll(query)</p>\n</blockquote>\n<p>as shown below, and I want to mock this.</p>\n<pre class=\"lang-java prettyprint-override\"><code>public interface UserRepository extends JpaRepository&lt;User, Long&gt;, JpaSpecificationExecutor&lt;User&gt; {\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>UserSpecification spec = new UserSpecification();\nSpecification&lt;User&gt; query = Specification.where(spec.userIdEqual(spec.userIdEqual(userId)))\n                    .and(spec.nameContains(target.getName()))\n                    .and(spec.startDateGreaterThanEqual(target.getStartDate()))\n                    .and(spec.endDateLessThanEqual(target.getEndDate()))\n\n       List&lt;User&gt; user = userRepository.findAll(query);\n</code></pre>\n<p>I thought I could mock it with @Mock from Mockito as follows, but it seems that the instance of Specification (the argument query of findAll) cannot be the same instance that is specified when it is actually called, resulting in findAll being called with different arguments.</p>\n<pre class=\"lang-java prettyprint-override\"><code>UserSpecification spec = new UserSpecification();\nSpecification&lt;User&gt; query = Specification.where(spec.userIdEqual(&quot;1&quot;))\n                    .and(spec.nameContains(&quot;john&quot;)\n                    .and(spec.startDateGreaterThanEqual(&quot;2024-1-1&quot;))\n                    .and(spec.endDateLessThanEqual(&quot;2024-1-2&quot;))\n\nwhen(userRepository.findAll(query)).thenReturn(userList)\n</code></pre>\n<p>How should I mock in cases where Specification is used like this? If anyone knows, I would appreciate your guidance.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}