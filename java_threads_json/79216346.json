{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "resttemplate",
      "spring-resttemplate"
    ],
    "owner": {
      "account_id": 37726488,
      "reputation": 1,
      "user_id": 28395612,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/0732cff3a98a2e6facc96398f6713519?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Konstantin Panisov",
      "link": "https://stackoverflow.com/users/28395612/konstantin-panisov"
    },
    "is_answered": false,
    "view_count": 70,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1732523071,
    "creation_date": 1732303603,
    "question_id": 79216346,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79216346/how-to-upload-a-big-file-by-resttemplate",
    "title": "How to upload a big file by RestTemplate?",
    "body": "<p>I get a MultipartFile from users and resent it to an API by RestTemplate. But I get <strong>ArrayIndexOutOfBoundsException</strong> if a file size biger than 2gb</p>\n<hr />\n<pre><code>java.lang.ArrayIndexOutOfBoundsException: arraycopy: last destination index 2147468288 out of bounds for byte[1819689347]\nat java.base/java.lang.System.arraycopy(Native Method) ~[na:na]\nat org.springframework.util.FastByteArrayOutputStream.resize(FastByteArrayOutputStream.java:299) ~[spring-core-6.1.8.jar:6.1.8]\nat org.springframework.util.FastByteArrayOutputStream.toByteArrayUnsafe(FastByteArrayOutputStream.java:215) ~[spring-core-6.1.8.jar:6.1.8]\nat org.springframework.http.client.AbstractBufferingClientHttpRequest.executeInternal(AbstractBufferingClientHttpRequest.java:44) ~[spring-web-6.1.8.jar:6.1.8]\nat org.springframework.http.client.AbstractClientHttpRequest.execute(AbstractClientHttpRequest.java:66) ~[spring-web-6.1.8.jar:6.1.8]\nat org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:889) ~[spring-web-6.1.8.jar:6.1.8]\nat org.springframework.web.client.RestTemplate.execute(RestTemplate.java:790) ~[spring-web-6.1.8.jar:6.1.8]\n</code></pre>\n<p>Method for sending request:</p>\n<pre><code>protected String postFileRestTemplate(String addToBaseURL,\n                                          InputStreamResource inputStreamResource) {\n\n       restTemplate.setInterceptors(Collections.singletonList(new LoggingInterceptor()));\n\n        httpHeaders.setContentType(MediaType.MULTIPART_FORM_DATA);\n\n        MultipartBodyBuilder builder = new MultipartBodyBuilder();\n        builder.part(&quot;content&quot;, &quot;iso&quot;);\n        builder.part(&quot;filename&quot;, inputStreamResource);\n\n        MultiValueMap&lt;String, HttpEntity&lt;?&gt;&gt; build = builder.build();\n        HttpEntity&lt;Object&gt; objectHttpEntity = new HttpEntity&lt;&gt;(build, httpHeaders);\n\n        ResponseEntity&lt;String&gt; exchange = restTemplate.postForEntity(\n                baseURL + addToBaseURL,\n                objectHttpEntity,\n                String.class);\n\n        log.info(exchange.getBody());\n        return exchange.getBody();\n\n    }\n</code></pre>\n<p>I also write LoggingInterceptor which do nothing, i needed to check the headers, but if i delete this. I get &quot;501 chunked transfer encoding not supported&quot; I don't know why it happend.</p>\n<pre><code>  public class LoggingInterceptor implements ClientHttpRequestInterceptor {\n\n\n    @Override\n    public ClientHttpResponse intercept(HttpRequest request, byte[] body, ClientHttpRequestExecution execution) throws IOException {\n        ClientHttpResponse response = execution.execute(request, body);\n        return response;\n    }\n</code></pre>\n<p>I tried to find info on web, but I didn't find any way how to do that.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}