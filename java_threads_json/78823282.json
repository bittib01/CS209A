{
  "question": {
    "tags": [
      "java",
      "oracle-database",
      "spring-boot",
      "ucp"
    ],
    "owner": {
      "account_id": 1100988,
      "reputation": 353,
      "user_id": 1093390,
      "user_type": "registered",
      "accept_rate": 71,
      "profile_image": "https://i.sstatic.net/76gxs.jpg?s=256",
      "display_name": "Swaraj",
      "link": "https://stackoverflow.com/users/1093390/swaraj"
    },
    "is_answered": false,
    "view_count": 498,
    "answer_count": 2,
    "score": -1,
    "last_activity_date": 1730722131,
    "creation_date": 1722552827,
    "question_id": 78823282,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78823282/universal-connection-pool-already-exists-error-oracle-ucp-springboot-custom-da",
    "title": "Universal Connection Pool already exists error (Oracle UCP) SpringBoot Custom DataSource",
    "body": "<p>I am facing below issue when running on cloud after few DB calls are done, unfortunately not able to reproduce locally. Need advice or direction if something is missing -</p>\n<pre><code>Caused by: oracle.ucp.UniversalConnectionPoolException: Universal Connection Pool already exists in the Universal Connection Pool Manager. Universal Connection Pool cannot be added to the Universal Connection Pool Manager\n    at oracle.ucp.util.UCPErrorHandler.newUniversalConnectionPoolException(UCPErrorHandler.java:378)\n    at oracle.ucp.util.UCPErrorHandler.throwUniversalConnectionPoolException(UCPErrorHandler.java:68)\n    at oracle.ucp.util.UCPErrorHandler.throwUniversalConnectionPoolException(UCPErrorHandler.java:91)\n    at oracle.ucp.util.UCPErrorHandler.throwUniversalConnectionPoolException(UCPErrorHandler.java:149)\n    at oracle.ucp.jdbc.PoolDataSourceImpl.createUniversalConnectionPool(PoolDataSourceImpl.java:985)\n    ... 37 common frames omitted\n</code></pre>\n<p>I have following DataSource bean - It was migrated from <code>OracleDataSource (dataSource.setConnectionCachingEnabled(true) - this is deprecated)</code></p>\n<pre><code>@Bean(&quot;testDataSource&quot;)\n    DataSource getDataSource() throws SQLException {\n        logger.info(&quot;Setting UP DataSource for : {}&quot;, DB_POOL_PROVIDER_UCP);\n        \n        PoolDataSource  pds = PoolDataSourceFactory.getPoolDataSource();\n\n        pds.setConnectionFactoryClassName(&quot;oracle.jdbc.pool.OracleDataSource&quot;);\n        pds.setURL(url);\n        pds.setUser(username);\n        pds.setPassword(password);\n        \n        pds.setConnectionPoolName(&quot;TestDBPool&quot;);\n        \n        pds.setMinPoolSize(2);\n        pds.setMaxPoolSize(50);\n        pds.setInitialPoolSize(3);\n        \n        pds.setInactiveConnectionTimeout(60);\n        pds.setMaxStatements(100);\n        pds.setAbandonedConnectionTimeout(60);\n        pds.setConnectionWaitTimeout(30);\n        pds.setTimeToLiveConnectionTimeout(240);\n        pds.setTimeoutCheckInterval(60);\n        \n        pds.setFastConnectionFailoverEnabled(false); //Just one node\n        pds.setValidateConnectionOnBorrow(true);\n        pds.setSQLForValidateConnection(&quot;select 1 from dual&quot;);\n        \n        return pds;\n    }\n</code></pre>\n<p>And most places DataSource is being used for</p>\n<blockquote>\n<p>org.springframework.jdbc.object.StoredProcedure</p>\n</blockquote>\n<p>And -</p>\n<blockquote>\n<p>try (Connection conn = dataSource.getConnection())</p>\n</blockquote>\n<p><strong>SpringBootVersion - 3.3.0</strong></p>\n<p><strong>UCP - 21.9.0.0</strong></p>\n<p><strong>ojdbc11 - 21.9.0.0</strong></p>\n<p>I have tried to get ConnectionPoolName after starting application locally hitting random API but it just Printing the Above DB Pool Name -</p>\n<pre><code>    String[] poolNames = UniversalConnectionPoolManagerImpl.getUniversalConnectionPoolManager().getConnectionPoolNames();\n    for (int i = 0; i &lt; poolNames.length; i++) {\n        System.out.println(poolNames[i]);\n    }\n</code></pre>\n<p>POM Snippet -</p>\n<pre><code>&lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;\n            &lt;exclusions&gt;\n                &lt;exclusion&gt;\n                    &lt;groupId&gt;com.zaxxer&lt;/groupId&gt;\n                    &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;\n                &lt;/exclusion&gt;\n            &lt;/exclusions&gt;\n        &lt;/dependency&gt;\n&lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n&lt;dependency&gt;\n            &lt;groupId&gt;com.oracle.database.jdbc&lt;/groupId&gt;\n            &lt;artifactId&gt;ojdbc11&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.oracle.database.jdbc&lt;/groupId&gt;\n            &lt;artifactId&gt;ucp&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}