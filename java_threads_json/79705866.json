{
  "question": {
    "tags": [
      "java",
      "android",
      "animation",
      "android-animation",
      "viewanimator"
    ],
    "owner": {
      "account_id": 13060317,
      "reputation": 717,
      "user_id": 9437740,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/6yvEH.png?s=256",
      "display_name": "VanessaF",
      "link": "https://stackoverflow.com/users/9437740/vanessaf"
    },
    "is_answered": true,
    "view_count": 279,
    "answer_count": 1,
    "score": 3,
    "last_activity_date": 1754123897,
    "creation_date": 1752825693,
    "last_edit_date": 1754123897,
    "question_id": 79705866,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79705866/improving-view-animate-performance-on-older-android-versions",
    "title": "Improving View.animate() performance on older Android versions",
    "body": "<p>I'm developing an Android game that animates rectangular views moving horizontally across the screen using <code>View.animate().translationX(...)</code>. The animation is just a plain rectangle moving left over a few seconds, yet it consistently lags on older devices (Samsung S7 and old tablets) and even slightly on newer ones in power-saving mode (Samsung S22 Ultra).</p>\n<p>Stripped-down version:</p>\n<pre><code>View rectangle = ...; // A dynamically added View to a ConstraintLayout\n\nrectangle.animate()\n    .setDuration(6000)\n    .translationX(-widthDisplay)\n    .setInterpolator(new LinearInterpolator())\n    .start();\n</code></pre>\n<p>Iâ€™ve tried the following optimizations, but the lag persists:</p>\n<ul>\n<li>Using <code>View.setLayerType(View.LAYER_TYPE_HARDWARE, null)</code>.</li>\n<li>Reducing the number of simultaneously animated views to just one.</li>\n<li>Avoiding any other heavy processing on the UI thread.</li>\n<li>Using ObjectAnimator instead.</li>\n</ul>\n<p>The issue is not related to the view complexity, number of views, or background tasks. Even animating a single rectangle causes lag on older or throttled devices. Removing <code>setAlpha()</code> or similar calls doesn't help.</p>\n<p>Is there a performance bottleneck with <code>View.animate()</code> (ViewPropertyAnimator) on older or throttled Android devices? And if so, is there a more efficient alternative or workaround for smooth, long-duration translation animations?</p>\n<p>My code for setting up the rectangles and animating them:</p>\n<pre><code>for (int currentElement =0; currentElement &lt;arrayList_GameEventRectangles.size(); currentElement++) {\n\n    //Create view and set\n    if (currentTimeSlot == arrayList_GameEventRectangles.get(currentElement).getStartingTimeSlot() - 15) {\n\n        arrayList_GameEventRectangles.get(currentElement).setActive(true);\n\n        //Set the parameters and the background of the view element\n        arrayList_GameEventRectangles.get(currentElement).setLayoutParams(new ViewGroup.LayoutParams(0, 0));\n\n        if(arrayList_GameEventRectangles.get(currentElement).getEventType().equals(VIEW_EVENT_RECTANGLE_SOLAR)) {\n            arrayList_GameEventRectangles.get(currentElement).setBackground(Objects.requireNonNull(ContextCompat.getDrawable(requireActivity(), R.drawable.game_event_rectangle_solar_1)).mutate());\n        }\n\n        if(arrayList_GameEventRectangles.get(currentElement).getEventType().equals(VIEW_EVENT_RECTANGLE_WIND)) {\n            arrayList_GameEventRectangles.get(currentElement).setBackground(Objects.requireNonNull(ContextCompat.getDrawable(requireActivity(), R.drawable.game_event_rectangle_wind_1)).mutate());\n        }\n\n        if(arrayList_GameEventRectangles.get(currentElement).getEventType().equals(VIEW_EVENT_RECTANGLE_GAS)) {\n            arrayList_GameEventRectangles.get(currentElement).setBackground(Objects.requireNonNull(ContextCompat.getDrawable(requireActivity(), R.drawable.game_event_rectangle_gas_1)).mutate());\n        }\n\n        if(arrayList_GameEventRectangles.get(currentElement).getEventType().equals(VIEW_EVENT_RECTANGLE_COAL)) {\n            arrayList_GameEventRectangles.get(currentElement).setBackground(Objects.requireNonNull(ContextCompat.getDrawable(requireActivity(), R.drawable.game_event_rectangle_coal_1)).mutate());\n        }\n\n        arrayList_GameEventRectangles.get(currentElement).setId(View.generateViewId());\n\n        //Make the view invisible (before it's appearance time)\n        arrayList_GameEventRectangles.get(currentElement).getBackground().setAlpha(0);\n\n        constraintLayout.bringChildToFront(binding.imageViewTargetRectangle);\n        // Set the ConstraintLayout programmatically for the view\n        View view = arrayList_GameEventRectangles.get(currentElement);\n        ViewGroup parent = (ViewGroup) view.getParent();\n\n       // Check if the view already has a parent\n        if (parent != null) {\n            parent.removeView(view); // Remove the view from its existing parent\n        }\n\n        constraintLayout.addView(view); // Now add the view to the constraintLayout\n\n        constraintSet.clone(constraintLayout);\n        float percentageHeightOfEventElement = 0.071f;\n        constraintSet.constrainPercentHeight(arrayList_GameEventRectangles.get(currentElement).getId(), percentageHeightOfEventElement);\n\n        float widthConstrainPercentage_element1 = (float)(arrayList_GameEventRectangles.get(currentElement).getDuration() / 100.0);\n\n        constraintSet.constrainPercentWidth(arrayList_GameEventRectangles.get(currentElement).getId(), widthConstrainPercentage_element1);\n        constraintSet.connect(arrayList_GameEventRectangles.get(currentElement).getId(),ConstraintSet.BOTTOM, ConstraintSet.PARENT_ID,ConstraintSet.BOTTOM,0);\n        constraintSet.connect(arrayList_GameEventRectangles.get(currentElement).getId(),ConstraintSet.TOP,ConstraintSet.PARENT_ID ,ConstraintSet.TOP,0);\n        constraintSet.connect(arrayList_GameEventRectangles.get(currentElement).getId(),ConstraintSet.LEFT,ConstraintSet.PARENT_ID ,ConstraintSet.LEFT,0);\n        constraintSet.connect(arrayList_GameEventRectangles.get(currentElement).getId(),ConstraintSet.RIGHT,ConstraintSet.PARENT_ID ,ConstraintSet.RIGHT,0);\n\n        float horizontalBias = 1.0f ;\n        constraintSet.setHorizontalBias(arrayList_GameEventRectangles.get(currentElement).getId(), horizontalBias);\n        float verticalBiasOfEventElementToBeInTheLine = 0.049f;\n        constraintSet.setVerticalBias(arrayList_GameEventRectangles.get(currentElement).getId(), verticalBiasOfEventElementToBeInTheLine);\n        constraintSet.applyTo(constraintLayout);\n\n    }\n\n    //Shift the view to the right border of the display. This is done before the view is being displayed to the user such that it can flow from right to left in the game\n    if (currentTimeSlot == arrayList_GameEventRectangles.get(currentElement).getStartingTimeSlot() - 10) {\n        arrayList_GameEventRectangles.get(currentElement).setTranslationX(arrayList_GameEventRectangles.get(currentElement).getWidth());\n    }\n\n    //Animate view element\n    if (currentTimeSlot == arrayList_GameEventRectangles.get(currentElement).getStartingTimeSlot()) {\n        arrayList_GameEventRectangles.get(currentElement).getBackground().setAlpha(255);\n\n        View rectangle = arrayList_GameEventRectangles.get(currentElement);\n        int rectangleWidth = rectangle.getWidth();\n\n        float distanceToCover_current = widthDisplay + rectangleWidth;\n        float distanceToCover_normalizedObject = widthDisplay + 20;\n        double ratioDistanceDifference = distanceToCover_current /distanceToCover_normalizedObject;\n\n        int numberOfMillisecondsUntilTheMiddleOfTheScreen_Level1 = 8000;\n        long durationForTheAnimation = (long)(numberOfMillisecondsUntilTheMiddleOfTheScreen_Level1 * speedMultiplicatorLevel [currentLevel - 1] * ratioDistanceDifference);\n\n        arrayList_GameEventRectangles.get(currentElement).animate().setDuration(durationForTheAnimation).translationX(widthDisplay*(-1)).setInterpolator(new LinearInterpolator()).start();\n    }\n\n    helpCounterUpdateScreen++;\n\n    //Check if the view is still running\n    if (arrayList_GameEventRectangles.get(currentElement).isActive() &amp;&amp; currentElement==0) {\n        if (arrayList_GameEventRectangles.get(currentElement).getX() &lt; arrayList_GameEventRectangles.get(currentElement).getWidth() * (-0.8)) {\n            arrayList_GameEventRectangles.get(currentElement).incrementNumberOfTimeSlotsAfterFinishing();\n        }\n        if (arrayList_GameEventRectangles.get(currentElement).getNumberOfTimeSlotsAfterFinishing()&gt; 100) {\n            arrayList_GameEventRectangles.get(currentElement).setActive(false);\n        }\n    }\n}\n</code></pre>\n<p><strong>Reminder</strong>: Does anyone have another idea without SurfaceView?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}