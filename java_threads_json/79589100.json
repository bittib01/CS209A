{
  "question": {
    "tags": [
      "java",
      "curl",
      "graphql",
      "java-http-client"
    ],
    "owner": {
      "account_id": 23234,
      "reputation": 35422,
      "user_id": 58082,
      "user_type": "registered",
      "accept_rate": 78,
      "profile_image": "https://www.gravatar.com/avatar/61200477cf8983809ec152f484750204?s=256&d=identicon&r=PG",
      "display_name": "Pierre",
      "link": "https://stackoverflow.com/users/58082/pierre"
    },
    "is_answered": true,
    "view_count": 116,
    "accepted_answer_id": 79589411,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1754644927,
    "creation_date": 1745426784,
    "last_edit_date": 1745436595,
    "question_id": 79589100,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79589100/java-java-net-http-httpclient-returns-http-status-403-while-curl-works-fine",
    "title": "java java.net.http.HttpClient returns http status 403 while curl works fine",
    "body": "<p>I'm trying to fetch a json string from a (GraphQL ?) server. The input is a json string + POST request and the ouput is a json document.</p>\n<p>When using <strong>curl</strong>, it works (well , let's be honest it works if you don't call the server too many times).</p>\n<pre><code> curl -v  'https://afb.ukbiobank.ac.uk/api' -X POST -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:137.0) Gecko/20100101 Firefox/137.0' -H 'Accept: application/json, text/plain, */*' -H 'Accept-Language: en-US,en;q=0.5'  -H 'Content-Type: application/json' -H 'Origin: https://afb.ukbiobank.ac.uk' -H 'Connection: keep-alive' -H 'Referer: https://afb.ukbiobank.ac.uk/variant/chr3-38435047-A-G'  --data-raw '{&quot;query&quot;:&quot;\\nquery VariantSplitPopulationQuery($chrom: String!, $pos: Int!, $ref: String!, $alt: String!) {\\n    variant(chrom: $chrom, pos: $pos, ref: $ref, alt: $alt) {\\n      Chrom\\n      Pos\\n      Ref\\n      Alt\\n      alleleCount\\n      alleleNum\\n      alleleFreq\\n      nHomozygotes\\n      maxImpact\\n      maxConsequence\\n      HGVSp\\n      geneSymbol\\n      populationDetails {\\n        population\\n        alleleCount\\n        alleleNum\\n        alleleFreq\\n        nHomozygotes\\n        nHemiAlt\\n      }\\n    }\\n  } \\n&quot;,&quot;variables&quot;:{&quot;chrom&quot;:&quot;chr3&quot;,&quot;pos&quot;:38435047,&quot;ref&quot;:&quot;A&quot;,&quot;alt&quot;:&quot;G&quot;}}'\n(...)\n&gt; POST /api HTTP/2\n&gt; Host: afb.ukbiobank.ac.uk\n&gt; User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:137.0) Gecko/20100101 Firefox/137.0\n&gt; Accept: application/json, text/plain, */*\n&gt; Accept-Language: en-US,en;q=0.5\n&gt; Content-Type: application/json\n&gt; Origin: https://afb.ukbiobank.ac.uk\n&gt; Connection: keep-alive\n&gt; Referer: https://afb.ukbiobank.ac.uk/variant/chr3-38435047-A-G\n&gt; Content-Length: 596\n(..)\n&lt; \n{&quot;data&quot;:{&quot;variant&quot;:{&quot;Chrom&quot;:&quot;chr3&quot;,&quot;Pos&quot;:38435047,&quot;Ref&quot;:&quot;A&quot;,&quot;Alt&quot;:&quot;G&quot;,&quot;alleleCount&quot;:587506,&quot;alleleNum&quot;:980494,&quot;alleleFreq&quot;:0.5991938757401881,&quot;nHomozygotes&quot;:178020,&quot;maxImpact&quot;:&quot;LOWEST&quot;,&quot;maxConsequence&quot;:&quot;intergenic_variant&quot;,&quot;HGVSp&quot;:&quot;.&quot;,&quot;geneSymbol&quot;:&quot;XYLB&quot;,&quot;populationDetails&quot;:[{&quot;population&quot;:&quot;African&quot;,&quot;alleleCount&quot;:3779,&quot;alleleNum&quot;:18454,&quot;alleleFreq&quot;:0.20477945160940716,&quot;nHomozygotes&quot;:438,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;Ashkenazi Jewish&quot;,&quot;alleleCount&quot;:3032,&quot;alleleNum&quot;:5714,&quot;alleleFreq&quot;:0.5306265313265663,&quot;nHomozygotes&quot;:796,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;East Asian&quot;,&quot;alleleCount&quot;:2101,&quot;alleleNum&quot;:4484,&quot;alleleFreq&quot;:0.4685548617305977,&quot;nHomozygotes&quot;:507,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;Non-Finnish European&quot;,&quot;alleleCount&quot;:558994,&quot;alleleNum&quot;:917198,&quot;alleleFreq&quot;:0.6094583721290278,&quot;nHomozygotes&quot;:170620,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;Other&quot;,&quot;alleleCount&quot;:8312,&quot;alleleNum&quot;:15340,&quot;alleleFreq&quot;:0.5418513689700131,&quot;nHomozygotes&quot;:2309,&quot;nHemiAlt&quot;:null},{&quot;population&quot;:&quot;South Asian&quot;,&quot;alleleCount&quot;:11288,&quot;alleleNum&quot;:19304,&quot;alleleFreq&quot;:0.5847492747617075,&quot;nHomozygotes&quot;:3350,&quot;nHemiAlt&quot;:null}]}}}\n</code></pre>\n<p>but when I want to use a java client, it always returns a code 403 (and a HTML page instead of a json). Here is a minimal example which use the query above.</p>\n<pre><code>\nimport java.net.URI;\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\n\npublic class Test {\n\n    public static void main(final String[] args) {\n        try {\n            final String query=&quot;{\\n&quot; +\n                    &quot;    \\&quot;query\\&quot;: \\&quot;\\nquery VariantSplitPopulationQuery($chrom: String!, $pos: Int!, $ref: String!, $alt: String!) {\\n    variant(chrom: $chrom, pos: $pos, ref: $ref, alt: $alt) {\\n      Chrom\\n      Pos\\n      Ref\\n      Alt\\n      alleleCount\\n      alleleNum\\n      alleleFreq\\n      nHomozygotes\\n      maxImpact\\n      maxConsequence\\n      HGVSp\\n      geneSymbol\\n      populationDetails {\\n        population\\n        alleleCount\\n        alleleNum\\n        alleleFreq\\n        nHomozygotes\\n        nHemiAlt\\n      }\\n    }\\n  } \\n\\&quot;,\\n&quot; +\n                    &quot;    \\&quot;variables\\&quot;: {\\n&quot; +\n                    &quot;        \\&quot;chrom\\&quot;: \\&quot;chr3\\&quot;,\\n&quot; +\n                    &quot;        \\&quot;pos\\&quot;: 38435047,\\n&quot; +\n                    &quot;        \\&quot;ref\\&quot;: \\&quot;A\\&quot;,\\n&quot; +\n                    &quot;        \\&quot;alt\\&quot;: \\&quot;G\\&quot;\\n&quot; +\n                    &quot;    }\\n&quot; +\n                    &quot;}\\n&quot;;\n            HttpClient httpClient = HttpClient.newHttpClient();\n            \n        \n            HttpRequest.Builder hb= HttpRequest.newBuilder();\n            \n            hb.header(&quot;User-Agent&quot;,&quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:137.0) Gecko/20100101 Firefox/137.0&quot;);\n            hb.header(&quot;Accept&quot;,&quot;application/json, text/plain, */*&quot;);\n            hb.header(&quot;Accept-Language&quot;,&quot;en-US,en;q=0.5&quot;);\n            hb.header(&quot;Content-Type&quot;,&quot;application/json&quot;);\n            hb.header(&quot;Origin&quot;,&quot;https://afb.ukbiobank.ac.uk&quot;);\n            hb.header(&quot;Referer&quot;,&quot;https://afb.ukbiobank.ac.uk/variant/chr3-38435047-A-G&quot;);\n            \n\n            hb.uri(URI.create(&quot;https://afb.ukbiobank.ac.uk/api&quot;));\n            hb.POST(HttpRequest.BodyPublishers.ofString(query));\n            HttpRequest request = hb.build();\n            \n            \n            HttpResponse&lt;String&gt; resp= httpClient.send(request, HttpResponse.BodyHandlers.ofString());\n            System.err.println(resp.body());\n            System.err.println(resp.statusCode());\n                \n        }\n        catch(Throwable err) {\n            err.printStackTrace();\n        }\n    }\n}\n</code></pre>\n<p>output is:</p>\n<pre><code>&lt;!DOCTYPE html&gt;&lt;h(...)\n403\n</code></pre>\n<p>How can I make the java program works ?\nThanks !</p>\n<p>EDIT: I also tested with '\\n' instead of '\\n' in the json string but got the Same result:</p>\n<pre><code>(...)\n&quot;    \\&quot;query\\&quot;: \\&quot;\\\\nquery VariantSplitPopulationQuery($chrom: String!, $pos: Int!, $ref: String!, $alt: String!) {\\\\n    variant(chrom: $chrom, pos: $pos, ref: $ref, alt: $alt) {\\\\n      Chrom\\\\n      Pos\\\\n      Ref\\\\n      Alt\\\\n      alleleCount\\\\n      alleleNum\\\\n      alleleFreq\\\\n      nHomozygotes\\\\n      maxImpact\\\\n      maxConsequence\\\\n      HGVSp\\\\n      geneSymbol\\\\n      populationDetails {\\\\n        population\\\\n        alleleCount\\\\n        alleleNum\\\\n        alleleFreq\\\\n        nHomozygotes\\\\n        nHemiAlt\\\\n      }\\\\n    }\\\\n  } \\\\n\\&quot;,\\n&quot; +\n\n(...)\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}