{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "shopping-cart",
      "spring-thymeleaf"
    ],
    "owner": {
      "account_id": 29818774,
      "reputation": 21,
      "user_id": 22852555,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/ACg8ocJGTX7oh5thvqZz5s4j9BOJf9dIetedIIMaftl_I-Ts=k-s256",
      "display_name": "Tuong Nguyen",
      "link": "https://stackoverflow.com/users/22852555/tuong-nguyen"
    },
    "is_answered": false,
    "view_count": 61,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1732382879,
    "creation_date": 1732319133,
    "last_edit_date": 1732320215,
    "question_id": 79216864,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79216864/shopping-cart-deletetion-bug",
    "title": "Shopping cart deletetion bug",
    "body": "<p>i tried to delete the last item from the cart. For all the previous item, the @GetMapping(&quot;remove-song-from-cart&quot;) work and return me to the cart page again but when hit the delete button of the last item. The method was not called. I think the problem is from the the get method remove-song-from-cart</p>\n<pre><code> package musicstore.musicselling.Entity;\n    \n    import java.util.HashSet;\n    import java.util.Set;\n    \n    import jakarta.persistence.CascadeType;\n    import jakarta.persistence.Entity;\n    import jakarta.persistence.FetchType;\n    import jakarta.persistence.GeneratedValue;\n    import jakarta.persistence.GenerationType;\n    import jakarta.persistence.Id;\n    import jakarta.persistence.OneToMany;\n    \n    @Entity\n    public class Cart {\n        @Id\n        @GeneratedValue(strategy = GenerationType.IDENTITY)\n        private Long cartId;\n    \n        @OneToMany(mappedBy = &quot;cart&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY, orphanRemoval = true)\n        private Set&lt;CartItem&gt; cartItems = new HashSet&lt;&gt;();\n    \n        public Long getCartId() {\n            return cartId;\n        }\n    \n        public Set&lt;CartItem&gt; getCartItems() {\n            return cartItems;\n        }\n    \n        public void setCartItems(Set&lt;CartItem&gt; cartItems) {\n            this.cartItems = cartItems;\n        }\n    \n        public void addCartItems(CartItem item) {\n            cartItems.add(item);\n            item.setCart(this);\n        }\n    \n        public void removeCartItems(CartItem item) {\n            cartItems.remove(item);\n            item.setCart(null);\n        }\n    \n    }\n\n\n\n\n\n\n\n\n    package musicstore.musicselling.Entity;\n    \n    import jakarta.annotation.Generated;\n    import jakarta.persistence.Entity;\n    import jakarta.persistence.GeneratedValue;\n    import jakarta.persistence.GenerationType;\n    import jakarta.persistence.Id;\n    import jakarta.persistence.JoinColumn;\n    import jakarta.persistence.ManyToOne;\n    \n    @Entity\n    public class CartItem {\n        @Id\n        @GeneratedValue(strategy = GenerationType.IDENTITY)\n        private Long itemId;\n    \n        @ManyToOne\n        @JoinColumn(name = &quot;cartId&quot;)\n        private Cart cart;\n    \n        @ManyToOne\n        @JoinColumn(name = &quot;songId&quot;)\n        private Song song;\n    \n        @ManyToOne\n        @JoinColumn(name = &quot;albumId&quot;)\n        private Album album;\n    \n        public CartItem() {\n        }\n    \n        public Long getItemId() {\n            return itemId;\n        }\n    \n        public Song getSong() {\n            return song;\n        }\n    \n        public void setSong(Song song) {\n            this.song = song;\n        }\n    \n        public Album getAlbum() {\n            return album;\n        }\n    \n        public void setAlbum(Album album) {\n            this.album = album;\n        }\n    \n        public Cart getCart() {\n            return cart;\n        }\n    \n        public void setCart(Cart cart) {\n            this.cart = cart;\n        }\n    \n    }\n\n\n\n\n\n\n\npackage musicstore.musicselling.Controller;\n\nimport java.util.ArrayList;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Set;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\n\nimport jakarta.servlet.http.HttpServletRequest;\n\nimport org.springframework.ui.Model;\nimport musicstore.musicselling.Entity.*;\nimport musicstore.musicselling.Repository.AlbumRepository;\nimport musicstore.musicselling.Repository.CartItemRepository;\nimport musicstore.musicselling.Repository.CartRepository;\nimport musicstore.musicselling.Repository.SongRepository;\n\n    @Controller\n    public class CartController {\n        @Autowired\n        SongRepository songRepository;\n    \n        @Autowired\n        AlbumRepository albumRepository;\n    \n        @Autowired\n        CartRepository cartRepository;\n    \n        @Autowired\n        private CartItemRepository cartItemRepository;\n    \n        private Cart getOrCreateCart() {\n            if (cartRepository.findByCartId(1L) == null) {\n                Cart cart = new Cart();\n                return cartRepository.save(cart);\n            }\n            return cartRepository.findByCartId(1L);\n    \n        }\n    \n        // add the song to the cart\n        @GetMapping(&quot;/add-song-to-cart&quot;)\n        public String addSongToCart(@RequestParam Long songId) {\n            Cart cart = getOrCreateCart();\n            Song song = songRepository.findBySongId(songId);\n            CartItem item = new CartItem();\n            item.setSong(song);\n            cart.addCartItems(item);\n            cartRepository.save(cart);\n            System.out.println(&quot;Add success&quot;);\n    \n            return &quot;redirect:/song-list&quot;;\n        }\n    \n        // push the data of cart list to the cart page\n        @GetMapping(&quot;/cart&quot;)\n        public String songCart(Model model) {\n            Cart cart = getOrCreateCart();\n            double price = 0;\n            List&lt;Song&gt; songItems = new ArrayList&lt;&gt;();\n            for (CartItem cartItem : cart.getCartItems()) {\n                if (cartItem.getSong() != null) {\n                    songItems.add(cartItem.getSong());\n                    price = price + cartItem.getSong().getSongPrice();\n                }\n            }\n    \n            String totalPrice = String.format(&quot;%.2f&quot;, price);\n            model.addAttribute(&quot;totalPrice&quot;, totalPrice);\n            model.addAttribute(&quot;songItems&quot;, songItems);\n            System.out.println(&quot;cart item size: &quot; + cart.getCartItems().size());\n            for (CartItem cartItem : cart.getCartItems()) {\n                System.out.println(&quot;Song id: &quot; + cartItem.getSong().getSongId());\n            }\n    \n            return &quot;cart&quot;;\n        }\n    \n        // remove the song from cart\n        @GetMapping(&quot;remove-song-from-cart&quot;)\n        public String removeSongFromCart(@RequestParam Long songId) {\n            Cart cart = getOrCreateCart();\n            Set&lt;CartItem&gt; cartList = cart.getCartItems();\n            System.out.println(&quot;The fucking cart size: &quot; + cartList.size());\n            CartItem itemToRemove = null;\n    \n            for (CartItem item : cartList) {\n                if (item.getSong().getSongId().equals(songId)) {\n                    itemToRemove = item;\n    \n                }\n            }\n            if (itemToRemove != null) {\n                cart.removeCartItems(itemToRemove);\n                cartRepository.save(cart);\n    \n            }\n    \n            System.out.println(&quot;item to remove: &quot; +\n                    itemToRemove.getSong().getSongName());\n    \n            return &quot;redirect:/cart&quot;;\n    \n        }\n    \n    }\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}