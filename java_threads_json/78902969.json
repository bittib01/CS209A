{
  "question": {
    "tags": [
      "java",
      "hibernate",
      "jpa",
      "entitymanager",
      "jpa-2.1"
    ],
    "owner": {
      "account_id": 1247323,
      "reputation": 1948,
      "user_id": 1319938,
      "user_type": "registered",
      "accept_rate": 67,
      "profile_image": "https://i.sstatic.net/Og98Q.jpg?s=256",
      "display_name": "mah454",
      "link": "https://stackoverflow.com/users/1319938/mah454"
    },
    "is_answered": true,
    "view_count": 89,
    "accepted_answer_id": 78910252,
    "answer_count": 1,
    "score": 2,
    "last_activity_date": 1724547612,
    "creation_date": 1724350620,
    "last_edit_date": 1724412932,
    "question_id": 78902969,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78902969/entitymanager-provider-not-found",
    "title": "EntityManager provider not found",
    "body": "<p>I used hibernate EntityManager on standalone application (Without framework) .</p>\n<p>this is my <code>pom.xml</code> :</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;project xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;\n\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;groupId&gt;ir.moke.roboexchange&lt;/groupId&gt;\n    &lt;artifactId&gt;roboexchange&lt;/artifactId&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n    &lt;organization&gt;\n        &lt;name&gt;Moke&lt;/name&gt;\n        &lt;url&gt;http://www.moke.ir&lt;/url&gt;\n    &lt;/organization&gt;\n\n    &lt;name&gt;Moke :: RoboExchange&lt;/name&gt;\n\n    &lt;properties&gt;\n        &lt;junit.jupiter.version&gt;5.9.2&lt;/junit.jupiter.version&gt;\n        &lt;junit.platform.version&gt;1.9.2&lt;/junit.platform.version&gt;\n    &lt;/properties&gt;\n\n    &lt;packaging&gt;jar&lt;/packaging&gt;\n\n    &lt;dependencies&gt;\n        &lt;!-- ORM --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;\n            &lt;version&gt;6.6.0.Final&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.hibernate.orm&lt;/groupId&gt;\n            &lt;artifactId&gt;hibernate-ant&lt;/artifactId&gt;\n            &lt;version&gt;6.6.0.Final&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- Json --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.eclipse&lt;/groupId&gt;\n            &lt;artifactId&gt;yasson&lt;/artifactId&gt;\n            &lt;version&gt;3.0.2&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- Database --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.postgresql&lt;/groupId&gt;\n            &lt;artifactId&gt;postgresql&lt;/artifactId&gt;\n            &lt;version&gt;42.5.4&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;redis.clients&lt;/groupId&gt;\n            &lt;artifactId&gt;jedis&lt;/artifactId&gt;\n            &lt;version&gt;4.3.1&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- Log --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;\n            &lt;version&gt;2.0.5&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;\n            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;\n            &lt;version&gt;1.4.6&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;\n            &lt;artifactId&gt;logback-core&lt;/artifactId&gt;\n            &lt;version&gt;1.4.6&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- Test --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n            &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;\n            &lt;version&gt;${junit.jupiter.version}&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n            &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;\n            &lt;version&gt;${junit.jupiter.version}&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;\n            &lt;artifactId&gt;junit-jupiter-params&lt;/artifactId&gt;\n            &lt;version&gt;${junit.jupiter.version}&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.junit.platform&lt;/groupId&gt;\n            &lt;artifactId&gt;junit-platform-suite&lt;/artifactId&gt;\n            &lt;version&gt;${junit.platform.version}&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;finalName&gt;roboexchange&lt;/finalName&gt;\n        &lt;plugins&gt;\n            &lt;!-- Java compiler version --&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.8.1&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;release&gt;17&lt;/release&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n\n            &lt;!-- copy compiled jar file to target/lib --&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;\n                &lt;version&gt;3.2.2&lt;/version&gt;\n                &lt;configuration&gt;\n                    &lt;archive&gt;\n                        &lt;manifest&gt;\n                            &lt;addClasspath&gt;true&lt;/addClasspath&gt;\n                            &lt;mainClass&gt;ir.moke.roboexchange.MainClass&lt;/mainClass&gt;\n                        &lt;/manifest&gt;\n                    &lt;/archive&gt;\n                    &lt;outputDirectory&gt;${project.build.directory}/lib/&lt;/outputDirectory&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n\n            &lt;!-- Copy dependencies --&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;id&gt;copy-dependencies&lt;/id&gt;\n                        &lt;phase&gt;package&lt;/phase&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;copy-dependencies&lt;/goal&gt;\n                        &lt;/goals&gt;\n                        &lt;configuration&gt;\n                            &lt;outputDirectory&gt;${project.build.directory}/lib&lt;/outputDirectory&gt;\n                            &lt;includeScope&gt;compile&lt;/includeScope&gt;\n                        &lt;/configuration&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n&lt;/project&gt;\n</code></pre>\n<p>and this is my <code>persistence.xml</code> :</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;persistence xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n             xmlns=&quot;http://xmlns.jcp.org/xml/ns/persistence&quot;\n             xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/persistence\n             http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd&quot;\n             version=&quot;2.1&quot;&gt;\n    &lt;persistence-unit name=&quot;db-connection&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&gt;\n        &lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;\n    &lt;/persistence-unit&gt;\n\n&lt;/persistence&gt;\n</code></pre>\n<p>I have a class named <code>EntityManagerProducer</code> :</p>\n<pre class=\"lang-java prettyprint-override\"><code>import ir.moke.roboexchange.config.Configuration;\nimport jakarta.persistence.EntityManager;\nimport jakarta.persistence.EntityManagerFactory;\nimport jakarta.persistence.Persistence;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class EntityManagerProducer {\n    public static final EntityManagerProducer instance = new EntityManagerProducer();\n    private final EntityManagerFactory entityManagerFactory;\n    private final EntityManager entityManager;\n\n    private EntityManagerProducer() {\n        String hostname = Configuration.dbHost;\n        String port = Configuration.dbPort;\n        String username = Configuration.dbUsername;\n        String password = Configuration.dbPassword;\n\n        Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();\n        properties.put(&quot;hibernate.connection.driver_class&quot;, &quot;org.postgresql.Driver&quot;);\n        properties.put(&quot;hibernate.connection.url&quot;, &quot;jdbc:postgresql://%s:%s/roboexchange&quot;.formatted(hostname, port));\n        properties.put(&quot;hibernate.connection.username&quot;, username);\n        properties.put(&quot;hibernate.connection.password&quot;, password);\n        properties.put(&quot;hibernate.dialect&quot;, &quot;org.hibernate.dialect.PostgreSQLDialect&quot;);\n        this.entityManagerFactory = Persistence.createEntityManagerFactory(&quot;db-connection&quot;, properties);\n        this.entityManager = this.entityManagerFactory.createEntityManager();\n    }\n\n    public EntityManager getEntityManager() {\n        return entityManager;\n    }\n\n    public EntityManagerFactory getEntityManagerFactory() {\n        return entityManagerFactory;\n    }\n}\n</code></pre>\n<p>this is my example CRUD :</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class SampleCRUD {\n    private static final EntityManager em = EntityManagerProducer.instance.getEntityManager();\n\n    public static void insert(Sample sample) {\n        EntityTransaction transaction = em.getTransaction();\n        transaction.begin();\n        em.persist(sample);\n        transaction.commit();\n    }\n}\n</code></pre>\n<h3>My main class work with Intellij IDEA without any problem .</h3>\n<p>but when i export project as jar file and run that , result this exception :</p>\n<pre><code>Aug 22, 2024 8:40:24 PM jakarta.persistence.spi.PersistenceProviderResolverHolder$DefaultPersistenceProviderResolver log\nWARNING: jakarta.persistence.spi::No valid providers found.\nException in thread &quot;Timer-0&quot; java.lang.ExceptionInInitializerError\n        at ir.moke.roboexchange.strategy.StrategyManager.&lt;clinit&gt;(StrategyManager.java:22)\n        at ir.moke.roboexchange.job.FetchStatistics_5Min.run(FetchStatistics_5Min.java:20)\n        at java.base/java.util.TimerThread.mainLoop(Timer.java:566)\n        at java.base/java.util.TimerThread.run(Timer.java:516)\nCaused by: jakarta.persistence.PersistenceException: No Persistence provider for EntityManager named db-connection\n        at jakarta.persistence.Persistence.createEntityManagerFactory(Persistence.java:86)\n        at ir.moke.roboexchange.producer.EntityManagerProducer.&lt;init&gt;(EntityManagerProducer.java:28)\n        at ir.moke.roboexchange.producer.EntityManagerProducer.&lt;clinit&gt;(EntityManagerProducer.java:12)\n        ... 4 more\n</code></pre>\n<p><strong>Note</strong> : <code>persistence.xml</code> inside jar file is under <code>META-INF</code> directory<br />\n<strong>Note</strong> : I mixed <code>persistence.xml</code> and programmatically class, because configuration dynamically maybe changed.</p>\n<hr />\n<h3>Update:</h3>\n<p>Run application :</p>\n<pre><code>&gt; mvn clean compile package \n&gt; cd target/lib \n&gt; java -jar roboexchange.jar   \n11:12:21,734 |-INFO in ch.qos.logback.core.model.processor.AppenderModelHandler - About to instantiate appender of type [ch.qos.logback.core.ConsoleAppender]\n11:12:21,769 |-WARN in ch.qos.logback.core.ConsoleAppender[CONSOLE] - This appender no longer admits a layout as a sub-component, set an encoder instead.\n11:12:21,769 |-WARN in ch.qos.logback.core.ConsoleAppender[CONSOLE] - To ensure compatibility, wrapping your layout in LayoutWrappingEncoder.\n11:12:21,769 |-WARN in ch.qos.logback.core.ConsoleAppender[CONSOLE] - See also http://logback.qos.ch/codes.html#layoutInsteadOfEncoder for details\n11:12:21,769 |-WARN in ch.qos.logback.core.model.processor.AppenderModelHandler - Appender named [FILE-ROLLING] not referenced. Skipping further processing.\n11:12:21,770 |-INFO in ch.qos.logback.classic.model.processor.LoggerModelHandler - Setting level of logger [org.hibernate] to INFO\n11:12:21,774 |-INFO in ch.qos.logback.classic.model.processor.LoggerModelHandler - Setting additivity of logger [org.hibernate] to false\n11:12:21,775 |-INFO in ch.qos.logback.core.model.processor.AppenderRefModelHandler - Attaching appender named [CONSOLE] to Logger[org.hibernate]\n11:12:21,775 |-INFO in ch.qos.logback.classic.model.processor.LoggerModelHandler - Setting level of logger [ir.moke.roboexchange] to DEBUG\n11:12:21,775 |-INFO in ch.qos.logback.classic.model.processor.LoggerModelHandler - Setting additivity of logger [ir.moke.roboexchange] to false\n11:12:21,775 |-INFO in ch.qos.logback.core.model.processor.AppenderRefModelHandler - Attaching appender named [CONSOLE] to Logger[ir.moke.roboexchange]\n11:12:21,775 |-INFO in ch.qos.logback.classic.model.processor.RootLoggerModelHandler - Setting level of ROOT logger to ALL\n11:12:21,776 |-INFO in ch.qos.logback.core.model.processor.AppenderRefModelHandler - Attaching appender named [CONSOLE] to Logger[ROOT]\n11:12:21,776 |-INFO in ch.qos.logback.core.model.processor.DefaultProcessor@33cb5951 - End of configuration.\n11:12:21,776 |-INFO in ch.qos.logback.classic.joran.JoranConfigurator@365c30cc - Registering current configuration as safe fallback point \n... \n...\n...\n...... and other logs ..... \n...\n...\n\nAug 22, 2024 8:40:24 PM jakarta.persistence.spi.PersistenceProviderResolverHolder$DefaultPersistenceProviderResolver log\nWARNING: jakarta.persistence.spi::No valid providers found.\nException in thread &quot;Timer-0&quot; java.lang.ExceptionInInitializerError\n        at ir.moke.roboexchange.strategy.StrategyManager.&lt;clinit&gt;(StrategyManager.java:22)\n        at ir.moke.roboexchange.job.FetchStatistics_5Min.run(FetchStatistics_5Min.java:20)\n        at java.base/java.util.TimerThread.mainLoop(Timer.java:566)\n        at java.base/java.util.TimerThread.run(Timer.java:516)\nCaused by: jakarta.persistence.PersistenceException: No Persistence provider for EntityManager named db-connection\n        at jakarta.persistence.Persistence.createEntityManagerFactory(Persistence.java:86)\n        at ir.moke.roboexchange.producer.EntityManagerProducer.&lt;init&gt;(EntityManagerProducer.java:28)\n        at ir.moke.roboexchange.producer.EntityManagerProducer.&lt;clinit&gt;(EntityManagerProducer.java:12)\n        ... 4 more   \n</code></pre>\n<p>this is content of MANIFEST.MF inside jar file :</p>\n<pre><code>Manifest-Version: 1.0\nCreated-By: Maven JAR Plugin 3.2.2\nBuild-Jdk-Spec: 21\nClass-Path: hibernate-core-6.6.0.Final.jar jakarta.persistence-api-3.1.0\n .jar jakarta.transaction-api-2.0.1.jar jboss-logging-3.5.0.Final.jar hi\n bernate-commons-annotations-7.0.1.Final.jar jandex-3.2.0.jar classmate-\n 1.5.1.jar byte-buddy-1.14.18.jar jakarta.xml.bind-api-4.0.0.jar jakarta\n .activation-api-2.1.0.jar jaxb-runtime-4.0.2.jar jaxb-core-4.0.2.jar an\n gus-activation-2.0.0.jar txw2-4.0.2.jar istack-commons-runtime-4.1.1.ja\n r jakarta.inject-api-2.0.1.jar antlr4-runtime-4.13.0.jar hibernate-ant-\n 6.6.0.Final.jar yasson-3.0.2.jar jakarta.json.bind-api-3.0.0.jar jakart\n a.json-api-2.1.0.jar parsson-1.1.0.jar postgresql-42.5.4.jar checker-qu\n al-3.5.0.jar jedis-4.3.1.jar commons-pool2-2.11.1.jar json-20220320.jar\n  gson-2.8.9.jar slf4j-api-2.0.5.jar logback-classic-1.4.6.jar logback-c\n ore-1.4.6.jar\nMain-Class: ir.moke.roboexchange.MainClass\n\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}