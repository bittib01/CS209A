{
  "question": {
    "tags": [
      "java",
      "mockito",
      "junit5",
      "spring-hateoas"
    ],
    "owner": {
      "account_id": 965625,
      "reputation": 904,
      "user_id": 1103606,
      "user_type": "registered",
      "accept_rate": 51,
      "profile_image": "https://www.gravatar.com/avatar/0d93cc650b93939ea91066fcb5aefae0?s=256&d=identicon&r=PG",
      "display_name": "Peter Penzov",
      "link": "https://stackoverflow.com/users/1103606/peter-penzov"
    },
    "is_answered": true,
    "view_count": 135,
    "accepted_answer_id": 79519622,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1742408269,
    "creation_date": 1741740504,
    "last_edit_date": 1742408269,
    "question_id": 79502420,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79502420/how-to-solve-cannot-subclass-final-class-java-lang-reflect-method",
    "title": "How to solve &#39;Cannot subclass final class java.lang.reflect.Method&#39;?",
    "body": "<p>I have this Junit 5 test code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@InjectMocks\nReportAssembler reportAssembler;\n\nprivate ReportingReturnResponse reportingReturnResponse;\nprivate ReturnReport returnReport;\nprivate StaticPathLinkBuilder staticPathLinkBuilder;\n\n@Test\npublic void testMergeReturnCompletesSuccessfully() {\n    ReportingResource reportResource = reportAssembler.mergeReturn(returnReport, this.reportingResource);\n    assertNotNull(reportResource.getReturnResource());\n}\n</code></pre>\n<p>The called code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public ReportingResource mergeReturn(ReturnReport returnReport, ReportingResource reportingResource) {\n    Link link = staticPathLinkBuilder.linkTo(\n        methodOn(ReturnController.class).getReturnById(\n            returnReport.getAccount().getId(),\n            returnReport.getReturn().getId())\n    ).withSelfRel();\n\n    return reportingResource;\n}\n\npublic LinkBuilder linkTo(Object dummyInvocation) {\n    LastInvocationAware lastInvocationAware = (LastInvocationAware) dummyInvocation;\n\n    MethodInvocation methodInvocation = lastInvocationAware.getLastInvocation();\n\n    StaticPathLinkBuilder staticPathLinkBuilder = getThis();\n    return staticPathLinkBuilder.linkTo(methodInvocation.getMethod(), methodInvocation.getArguments());\n}\n</code></pre>\n<p>The line <code>return staticPathLinkBuilder.linkTo(methodInvocation.getMethod(), methodInvocation.getArguments())</code> throws an exception <code>Caused by: java.lang.IllegalArgumentException: Cannot subclass final class java.lang.reflect.Method</code></p>\n<p>How I can solve it?</p>\n<p>The stacktrace:</p>\n<pre class=\"lang-java prettyprint-override\"><code>org.springframework.aop.framework.AopConfigException: Could not generate CGLIB subclass of class java.lang.reflect.Method: Common causes of this problem include using a final class or a non-visible class\n    at org.springframework.aop.framework.CglibAopProxy.buildProxy(CglibAopProxy.java:237)\n    at org.springframework.aop.framework.CglibAopProxy.getProxy(CglibAopProxy.java:167)\n    at org.springframework.aop.framework.ProxyFactory.getProxy(ProxyFactory.java:110)\n    at org.springframework.hateoas.server.core.DummyInvocationUtils.getProxyWithInterceptor(DummyInvocationUtils.java:207)\n    at org.springframework.hateoas.server.core.DummyInvocationUtils$InvocationRecordingMethodInterceptor.invoke(DummyInvocationUtils.java:96)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\n    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)\n    at jdk.proxy3/jdk.proxy3.$Proxy81.getMethod(Unknown Source)\n    at com.util.StaticPathLinkBuilder.linkTo(StaticPathLinkBuilder.java:56)\n    at com.util.StaticPathLinkBuilder.linkTo(StaticPathLinkBuilder.java:42)\n    at com.assembler.ReportingAssembler.mergeReturn(ReportingAssembler.java:233)\n    at com.assembler.ReportingAssemblerReturnTest.testMergeReturnCompletesSuccessfully(ReportingAssemblerReturnTest.java:50)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\nCaused by: java.lang.IllegalArgumentException: Cannot subclass final class java.lang.reflect.Method\n    at org.springframework.cglib.proxy.Enhancer.generateClass(Enhancer.java:653)\n    at org.springframework.cglib.transform.TransformingClassGenerator.generateClass(TransformingClassGenerator.java:35)\n    at org.springframework.cglib.core.DefaultGeneratorStrategy.generate(DefaultGeneratorStrategy.java:26)\n    at org.springframework.cglib.core.ClassLoaderAwareGeneratorStrategy.generate(ClassLoaderAwareGeneratorStrategy.java:76)\n    at org.springframework.cglib.core.AbstractClassGenerator.generate(AbstractClassGenerator.java:366)\n    at org.springframework.cglib.proxy.Enhancer.generate(Enhancer.java:575)\n    at org.springframework.cglib.core.AbstractClassGenerator$ClassLoaderData.lambda$new$1(AbstractClassGenerator.java:107)\n    at org.springframework.cglib.core.internal.LoadingCache.lambda$createEntry$1(LoadingCache.java:52)\n    at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n    at org.springframework.cglib.core.internal.LoadingCache.createEntry(LoadingCache.java:57)\n    at org.springframework.cglib.core.internal.LoadingCache.get(LoadingCache.java:34)\n    at org.springframework.cglib.core.AbstractClassGenerator$ClassLoaderData.get(AbstractClassGenerator.java:130)\n    at org.springframework.cglib.core.AbstractClassGenerator.create(AbstractClassGenerator.java:317)\n    at org.springframework.cglib.proxy.Enhancer.createHelper(Enhancer.java:562)\n    at org.springframework.cglib.proxy.Enhancer.createClass(Enhancer.java:407)\n    at org.springframework.aop.framework.ObjenesisCglibAopProxy.createProxyClassAndInstance(ObjenesisCglibAopProxy.java:62)\n    at org.springframework.aop.framework.CglibAopProxy.buildProxy(CglibAopProxy.java:228)\n    at org.springframework.aop.framework.CglibAopProxy.getProxy(CglibAopProxy.java:167)\n    at org.springframework.aop.framework.ProxyFactory.getProxy(ProxyFactory.java:110)\n    at org.springframework.hateoas.server.core.DummyInvocationUtils.getProxyWithInterceptor(DummyInvocationUtils.java:207)\n    at org.springframework.hateoas.server.core.DummyInvocationUtils$InvocationRecordingMethodInterceptor.invoke(DummyInvocationUtils.java:96)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\n    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)\n    at jdk.proxy3/jdk.proxy3.$Proxy81.getMethod(Unknown Source)\n    at com.util.StaticPathLinkBuilder.linkTo(StaticPathLinkBuilder.java:56)\n    at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)\n    at org.mockito.internal.util.reflection.InstrumentationMemberAccessor$Dispatcher$ByteBuddy$ADlM6biV.invokeWithArguments(Unknown Source)\n    at org.mockito.internal.util.reflection.InstrumentationMemberAccessor.invoke(InstrumentationMemberAccessor.java:251)\n    at org.mockito.internal.util.reflection.ModuleMemberAccessor.invoke(ModuleMemberAccessor.java:55)\n    at org.mockito.internal.creation.bytebuddy.MockMethodAdvice.tryInvoke(MockMethodAdvice.java:314)\n    at org.mockito.internal.creation.bytebuddy.MockMethodAdvice$RealMethodCall.invoke(MockMethodAdvice.java:234)\n    at org.mockito.internal.invocation.InterceptedInvocation.callRealMethod(InterceptedInvocation.java:142)\n    at org.mockito.internal.stubbing.answers.CallsRealMethods.answer(CallsRealMethods.java:45)\n    at org.mockito.Answers.answer(Answers.java:90)\n    at org.mockito.internal.handler.MockHandlerImpl.handle(MockHandlerImpl.java:111)\n    at org.mockito.internal.handler.NullResultGuardian.handle(NullResultGuardian.java:29)\n    at org.mockito.internal.handler.InvocationNotifierHandler.handle(InvocationNotifierHandler.java:34)\n    at org.mockito.internal.creation.bytebuddy.MockMethodInterceptor.doIntercept(MockMethodInterceptor.java:82)\n    at org.mockito.internal.creation.bytebuddy.MockMethodAdvice.handle(MockMethodAdvice.java:134)\n    ... 6 more\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}