{
  "question": {
    "tags": [
      "java",
      "postgresql",
      "jsp"
    ],
    "owner": {
      "account_id": 36169819,
      "reputation": 1,
      "user_id": 27600094,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/Dz8BDF4E.jpg?s=256",
      "display_name": "JonathanDEVOPS",
      "link": "https://stackoverflow.com/users/27600094/jonathandevops"
    },
    "is_answered": false,
    "view_count": 66,
    "answer_count": 1,
    "score": -1,
    "last_activity_date": 1758631594,
    "creation_date": 1727929986,
    "last_edit_date": 1758631594,
    "question_id": 79049133,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79049133/sslhandshakeexception-in-password-recovery-system-using-javamail-with-jsp-projec",
    "title": "SSLHandshakeException in Password Recovery System Using JavaMail with JSP Project on Tomcat 9",
    "body": "<p>enter code hereI'm working on a Java JSP project deployed on Tomcat 9 with a PostgreSQL database for data storage. A critical part of this system is the password recovery functionality, which is implemented using the JavaMail API to send recovery emails to users. However, I am facing persistent issues with the email-sending feature due to SSL handshake errors.</p>\n<p>Here is a breakdown of my project setup:</p>\n<p>Project Setup:</p>\n<p>Java Version: OpenJDK 21.0.4 LTS (Temurin)</p>\n<pre><code>openjdk version &quot;21.0.4&quot; 2024-07-16 LTS\nOpenJDK Runtime Environment Temurin-21.0.4+7 (build 21.0.4+7-LTS)\nOpenJDK 64-Bit Server VM Temurin-21.0.4+7 (build 21.0.4+7-LTS, mixed mode, sharing)\n</code></pre>\n<ul>\n<li><p>JSP and Java Servlets: Used for frontend and backend logic.</p>\n</li>\n<li><p>Server: Tomcat 9, running on Windows, with the following configurations:</p>\n<ul>\n<li>JRE Path: C:\\Program Files\\Java\\jdk1.7.0_80\\jre</li>\n<li>JDK Path: C:\\Program Files\\Java\\jdk1.7.0_80</li>\n<li>Tomcat Path: C:\\Program Files\\Apache Software Foundation\\Tomcat 9.0</li>\n<li>Catalina Config: C:\\Program Files\\Apache Software Foundation\\Tomcat 9.0\\conf\\Catalina</li>\n</ul>\n</li>\n<li><p>Database: PostgreSQL 42.2.29 driver (PostgreSQL JDBC)</p>\n</li>\n</ul>\n<p>Main Issue: The password recovery system relies on sending emails via JavaMail, but I keep getting an SSL handshake error whenever the system tries to send an email. Below is the full error message:</p>\n<pre><code>javax.net.ssl.SSLHandshakeException: No appropriate protocol (protocol is disabled or cipher suites are inappropriate)\n    at sun.security.ssl.HandshakeContext.&lt;init&gt;(HandshakeContext.java:171)\n    at sun.security.ssl.ClientHandshakeContext.&lt;init&gt;(ClientHandshakeContext.java:101)\n    at sun.security.ssl.TransportContext.kickstart(TransportContext.java:238)\n    at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:394)\n    at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:373)\n    at com.sun.mail.util.SocketFetcher.configureSSLSocket(SocketFetcher.java:549)\n    at com.sun.mail.util.SocketFetcher.createSocket(SocketFetcher.java:354)\n    at com.sun.mail.util.SocketFetcher.getSocket(SocketFetcher.java:237)\n    at com.sun.mail.smtp.SMTPTransport.openServer(SMTPTransport.java:1927)\n</code></pre>\n<p>This issue appears whenever the system tries to connect to the email server via SSL to send the recovery emails.</p>\n<p>Libraries Used (JARs):</p>\n<ul>\n<li>PostgreSQL JDBC (postgresql-42.2.29.jre7.jar)</li>\n<li>Bcrypt (jbcrypt-0.4.jar)</li>\n<li>JavaMail API (mail-1.4.7.jar, smtp-1.6.2.jar, javax.activation.jar)</li>\n<li>Security Policies (US_export_policy.jar, local_policy.jar)</li>\n</ul>\n<h2>RECOVERY_ACCOUNT.JSP</h2>\n<pre><code>// THIS IS THE MAIN CODE THAT IS SENDING EMAILS (RECOVERY_ACCOUNT.JSP)\n\n    // Database connection configurations\n    String url = &quot;jdbc:postgresql://localhost:5432/bibliotech&quot;;\n    String user = &quot;postgres&quot;;\n    String password = &quot;admin&quot;;\n    \n    String email = request.getParameter(&quot;email&quot;);\n    String passwordHash = null;\n    \n    try {\n        // Connect to the database\n        Class.forName(&quot;org.postgresql.Driver&quot;);\n        Connection conn = DriverManager.getConnection(url, user, password);\n        enter code here\n        // Query to check if the email exists\n        String query = &quot;SELECT password_hash FROM USERS WHERE email = ?&quot;;\n        PreparedStatement ps`enter code here`tmt = conn.prepareStatement(query);\n        pstmt.setString(1, email);\n        ResultSet rs = pstmt.executeQuery();\n    \n        if (rs.next()) {\n            passwordHash = rs.getString(&quot;password_hash&quot;);  // Retrieve the password hash\n        } else {\n            out.println(&quot;&lt;script&gt;alert('Email not found!'); window.location.href = 'recovery.jsp';&lt;/script&gt;&quot;);\n        }\n    \n        rs.close();\n        pstmt.close();\n        conn.close();\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n    \n    // If the password hash was found, send an email to the user\n    if (passwordHash != null) {\n        // JavaMail configurations\n        String host = &quot;smtp.gmail.com&quot;;  // Using Gmail as an example\n        String from = &quot;bibliotechproject@gmail.com&quot;; // Your email\n        String appPassword = &quot;************&quot;;  // Use a Gmail app password\n        String to = email;\n        String subject = &quot;Password Recovery - Bibliotech&quot;;\n    \n        // Email content with HTML\n        String messageText = \n        &quot;&lt;div style='font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4;'&gt;&quot;\n            + &quot;&lt;center&gt;&quot;\n                + &quot;&lt;img src='https://iili.io/dPzedMX.png' alt='Account Recovery' style='width: 100%; max-width: 600px; height: auto;'&gt;&quot;\n                + &quot;&lt;div style='background-color: #ffffff; padding: 20px; border-radius: 8px; max-width: 600px; text-align: left;'&gt;&quot;\n                    + &quot;&lt;h2 style='color: #333;'&gt;Account Recovery&lt;/h2&gt;&quot;\n                    + &quot;&lt;p style='color: #555;'&gt;Hello,&lt;/p&gt;&quot;\n                    + &quot;&lt;p style='color: #555;'&gt;We received a request to recover the password for your account. Here are your login details:&lt;/p&gt;&quot;\n                    + &quot;&lt;p style='font-weight: bold; color: #333;'&gt;Email: &quot; + email + &quot;&lt;/p&gt;&quot;\n                    + &quot;&lt;p style='font-weight: bold; color: #333;'&gt;Password: &quot; + passwordHash + &quot;&lt;/p&gt;&quot;\n                    + &quot;&lt;p style='color: #555;'&gt;If you did not make this request, please ignore this email.&lt;/p&gt;&quot;\n                    + &quot;&lt;p style='color: #555;'&gt;Sincerely, https://prod.liveshare.vsengsaas.visualstudio.com/join?01A2BDE3A14A18BC1D1E0892E16E13D31189&lt;/p&gt;&quot;\n                    + &quot;&lt;p style='color: #333; font-weight: bold;'&gt;Support Team - Bibliotech&lt;/p&gt;&quot;\n                + &quot;&lt;/div&gt;&quot;\n            + &quot;&lt;/center&gt;&quot;\n        + &quot;&lt;/div&gt;&quot;;\n    \n        Properties props = System.getProperties();\n        props.put(&quot;mail.smtp.starttls.enable&quot;, &quot;true&quot;);\n        props.put(&quot;mail.smtp.host&quot;, host);\n        props.put(&quot;mail.smtp.user&quot;, from);\n        props.put(&quot;mail.smtp.password&quot;, appPassword);\n        props.put(&quot;mail.smtp.port&quot;, &quot;587&quot;);\n        props.put(&quot;mail.debug&quot;, &quot;true&quot;);\n        props.put(&quot;mail.smtp.ssl.enable&quot;, &quot;true&quot;);\n        props.put(&quot;mail.smtp.auth&quot;, &quot;true&quot;);\n    \n        Session mailSession = Session.getDefaultInstance(props, null);\n        MimeMessage message = new MimeMessage(mailSession);\n    \n        try {\n            message.setFrom(new InternetAddress(from));\n            message.addRecipient(Message.RecipientType.TO, new InternetAddress(to));\n    \n            message.setSubject(subject);\n            message.setContent(messageText, &quot;text/html&quot;);\n    \n            Transport transport = mailSession.getTransport(&quot;smtp&quot;);\n            transport.connect(host, from, appPassword);\n            transport.sendMessage(message, message.getAllRecipients());\n            transport.close();\n    \n            response.sendRedirect(&quot;send_success.jsp&quot;);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre>\n<p><strong>I added these libraries</strong></p>\n<ul>\n<li>US_export_policy.jar</li>\n<li>bcrypt-0.4.1.jar</li>\n<li>bytes-0.4.6.jar</li>\n<li>javax.activation.jar</li>\n<li>jbcrypt-0.4.jar</li>\n<li>local_policy.jar</li>\n<li>mail-1.4.7.jar</li>\n<li>postgresql-42.2.29.jre7.jar</li>\n<li>smtp-1.6.2.jar</li>\n</ul>\n<p>What I've Tried:</p>\n<p>Ensured that the correct SSL protocols are enabled on the server and in my JavaMail configuration.\nTried updating the JavaMail library to resolve potential SSL protocol mismatches.\nLooked at the order of the JARs in the lib folder to check for conflicting libraries.\nRemaining Questions:</p>\n<p>Is the SSL handshake error related to my Java 21 version, or is it a misconfiguration in the JavaMail or Tomcat server?\nCould the issue stem from older versions of JavaMail or other JAR files causing conflicts with SSL protocols?\nHas anyone encountered similar issues when using JavaMail for password recovery in a JSP project? How did you solve the SSL handshake problem?\nI'd appreciate any advice on how to resolve this, especially regarding SSL configuration with JavaMail. If it's a matter of JAR versions, what would be the correct versions and ordering of these libraries?</p>\n<p>Thanks in advance for any insights!</p>\n<p>One day at the educational institution where I am carrying out this project, sending emails simply worked, without me needing to change anything, I just arrived, turned on the computer and everything worked, I believed it was the Java configuration installed on that machine, but in the the other day when I tested again on that same machine, it gave me an error again when sending emails.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}