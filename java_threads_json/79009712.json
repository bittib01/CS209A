{
  "question": {
    "tags": [
      "java",
      "android",
      "react-native",
      "kotlin",
      "gradle"
    ],
    "owner": {
      "account_id": 2246668,
      "reputation": 10352,
      "user_id": 1979861,
      "user_type": "registered",
      "accept_rate": 100,
      "profile_image": "https://i.sstatic.net/8izBy.png?s=256",
      "display_name": "Florin Dobre",
      "link": "https://stackoverflow.com/users/1979861/florin-dobre"
    },
    "is_answered": false,
    "view_count": 411,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1727161724,
    "creation_date": 1726926733,
    "question_id": 79009712,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79009712/react-native-android-missing-classes-detected-while-running-r8-error-in-jenkins",
    "title": "React Native Android Missing classes detected while running R8 error in Jenkins",
    "body": "<p>I am trying to upgrade RN from 0.72 to 0.73.9</p>\n<p>I get the below error in Jenkins (I cannot replicate the issue on local machine).</p>\n<pre><code>&gt; Task :app:lintVitalAnalyzeDevRelease\n\ntimber.lint.TimberIssueRegistry in /root/.gradle/caches/transforms-3/26daadcd46ecfc898dac002daac9b73b/transformed/jetified-timber-4.7.1/jars/lint.jar does not specify a vendor; see IssueRegistry#vendor\n\n\n\n&gt; Task :app:lintVitalReportDevRelease\n\n&gt; Task :app:lintVitalDevRelease\n\n\n\n&gt; Task :app:minifyDevReleaseWithR8 FAILED\n\nERROR: Missing classes detected while running R8. Please add the missing classes or apply additional keep rules that are generated in /home/jenkins/workspace/APP_PR-1867/android/app/build/outputs/mapping/devRelease/missing_rules.txt.\n\nERROR: R8: Missing class edu.umd.cs.findbugs.annotations.SuppressFBWarnings (referenced from: void com.jwplayer.c.a.f.onMetadata(androidx.media3.common.Metadata))\n\nMissing class kotlinx.parcelize.Parcelize (referenced from: io.didomi.sdk.Purpose and 10 other contexts)\n\nASM Instrumentation process wasn't able to resolve some classes, this means that\n\nthe instrumented classes might contain corrupt stack frames. Make sure the\n\ndependencies that contain these classes are on the runtime or the provided\n\nclasspath. Otherwise, the jvm might fail to load the corrupt classes at runtime\n\nwhen running in a jvm environment like unit tests.\n\n\n\nClasses that weren't resolved:\n\n&gt; com.jwplayer.pub.api.configuration.PlayerConfig\n\n&gt; com.google.android.gms.cast.framework.CastSession\n\n&gt; com.jwplayer.pub.api.JWPlayer$PlayerInitializationListener\n\n&gt; com.jwplayer.api.b.a.l\n\n&gt; com.jwplayer.api.b.a.a\n\n&gt; com.jwplayer.c.m\n\n&gt; com.jwplayer.api.b.a.k\n\n&gt; com.jwplayer.a.a\n\n&gt; com.jwplayer.a.h\n\n&gt; com.jwplayer.c.e\n\n-- 74 more classes --\n\n\n\n\n\nFAILURE: Build failed with an exception.\n\n\n\n* What went wrong:\n\nExecution failed for task ':app:minifyDevReleaseWithR8'.\n\n&gt; A failure occurred while executing com.android.build.gradle.internal.tasks.R8Task$R8Runnable\n\n   &gt; Compilation failed to complete\n</code></pre>\n<p>I've tried editing the proguard-rules.pro file and adding:</p>\n<pre><code>-keepattributes *Annotation*\n-keep @interface edu.umd.cs.findbugs.annotations.**\n-keep class kotlinx.parcelize.** { *; }\n-keep @kotlinx.parcelize.Parcelize class * {\n    &lt;fields&gt;;\n    &lt;methods&gt;;\n}\n-keep class com.jwplayer.pub.api.** { *; }\n-keep class com.google.android.gms.cast.framework.** { *; }\n-keep class com.jwplayer.** { *; }\n</code></pre>\n<p>but this doesn't seem to affect in any way the above errors.</p>\n<p>I am using <code>https://github.com/jwplayer/jwplayer-react-native</code></p>\n<p>content of app/build.gradle:</p>\n<pre><code>apply plugin: 'com.android.application'\napply plugin: 'org.jetbrains.kotlin.android'\napply plugin: 'com.google.firebase.firebase-perf'\napply plugin: 'com.google.gms.google-services'\napply plugin: 'com.google.firebase.crashlytics'\n\nproject.ext.envConfigFiles = [\n    dev: &quot;.env.dev&quot;,\n    staging: &quot;.env.staging&quot;,\n    prod: &quot;.env.prod&quot;,\n]\n\napply from: project(':react-native-config').projectDir.getPath() + &quot;/dotenv.gradle&quot;\napply plugin: 'kotlin-android'\n\napply plugin: &quot;com.facebook.react&quot;\n\n\n\n\nreact {\n    entryFile = file(&quot;../../index.js&quot;)\n}\n\n\ndef enableSeparateBuildPerCPUArchitecture = false\n\n\ndef enableProguardInReleaseBuilds = true\n\n\ndef jscFlavor = 'org.webkit:android-jsc:+'\n\nclass BuildConfig {\n    static final int versionMajor = 10\n    static final int versionMinor = 6\n    static final int versionFix = 2\n    static final int playstoreVersionSuffix = 0\n}\n\next {\n    buildConfig = new BuildConfig()\n    RNJWPlayerUseGoogleCast = true\n    exoplayerVersion = '2.18.1'\n    JWPlayerVersion = '4.18.2'\n}\n\nandroid {\n    ndkVersion rootProject.ext.ndkVersion\n\n    buildToolsVersion rootProject.ext.buildToolsVersion\n    compileSdkVersion rootProject.ext.compileSdkVersion\n\n    namespace &quot;&lt;myNameSpaceisHere&gt;&quot;\n\n    defaultConfig {\n        applicationId &quot;&lt;myAppIdHere&gt;&quot;\n        minSdkVersion rootProject.ext.minSdkVersion\n        targetSdkVersion rootProject.ext.targetSdkVersion\n        // versionCode BuildConfig.versionMajor * 1000000 + 3 * 10000 + BuildConfig.versionFix * 100 + BuildConfig.playstoreVersionSuffix\n        versionCode BuildConfig.versionMajor * 1000000 + BuildConfig.versionMinor * 10000 + BuildConfig.versionFix * 100 + BuildConfig.playstoreVersionSuffix\n        versionName &quot;${BuildConfig.versionMajor}.${BuildConfig.versionMinor}.${BuildConfig.versionFix}&quot;\n        multiDexEnabled true\n\n        // react-native-iap: we only use the Google Play flavor, this needs an update if we use amazon too!!\n        // https://stackoverflow.com/questions/67941766/react-native-build-failed-could-not-determine-the-dependencies-of-task-appm\n        missingDimensionStrategy 'store', 'play'\n\n        // https://github.com/FormidableLabs/react-native-app-auth#android-setup\n        manifestPlaceholders = [\n          appAuthRedirectScheme: &quot;&lt;myNameSpaceisHere&gt;&quot;\n        ]\n\n        // https://github.com/luggit/react-native-config#advanced-android-setup\n        resValue &quot;string&quot;, &quot;build_config_package&quot;, &quot;&lt;myNameSpaceisHere&gt;&quot;\n\n        // https://docs.wonderpush.com/docs/android-sdk#specifying-where-to-find-the-buildconfig-class\n        resValue &quot;string&quot;, &quot;wonderpush_buildConfigPackage&quot;, &quot;&lt;myNameSpaceisHere&gt;&quot;\n    }\n\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_18\n        targetCompatibility JavaVersion.VERSION_18\n    }\n\n    kotlin {\n        jvmToolchain(17)\n    }\n\n    signingConfigs {\n        debug {\n            storeFile file('../keystore/debug.keystore')\n            storePassword 'android'\n            keyAlias 'androiddebugkey'\n            keyPassword 'android'\n        }\n\n        release {\n            storeFile file(System.getenv(&quot;APP_KEYSTORE&quot;) ?: '../keystore/debug.keystore')\n            storePassword System.getenv(&quot;APP&quot;) ?: 'android'\n            keyAlias System.getenv(&quot;APP&quot;) ?: 'androiddebugkey'\n            keyPassword System.getenv(&quot;APP&quot;) ?: 'android'\n        }\n    }\n    buildTypes {\n        debug {\n            signingConfig signingConfigs.debug\n        }\n        release {\n           \n            signingConfig isIdeBuild() ? signingConfigs.debug : signingConfigs.release\n            minifyEnabled enableProguardInReleaseBuilds\n            shrinkResources enableProguardInReleaseBuilds\n            debuggable isIdeBuild()\n            proguardFiles getDefaultProguardFile(&quot;proguard-android.txt&quot;), &quot;proguard-rules.pro&quot;\n        }\n    }\n\n    flavorDimensions &quot;server&quot;\n\n    productFlavors {\n        dev {\n            dimension &quot;server&quot;\n            applicationIdSuffix &quot;.dev&quot;\n            versionNameSuffix hyphen(buildVersionNameSuffix('dev'))\n            buildConfigField &quot;String&quot;, &quot;APP_INFO&quot;, quoted(buildVersionNameSuffix(&quot;dev&quot;))\n        }\n        staging {\n            dimension &quot;server&quot;\n            applicationIdSuffix &quot;.staging&quot;\n            versionNameSuffix hyphen(buildVersionNameSuffix('staging'))\n            buildConfigField &quot;String&quot;, &quot;APP_INFO&quot;, quoted(buildVersionNameSuffix(&quot;staging&quot;))\n        }\n        prod {\n            dimension &quot;server&quot;\n            String branchName = System.getenv('BRANCH_NAME') ?: &quot;&quot;\n\n            if (isIdeBuild()) {\n                versionNameSuffix hyphen(buildVersionNameSuffix(&quot;prod&quot;))\n                buildConfigField &quot;String&quot;, &quot;APP_INFO&quot;, quoted(buildVersionNameSuffix(&quot;prod&quot;))\n            } else {\n                if (!branchName.startsWith(&quot;release/&quot;)) {\n                    versionNameSuffix hyphen(buildVersionNameSuffix(&quot;prod&quot;))\n                    buildConfigField &quot;String&quot;, &quot;APP_INFO&quot;, quoted(buildVersionNameSuffix(&quot;prod&quot;))\n                } else {\n                    buildConfigField &quot;String&quot;, &quot;APP_INFO&quot;, quoted(&quot;&quot;)\n                }\n            }\n        }\n    }\n    // applicationVariants are e.g. debug, release\n    applicationVariants.all { variant -&gt;\n        def apkName = &quot;app-${variant.name}-${android.defaultConfig.versionName}-${variant.buildType.name}&quot;\n\n        variant.outputs.each { output -&gt;\n            // Example: versionCode 1 will generate 1001 for armeabi-v7a, 1002 for x86, etc.\n            // For each separate APK per architecture, set a unique version code as described here:\n            // https://developer.android.com/studio/build/configure-apk-splits.html\n            def versionCodes = [&quot;armeabi-v7a&quot;: 1, &quot;x86&quot;: 2, &quot;arm64-v8a&quot;: 3, &quot;x86_64&quot;: 4]\n            def abi = output.getFilter(com.android.build.OutputFile.ABI)\n            if (abi != null) {  // null for the universal-debug, universal-release variants\n                output.versionCodeOverride =\n                        defaultConfig.versionCode * 1000 + versionCodes.get(abi)\n            }\n        }\n\n        variant.outputs.all { output -&gt;\n            outputFileName = &quot;${apkName}.apk&quot;\n        }\n    }\n\n    lintOptions {\n        baseline file(&quot;lint-baseline.xml&quot;)\n        checkAllWarnings true\n        warningsAsErrors true\n    }\n}\n\ndef gitSha() {\n    if (isIdeBuild()) {\n        return &quot;devbuild&quot;\n    } else {\n        if (System.getenv(&quot;GIT_COMMIT&quot;) != null) {\n            return System.getenv(&quot;GIT_COMMIT&quot;).substring(0, 7)\n        } else {\n            return &quot;devbuild&quot;\n        }\n    }\n}\n\ndef buildVersionNameSuffix(String environment) {\n    def upperCaseEnv = environment.toUpperCase()\n    if (upperCaseEnv == &quot;PROD&quot;) {\n        return &quot;&quot;\n    }\n    return &quot;${System.getenv('BUILD_NUMBER')}-${environment}-${gitSha()}&quot;\n}\n\nprivate static quoted(string) {\n    return &quot;\\&quot;$string\\&quot;&quot;\n}\n\nprivate static hyphen(String string) {\n    if (!string.isEmpty()) {\n        return &quot;-$string&quot;\n    } else {\n        return &quot;&quot;\n    }\n}\n\ndependencies {\n    implementation project(':react-native-config')\n    //noinspection GradleDynamicVersion\n    implementation &quot;org.jetbrains.kotlin:kotlin-reflect:$kotlinVersion&quot;\n    implementation 'androidx.constraintlayout:constraintlayout:1.1.3'\n    implementation 'com.google.android.material:material:1.1.0'\n\n    implementation &quot;com.google.android.gms:play-services-base:17.2.1&quot;\n\n    // The version of react-native is set by the React Native Gradle Plugin\n    implementation(&quot;com.facebook.react:react-android&quot;)\n\n    if (hermesEnabled.toBoolean()) {\n        implementation(&quot;com.facebook.react:hermes-android&quot;)\n    } else {\n        implementation jscFlavor\n    }\n\n    implementation &quot;androidx.core:core-ktx:1.2.0&quot;\n    implementation &quot;org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlinVersion&quot;\n    implementation 'com.dailymotion.dailymotion-sdk-android:sdk:0.2.10'\n\n    implementation 'com.jakewharton.timber:timber:4.7.1'\n\n    implementation 'androidx.constraintlayout:constraintlayout:1.1.3'\n\n\n    debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.9.1'\n\n    testImplementation 'junit:junit:4.13'\n\n    implementation &quot;org.jetbrains.kotlin:kotlin-test-junit:$kotlinVersion&quot;\n\n    implementation &quot;androidx.appcompat:appcompat:1.2.0&quot;\n\n    implementation 'com.squareup.okhttp3:okhttp:4.9.3'\n    implementation &quot;com.google.android.gms:play-services-cast-framework:${safeExtGet('castFrameworkVersion', '+')}&quot;\n    implementation 'io.didomi.sdk:android:1.86.3'\n    implementation &quot;androidx.work:work-runtime:2.7.1&quot;\n\n    // JWPlayer SDK\n    implementation &quot;com.jwplayer:jwplayer-core:$JWPlayerVersion&quot;\n    implementation &quot;com.jwplayer:jwplayer-common:$JWPlayerVersion&quot;\n    implementation &quot;com.jwplayer:jwplayer-chromecast:$JWPlayerVersion&quot;\n    implementation &quot;com.jwplayer:jwplayer-ima:$JWPlayerVersion&quot;\n}\n\n\ndef safeExtGet(prop, fallback) {\n  rootProject.ext.has(prop) ? rootProject.ext.get(prop) : fallback\n}\n\napply from: file(&quot;../../node_modules/@react-native-community/cli-platform-android/native_modules.gradle&quot;); applyNativeModulesAppBuildGradle(project)\n\n</code></pre>\n<p>content of build.gradle:</p>\n<pre><code>// Top-level build file where you can add configuration options common to all sub-projects/modules.\n\nbuildscript {\n    ext {\n        minSdkVersion = 28\n        compileSdkVersion = 34\n        targetSdkVersion = 34\n        buildToolsVersion = &quot;34.0.0&quot;\n        androidXCore = &quot;1.0.2&quot;\n        androidXAnnotation = &quot;1.2.0&quot;\n        androidXBrowser = &quot;1.3.0&quot;\n        castFrameworkVersion = &quot;21.3.0&quot;\n\n        ndkVersion = &quot;25.1.8937393&quot;\n        kotlinVersion='1.9.10'\n    }\n\n    repositories {\n        google()\n        mavenCentral()\n        maven { url 'https://maven.fabric.io/public' }\n    }\n    dependencies {\n        classpath(&quot;com.android.tools.build:gradle&quot;)\n        classpath(&quot;com.facebook.react:react-native-gradle-plugin&quot;)\n        classpath &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion&quot;\n        classpath 'com.google.gms:google-services:4.4.0'\n        classpath 'com.google.firebase:firebase-crashlytics-gradle:2.7.1'\n        classpath 'com.google.firebase:perf-plugin:1.4.1'\n    }\n}\n\nplugins {\n    id &quot;com.github.ben-manes.versions&quot; version &quot;0.38.0&quot;\n}\n\nallprojects {\n    tasks.withType(Javadoc).all { enabled = false }\n\n    repositories {\n        maven {\n            // All of React Native (JS, Obj-C sources, Android binaries) is installed from npm\n            url(&quot;$rootDir/../node_modules/react-native/android&quot;)\n        }\n        maven {\n            // Android JSC is installed from npm\n            url(&quot;$rootDir/../node_modules/jsc-android/dist&quot;)\n        }\n\n        mavenCentral()\n        mavenLocal()\n\n        google()\n        maven { url &quot;https://jitpack.io&quot; }\n        maven {\n            // JW Player\n            url 'https://mvn.jwplayer.com/content/repositories/releases/'\n        }\n    }\n}\n\napply plugin: &quot;com.facebook.react.rootproject&quot;\n\n\ndependencyUpdates.resolutionStrategy = {\n    componentSelection { rules -&gt;\n        rules.all { ComponentSelection selection -&gt;\n            boolean rejected = ['alpha', 'beta'].any { qualifier -&gt;\n                selection.candidate.version ==~ /(?i).*[.-]${qualifier}[.\\d-]*/\n            }\n            if (rejected) {\n                selection.reject('Release candidate')\n            }\n        }\n    }\n}\n\ntask clean(type: Delete) {\n    delete rootProject.buildDir\n}\n\ndef isIdeBuild() {\n    return properties.containsKey(&quot;android.injected.invoked.from.ide&quot;)\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}