{
  "question": {
    "tags": [
      "java",
      "pdf",
      "pdfbox",
      "tagged-pdf"
    ],
    "owner": {
      "account_id": 27429963,
      "reputation": 27,
      "user_id": 20926830,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/TLzOI.png?s=256",
      "display_name": "CodeComposer",
      "link": "https://stackoverflow.com/users/20926830/codecomposer"
    },
    "is_answered": false,
    "view_count": 150,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1742468008,
    "creation_date": 1742204538,
    "last_edit_date": 1742468008,
    "question_id": 79514183,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79514183/how-to-properly-associate-pdannotationlink-with-pdstructureelement-for-pdf-ua-co",
    "title": "How to properly associate PDAnnotationLink with PDStructureElement for PDF/UA compliance?",
    "body": "<p>I'm using PDFBox 3.0.2 to generate an accessible PDF with structured elements, but I am failing the PAC (PDF Accessibility Checker) test because I cannot properly associate a PDAnnotationLink with its PDStructureElement.</p>\n<p>Here's the relevant code I am using:</p>\n<pre class=\"lang-java prettyprint-override\"><code>// Step 1: Create structure element\nPDStructureElement element = new PDStructureElement(StandardStructureTypes.LINK, parentElement);\n\n// Step 2: Create the accessible link annotation\nPDAnnotationLink link = new PDAnnotationLink();\nlink.setPage(page);\nPDRectangle linkRect = new PDRectangle(100, 100, 120, 15);\nlink.setRectangle(linkRect );\nlink.setContents(layoutInfo.text());\nlink.getCOSObject().setBoolean(&quot;IsMap&quot;, false);\n\nPDObjectReference objRef = new PDObjectReference();\nobjRef.setReferencedObject(link);\nelement.appendKid(objRef);\n\nlink.setStructParent(structParentCounter);\n\npage.getAnnotations().add(link);\n\nPDActionGoTo action = new PDActionGoTo();\n\nPDPageXYZDestination destination = new PDPageXYZDestination();\ndestination.setPage(page);\ndestination.setTop((int) 83);\naction.setDestination(destination);\nlink.setAction(action);\n\npage.getAnnotations().add(link);\n\n// Step 3: Associate the marked content reference with the structure element\nPDMarkedContentReference mcr = new PDMarkedContentReference();\nmcr.setMCID(mcidCounter);\nelement.appendKid(mcr);\n\n// Step 4: Define marked content properties\nCOSDictionary markedContentDictionary = new COSDictionary();\nmarkedContentDictionary.setInt(COSName.MCID, mcidCounter);\nmarkedContentDictionary.setString(COSName.CONTENTS, &quot;*&quot;);\n\ntry {\n    PDPageContentStream contentStream = getCurrentLayoutState().contentStream();\n    contentStream.setLeading(LINIE_SPACING);\n    \n    // Step 5: Begin marked content\n    contentStream.beginMarkedContent(COSName.getPDFName(&quot;link&quot;), PDPropertyList.create(markedContentDictionary ));\n    contentStream.beginText();\n    contentStream.newLineAtOffset(100, 100);\n    contentStream.showText(&quot;*&quot;);\n    contentStream.endText();\n    contentStream.endMarkedContent();\n\n    // Step 6: Move to next MCID\n    mcidCounter++;\n    structureElementArray.add(element);\n\n} catch (IOException e) {\n    e.printStackTrace();\n}\n</code></pre>\n<p>Even though I have structured the content, PAC still does not recognize the PDAnnotationLink as part of the structure. The annotation is visible in the PDF, but it does not appear as part of the Link structure in accessibility tools.</p>\n<p>How can I properly associate PDAnnotationLink with its corresponding PDStructureElement so that PAC recognizes the link annotation as part of the structure?</p>\n<p>Additional notes</p>\n<ul>\n<li>PDFBox Version: 3.0.2</li>\n<li>Goal: PDF/UA Compliance</li>\n<li>Issue: PDAnnotationLink not connected to PDStructureElement</li>\n</ul>\n<p>What I've tried: using appendKid(), PDMarkedContentReference, and setting a COSDictionary, but the link is still not detected correctly.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}