{
  "question": {
    "tags": [
      "java",
      "xml",
      "xbrl",
      "xmlcatalog"
    ],
    "owner": {
      "account_id": 94158,
      "reputation": 10059,
      "user_id": 257233,
      "user_type": "registered",
      "accept_rate": 88,
      "profile_image": "https://www.gravatar.com/avatar/eee4f99bf88fb3d8f577e40f236caf12?s=256&d=identicon&r=PG",
      "display_name": "Robert Mark Bram",
      "link": "https://stackoverflow.com/users/257233/robert-mark-bram"
    },
    "is_answered": true,
    "view_count": 214,
    "accepted_answer_id": 79575326,
    "answer_count": 3,
    "score": 0,
    "last_activity_date": 1747601340,
    "creation_date": 1744634234,
    "last_edit_date": 1747601340,
    "question_id": 79573162,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79573162/error-validating-xbrl-using-catalog-xml-to-ensure-only-local-xsd-files-are-used",
    "title": "Error validating XBRL using catalog.xml to ensure only local XSD files are used",
    "body": "<p>I put this code on Github:</p>\n<ol>\n<li><a href=\"https://github.com/robertmarkbram/XbrlValidationWithXsdUsesXercesApplication\" rel=\"nofollow noreferrer\">https://github.com/robertmarkbram/XbrlValidationWithXsdUsesXercesApplication</a> - uses Xerces.</li>\n<li><a href=\"https://github.com/robertmarkbram/XbrlValidationWithXsdNoXercesApplication\" rel=\"nofollow noreferrer\">https://github.com/robertmarkbram/XbrlValidationWithXsdNoXercesApplication</a> - no Xerces, just what is in the JDK.</li>\n</ol>\n<p>This is my code to validate an XBRL file using an XSD and a <code>catalog.xml</code> listing the local paths to all the XSD files:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package validate;\n\nimport java.io.IOException;\nimport java.nio.file.Path;\nimport javax.xml.XMLConstants;\nimport javax.xml.transform.Source;\nimport javax.xml.transform.stream.StreamSource;\nimport javax.xml.validation.Schema;\nimport javax.xml.validation.SchemaFactory;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.xerces.util.XMLCatalogResolver;\nimport org.xml.sax.SAXException;\nimport org.xml.sax.SAXParseException;\n\n@Slf4j\npublic class XsdValidatorTest {\n\n    public static void main(String[] args) throws SAXException, IOException {\n        // Compute path to the XBRL payload to be validated.\n        final Path xbrlPath = Path.of(\n            &quot;/path/to/xbrl.xml&quot;\n        );\n        final Source xmlStreamSource = new StreamSource(xbrlPath.toFile());\n\n        // Create objects to do the validation.\n        final SchemaFactory schemaFactory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n        final Path xsdPath = Path.of(\n            &quot;/path/to/sprcnt.0001.conttrans.request.02.02.report.xsd&quot;\n        );\n        final Schema schema = schemaFactory.newSchema(xsdPath.toFile());\n        // Set up a CatalogResolver so that use the local XSD files and not look them up from the internet.\n        final String[] catalogs = { &quot;xsd/catalog.xml&quot; };\n        final XMLCatalogResolver resolver = new XMLCatalogResolver(catalogs);\n        schemaFactory.setResourceResolver(resolver);\n        // Create the validator.\n        javax.xml.validation.Validator validator = schema.newValidator();\n        // Capture the XSD errors so that we can report them back.\n        final XsdValidator.XsdErrorHandler errorHandler = new XsdValidator.XsdErrorHandler(xbrlPath);\n        validator.setErrorHandler(errorHandler);\n\n        // Validate and extract errors.\n        validator.validate(xmlStreamSource);\n        if (errorHandler.getErrors().isEmpty()) {\n            log.info(&quot;'{}' is valid against '{}'.&quot;, xbrlPath, xsdPath);\n        }\n        for (SAXParseException error : errorHandler.getErrors()) {\n            log.debug(&quot;Error: {}&quot;, error.toString());\n        }\n    }\n}\n</code></pre>\n<p>The XBRL I am trying to validate is here: <a href=\"https://gist.github.com/robertmarkbram/d8c2b3ad7c0e23753e45ca996f561816\" rel=\"nofollow noreferrer\">https://gist.github.com/robertmarkbram/d8c2b3ad7c0e23753e45ca996f561816</a> (removed because it's not important for my actual problem and the post is too long already).</p>\n<p>The XSD file used is the same file from <code>link:schemaRef</code> in the XBRL, just saved locally: <a href=\"http://sbr.gov.au/taxonomy/sbr_au_reports/sprstrm/sprcnt/sprcnt_0001/sprcnt.0001.conttrans.request.02.02.report.xsd\" rel=\"nofollow noreferrer\">http://sbr.gov.au/taxonomy/sbr_au_reports/sprstrm/sprcnt/sprcnt_0001/sprcnt.0001.conttrans.request.02.02.report.xsd</a></p>\n<p>Finally, the catalog.xml file contains references to all the XSD files I found locally when validating my XBRL file using <a href=\"https://arelle.org/arelle/\" rel=\"nofollow noreferrer\">Arelle</a>.</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;catalog xmlns=&quot;urn:oasis:names:tc:entity:xmlns:xml:catalog&quot;&gt;\n   ... Removed lines because the post was too long ...\n   &lt;system systemId=&quot;http://sbr.gov.au/icls/py/pyin/pyin.02.17.data&quot; uri=&quot;xsd/sbr.gov.au/taxonomy/sbr_au_taxonomy/icls/py/pyin/pyin.02.17.data.xsd&quot; /&gt;\n   &lt;system systemId=&quot;http://sbr.gov.au/rprt/sprstrm/sprcnt/sprcnt.0001.private.02.01.module&quot; uri=&quot;xsd/sbr.gov.au/taxonomy/sbr_au_reports/sprstrm/sprcnt/sprcnt_0001/sprcnt.0001.private.02.01.module.xsd&quot; /&gt;\n   &lt;system systemId=&quot;http://sbr.gov.au/rprt/sprstrm/sprcnt/sprcnt.0001.private.02.02.module&quot; uri=&quot;xsd/sbr.gov.au/taxonomy/sbr_au_reports/sprstrm/sprcnt/sprcnt_0001/sprcnt.0001.private.02.02.module.xsd&quot; /&gt;\n   &lt;system systemId=&quot;http://www.w3.org/1999/xlink&quot; uri=&quot;xsd/www.xbrl.org/2003/xlink-2003-12-31.xsd&quot; /&gt;\n   &lt;system systemId=&quot;http://www.xbrl.org/2003/instance&quot; uri=&quot;xsd/www.xbrl.org/2003/xbrl-instance-2003-12-31.xsd&quot; /&gt;\n   &lt;system systemId=&quot;http://www.xbrl.org/2003/linkbase&quot; uri=&quot;xsd/www.xbrl.org/2003/xbrl-linkbase-2003-12-31.xsd&quot; /&gt;\n   &lt;system systemId=&quot;http://xbrl.org/2005/xbrldt&quot; uri=&quot;xsd/www.xbrl.org/2005/xbrldt-2005.xsd&quot; /&gt;\n   &lt;system systemId=&quot;http://www.xbrl.org/2003/linkbase&quot; uri=&quot;xsd/www.xbrl.org/2003/xbrl-linkbase-2003-12-31.xsd&quot; /&gt;\n   &lt;system systemId=&quot;http://www.xbrl.org/2003/XLink&quot; uri=&quot;xsd/www.xbrl.org/2003/xl-2003-12-31.xsd&quot; /&gt;\n   &lt;system systemId=&quot;http://www.w3.org/1999/xlink&quot; uri=&quot;xsd/www.xbrl.org/2003/xlink-2003-12-31.xsd&quot; /&gt;\n&lt;/catalog&gt;\n</code></pre>\n<p>This works fine when connected to the internet:</p>\n<pre><code>2025-04-14 22:00:53,043 [main] INFO validate.XsdValidatorTest [XsdValidatorTest.java:44] - main - '/path/to/xbrl.xml' is valid against '/path/to/sprcnt.0001.conttrans.request.02.02.report.xsd'.\n</code></pre>\n<p>Now turn the internet off and it fails, not knowing what <code>xbrli:item</code> is.</p>\n<pre><code>Exception in thread &quot;main&quot; org.xml.sax.SAXParseException; systemId: file:/path/to/sprcnt.0001.conttrans.request.02.02.report.xsd; lineNumber: 82; columnNumber: 171; src-resolve: Cannot resolve the name 'xbrli:item' to a(n) 'element declaration' component.\n    at org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException(Unknown Source)\n   ... snip\n    at java.xml/javax.xml.validation.SchemaFactory.newSchema(SchemaFactory.java:628)\n    at validate.XsdValidatorTest.main(XsdValidatorTest.java:30)\n\nFAILURE: Build failed with an exception.\n</code></pre>\n<hr />\n<p>Wednesday 16 April 2025, 12:40:23 pm</p>\n<p>In response to @Ghislain Fourny's answer.</p>\n<p>I updated <code>catalog.xml</code> to:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;catalog xmlns=&quot;urn:oasis:names:tc:entity:xmlns:xml:catalog&quot;&gt;\n   &lt;rewriteURI rewritePrefix=&quot;file:/Users/rob.bram/home/dev/superstream/sscore/src/main/resources/xsd/sbr.gov.au/&quot; uriStartString=&quot;http://sbr.gov.au/&quot;/&gt;\n&lt;/catalog&gt;\n</code></pre>\n<p>I verified that path is correct, but I am still getting exactly the same result.</p>\n<ul>\n<li>Validation works fine when Internet is connected.</li>\n<li>When Internet is off, I get <code>Exception in thread &quot;main&quot; org.xml.sax.SAXParseException; systemId: file:/Users/rob.bram/home/dev/superstream/sscore/src/main/resources/xsd/sbr.gov.au/taxonomy/sbr_au_reports/sprstrm/sprcnt/sprcnt_0001/sprcnt.0001.conttrans.request.02.02.report.xsd; lineNumber: 82; columnNumber: 171; src-resolve: Cannot resolve the name 'xbrli:item' to a(n) 'element declaration' component.</code></li>\n</ul>\n<p>How do I verify that the catalog is even being used? When I change <code>rewritePrefix</code> to have a completely wrong path, the result is still the same. I added <code>&lt;logger name=&quot;javax.xml.catalog&quot; level=&quot;DEBUG&quot; /&gt;</code> to <code>src/main/resources/logback-spring.xml</code> and see no logging at all from it.</p>\n<hr />\n<p>Thursday 17 April 2025, 02:43:11 pm</p>\n<p>I modified code to log each XSD we try to resolve:</p>\n<pre class=\"lang-java prettyprint-override\"><code>final XMLCatalogResolver resolver = new XMLCatalogResolver(catalogs) {\n   @Override\n   public LSInput resolveResource(\n         final String type,\n         final String namespaceURI,\n         final String publicId,\n         final String systemId,\n         final String baseURI\n   ) {\n         final LSInput lsInput = super.resolveResource(type, namespaceURI, publicId, systemId, baseURI);\n         final String resolvedSystemId = (lsInput != null) ? lsInput.getSystemId() : &quot;null&quot;;\n         log.info(&quot;Attempted to resolve '{}', resolved to: {}&quot;, systemId, resolvedSystemId);\n         return lsInput;\n   }\n};\n</code></pre>\n<p>And modified <code>catalog.xml</code> in response to @Ghislain Fourny's most recent suggestion.</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;catalog xmlns=&quot;urn:oasis:names:tc:entity:xmlns:xml:catalog&quot;&gt;\n   ...\n   &lt;uri name=&quot;http://www.xbrl.org/2003/instance&quot; uri=&quot;xsd/www.xbrl.org/2003/xbrl-instance-2003-12-31.xsd&quot; /&gt;\n&lt;/catalog&gt;\n</code></pre>\n<p>I am still getting the same result (works when internet is on, same error when internet is off). I am also not seeing any output from <code>XMLCatalogResolver</code>, leaving me very unclear about whether the resolver is being used.</p>\n<hr />\n<p>Sunday 18 May 2025, 11:30:46 pm</p>\n<p>I have marked @Ghislain Fourny's answer as correct, because that solved part of the problem. I needed to use catalog entries of the form: <code>&lt;uri name=&quot;...&quot; uri=&quot;...&quot;/&gt;</code>. Thank you very much!</p>\n<p>Thanks to a <a href=\"https://coderanch.com/t/789281/java/Error-validating-XBRL-catalog-xml#3591638\" rel=\"nofollow noreferrer\">reply on another forum</a>, I needed to change the order in which I created the objects to ensure that the catalog and resource resolver is added to the schema factory <em>before</em> I create a the schema object.</p>\n<pre><code>// Create the schema factory.\nfinal SchemaFactory schemaFactory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n\n// Tell the schema factory to use a catalog and resource resolver to use local XSD files.\nfinal String[] catalogs = {&quot;src/main/resources/xsd/catalog.xml&quot;};\nfinal XMLCatalogResolver resolver = new XMLCatalogResolver(catalogs) {\n    @Override\n    public LSInput resolveResource(\n            final String type,\n            final String namespaceURI,\n            final String publicId,\n            final String systemId,\n            final String baseURI\n    ) {\n        final LSInput lsInput = super.resolveResource(type, namespaceURI, publicId, systemId, baseURI);\n        final String resolvedSystemId = (lsInput != null) ? lsInput.getSystemId() : &quot;null&quot;;\n        System.out.println(&quot;Attempted to resolve '&quot; + systemId + &quot;', resolved to: &quot; + resolvedSystemId);\n        return lsInput;\n    }\n};\nschemaFactory.setResourceResolver(resolver);\n\n// Create the validator using the XSD.\nfinal String entryPointXsd = &quot;src/main/resources/xsd/sbr.gov.au/taxonomy/sbr_au_reports/sprstrm/sprcnt/sprcnt_0001/sprcnt.0001.conttrans.request.02.02.report.xsd&quot;;\nfinal Schema schema = schemaFactory.newSchema(new File(entryPointXsd));\njavax.xml.validation.Validator validator = schema.newValidator();\n\n// Add an error handler.\nfinal XsdErrorHandler errorHandler = new XsdErrorHandler(xbrlPath);\nvalidator.setErrorHandler(errorHandler);\n\n// Validate and output errors.\nfinal Source xmlStreamSource = new StreamSource(xbrlPath.toFile());\nvalidator.validate(xmlStreamSource);\nif (errorHandler.getErrors().isEmpty()) {\n    System.out.println(&quot;'&quot; + xbrlPath\n            + &quot;' is valid against '&quot; + entryPointXsd\n            + &quot;'.&quot;);\n}\nfor (SAXParseException error : errorHandler.getErrors()) {\n    System.err.println(&quot;Error: &quot; + error.toString());\n}\n</code></pre>\n<p>However, this left me with a new set of problems - the <a href=\"https://gist.github.com/robertmarkbram/00c73758d0ce6b1b7b0ed1aec7a9d869\" rel=\"nofollow noreferrer\">catalog.xml</a> entries were not sufficient and needed adjusting. I still have issues with the entry for <code>xbrl-linkbase-2003-12-31.xsd</code>, but I will make a new question for it because this one already has too detail in it.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}