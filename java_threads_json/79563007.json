{
  "question": {
    "tags": [
      "java",
      "kubernetes",
      "activemq-artemis"
    ],
    "owner": {
      "account_id": 15016264,
      "reputation": 77,
      "user_id": 10839199,
      "user_type": "registered",
      "profile_image": "https://lh4.googleusercontent.com/-4hHSoEEhmQo/AAAAAAAAAAI/AAAAAAAAAEM/Or9E6JvtjcA/s256-rj/photo.jpg",
      "display_name": "Roman R.",
      "link": "https://stackoverflow.com/users/10839199/roman-r"
    },
    "is_answered": true,
    "view_count": 245,
    "accepted_answer_id": 79563023,
    "answer_count": 3,
    "score": 0,
    "last_activity_date": 1748345265,
    "creation_date": 1744144307,
    "last_edit_date": 1744145002,
    "question_id": 79563007,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79563007/activemq-artemis-does-not-display-console-when-runs-in-k8s",
    "title": "ActiveMQ Artemis does not display console when runs in K8S",
    "body": "<p>I deployed <code>apache/activemq-artemis:2.40.0-alpine</code> in k8s cluster. First run goes well, but when I open console I'm unable to view literally everything but white list:\n<a href=\"https://i.sstatic.net/LR6hVtVd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/LR6hVtVd.png\" alt=\"enter image description here\" /></a>\n<a href=\"https://i.sstatic.net/8HdEn9TK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/8HdEn9TK.png\" alt=\"enter image description here\" /></a></p>\n<p>Log:</p>\n<pre class=\"lang-none prettyprint-override\"><code>│ 2025-04-08 18:01:11,109 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-amqp-protocol]. Adding protocol support for: AMQP                                                                       │\n│ 2025-04-08 18:01:11,109 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-hornetq-protocol]. Adding protocol support for: HORNETQ                                                                 │\n│ 2025-04-08 18:01:11,110 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-mqtt-protocol]. Adding protocol support for: MQTT                                                                       │\n│ 2025-04-08 18:01:11,110 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-openwire-protocol]. Adding protocol support for: OPENWIRE                                                               │\n│ 2025-04-08 18:01:11,110 INFO  [org.apache.activemq.artemis.core.server] AMQ221043: Protocol module found: [artemis-stomp-protocol]. Adding protocol support for: STOMP                                                                     │\n│ 2025-04-08 18:01:11,298 INFO  [org.apache.activemq.artemis.core.server] AMQ221034: Waiting indefinitely to obtain primary lock                                                                                                             │\n│ 2025-04-08 18:01:11,299 INFO  [org.apache.activemq.artemis.core.server] AMQ221035: Primary Server Obtained primary lock                                                                                                                    │\n│ 2025-04-08 18:01:11,510 INFO  [org.apache.activemq.artemis.core.server] AMQ221080: Deploying address DLQ supporting [ANYCAST]                                                                                                              │\n│ 2025-04-08 18:01:11,594 INFO  [org.apache.activemq.artemis.core.server] AMQ221003: Deploying ANYCAST queue DLQ on address DLQ                                                                                                              │\n│ 2025-04-08 18:01:11,804 INFO  [org.apache.activemq.artemis.core.server] AMQ221080: Deploying address ExpiryQueue supporting [ANYCAST]                                                                                                      │\n│ 2025-04-08 18:01:11,805 INFO  [org.apache.activemq.artemis.core.server] AMQ221003: Deploying ANYCAST queue ExpiryQueue on address ExpiryQueue                                                                                              │\n│ 2025-04-08 18:01:12,699 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:61616 for protocols [CORE,MQTT,AMQP,STOMP,HORNETQ,OPENWIRE]                                                           │\n│ 2025-04-08 18:01:12,700 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:5445 for protocols [HORNETQ,STOMP]                                                                                    │\n│ 2025-04-08 18:01:12,702 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:5672 for protocols [AMQP]                                                                                             │\n│ 2025-04-08 18:01:12,703 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:1883 for protocols [MQTT]                                                                                             │\n│ 2025-04-08 18:01:12,704 INFO  [org.apache.activemq.artemis.core.server] AMQ221020: Started EPOLL Acceptor at 0.0.0.0:61613 for protocols [STOMP]                                                                                           │\n│ 2025-04-08 18:01:12,706 INFO  [org.apache.activemq.artemis.core.server] AMQ221007: Server is now active                                                                                                                                    │\n│ 2025-04-08 18:01:12,706 INFO  [org.apache.activemq.artemis.core.server] AMQ221001: Apache ActiveMQ Artemis Message Broker version 2.40.0 [0.0.0.0, nodeID=7401e03f-14a3-11f0-ac6e-02d91668a613]                                            │\n│ 2025-04-08 18:01:12,713 INFO  [org.apache.activemq.artemis] AMQ241003: Starting embedded web server                                                                                                                                        │\n│ 2025-04-08 18:01:14,205 INFO  [io.hawt.HawtioContextListener] Initialising Hawtio services                                                                                                                                                 │\n│ 2025-04-08 18:01:14,210 INFO  [io.hawt.jmx.JmxTreeWatcher] Welcome to Hawtio 4.2.0                                                                                                                                                         │\n│ 2025-04-08 18:01:14,292 INFO  [io.hawt.web.auth.AuthenticationConfiguration] Authentication throttling is enabled                                                                                                                          │\n│ 2025-04-08 18:01:14,390 INFO  [io.hawt.web.auth.AuthenticationConfiguration] Starting Hawtio authentication filter, JAAS realm: &quot;activemq&quot; authorized role(s): &quot;amq&quot; role principal classes: &quot;org.apache.activemq.artemis.spi.core.securit │\n│ 2025-04-08 18:01:14,390 INFO  [io.hawt.web.auth.AuthenticationConfiguration] Looking for OIDC configuration file in: /var/lib/artemis-instance/etc/hawtio-oidc.properties                                                                  │\n│ 2025-04-08 18:01:14,505 INFO  [io.hawt.web.auth.ClientRouteRedirectFilter] Hawtio ClientRouteRedirectFilter is using 1800 sec. HttpSession timeout                                                                                         │\n│ 2025-04-08 18:01:14,611 INFO  [org.apache.activemq.artemis] AMQ241001: HTTP Server started at http://0.0.0.0:8161                                                                                                                          │\n│ 2025-04-08 18:01:14,611 INFO  [org.apache.activemq.artemis] AMQ241002: Artemis Jolokia REST API available at http://0.0.0.0:8161/console/jolokia                                                                                           │\n│ 2025-04-08 18:01:14,611 INFO  [org.apache.activemq.artemis] AMQ241004: Artemis Console available at http://0.0.0.0:8161/console                                                                                                            │\n│ 2025-04-08 18:01:28,287 INFO  [io.hawt.web.auth.keycloak.KeycloakServlet] Keycloak integration is disabled                                                                                                                                 │\n│ 2025-04-08 18:01:34,108 INFO  [io.hawt.web.auth.LoginServlet] Hawtio login is using 1800 sec. HttpSession timeout                                                                                                                          │\n│ 2025-04-08 18:01:34,401 INFO  [io.hawt.web.auth.LoginServlet] Logging in user: artemis                                                                                                                                                     │\n│ 2025-04-08 18:01:47,631 INFO  [io.hawt.web.servlets.JolokiaConfiguredAgentServlet] Jolokia overridden property: [key=policyLocation, value=file:/var/lib/artemis-instance/./etc/jolokia-access.xml]                                        │\n│ 2025-04-08 18:01:47,634 INFO  [io.hawt.web.proxy.ProxyServlet] Proxy servlet is disabled                                                                                                                                                   │\n│ 2025-04-08 18:02:47,861 INFO  [io.hawt.web.auth.LoginServlet] Logging in user: artemis                                                                                                                                                     │\n│ 2025-04-08 20:16:49,260 INFO  [io.hawt.web.auth.LoginServlet] Logging in user: artemis  \n</code></pre>\n<p>moreover, in browser console i see the following error:\n<a href=\"https://i.sstatic.net/3SckIxlD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/3SckIxlD.png\" alt=\"enter image description here\" /></a></p>\n<p>My current ingress configuration:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  labels:\n    app.kubernetes.io/component: Ingress\n  name: amq-artemis\n  annotations:\n    external-dns.alpha.kubernetes.io/hostname: hidden\n    external-dns.alpha.kubernetes.io/ingress-hostname-source: annotation-only\n    cert-manager.io/cluster-issuer: hidden\n    cert-manager.io/duration: 2160h\n    cert-manager.io/renew-before: 720h\n    nginx.ingress.kubernetes.io/keepalive_timeout: &quot;1200&quot;\n    nginx.ingress.kubernetes.io/proxy-body-size: &quot;250m&quot;\n    nginx.ingress.kubernetes.io/proxy-buffers-number: &quot;4 256k&quot;\n    nginx.ingress.kubernetes.io/proxy-buffering: 'on'\n    nginx.ingress.kubernetes.io/proxy-buffer-size: &quot;128k&quot;\n    nginx.ingress.kubernetes.io/proxy-read-timeout: &quot;300&quot;\n    nginx.ingress.kubernetes.io/proxy-connect-timeout: &quot;300&quot;\n    nginx.ingress.kubernetes.io/proxy-send-timeout: &quot;300&quot;\n    nginx.ingress.kubernetes.io/backend-protocol: HTTP\n    nginx.ingress.kubernetes.io/ssl-redirect: &quot;true&quot;\n    nginx.ingress.kubernetes.io/affinity: &quot;cookie&quot;\n    nginx.ingress.kubernetes.io/session-cookie-name: &quot;amq-artemis&quot;\n    nginx.ingress.kubernetes.io/session-cookie-samesite: &quot;None&quot;\n    nginx.ingress.kubernetes.io/session-cookie-secure: &quot;true&quot;\n    nginx.ingress.kubernetes.io/session-cookie-path: &quot;/; Secure&quot;\n    nginx.ingress.kubernetes.io/app-root: /console/artemis\n    nginx.ingress.kubernetes.io/cors-allow-methods: &quot;PUT, GET, POST, OPTIONS&quot;\n    nginx.ingress.kubernetes.io/enable-cors: &quot;true&quot;\n    nginx.ingress.kubernetes.io/cors-allow-credentials: &quot;true&quot;\n    nginx.ingress.kubernetes.io/cors-allow-origin: &quot;*&quot;\n    nginx.ingress.kubernetes.io/cors-allow-headers: &quot;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&quot;\n    nginx.ingress.kubernetes.io/configuration-snippet: |\n      proxy_busy_buffers_size   256k;\n      client_body_buffer_size   10m;\n      send_timeout              300;\nspec:\n  ingressClassName: nginx\n  tls:\n    - hosts:\n        - hidden\n      secretName: artemis-fqdn-cert\n  rules:\n    - host: hidden\n      http:\n        paths:\n        - path: /\n          pathType: Prefix\n          backend:\n            service:\n              name: amq-artemis\n              port:\n                number: 8161\n        - path: /jolokia\n          pathType: Prefix\n          backend:\n            service:\n              name: amq-artemis\n              port:\n                number: 8161\n        - path: /hawtio\n          pathType: Prefix\n          backend:\n            service:\n              name: amq-artemis\n              port:\n                number: 8161\n        - path: /console\n          pathType: Prefix\n          backend:\n            service:\n              name: amq-artemis\n              port:\n                number: 8161\n</code></pre>\n<p>I run broker with the following parameters: <code>--relax-jolokia --name art --http-host 0.0.0.0 </code></p>\n<p>I have tried with various of ingress rules and annotations, but futile. Any idea what it could be?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}