{
  "question": {
    "tags": [
      "java",
      "powershell",
      "powershell-remoting"
    ],
    "owner": {
      "account_id": 24909718,
      "reputation": 61,
      "user_id": 18779401,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/255563f2c4cd029f036d20754aaa8a8c?s=256&d=identicon&r=PG",
      "display_name": "cProgrammer1992",
      "link": "https://stackoverflow.com/users/18779401/cprogrammer1992"
    },
    "is_answered": false,
    "view_count": 154,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1737880607,
    "creation_date": 1733414256,
    "last_edit_date": 1737880607,
    "question_id": 79255391,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79255391/java-processbuilder-execute-powershell-script-as-admin",
    "title": "Java ProcessBuilder execute PowerShell Script as Admin",
    "body": "<p>I have a Java application which is started with non admin rights.\nFrom my Java application I want to start different PowerShell scripts. The PowerShell scrips have input and output parameter. Inside the scripts PSRemoting commands are executed in order to control other Windows PCs. I need to start the PowerShell scripts from Java as admin. In my Java application the admin user and admin password is known.</p>\n<p>Starting the PowerShell script, passing the arguments and returning the return values, does work so far. But I have not managed to start the script as admin.</p>\n<pre><code>      List&lt;String&gt; cmd = new ArrayList&lt;&gt;();\n      cmd.add(&quot;powershell.exe&quot;);\n      cmd.add(&quot;-ExecutionPolicy&quot;);\n      cmd.add(&quot;Bypass&quot;);\n      cmd.add(&quot;-File&quot;);\n      cmd.add(tempScriptPath.toString());\n\n      // Add the arguments for the PowerShell file\n      Iterator&lt;Map.Entry&lt;String, JsonNode&gt;&gt; fields = jsonArgs.fields();\n      while (fields.hasNext()) {\n        Map.Entry&lt;String, JsonNode&gt; field = fields.next();\n        String key = field.getKey();\n        String value = field.getValue().asText(); // Get value as text\n\n        // Add the key and value to the list\n        cmd.add(&quot;-&quot; + key);\n        cmd.add(value);\n      }\n\n      ProcessBuilder pb = new ProcessBuilder(cmd);\n      pb.redirectErrorStream(true); // Combine stdout and stderr\n\n      // Start the process\n      Process process = pb.start();\n</code></pre>\n<p>This is a dummy PowerShell script:</p>\n<pre><code>param (\n    [string]$ip\n)\nWrite-Output &quot;PS INFO: Check if ps remoting is active&quot;\n\n$hostname = Invoke-Command -ComputerName 127.0.0.1 -ScriptBlock { hostname }\n\nWrite-Output &quot;PS INFO: Hostname is $hostname&quot;\n\n$result = @{\n    PsErrorCode = 0\n    Hostname = $hostname\n}\n\n$result | ConvertTo-Json -Depth 10\n</code></pre>\n<p>I guess I have to add the runAs option and the user and password to the cmd but until now I have not managed it.</p>\n<p>Maybe someone does know how to start the script as admin.</p>\n<p>Update: I forgot to mention that the pc has to users. A standard user and an admin user. The java application is started by the standard user. For executing the power shell commands I need elevated privileges which are only available by the admin user.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}