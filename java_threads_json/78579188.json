{
  "question": {
    "tags": [
      "java",
      "spring",
      "hibernate",
      "sqlite",
      "timestamp"
    ],
    "owner": {
      "account_id": 12473846,
      "reputation": 238,
      "user_id": 9080974,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/sq0uN.png?s=256",
      "display_name": "Herry",
      "link": "https://stackoverflow.com/users/9080974/herry"
    },
    "is_answered": true,
    "view_count": 230,
    "accepted_answer_id": 78810689,
    "answer_count": 1,
    "score": 2,
    "last_activity_date": 1722329613,
    "creation_date": 1717569997,
    "last_edit_date": 1717580482,
    "question_id": 78579188,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78579188/springboot-3-sqlite-indexoutofboundsexception-when-loading-instants",
    "title": "SpringBoot 3, SQLite - IndexOutOfBoundsException when loading Instants",
    "body": "<p>I am using SpringBoot 3 to access a SQLite database. My problem is, that when fetching entities parallely, I get a random <code>ArrayIndexOutOfBoundsException</code> in a Java class that parses a date.</p>\n<p>SpringBoot 3.2.5</p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.xerial&lt;/groupId&gt;\n    &lt;artifactId&gt;sqlite-jdbc&lt;/artifactId&gt;\n    &lt;version&gt;3.42.2.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>The dialect is set to <code>spring.jpa.database-platform=org.hibernate.community.dialect.SQLiteDialect</code></p>\n<p>My Java class looks like this:</p>\n<pre><code>public class SomeTable implements Serializable {\n  private static final String COLUMN_NAME_CREATED = &quot;CREATED&quot;;\n  private static final String COLUMN_NAME_MODIFIED = &quot;MODIFIED&quot;;\n  private static final String COLUMN_NAME_IP = &quot;IP&quot;;\n  private static final String COLUMN_NAME_USERNAME = &quot;USERNAME&quot;;\n\n  @Id\n  @Column(length = 36)\n  protected String id;\n\n  @NotNull\n  @Column(name = &quot;created&quot;)\n  private Instant created;\n\n  @NotNull\n  @Column(name = &quot;modified&quot;)\n  private Instant modified;\n}\n</code></pre>\n<p>The table looks like this:</p>\n<pre><code>CREATE TABLE &quot;some_table&quot; (\n    &quot;id&quot;    varchar(36) NOT NULL,\n    &quot;created&quot;   timestamp NOT NULL,\n    &quot;modified&quot;  timestamp NOT NULL\n);\n</code></pre>\n<p>This is the stacktrace I am getting:</p>\n<pre><code>java.lang.ArrayIndexOutOfBoundsException: Index 18 out of bounds for length 13\nat java.base/sun.util.calendar.BaseCalendar.getCalendarDateFromFixedDate(Unknown Source)\nat java.base/java.util.GregorianCalendar.computeFields(Unknown Source)\nat java.base/java.util.GregorianCalendar.computeFields(Unknown Source)\nat java.base/java.util.Calendar.setTimeInMillis(Unknown Source)\nat org.sqlite.jdbc3.JDBC3ResultSet.getTimestamp(JDBC3ResultSet.java:490)\nat com.zaxxer.hikari.pool.HikariProxyResultSet.getTimestamp(HikariProxyResultSet.java)\nat org.hibernate.type.descriptor.jdbc.TimestampUtcAsJdbcTimestampJdbcType$2.doExtract(TimestampUtcAsJdbcTimestampJdbcType.java:103)\nat org.hibernate.type.descriptor.jdbc.BasicExtractor.extract(BasicExtractor.java:44)\nat org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.getCurrentRowValue(JdbcValuesResultSetImpl.java:302)\nat org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.getJdbcValue(RowProcessingStateStandardImpl.java:119)\nat org.hibernate.sql.results.graph.basic.BasicResultAssembler.extractRawValue(BasicResultAssembler.java:52)\nat org.hibernate.sql.results.graph.basic.BasicResultAssembler.assemble(BasicResultAssembler.java:59)\nat org.hibernate.sql.results.graph.DomainResultAssembler.assemble(DomainResultAssembler.java:33)\nat org.hibernate.sql.results.graph.entity.AbstractEntityInitializer.extractConcreteTypeStateValues(AbstractEntityInitializer.java:1081)\nat org.hibernate.sql.results.graph.entity.AbstractEntityInitializer.initializeEntityInstance(AbstractEntityInitializer.java:838)\nat org.hibernate.sql.results.graph.entity.AbstractEntityInitializer.initializeEntity(AbstractEntityInitializer.java:813)\nat org.hibernate.sql.results.graph.entity.AbstractEntityInitializer.initializeInstance(AbstractEntityInitializer.java:799)\nat org.hibernate.sql.results.internal.InitializersList.initializeInstance(InitializersList.java:70)\nat org.hibernate.sql.results.internal.StandardRowReader.coordinateInitializers(StandardRowReader.java:109)\nat org.hibernate.sql.results.internal.StandardRowReader.readRow(StandardRowReader.java:86)\nat org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:181)\nat org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)\nat org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:209)\nat org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:83)\nat org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:76)\nat org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:65)\nat org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:145)\nat org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:117)\nat org.hibernate.loader.ast.internal.SingleIdEntityLoaderStandardImpl.load(SingleIdEntityLoaderStandardImpl.java:75)\nat org.hibernate.persister.entity.AbstractEntityPersister.doLoad(AbstractEntityPersister.java:3748)\nat org.hibernate.persister.entity.AbstractEntityPersister.load(AbstractEntityPersister.java:3737)\nat org.hibernate.event.internal.DefaultLoadEventListener.loadFromDatasource(DefaultLoadEventListener.java:604)\nat org.hibernate.event.internal.DefaultLoadEventListener.loadFromCacheOrDatasource(DefaultLoadEventListener.java:590)\nat org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:560)\nat org.hibernate.event.internal.DefaultLoadEventListener.doLoad(DefaultLoadEventListener.java:544)\nat org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:207)\nat org.hibernate.event.internal.DefaultLoadEventListener.loadWithRegularProxy(DefaultLoadEventListener.java:290)\nat org.hibernate.event.internal.DefaultLoadEventListener.proxyOrLoad(DefaultLoadEventListener.java:242)\nat org.hibernate.event.internal.DefaultLoadEventListener.doOnLoad(DefaultLoadEventListener.java:111)\nat org.hibernate.event.internal.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:68)\nat org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:138)\nat org.hibernate.internal.SessionImpl.fireLoadNoChecks(SessionImpl.java:1222)\nat org.hibernate.internal.SessionImpl.internalLoad(SessionImpl.java:1068)\nat org.hibernate.sql.results.graph.entity.internal.EntitySelectFetchInitializer.initializeInstance(EntitySelectFetchInitializer.java:195)\nat org.hibernate.sql.results.internal.InitializersList.initializeInstance(InitializersList.java:70)\nat org.hibernate.sql.results.internal.StandardRowReader.coordinateInitializers(StandardRowReader.java:109)\nat org.hibernate.sql.results.internal.StandardRowReader.readRow(StandardRowReader.java:86)\nat org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:203)\nat org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)\nat org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:209)\nat org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:83)\nat org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:76)\nat org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:65)\nat org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$2(ConcreteSqmSelectQueryPlan.java:137)\nat org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:362)\nat org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:303)\nat org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:509)\nat org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:427)\nat org.hibernate.query.Query.getResultList(Query.java:120)\nat org.springframework.data.jpa.repository.support.SimpleJpaRepository.findAll(SimpleJpaRepository.java:383)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.base/java.lang.reflect.Method.invoke(Unknown Source)\nat org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)\nat org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)\nat org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)\nat org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)\nat org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)\nat org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)\nat org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\nat org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)\nat org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\nat org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\nat org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)\nat org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392)\nat org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\nat org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\nat org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\nat org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\nat org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)\nat jdk.proxy2/jdk.proxy2.$Proxy229.findAll(Unknown Source)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.base/java.lang.reflect.Method.invoke(Unknown Source)\nat org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)\nat org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)\nat org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)\nat org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)\nat jdk.proxy2/jdk.proxy2.$Proxy229.findAll(Unknown Source)\nat com.my.project.services.SomeTableService.getSomeTable(AbstractNetworkRoutingService.java:97)\n\nCaused by: java.lang.ArrayIndexOutOfBoundsException: Index 27 out of bounds for length 13\nat java.base/sun.util.calendar.BaseCalendar.getCalendarDateFromFixedDate(Unknown Source)\nat java.base/java.util.GregorianCalendar.computeFields(Unknown Source)\nat java.base/java.util.GregorianCalendar.computeFields(Unknown Source)\nat java.base/java.util.Calendar.setTimeInMillis(Unknown Source)\nat org.sqlite.jdbc3.JDBC3ResultSet.getTimestamp(JDBC3ResultSet.java:490)\nat com.zaxxer.hikari.pool.HikariProxyResultSet.getTimestamp(HikariProxyResultSet.java)\nat org.hibernate.type.descriptor.jdbc.TimestampUtcAsJdbcTimestampJdbcType$2.doExtract(TimestampUtcAsJdbcTimestampJdbcType.java:103)\nat org.hibernate.type.descriptor.jdbc.BasicExtractor.extract(BasicExtractor.java:44)\nat org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.getCurrentRowValue(JdbcValuesResultSetImpl.java:302)\nat org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.getJdbcValue(RowProcessingStateStandardImpl.java:119)\nat org.hibernate.sql.results.graph.basic.BasicResultAssembler.extractRawValue(BasicResultAssembler.java:52)\nat org.hibernate.sql.results.graph.basic.BasicResultAssembler.assemble(BasicResultAssembler.java:59)\nat org.hibernate.sql.results.graph.DomainResultAssembler.assemble(DomainResultAssembler.java:33)\nat org.hibernate.sql.results.graph.entity.AbstractEntityInitializer.extractConcreteTypeStateValues(AbstractEntityInitializer.java:1081)\nat org.hibernate.sql.results.graph.entity.AbstractEntityInitializer.initializeEntityInstance(AbstractEntityInitializer.java:838)\nat org.hibernate.sql.results.graph.entity.AbstractEntityInitializer.initializeEntity(AbstractEntityInitializer.java:813)\nat org.hibernate.sql.results.graph.entity.AbstractEntityInitializer.initializeInstance(AbstractEntityInitializer.java:799)\nat org.hibernate.sql.results.internal.InitializersList.initializeInstance(InitializersList.java:70)\nat org.hibernate.sql.results.internal.StandardRowReader.coordinateInitializers(StandardRowReader.java:109)\nat org.hibernate.sql.results.internal.StandardRowReader.readRow(StandardRowReader.java:86)\n...\ncom.my.project.services.SomeTableService.getSomeTable(AbstractNetworkRoutingService.java:97)\n</code></pre>\n<p>The dates in the table look like this:\n<a href=\"https://i.sstatic.net/8ZV0K8TK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/8ZV0K8TK.png\" alt=\"screenshot of suspect columns\" /></a></p>\n<p>We tried to use a custom converter that uses <code>Instant.ofEpochMillis()</code> but the problem still appeared.</p>\n<p>My current assumption is a race condition. Limiting the number of connections to 1 via Spring settings solves the problem - but having to do that because of this seems just wrong, performance-wise this is not optimal so I was thinking someone might have an idea on some other way.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}