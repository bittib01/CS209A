{
  "question": {
    "tags": [
      "java",
      "java.util.concurrent",
      "concurrenthashmap"
    ],
    "owner": {
      "account_id": 85548,
      "reputation": 7926,
      "user_id": 238421,
      "user_type": "registered",
      "accept_rate": 100,
      "profile_image": "https://www.gravatar.com/avatar/364633fd122d04290ae7257642b45800?s=256&d=identicon&r=PG",
      "display_name": "Danilo Piazzalunga",
      "link": "https://stackoverflow.com/users/238421/danilo-piazzalunga"
    },
    "is_answered": true,
    "view_count": 84,
    "accepted_answer_id": 79823643,
    "answer_count": 1,
    "score": 2,
    "last_activity_date": 1763485763,
    "creation_date": 1763484846,
    "question_id": 79823619,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79823619/concurrentmap-atomically-check-if-a-value-if-present-and-then-mutate-it-with-a",
    "title": "ConcurrentMap: atomically check if a value if present, and then mutate it with a consumer",
    "body": "<p>Given a Java <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/concurrent/ConcurrentMap.html\" rel=\"nofollow noreferrer\"><code>ConcurrentMap</code></a>, I would like to atomically:</p>\n<ul>\n<li>Check if an entry is contained in the map</li>\n<li>If it is present, run an action (I'm thinkng of a <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/function/BiConsumer.html\" rel=\"nofollow noreferrer\"><code>BiConsumer</code></a> taking the key and its value)</li>\n<li>Otherwise, run another action (a <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/function/Consumer.html\" rel=\"nofollow noreferrer\"><code>Consumer</code></a> which accepts the missing key)</li>\n</ul>\n<p>How could I use existing <code>ConcurrentMap</code> API to perform the following actions in a thread-safe way?</p>\n<pre><code>if (map.containsKey(key)) {\n    V value = map.get(key);\n    ifPresentAction.accept(key, value);\n} else {\n    ifAbsentAction.accept(key);\n}\n</code></pre>\n<p>where <code>map</code> is of type <code>ConcurrentMap&lt;K, V&gt;</code>, <code>key</code> is of type <code>K</code>, and <code>ifPresentAction</code> and <code>ifAbsentAction</code> are respectively a <code>BiConsumer&lt;K, V&gt;</code> and a <code>Consumer&lt;K&gt;</code>.</p>\n<hr />\n<p><strong>Additional Information</strong></p>\n<p>I thought of invoking <a href=\"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Optional.html#ifPresentOrElse(java.util.function.Consumer,java.lang.Runnable)\" rel=\"nofollow noreferrer\"><code>Optional.ifPresentOrElse</code></a> (with the correct types), but I am not sure if it would be thread-safe.</p>\n<pre><code>Optional.ofNullable(map.get(key))\n        .ifPresentOrElse(ifPresentAction, ifAbsentAction);\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}