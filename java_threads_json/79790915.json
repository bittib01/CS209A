{
  "question": {
    "tags": [
      "java",
      "postgresql",
      "spring-boot",
      "flyway",
      "axon"
    ],
    "owner": {
      "account_id": 13704422,
      "reputation": 1725,
      "user_id": 9888512,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/9dcd79663ed2d8dc76afe278b6674305?s=256&d=identicon&r=PG",
      "display_name": "MatterOfFact",
      "link": "https://stackoverflow.com/users/9888512/matteroffact"
    },
    "is_answered": false,
    "view_count": 93,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1761744043,
    "creation_date": 1760515242,
    "last_edit_date": 1760938237,
    "question_id": 79790915,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79790915/axon-framework-with-postgresql-using-bytea-instead-of-oid-not-working",
    "title": "Axon Framework with postgresql: Using Bytea instead of OID not working",
    "body": "<p>I'm using axon framework 4.12.1 with postgresql (17), flyway and spring boot (3.5.6).\nFollowing the <a href=\"https://docs.axoniq.io/axon-framework-reference/4.12/tuning/rdbms-tuning/#_postgresql_lob_annotated_columns_and_default_hibernate_mapping\" rel=\"nofollow noreferrer\">recommendations</a> I changed the sql migration files to use bytea instead of oid and configured the appropriate orm.xml.</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;entity-mappings version=&quot;2.0&quot; xmlns=&quot;http://java.sun.com/xml/ns/persistence/orm&quot;&gt;\n    &lt;mapped-superclass access=&quot;FIELD&quot; metadata-complete=&quot;false&quot;\n                       class=&quot;org.axonframework.eventhandling.AbstractSequencedDomainEventEntry&quot;&gt;\n        &lt;attributes&gt;\n            &lt;id name=&quot;globalIndex&quot;&gt;\n                &lt;generated-value strategy=&quot;SEQUENCE&quot; generator=&quot;mySequenceGenerator&quot;/&gt;\n                &lt;sequence-generator name=&quot;mySequenceGenerator&quot; sequence-name=&quot;domain_event_entry_seq&quot;\n                                    allocation-size=&quot;1&quot;/&gt;\n            &lt;/id&gt;\n            &lt;basic name=&quot;metaData&quot;&gt;\n                &lt;column name=&quot;meta_data&quot; column-definition=&quot;BYTEA&quot;/&gt;\n            &lt;/basic&gt;\n            &lt;basic name=&quot;payload&quot;&gt;\n                &lt;column name=&quot;payload&quot; column-definition=&quot;BYTEA&quot;/&gt;\n            &lt;/basic&gt;\n        &lt;/attributes&gt;\n    &lt;/mapped-superclass&gt;\n    &lt;entity class=&quot;org.axonframework.modelling.saga.repository.jpa.SagaEntry&quot;&gt;\n        &lt;attribute-override name=&quot;serializedSaga&quot;&gt;\n            &lt;column name=&quot;serialized_saga&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n    &lt;/entity&gt;\n    &lt;entity class=&quot;org.axonframework.eventhandling.tokenstore.jpa.TokenEntry&quot;&gt;\n        &lt;attribute-override name=&quot;token&quot;&gt;\n            &lt;column name=&quot;token&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n    &lt;/entity&gt;\n    &lt;entity class=&quot;org.axonframework.eventsourcing.eventstore.jpa.SnapshotEventEntry&quot;&gt;\n        &lt;attribute-override name=&quot;metaData&quot;&gt;\n            &lt;column name=&quot;meta_data&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n        &lt;attribute-override name=&quot;payload&quot;&gt;\n            &lt;column name=&quot;payload&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n    &lt;/entity&gt;\n    &lt;entity class=&quot;org.axonframework.eventhandling.deadletter.jpa.DeadLetterEntry&quot;&gt;\n        &lt;attribute-override name=&quot;diagnostics&quot;&gt;\n            &lt;column name=&quot;diagnostics&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n        &lt;attribute-override name=&quot;metaData&quot;&gt;\n            &lt;column name=&quot;meta_data&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n        &lt;attribute-override name=&quot;payload&quot;&gt;\n            &lt;column name=&quot;payload&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n        &lt;attribute-override name=&quot;token&quot;&gt;\n            &lt;column name=&quot;token&quot; column-definition=&quot;BYTEA&quot;&gt;&lt;/column&gt;\n        &lt;/attribute-override&gt;\n    &lt;/entity&gt;\n&lt;/entity-mappings&gt;\n</code></pre>\n<p>when using the app it's now failing with</p>\n<blockquote>\n<p>org.hibernate.exception.SQLGrammarException: could not execute\nstatement [ERROR: column &quot;meta_data&quot; is of type bytea but expression\nis of type bigint   Hint: You will need to rewrite or cast the\nexpression.   Position: 179] [insert into domain_event_entry\n(aggregate_identifier,event_identifier,meta_data,payload,payload_revision,payload_type,sequence_number,time_stamp,type,global_index)\nvalues (?,?,?,?,?,?,?,?,?,?)]</p>\n</blockquote>\n<p>domain event entry table definition:</p>\n<pre class=\"lang-sql prettyprint-override\"><code>create table public.domain_event_entry\n(\n    global_index         bigserial\n        constraint pk_domain_event_entry\n            primary key,\n    aggregate_identifier varchar(255) not null,\n    sequence_number      bigint       not null,\n    type                 varchar(255),\n    event_identifier     varchar(255) not null\n        constraint uk_domain_event_entry_identifier\n            unique,\n    meta_data            bytea,\n    payload              bytea        not null,\n    payload_revision     varchar(255),\n    payload_type         varchar(255) not null,\n    time_stamp           varchar(255) not null,\n    constraint uk_domain_event_entry\n        unique (aggregate_identifier, sequence_number)\n);\n\ncreate unique index idx_domain_event_entry_aggregate_seq\n    on public.domain_event_entry (aggregate_identifier, sequence_number);\n\ncreate unique index idx_domain_event_entry_event_id\n    on public.domain_event_entry (event_identifier);\n\n</code></pre>\n<p>application.properties (excerpt):</p>\n<pre><code>spring.datasource.driverClassName=org.postgresql.Driver\nspring.jpa.database-platform=com.haufe.zeva.infrastructure.persistence.ByteaEnforcedPostgresSQLDialect # the dialect I copied from the documentation\nspring.jpa.generate-ddl=false\nspring.jpa.hibernate.ddl-auto=none\nspring.jpa.properties.hibernate.hbm2ddl.auto=none\nspring.jpa.properties.jakarta.persistence.schema-generation.database.action=none\nspring.jpa.properties.jakarta.persistence.schema-generation.create-source=none\nspring.jpa.properties.jakarta.persistence.schema-generation.drop-source=none\nspring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl\nspring.jpa.hibernate.naming.strategy=org.hibernate.cfg.EJB3NamingStrategy\nspring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true\nspring.jpa.open-in-view=false\nspring.jpa.properties.hibernate.multiTenancy=DISCRIMINATOR\nspring.jpa.properties.hibernate.tenant_identifier_resolver=com.som.path.TenantResolver\nspring.jpa.properties.hibernate.hbm2ddl.halt_on_error=false\n# axon framework\naxon.axonserver.enabled=false\n</code></pre>\n<p>How to make the configuration work with <code>bytea</code>?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}