{
  "question": {
    "tags": [
      "java",
      "mqtt"
    ],
    "owner": {
      "account_id": 31073470,
      "reputation": 11,
      "user_id": 23884914,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/0a10075a9eee6715d8b9174f726e22b8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "tony Bran",
      "link": "https://stackoverflow.com/users/23884914/tony-bran"
    },
    "is_answered": false,
    "view_count": 43,
    "answer_count": 0,
    "score": 1,
    "last_activity_date": 1719204235,
    "creation_date": 1719122888,
    "last_edit_date": 1719204235,
    "question_id": 78657890,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78657890/mttdemo-error-cant-found-bean-mqttgeteway",
    "title": "MttDemo Error, Can&#39;t found bean MqttGeteway",
    "body": "<blockquote>\n<p>Parameter 0 of constructor in\ncom.mqtt.ecmqtt.controller.MqttController required a bean of type\n'com.mqtt.ecmqtt.mqtt.gateway.MqttGateway' that could not be found.</p>\n</blockquote>\n<p>Why does it say there is no such bean?</p>\n<p>Error details: <a href=\"https://github.com/QingYiShiDeCha/Mqtt-Demo\" rel=\"nofollow noreferrer\">https://github.com/QingYiShiDeCha/Mqtt-Demo</a></p>\n<p>I tried to customize the implementation class of the <code>Mqttgateway</code>, but the console still prompts an error and is null. After deleting it, it prompted that there was no bean. What is the problem? How to solve it?</p>\n<pre><code>mqtt:\n  broker-url:\n   - tcp://broker-cn.emqx.io:1883\n  username: emqx\n  password: public\n  client-id: mqttClientId\n  connection-timeout: 3000\n  default-topic: test/topic\n  subscription-topic:\n    - qingcha\n    - topicA\n</code></pre>\n<pre><code>@Getter\n@Setter\n@Component\n@ConfigurationProperties(prefix = &quot;mqtt&quot;)\npublic class MqttProperties {\n    private String[] brokerUrl;\n    private String clientId;\n    private String username;\n    private String password;\n    private String defaultTopic;\n    private Long connectionTimeout;\n    private String[] subscriptionTopic;\n}\n</code></pre>\n<pre><code>@Configuration\n@IntegrationComponentScan\npublic class MqttConfig {\n    @Autowired\n    private MqttProperties mqttProperties;\n\n\n    @Bean\n    public MqttConnectOptions mqttConnectOptions() {\n        MqttConnectOptions options = new MqttConnectOptions();\n        options.setUserName(mqttProperties.getUsername());\n        options.setPassword(mqttProperties.getPassword().toCharArray());\n        options.setServerURIs(mqttProperties.getBrokerUrl());\n        return options;\n    }\n\n    /**\n     * 创建MqttPahoClientFactory，设置MQTT Broker连接属性，如果使用SSL验证，也在这里设置。\n     *\n     * @return factory\n     */\n    @Bean\n    public MqttPahoClientFactory mqttClientFactory() {\n        DefaultMqttPahoClientFactory factory = new DefaultMqttPahoClientFactory();\n        factory.setConnectionOptions(mqttConnectOptions());\n\n        return factory;\n    }\n\n    /**\n     * 发送通道\n     */\n    @Bean\n    public MessageChannel mqttOutputChannel() {\n        return new DirectChannel();\n    }\n\n    @Bean\n    @ServiceActivator(inputChannel = &quot;mqttOutputChannel&quot;)\n    public MessageHandler messageHandler() {\n        MqttPahoMessageHandler handler = new MqttPahoMessageHandler(mqttProperties.getClientId(), mqttClientFactory());\n        // 如果设置为true, 即异步, 发送消息将不对阻塞\n        handler.setAsync(true);\n        handler.setDefaultTopic(mqttProperties.getDefaultTopic());\n        return handler;\n    }\n\n    /**\n     * 接收通道\n     */\n    @Bean\n    public MessageChannel mqttInputChannel() {\n        return new DirectChannel();\n    }\n\n    /**\n     * 配置client监听的topic\n     */\n    @Bean\n    public MessageProducer messageProducer() {\n        MqttPahoMessageDrivenChannelAdapter adapter =\n                new MqttPahoMessageDrivenChannelAdapter(mqttProperties.getClientId() + &quot;_input&quot;, mqttClientFactory(), mqttProperties.getSubscriptionTopic());\n        adapter.setCompletionTimeout(mqttProperties.getConnectionTimeout());\n        adapter.setConverter(new DefaultPahoMessageConverter());\n        adapter.setOutputChannel(mqttInputChannel());\n        return adapter;\n    }\n\n    @Bean\n    @ServiceActivator(inputChannel = &quot;mqttInputChannel&quot;)\n    public MessageHandler mqttInputHandler() {\n        return new ReceiveMessageHandler();\n    }\n}\n</code></pre>\n<pre><code>@Slf4j\npublic class ReceiveMessageHandler implements MessageHandler {\n\n    @Resource\n    private SensorMapper sensorMapper;\n\n    @Override\n    public void handleMessage(Message&lt;?&gt; message) throws MessagingException {\n        String topic = Objects.requireNonNull(message.getHeaders().get(&quot;mqtt_receivedTopic&quot;)).toString();\n        log.info(&quot;Receive message from topic {}&quot;, topic);\n        if (&quot;hello&quot;.equalsIgnoreCase(topic)) {\n            log.info(&quot;hello: {}&quot;, message.getPayload());\n        } else {\n            try {\n                String payload = message.getPayload().toString();\n                SensorData sensorData = JSON.parseObject(payload, SensorData.class);\n                log.info(&quot;receive data: {}&quot;, sensorData);\n\n                sensorMapper.insert(sensorData);\n\n            } catch (Exception e) {\n                e.printStackTrace();\n                log.error(e.getMessage());\n            }\n        }\n\n    }\n}\n</code></pre>\n<pre><code>@MessagingGateway(defaultRequestChannel = &quot;mqttOutputChannel&quot;)\npublic interface MqttGateway {\n    /**\n     * 向默认topic发送消息\n     *\n     * @param data 数据\n     */\n    void sendToMqtt(String data);\n\n    /**\n     * 指定 topic 进行消息发送\n     *\n     * @param data  数据\n     * @param topic 主题\n     */\n    void sendToMqtt(String data, @Header(MqttHeaders.TOPIC) String topic);\n\n    /**\n     * 指定 topic 和 qos 进行消息发送\n     *\n     * @param data  数据\n     * @param topic 主题\n     * @param qos   服务质量\n     */\n    void sendToMqtt(String data, @Header(MqttHeaders.TOPIC) String topic, @Header(MqttHeaders.QOS) int qos);\n}\n</code></pre>\n<pre><code>@RestController\n@RequestMapping(&quot;/mqtt&quot;)\n@RequiredArgsConstructor\npublic class MqttController {\n    private final MqttGateway mqttGateway;\n\n    @PostMapping(&quot;/send&quot;)\n    public String sendMsg(String data) {\n        mqttGateway.sendToMqtt(data);\n        return &quot;success&quot;;\n    }\n\n    /**\n     * 发送mqtt消息\n     *\n     * @param data  负载\n     * @param topic 话题\n     * @return String\n     */\n    @PostMapping(&quot;/topic/send&quot;)\n    public String sendMsg(String data, String topic) {\n        mqttGateway.sendToMqtt(data, topic);\n        return &quot;success&quot;;\n    }\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}