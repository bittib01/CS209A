{
  "question": {
    "tags": [
      "java",
      "android",
      "xml",
      "gps",
      "wakelock"
    ],
    "owner": {
      "account_id": 42316605,
      "reputation": 1,
      "user_id": 30692481,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/fd0d49b5e35de7a2e0a4392f60cdebc7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "loore",
      "link": "https://stackoverflow.com/users/30692481/loore"
    },
    "is_answered": false,
    "view_count": 93,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1749968348,
    "creation_date": 1748817100,
    "last_edit_date": 1748817516,
    "question_id": 79647993,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79647993/android-onlocationchanged-callback-not-working-when-the-screen-is-off",
    "title": "Android onLocationChanged() callback not working when the screen is off",
    "body": "<p>I'm relatively new to Android programming, and I was trying to create an app with a Foreground Service (I'm targeting API 31 or higher) which uses Location and Sensors. I've implemented both <code>SensorEventListener</code> and <code>LocationListener</code> and their respective interface methods <code>onSensorChanged()</code> and <code>onLocationChanged()</code>. They both work as intended when the App's Activities are in Foreground, but <code>onLocationChanged()</code> is not called when I turn the device's screen off.</p>\n<p>In my manifest, I request the following permissions:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>...\n&lt;uses-permission android:name=&quot;android.permission.FOREGROUND_SERVICE&quot;/&gt;\n&lt;uses-permission android:name=&quot;android.permission.FOREGROUND_SERVICE_LOCATION&quot;/&gt;\n&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot;/&gt;\n&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;/&gt;\n&lt;uses-permission android:name=&quot;android.permission.ACCESS_BACKGROUND_LOCATION&quot;/&gt;\n&lt;uses-permission android:name=&quot;android.permission.POST_NOTIFICATIONS&quot;/&gt;\n&lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot;/&gt;\n...\n</code></pre>\n<p>and I've requested them dynamically in my main activity; I've declared my service with</p>\n<pre><code>&lt;service\n    ...\n    android:exported=&quot;false&quot;\n    android:foregroundServiceType=&quot;location&quot;&gt;\n&lt;/service&gt;\n</code></pre>\n<p>In my activity, I'm starting my Foreground Service with</p>\n<pre class=\"lang-java prettyprint-override\"><code>startForegroundService(i);\n</code></pre>\n<p>and in the service's onStartCommand() method, I'm using</p>\n<pre class=\"lang-java prettyprint-override\"><code>ServiceCompat.startForeground(this, notification_id, serviceNotification, FOREGROUND_SERVICE_TYPE_LOCATION);\n</code></pre>\n<p>The Service starts normally and the notification I've created is posted as intended; in service's onCreate() I've registered both the callback methods for sensors and location change</p>\n<pre class=\"lang-java prettyprint-override\"><code>SensorManager sm = (SensorManager) getSystemService(SENSOR_SERVICE);\nsm.registerListener(this, accelSensor, SensorManager.SENSOR_DELAY_UI);\nsm.registerListener(this, rotationVectorSensor, SensorManager.SENSOR_DELAY_UI);\n\n...\n\nLocationManager lm = (LocationManager) getSystemService(LOCATION_SERVICE);\nlm.requestLocationUpdates(LocationManager.GPS_PROVIDER, 50, 5.f, this);\n</code></pre>\n<p>I've noticed that if I used my app with the screen off but with something that kept the device working (for example a GPS Navigator on Android Auto) both the callback methods worked as intended, so I've also tried to use a WakeLock in my service's onStartCommand</p>\n<pre class=\"lang-java prettyprint-override\"><code>PowerManager powerManager = (PowerManager) getSystemService(POWER_SERVICE);\nwakeLock = powerManager.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK, &quot;myService::ServiceWakeLockTAG&quot;);\nwakeLock.acquire();\n\n...\n</code></pre>\n<p>which I later release in the service's onDestroy method</p>\n<pre class=\"lang-java prettyprint-override\"><code>...\n\nwakeLock.release();\n</code></pre>\n<p>After all of this, I've also &quot;whitelisted&quot; my app in the device settings, so it is not restricted by Android's battery saving options, but my problem still remains, and what I can see from the logs is that the onLocationChanged() is not called if the screen is off.</p>\n<p>Is there any way to ensure my app keeps working as intended even in this condition?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}