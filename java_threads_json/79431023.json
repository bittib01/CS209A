{
  "question": {
    "tags": [
      "python",
      "java",
      "tensorflow"
    ],
    "owner": {
      "account_id": 242409,
      "reputation": 1473,
      "user_id": 513904,
      "user_type": "registered",
      "accept_rate": 67,
      "profile_image": "https://www.gravatar.com/avatar/8eb3d57e90dc66a40ac271e90a6075d6?s=256&d=identicon&r=PG",
      "display_name": "Eli S",
      "link": "https://stackoverflow.com/users/513904/eli-s"
    },
    "is_answered": false,
    "view_count": 49,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1755758104,
    "creation_date": 1739299267,
    "question_id": 79431023,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79431023/tracing-custommaskwarning-to-its-source",
    "title": "Tracing CustomMaskWarning to its source",
    "body": "<p>I am working with old TensorFlow (2.7) and Java Tensorflow but the answer may still help others tracing similar issues. My model produces the error when saved to the 2.7 save() format:</p>\n<pre><code>CustomMaskWarning: Custom mask layers require a config and must override get_config. When loading, the custom mask layer must be passed to the custom_objects argument. \n</code></pre>\n<p>Originally I imagined this came from the metric and loss function, since the model cannot save and load these, presumably because of some sort of serialization issue.</p>\n<pre><code>def masked_mae(y_true, y_pred):\n    # Mask NaN values, replace by 0\n    y_true = tf.where(tf.math.is_nan(y_true), y_pred, y_true)\n   \n    # Calculate absolute differences\n    absolute_differences = tf.abs(y_true - y_pred)\n    \n    # Compute the mean, ignoring potential NaN values (if any remain after replacement)\n    mae = tf.reduce_mean(absolute_differences)\n    \n    return mae\n</code></pre>\n<p>I don't know how to deliver custom_objects in Java, and I'm done training, so I tried compiling the model with loss=None and metrics=None and saving it that way. The model can be loaded with this change but the error has not gone away. Is there a way to trace what layer is causing this and why? Is it just a nuisance? There are no obvious uses of masks.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}