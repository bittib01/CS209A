{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "spring-mvc"
    ],
    "owner": {
      "account_id": 18044315,
      "reputation": 1775,
      "user_id": 13115701,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/YjiT5Pfx.jpg?s=256",
      "display_name": "Paul Marcelin Bejan",
      "link": "https://stackoverflow.com/users/13115701/paul-marcelin-bejan"
    },
    "is_answered": true,
    "view_count": 482,
    "accepted_answer_id": 78728320,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1734927353,
    "creation_date": 1720568739,
    "last_edit_date": 1720572800,
    "question_id": 78728106,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78728106/how-to-log-json-request-in-spring-application",
    "title": "How to log JSON request in spring application?",
    "body": "<p>After many attempts, I'm here to ask if there is a way to log the input JSON request before it is deserialized into a Java Object.</p>\n<p>My attempts:</p>\n<p><strong>1:</strong> I'm able to correctly log the request, before deserialization, but then is giving me &quot;I/O error while reading input message&quot;</p>\n<p>Code: RequestInterceptor (getRequestBody from HttpServletRequest)</p>\n<pre><code>@Slf4j\n@Order(3)\n@Component\npublic class RequestInterceptor implements HandlerInterceptor {\n\n    @Override\n    public boolean preHandle(final HttpServletRequest request, \n                             final HttpServletResponse response,\n                             final Object handler) throws Exception {\n        logRequestDetails(request);\n        return true;\n    }\n\n    @SuppressWarnings(&quot;unchecked&quot;)\n    private void logRequestDetails(HttpServletRequest request) throws IOException {\n        String httpMethod = request.getMethod();\n        String url = request.getRequestURL().toString();\n        String queryString = request.getQueryString();\n        Map&lt;String, String&gt; pathVariables = (Map&lt;String, String&gt;) request.getAttribute(HandlerMapping.URI_TEMPLATE_VARIABLES_ATTRIBUTE);\n        String requestBody = getRequestBody(request);\n        \n        log.info(&quot;REQUEST INFO: [ (Method: {}) (URL: {}) (Query String: {}) (Path Variables: {}) ]&quot;, httpMethod, url, queryString, pathVariables);\n        log.info(&quot;REQUEST: {}&quot;, requestBody);\n    \n    }\n    \n    private String getRequestBody(HttpServletRequest request) {\n        StringBuilder stringBuilder = new StringBuilder();\n        try (BufferedReader bufferedReader = request.getReader()) {\n            String line;\n            while ((line = bufferedReader.readLine()) != null) {\n                stringBuilder.append(line);\n            }\n        } catch (IOException e) {\n            return &quot;[Error Reading Body]&quot;;\n        }\n        return stringBuilder.toString();\n    }\n    \n}\n</code></pre>\n<p>Logs: HttpMessageNotReadableException: I/O error while reading input message</p>\n<pre><code>2024-07-10 00:43:00.523 | http-nio-9001-exec-1 | INFO  | i.g.p.dav.adap.inbou.rest.interceptor.RequestInterceptor | 90963499-0c12-43e3-bd03-f92392090e26 | 16c64a15-6383-4ca2-87ae-34516435f64f | REQUEST INFO: [ (Method: POST) (URL: http://localhost:9001/api/account/passengers/associate-passengers) (Query String: null) (Path Variables: {}) ]\n2024-07-10 00:43:00.523 | http-nio-9001-exec-1 | INFO  | i.g.p.dav.adap.inbou.rest.interceptor.RequestInterceptor | 90963499-0c12-43e3-bd03-f92392090e26 | 16c64a15-6383-4ca2-87ae-34516435f64f | REQUEST: [  {    &quot;accountId&quot;: 100,    &quot;firstName&quot;: &quot;David&quot;,    &quot;lastName&quot;: &quot;Guetta&quot;,    &quot;dateOfBirth&quot;: &quot;1967-11-07&quot;,    &quot;nationalityId&quot;: 63,    &quot;email&quot;: &quot;davidguetta@gmail.com&quot;,    &quot;phoneNumber&quot;: &quot;+33 3334448899&quot;  }]\n2024-07-10 00:43:00.654 | http-nio-9001-exec-1 | ERROR | i.g.p.coa.rese.adapt.inbound.controller.rest.ExceptionRestController | 90963499-0c12-43e3-bd03-f92392090e26 | 16c64a15-6383-4ca2-87ae-34516435f64f | Exception 238abf96-75f5-47c2-88dc-93c4ef83e935\norg.springframework.http.converter.HttpMessageNotReadableException: I/O error while reading input message\n    at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodArgumentResolver.readWithMessageConverters(AbstractMessageConverterMethodArgumentResolver.java:200) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.readWithMessageConverters(RequestResponseBodyMethodProcessor.java:159) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.resolveArgument(RequestResponseBodyMethodProcessor.java:134) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.method.support.HandlerMethodArgumentResolverComposite.resolveArgument(HandlerMethodArgumentResolverComposite.java:122) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.method.support.InvocableHandlerMethod.getMethodArgumentValues(InvocableHandlerMethod.java:228) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:920) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.19.jar:6.0]\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.19.jar:6.0]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n</code></pre>\n<p><strong>2:</strong>\nI'm able to correctly log the request, before deserialization, but then is giving me &quot;request body is missing&quot;</p>\n<p>Code: RequestInterceptor (request wrapped into ContentCachingRequestWrapper)</p>\n<pre><code>@Slf4j\n@Order(3)\n@Component\npublic class RequestInterceptor implements HandlerInterceptor {\n\n    @Override\n    public boolean preHandle(final HttpServletRequest request, \n                             final HttpServletResponse response,\n                             final Object handler) throws Exception {\n        ContentCachingRequestWrapper requestWrapper;\n        \n        if (request instanceof ContentCachingRequestWrapper contentCachingRequestWrapper) {\n            requestWrapper = contentCachingRequestWrapper;\n        } else {\n            requestWrapper = new ContentCachingRequestWrapper(request);\n        }\n        \n        logRequestDetails(requestWrapper);\n        return true;\n    }\n\n    @SuppressWarnings(&quot;unchecked&quot;)\n    private void logRequestDetails(ContentCachingRequestWrapper request) throws IOException {\n        String httpMethod = request.getMethod();\n        String url = request.getRequestURL().toString();\n        String queryString = request.getQueryString();\n        Map&lt;String, String&gt; pathVariables = (Map&lt;String, String&gt;) request.getAttribute(HandlerMapping.URI_TEMPLATE_VARIABLES_ATTRIBUTE);\n        String requestBody = getRequestBody(request);\n        \n        log.info(&quot;REQUEST INFO: [ (Method: {}) (URL: {}) (Query String: {}) (Path Variables: {}) ]&quot;, httpMethod, url, queryString, pathVariables);\n        log.info(&quot;REQUEST: {}&quot;, requestBody);\n    \n    }\n    \n    private String getRequestBody(HttpServletRequest request) {\n        StringBuilder stringBuilder = new StringBuilder();\n        try (BufferedReader bufferedReader = request.getReader()) {\n            String line;\n            while ((line = bufferedReader.readLine()) != null) {\n                stringBuilder.append(line);\n            }\n        } catch (IOException e) {\n            return &quot;[Error Reading Body]&quot;;\n        }\n        return stringBuilder.toString();\n    }\n    \n}\n</code></pre>\n<p>Logs: HttpMessageNotReadableException: Required request body is missing</p>\n<pre><code>2024-07-10 00:35:34.738 | http-nio-9001-exec-2 | INFO  | i.g.p.dav.adap.inbou.rest.interceptor.RequestInterceptor | 176cc195-73ec-4921-8d84-5d50f5853cf6 | 5d3d84a5-5330-4608-bc6b-e90916543c94 | REQUEST INFO: [ (Method: POST) (URL: http://localhost:9001/api/account/passengers/associate-passengers) (Query String: null) (Path Variables: {}) ]\n2024-07-10 00:35:34.738 | http-nio-9001-exec-2 | INFO  | i.g.p.dav.adap.inbou.rest.interceptor.RequestInterceptor | 176cc195-73ec-4921-8d84-5d50f5853cf6 | 5d3d84a5-5330-4608-bc6b-e90916543c94 | REQUEST: [  {    &quot;accountId&quot;: 100,    &quot;firstName&quot;: &quot;David&quot;,    &quot;lastName&quot;: &quot;Guetta&quot;,    &quot;dateOfBirth&quot;: &quot;1967-11-07&quot;,    &quot;nationalityId&quot;: 63,    &quot;email&quot;: &quot;davidguetta@gmail.com&quot;,    &quot;phoneNumber&quot;: &quot;+33 3334448899&quot;  }]\n2024-07-10 00:35:34.758 | http-nio-9001-exec-2 | ERROR | i.g.p.coa.rese.adapt.inbound.controller.rest.ExceptionRestController | 176cc195-73ec-4921-8d84-5d50f5853cf6 | 5d3d84a5-5330-4608-bc6b-e90916543c94 | Exception 6e9a77ed-24bf-438d-934c-4c7981c6bb70\norg.springframework.http.converter.HttpMessageNotReadableException: Required request body is missing: public io.github.paulmarcelinbejan.davinci.adapters.api.DavinciApiResponse&lt;java.util.List&lt;io.github.paulmarcelinbejan.coandaairlines.reservationsystem.ports.domain.Passenger&gt;&gt; io.github.paulmarcelinbejan.coandaairlines.reservationsystem.adapters.inbound.controller.rest.PassengerRestController.associatePassengers(java.util.List&lt;io.github.paulmarcelinbejan.coandaairlines.reservationsystem.adapters.inbound.dto.request.PassengerRequest&gt;)\n    at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.readWithMessageConverters(RequestResponseBodyMethodProcessor.java:162) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.resolveArgument(RequestResponseBodyMethodProcessor.java:134) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.method.support.HandlerMethodArgumentResolverComposite.resolveArgument(HandlerMethodArgumentResolverComposite.java:122) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.method.support.InvocableHandlerMethod.getMethodArgumentValues(InvocableHandlerMethod.java:228) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:920) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.19.jar:6.0]\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.1.4.jar:6.1.4]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.19.jar:6.0]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.4.jar:6.1.4]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.19.jar:10.1.19]\n</code></pre>\n<p><strong>3:</strong> Using LoggingFilterBean I'm able to log the request, but it is logged at the end of the api, and not when the api is invoked, and moreover, the 2 ids from MappedDiagnosticContext (<code>| 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a |</code>) written by the interceptors are not logged.</p>\n<p>Code: LoggingFilterBean</p>\n<pre><code>@Slf4j\n@Component\npublic class LoggingFilterBean extends GenericFilterBean {\n\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {\n        ContentCachingRequestWrapper requestWrapper = requestWrapper(request);\n        ContentCachingResponseWrapper responseWrapper = responseWrapper(response);\n        \n        chain.doFilter(requestWrapper, responseWrapper);\n        \n        logRequest(requestWrapper);\n        logResponse(responseWrapper);\n    }\n\n    private void logRequest(ContentCachingRequestWrapper request) {\n        StringBuilder builder = new StringBuilder();\n        final String jsonRequest = new String(request.getContentAsByteArray());\n        builder.append(jsonRequest);\n        log.info(&quot;Request: {}&quot;, builder);\n    }\n\n    private void logResponse(ContentCachingResponseWrapper response) throws IOException {\n        StringBuilder builder = new StringBuilder();\n        builder.append(new String(response.getContentAsByteArray()));\n        log.info(&quot;Response: {}&quot;, builder);\n        response.copyBodyToResponse();\n    }\n\n    private ContentCachingRequestWrapper requestWrapper(ServletRequest request) {\n        if (request instanceof ContentCachingRequestWrapper requestWrapper) {\n            return requestWrapper;\n        }\n        return new ContentCachingRequestWrapper((HttpServletRequest) request);\n    }\n\n    private ContentCachingResponseWrapper responseWrapper(ServletResponse response) {\n        if (response instanceof ContentCachingResponseWrapper responseWrapper) {\n            return responseWrapper;\n        }\n        return new ContentCachingResponseWrapper((HttpServletResponse) response);\n    }\n    \n}\n</code></pre>\n<p>Logs:</p>\n<pre><code>2024-07-10 01:00:21.665 | http-nio-9001-exec-1 | INFO  | i.g.p.dav.adap.inbou.rest.interceptor.RequestInterceptor | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | REQUEST INFO: [ (Method: POST) (URL: http://localhost:9001/api/account/passengers/associate-passengers) (Query String: null) (Path Variables: {}) ]\n2024-07-10 01:00:21.745 | http-nio-9001-exec-1 | DEBUG | o.h.SQL | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | select nextval('id_passenger_seq')\n2024-07-10 01:00:21.768 | http-nio-9001-exec-1 | DEBUG | o.h.SQL | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | insert into passenger (fk_account,date_of_birth,email,first_name,is_primary,last_name,fk_nationality,phone_number,id_passenger) values (?,?,?,?,?,?,?,?,?)\n2024-07-10 01:00:21.770 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | binding parameter (1:BIGINT) &lt;- [9]\n2024-07-10 01:00:21.771 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | binding parameter (2:VARCHAR) &lt;- [1967-11-07]\n2024-07-10 01:00:21.771 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | binding parameter (3:VARCHAR) &lt;- [davidguetta@gmail.com]\n2024-07-10 01:00:21.771 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | binding parameter (4:VARCHAR) &lt;- [David]\n2024-07-10 01:00:21.771 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | binding parameter (5:BOOLEAN) &lt;- [false]\n2024-07-10 01:00:21.771 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | binding parameter (6:VARCHAR) &lt;- [Guetta]\n2024-07-10 01:00:21.771 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | binding parameter (7:INTEGER) &lt;- [63]\n2024-07-10 01:00:21.771 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | binding parameter (8:VARCHAR) &lt;- [+33 3334448899]\n2024-07-10 01:00:21.771 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 99d30bc4-4102-482a-a78e-614f2c0f5876 | 31b3b078-737f-4c60-a429-0596a0736b7a | binding parameter (9:BIGINT) &lt;- [23]\n2024-07-10 01:00:21.797 | http-nio-9001-exec-1 | INFO  | i.g.p.dav.adap.inbou.rest.filter.LoggingFilterBean |  |  | Request: [\n  {\n    &quot;accountId&quot;: 9,\n    &quot;firstName&quot;: &quot;David&quot;,\n    &quot;lastName&quot;: &quot;Guetta&quot;,\n    &quot;dateOfBirth&quot;: &quot;1967-11-07&quot;,\n    &quot;nationalityId&quot;: 63,\n    &quot;email&quot;: &quot;davidguetta@gmail.com&quot;,\n    &quot;phoneNumber&quot;: &quot;+33 3334448899&quot;\n  }\n]\n2024-07-10 01:00:21.797 | http-nio-9001-exec-1 | INFO  | i.g.p.dav.adap.inbou.rest.filter.LoggingFilterBean |  |  | Response: {&quot;status&quot;:&quot;OK&quot;,&quot;response&quot;:[{&quot;id&quot;:23,&quot;accountId&quot;:9,&quot;isPrimary&quot;:false,&quot;firstName&quot;:&quot;David&quot;,&quot;lastName&quot;:&quot;Guetta&quot;,&quot;dateOfBirth&quot;:&quot;1967-11-07&quot;,&quot;nationalityId&quot;:63,&quot;email&quot;:&quot;davidguetta@gmail.com&quot;,&quot;phoneNumber&quot;:&quot;+33 3334448899&quot;}]}\n</code></pre>\n<hr />\n<p>One solution in order to be able to log before the API is invoked and without having exceptions is by using a ControllerAdvice:</p>\n<p><strong>4:</strong> The request is already deserialized, so in order to log the json as string I have to serialize the request.</p>\n<p>Code: RequestBodyControllerAdvice</p>\n<pre><code>@Slf4j\n@ControllerAdvice\n@RequiredArgsConstructor\npublic class RequestBodyControllerAdvice extends RequestBodyAdviceAdapter {\n    \n    private final HttpServletRequest httpServletRequest;\n    \n    @Override\n    public boolean supports(MethodParameter methodParameter, Type type, \n                            Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass) {\n        return true;\n    }\n    \n    @Override\n    public Object afterBodyRead(Object body, HttpInputMessage inputMessage,\n                                MethodParameter parameter, Type targetType,\n            Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType) {\n        \n        String json;\n\n        if (body instanceof JsonSerializer object) {\n            json = object.toJSON();\n        } else {\n            try {\n                json = OBJECT_MAPPER.writeValueAsString(body);\n            } catch (JsonProcessingException e) {\n                throw new RuntimeException(e);\n            }\n        }\n        \n        log.info(&quot;REQUEST: {}&quot;, json);\n        \n        return super.afterBodyRead(body, inputMessage, parameter, targetType, converterType);\n    }\n    \n    private static final ObjectMapper OBJECT_MAPPER = new ObjectMapper();\n    \n}\n</code></pre>\n<p>Logs:</p>\n<pre><code>2024-07-10 01:31:55.879 | http-nio-9001-exec-1 | INFO  | i.g.p.dav.adap.inbou.rest.interceptor.RequestInterceptor | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | REQUEST INFO: [ (Method: POST) (URL: http://localhost:9001/api/account/passengers/associate-passengers) (Query String: null) (Path Variables: {}) ]\n2024-07-10 01:31:55.902 | http-nio-9001-exec-1 | INFO  | i.g.p.dav.adap.inbou.rest.filter.RequestBodyControllerAdvice | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | REQUEST: [{&quot;accountId&quot;:9,&quot;firstName&quot;:&quot;David&quot;,&quot;lastName&quot;:&quot;Guetta&quot;,&quot;dateOfBirth&quot;:&quot;1967-11-07&quot;,&quot;nationalityId&quot;:63,&quot;email&quot;:&quot;davidguetta@gmail.com&quot;,&quot;phoneNumber&quot;:&quot;+33 3334448899&quot;}]\n2024-07-10 01:31:55.966 | http-nio-9001-exec-1 | DEBUG | o.h.SQL | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | select nextval('id_passenger_seq')\n2024-07-10 01:31:55.988 | http-nio-9001-exec-1 | DEBUG | o.h.SQL | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | insert into passenger (fk_account,date_of_birth,email,first_name,is_primary,last_name,fk_nationality,phone_number,id_passenger) values (?,?,?,?,?,?,?,?,?)\n2024-07-10 01:31:55.989 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | binding parameter (1:BIGINT) &lt;- [9]\n2024-07-10 01:31:55.990 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | binding parameter (2:VARCHAR) &lt;- [1967-11-07]\n2024-07-10 01:31:55.990 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | binding parameter (3:VARCHAR) &lt;- [davidguetta@gmail.com]\n2024-07-10 01:31:55.990 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | binding parameter (4:VARCHAR) &lt;- [David]\n2024-07-10 01:31:55.990 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | binding parameter (5:BOOLEAN) &lt;- [false]\n2024-07-10 01:31:55.990 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | binding parameter (6:VARCHAR) &lt;- [Guetta]\n2024-07-10 01:31:55.990 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | binding parameter (7:INTEGER) &lt;- [63]\n2024-07-10 01:31:55.990 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | binding parameter (8:VARCHAR) &lt;- [+33 3334448899]\n2024-07-10 01:31:55.990 | http-nio-9001-exec-1 | TRACE | o.h.o.jdb.bind | 0137fbd6-a64c-4b7c-9930-4225a6651051 | 7ed2fa14-ffcf-468e-82ff-a7f5a5bfddae | binding parameter (9:BIGINT) &lt;- [25]\n</code></pre>\n<p>I'm looking for a solution to:</p>\n<ol>\n<li>Log at the beginning before entering into rest controller method</li>\n<li>Log the json request without having to serialize the request object which it has just beeing deserialized by spring.</li>\n</ol>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}