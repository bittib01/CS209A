{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "hibernate",
      "jpa",
      "orm"
    ],
    "owner": {
      "account_id": 24893102,
      "reputation": 177,
      "user_id": 18764743,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/f5F3VvM6.jpg?s=256",
      "display_name": "Diallo Francis Patrick",
      "link": "https://stackoverflow.com/users/18764743/diallo-francis-patrick"
    },
    "is_answered": true,
    "view_count": 76,
    "accepted_answer_id": 78468830,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1719123701,
    "creation_date": 1715265196,
    "last_edit_date": 1719123701,
    "question_id": 78455156,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78455156/hibernate-jpa-how-to-properly-model-unidirectional-manytomany-relationship-for",
    "title": "Hibernate/JPA: How to properly model unidirectional @ManyToMany relationship for CRUD operations?",
    "body": "<p>I have implemented the following entities:</p>\n<p>Teacher:</p>\n<pre><code>@Getter\n@Setter\n@ToString\n@Entity\n@Builder\n@AllArgsConstructor\n@NoArgsConstructor\npublic class Teacher {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(name = &quot;id&quot;, nullable = false, updatable = false)\n    private Long id;\n    private String name;\n    @ManyToMany(cascade = CascadeType.MERGE)\n    @JoinTable(\n            name = &quot;teacher_timeslot&quot;,\n            joinColumns = @JoinColumn(name = &quot;teacher_id&quot;),\n            inverseJoinColumns = @JoinColumn(name = &quot;timeslot_id&quot;)\n    )\n    @ToString.Exclude\n    private Set&lt;Timeslot&gt; timeslots = new HashSet&lt;&gt;(); //teacher preferred timeslots\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (o == null || Hibernate.getClass(this) != Hibernate.getClass(o)) return false;\n        Teacher teacher = (Teacher) o;\n        return id != null &amp;&amp; Objects.equals(id, teacher.id);\n    }\n\n    @Override\n    public int hashCode() {\n        return getClass().hashCode();\n    }\n}\n</code></pre>\n<p>Timeslot:</p>\n<pre><code>//ignore the JsonIdentity as I need it to another class (Timetable to be more specific)\n@JsonIdentityInfo(scope = Timeslot.class, generator = ObjectIdGenerators.PropertyGenerator.class, property = &quot;id&quot;)\n@Getter\n@Setter\n@ToString\n//@RequiredArgsConstructor\n@Entity\n@Builder\n@AllArgsConstructor\n@NoArgsConstructor\npublic class Timeslot{\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(name = &quot;id&quot;, nullable = false, updatable = false)\n    @PlanningId\n    private Long id;\n    private DayOfWeek dayOfWeek;\n    private LocalTime startTime;\n    private LocalTime endTime;\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (o == null || Hibernate.getClass(this) != Hibernate.getClass(o)) return false;\n        Timeslot timeslot = (Timeslot) o;\n        return id != null &amp;&amp; Objects.equals(id, timeslot.id);\n    }\n\n    @Override\n    public int hashCode() {\n        return getClass().hashCode();\n    }\n}\n</code></pre>\n<p>And those are the following JSON payload that I am using for saving/get a Teacher or Timeslot:</p>\n<p>Save Timeslot:</p>\n<pre><code>{&quot;id&quot;:3,&quot;dayOfWeek&quot;:&quot;MONDAY&quot;,&quot;startTime&quot;:&quot;14:00:00&quot;,&quot;endTime&quot;:&quot;16:00:00&quot;}\n</code></pre>\n<p>Get Timeslots:</p>\n<pre><code>[\n    {\n        &quot;id&quot;: 1,\n        &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n        &quot;startTime&quot;: &quot;10:00:00&quot;,\n        &quot;endTime&quot;: &quot;12:00:00&quot;\n    },\n    {\n        &quot;id&quot;: 2,\n        &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n        &quot;startTime&quot;: &quot;12:00:00&quot;,\n        &quot;endTime&quot;: &quot;14:00:00&quot;\n    },\n    {\n        &quot;id&quot;: 3,\n        &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n        &quot;startTime&quot;: &quot;14:00:00&quot;,\n        &quot;endTime&quot;: &quot;16:00:00&quot;\n    }\n]\n</code></pre>\n<p>Save/Get Teacher:</p>\n<pre><code>([){\n    &quot;id&quot;: 1,\n    &quot;name&quot;: &quot;Ben&quot;,\n    &quot;timeslots&quot;: [\n        {\n            &quot;id&quot;: 1,\n            &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n            &quot;startTime&quot;: &quot;10:00:00&quot;,\n            &quot;endTime&quot;: &quot;12:00:00&quot;\n        },\n        {\n            &quot;id&quot;: 2,\n            &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n            &quot;startTime&quot;: &quot;12:00:00&quot;,\n            &quot;endTime&quot;: &quot;14:00:00&quot;\n        }\n    ]\n}(])\n</code></pre>\n<p>If I want to add another Teacher:</p>\n<pre><code>{\n    &quot;id&quot;: 2,\n    &quot;name&quot;: &quot;Alex&quot;,\n    &quot;timeslots&quot;: [\n        {\n            &quot;id&quot;: 2,\n            &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n            &quot;startTime&quot;: &quot;12:00:00&quot;,\n            &quot;endTime&quot;: &quot;14:00:00&quot;\n        },\n        {\n            &quot;id&quot;: 3,\n            &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n            &quot;startTime&quot;: &quot;14:00:00&quot;,\n            &quot;endTime&quot;: &quot;16:00:00&quot;\n        }\n    ]\n}\n</code></pre>\n<p>And I perform a getAllTeachers() request I receive the following:</p>\n<pre><code>[\n    {\n        &quot;id&quot;: 1,\n        &quot;name&quot;: &quot;Ben&quot;,\n        &quot;timeslots&quot;: [\n            {\n                &quot;id&quot;: 1,\n                &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n                &quot;startTime&quot;: &quot;10:00:00&quot;,\n                &quot;endTime&quot;: &quot;12:00:00&quot;\n            },\n            {\n                &quot;id&quot;: 2,\n                &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n                &quot;startTime&quot;: &quot;12:00:00&quot;,\n                &quot;endTime&quot;: &quot;14:00:00&quot;\n            }\n        ]\n    },\n    {\n        &quot;id&quot;: 2,\n        &quot;name&quot;: &quot;Alex&quot;,\n        &quot;timeslots&quot;: [\n            2, // the problem\n            {\n                &quot;id&quot;: 3,\n                &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n                &quot;startTime&quot;: &quot;14:00:00&quot;,\n                &quot;endTime&quot;: &quot;16:00:00&quot;\n            }\n        ]\n    }\n]\n</code></pre>\n<p>instead of:</p>\n<pre><code>[\n    {\n        &quot;id&quot;: 1,\n        &quot;name&quot;: &quot;Ben&quot;,\n        &quot;timeslots&quot;: [\n            {\n                &quot;id&quot;: 1,\n                &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n                &quot;startTime&quot;: &quot;10:00:00&quot;,\n                &quot;endTime&quot;: &quot;12:00:00&quot;\n            },\n            {\n                &quot;id&quot;: 2,\n                &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n                &quot;startTime&quot;: &quot;12:00:00&quot;,\n                &quot;endTime&quot;: &quot;14:00:00&quot;\n            }\n        ]\n    },\n    {\n        &quot;id&quot;: 2,\n        &quot;name&quot;: &quot;Alex&quot;,\n        &quot;timeslots&quot;: [\n            {\n                &quot;id&quot;: 2,\n                &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n                &quot;startTime&quot;: &quot;12:00:00&quot;,\n                &quot;endTime&quot;: &quot;14:00:00&quot;\n            },\n            {\n                &quot;id&quot;: 3,\n                &quot;dayOfWeek&quot;: &quot;MONDAY&quot;,\n                &quot;startTime&quot;: &quot;14:00:00&quot;,\n                &quot;endTime&quot;: &quot;16:00:00&quot;\n            }\n        ]\n    }\n]\n</code></pre>\n<p>How can I solve this issue? What am I missing here?\nBasically, I want to replicate the following sequence of code while ensuring the CRUD functionality:</p>\n<pre><code>Timeslot wednesday12to14 = new Timeslot(nextTimeslotId++, DayOfWeek.WEDNESDAY, LocalTime.of(12, 0), LocalTime.of(14, 0));\nTeacher ben =  new Teacher(nextTeacherId++, &quot;Ben&quot;, List.of(tuesday12to14, tuesday14to16,\n            tuesday16to18, tuesday18to20, tuesday20to22, wednesday12to14, wednesday14to16, wednesday18to20, wednesday20to22));\n</code></pre>\n<p>Any help will be appreciated! Feel free to edit if I didn't formulate the question correctly.</p>\n<h4>UPDATE</h4>\n<p>I tried to following things:</p>\n<ol>\n<li>Removed the cascade and added FetchType.Eager from @ManyToMany annotation</li>\n<li>Removed the cascade and the fetch type from @ManyToMany annotation</li>\n<li>I also tried to add jakarta @Transactional annotation on the Service for create and read methods.</li>\n</ol>\n<p>None of them works.</p>\n<p>This is my Teacher Service implementation:</p>\n<pre><code>@Service\n@RequiredArgsConstructor\n@Slf4j\npublic class TeacherService {\n\n    private final TeacherRepo teacherRepo;\n\n    public List&lt;Teacher&gt; getAllTeachers() {\n        return teacherRepo.findAllByOrderByIdAsc();\n    }\n\n    public Teacher createTeacher(Teacher teacher) {\n        return teacherRepo.save(teacher);\n    }\n\n    //update and delete methods\n\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}