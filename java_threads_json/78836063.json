{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "multithreading",
      "kotlin",
      "virtual-threads"
    ],
    "owner": {
      "account_id": 4736203,
      "reputation": 777,
      "user_id": 3830531,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/323ff6fbd6902a32fe8e580a149a2e8c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Heits",
      "link": "https://stackoverflow.com/users/3830531/heits"
    },
    "is_answered": true,
    "view_count": 1288,
    "accepted_answer_id": 78836771,
    "answer_count": 1,
    "score": 4,
    "last_activity_date": 1760480608,
    "creation_date": 1722884679,
    "question_id": 78836063,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78836063/cannot-limit-the-concurrency-of-servlet-requests-using-spring-boot-virtual-threa",
    "title": "Cannot limit the concurrency of servlet requests using Spring Boot virtual threads with Tomcat",
    "body": "<p>I am updating a Kotlin (v1.9.25) Spring Boot (v3.3.1) project from Java 17 to Java 21 in order to enable Virtual Threads.</p>\n<p>In our service, almost all requests acquire one database connection and hold to it for the whole request, while some very specific ones require more than one. To avoid database connection starvation, we set the maximum number of database connections to be just a little above the maximum concurrent requests.</p>\n<pre><code>spring.threads.virtual.enabled: true\nspring.datasource.hikari.maximum-pool-size: 50\nserver.tomcat.threads.max: 4 # used to be 45 before virtual threads \n</code></pre>\n<p>Up to now, we control maximum concurrent requests by means of <code>server.tomcat.threads.max</code>, but with virtual threads it all changes: the idea, as far as I understand, is to have a executor receiving an unlimited amount of tasks, so no limits here.</p>\n<p>That leaves me to my question: <strong>how can I limit the maximum number of concurrent connections on my service while using virtual threads?</strong></p>\n<p>I thought of implementing a semaphore but something seems to be off with this approach, I though that it would be configurable.</p>\n<p>Thank you very much!</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}