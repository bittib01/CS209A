{
  "question": {
    "tags": [
      "java",
      "javafx",
      "x11",
      "jna"
    ],
    "owner": {
      "account_id": 34599290,
      "reputation": 1188,
      "user_id": 26656564,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/882f996623517814360ba4bb403102e7?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "SilverCube",
      "link": "https://stackoverflow.com/users/26656564/silvercube"
    },
    "is_answered": true,
    "view_count": 272,
    "accepted_answer_id": 79225438,
    "answer_count": 2,
    "score": 2,
    "last_activity_date": 1732599420,
    "creation_date": 1731762656,
    "last_edit_date": 1732009824,
    "question_id": 79195216,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79195216/how-to-make-transparent-javafx-stage-transparent-for-mouse-events-for-linux-x11",
    "title": "How to make transparent JavaFX stage transparent for mouse events for Linux X11?",
    "body": "<p>I have a transparent stage and I need when user click inside this stage then mouse event to be passed to a window that is behind my JavaFX stage (for example, if there is a text editor behind my stage then mouse event should be passed to that editor window). By other words I need the Stage to be transparent for mouse events.</p>\n<p>This is my code:</p>\n<pre><code>public class Test12 extends Application {\n\n    @Override\n    public void start(Stage primaryStage) {\n        var vBox = new VBox();\n        vBox.setStyle(&quot;-fx-border-width: 1; -fx-border-color: black&quot;);\n        vBox.setMouseTransparent(true);\n        var scene = new Scene(vBox, 400, 300);\n        scene.setFill(Color.TRANSPARENT);\n        scene.getStylesheets().add(this.getClass().getResource(&quot;test.css&quot;).toExternalForm());\n        primaryStage.initStyle(StageStyle.TRANSPARENT);\n        primaryStage.setScene(scene);\n        primaryStage.show();\n        primaryStage.setAlwaysOnTop(true);\n\n    }\n\n    public static void main(String[] args) {\n        launch(args);\n    }\n}\n</code></pre>\n<p>CSS</p>\n<pre><code>.root { -fx-background-color: transparent; }\n</code></pre>\n<p>Could anyone say how to do it, if it is possible.</p>\n<p><strong>UPDATE</strong><br>\nThis is a C program that makes the right half of the window transparent for mouse events (use <code>gcc -o program program.c -lX11 -lXext</code>):</p>\n<pre><code>#include &lt;X11/Xlib.h&gt;\n#include &lt;X11/Xutil.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;X11/extensions/shape.h&gt;\n\n/* ----------------------------------------------------------------------------------------------- */\n#define _NET_WM_STATE_REMOVE        0    // remove/unset property\n#define _NET_WM_STATE_ADD           1    // add/set property\n#define _NET_WM_STATE_TOGGLE        2    // toggle property\n\nBool makeAlwaysOnTop(Display* display,  Window mywin) {\n    int screen = DefaultScreen(display);\n    Window root = RootWindow(display, screen);\n    Atom wmStateAbove = XInternAtom( display, &quot;_NET_WM_STATE_ABOVE&quot;, 1 );\n    if( wmStateAbove != None ) {\n        printf( &quot;_NET_WM_STATE_ABOVE has atom of %ld\\n&quot;, (long)wmStateAbove );\n    } else {\n        printf( &quot;ERROR: cannot find atom for _NET_WM_STATE_ABOVE !\\n&quot; );\n        return False;\n    }\n\n    Atom wmNetWmState = XInternAtom( display, &quot;_NET_WM_STATE&quot;, 1 );\n    if( wmNetWmState != None ) {\n        printf( &quot;_NET_WM_STATE has atom of %ld\\n&quot;, (long)wmNetWmState );\n    } else {\n        printf( &quot;ERROR: cannot find atom for _NET_WM_STATE !\\n&quot; );\n        return False;\n    }\n\n    if( wmStateAbove != None )\n    {\n        XClientMessageEvent xclient;\n        memset( &amp;xclient, 0, sizeof (xclient) );\n        xclient.type = ClientMessage;\n        xclient.window = mywin;\n        xclient.message_type = wmNetWmState;\n        xclient.format = 32;\n        xclient.data.l[0] = _NET_WM_STATE_ADD;\n        xclient.data.l[1] = wmStateAbove;\n        xclient.data.l[2] = 0;\n        xclient.data.l[3] = 0;\n        xclient.data.l[4] = 0;\n        XSendEvent( display,\n          root,\n          False,\n          SubstructureRedirectMask | SubstructureNotifyMask,\n          (XEvent *)&amp;xclient );\n        XFlush(display);\n        return True;\n    }\n    return False;\n}\n\n/* ----------------------------------------------------------------------------------------------- */\n\nvoid makeHalfTransparent(Display* dpy,  Window win) {\n    Pixmap shape = XCreatePixmap(dpy, win, 400, 300, 1);\n    GC gc = XCreateGC(dpy, shape, 0, NULL);\n    XSetFillStyle(dpy, gc, FillSolid);\n    XSetForeground(dpy, gc, 0);\n    XFillRectangle(dpy, shape, gc, 0, 0, 400, 300);\n    XSetForeground(dpy, gc, 1);\n    XFillRectangle(dpy, shape, gc, 0, 0, 200, 300);\n    XShapeCombineMask(dpy, win, ShapeBounding, 0, 0, shape, ShapeSet);\n    XFreeGC(dpy, gc);\n}\n\n/* ----------------------------------------------------------------------------------------------- */\n\nint main() {\n    Display *dpy;\n    Window win;\n\n    XEvent event;\n    int screen;\n\n    dpy = XOpenDisplay(NULL);\n    if (dpy == NULL) {\n        fprintf(stderr, &quot;Cannot open display\\n&quot;);\n        return 1;\n    }\n\n    screen = DefaultScreen(dpy);\n    win = XCreateSimpleWindow(dpy, RootWindow(dpy, screen), 10, 10, 400, 300, 1, BlackPixel(dpy, screen), WhitePixel(dpy, screen));\n    XSelectInput(dpy, win, ExposureMask | KeyPressMask);\n\n    XMapWindow(dpy, win);\n    makeAlwaysOnTop(dpy, win);\n    makeHalfTransparent(dpy, win);\n\n    while (1) {\n        XNextEvent(dpy, &amp;event);\n        if (event.type == KeyPress) {\n            break;\n        }\n    }\n\n    XDestroyWindow(dpy, win);\n    XCloseDisplay(dpy);\n    return 0;\n}\n</code></pre>\n<p>This is my JavaFX application that using JNA must make the right half of the window transparent for mouse events (by other words I ported <code>makeHalfTransparent</code> function from C to Java):</p>\n<pre><code>import com.sun.jna.Library;\nimport com.sun.jna.Native;\nimport com.sun.jna.Pointer;\nimport com.sun.jna.platform.unix.X11;\nimport com.sun.jna.ptr.PointerByReference;\nimport java.lang.reflect.Method;\nimport javafx.application.Application;\nimport static javafx.application.Application.launch;\nimport javafx.scene.Scene;\nimport javafx.scene.control.Button;\nimport javafx.scene.layout.HBox;\nimport javafx.scene.layout.Priority;\nimport javafx.scene.layout.VBox;\nimport javafx.scene.paint.Color;\nimport javafx.stage.Stage;\nimport javafx.stage.Window;\nimport javafx.stage.StageStyle;\n\n\npublic class JavaFxTest10 extends Application {\n\n    public static interface CustomX11 extends Library {\n\n        CustomX11 INSTANCE = (CustomX11) Native.load(&quot;X11&quot;, CustomX11.class);\n\n        X11.Display XOpenDisplay(String display_name);\n\n        int XFreeGC(X11.Display display, X11.GC gc);\n\n        void XSetForeground(X11.Display display, X11.GC gc, int foreground);\n\n        X11.Pixmap XCreatePixmap(X11.Display display, X11.Window w, int width, int height, int depth);\n\n        void XFillRectangle(X11.Display display, X11.Pixmap drawable, X11.GC gc, int x, int y, int width, int height);\n\n        X11.GC XCreateGC(X11.Display display, X11.Pixmap drawable, int valuemask, X11.XGCValues values);\n\n        void XFreePixmap(X11.Display display, X11.Pixmap pixmap);\n\n        int XFetchName(X11.Display display, Window w, PointerByReference windowName);\n\n        X11.Window XDefaultRootWindow(X11.Display display);\n\n        X11.Window XCreateSimpleWindow(X11.Display display, X11.Window rootWindow, int a, int b, int c, int d, int e, int h, int g);\n\n        X11.Atom XInternAtom(X11.Display display, String atom_name, boolean only_if_exists);\n\n        void XChangeProperty(X11.Display display, X11.Window window, X11.Atom property, X11.Atom type, int format, int mode, Pointer data, int nelements);\n\n        void XSetFillStyle(X11.Display display, X11.GC gc, int fillStyle);\n\n        void XFillRectangle(X11.Display display, X11.Drawable drawable, X11.GC gc, int x, int y, int width, int height);\n    }\n\n    public interface Xext extends Library {\n\n       Xext INSTANCE = Native.load(&quot;Xext&quot;, Xext.class);\n\n       void XShapeCombineMask(X11.Display display, X11.Window w, int shapeOp, int x, int y, X11.Pixmap shape, int shapeKind);\n    }\n\n    @Override\n    public void start(Stage primaryStage) {\n        var button = new Button(&quot;Push Me&quot;);\n        button.setOnAction(e -&gt; {\n            var p = getWIndowPoiter(primaryStage);\n            var window = getWindow(p);\n            printWindowTitle(window);//checking pointer\n            makeHalfTransparent(window, (int) primaryStage.getWidth(), (int) primaryStage.getHeight());\n        });\n        var hBox = new HBox(button);\n        hBox.setStyle(&quot;-fx-background-color: green&quot;);\n        var content = new VBox();\n        content.setMouseTransparent(true);\n        VBox.setVgrow(content, Priority.ALWAYS);\n\n        var mainBox = new VBox(hBox, content);\n        mainBox.setStyle(&quot;-fx-border-width: 1; -fx-border-color: black&quot;);\n        var scene = new Scene(mainBox, 400, 300);\n        scene.setFill(Color.TRANSPARENT);\n        scene.getStylesheets().add(this.getClass().getResource(&quot;test.css&quot;).toExternalForm());\n        primaryStage.initStyle(StageStyle.TRANSPARENT);\n        primaryStage.setScene(scene);\n        primaryStage.show();\n        primaryStage.setAlwaysOnTop(true);\n        primaryStage.setTitle(&quot;JafaFX Window 777&quot;);\n    }\n\n    private Pointer getWIndowPoiter(Stage stage) {\n        try {\n            final Method getPeer = Window.class.getDeclaredMethod(&quot;getPeer&quot;, null);\n            getPeer.setAccessible(true);\n            final Object tkStage = getPeer.invoke(stage);\n            final Method getRawHandle = tkStage.getClass().getMethod(&quot;getRawHandle&quot;);\n            getRawHandle.setAccessible(true);\n            var l = (Long) getRawHandle.invoke(tkStage);\n            final Pointer pointer = new Pointer(l);\n            System.out.println(pointer);\n            return pointer;\n        } catch (Exception ex) {\n            System.out.println(ex.getMessage());\n            ex.printStackTrace();\n            return null;\n        }\n    }\n\n    private X11.Window getWindow( Pointer windowPointer) {\n        X11.Window window = new X11.Window(Pointer.nativeValue(windowPointer));\n        return window;\n    }\n\n    private void printWindowTitle(X11.Window window) {\n        final X11 x11 = X11.INSTANCE;\n        X11.Display display = x11.XOpenDisplay(null);\n        PointerByReference windowNameReference = new PointerByReference();\n        int status = X11.INSTANCE.XFetchName(display, window, windowNameReference);\n\n        if (status == 1) {\n            Pointer windowNamePointer = windowNameReference.getValue();\n            String windowTitle = windowNamePointer.getString(0);\n            System.out.println(&quot;Window Title: &quot; + windowTitle);\n        } else {\n            System.out.println(&quot;Failed to fetch window name.&quot;);\n        }\n    }\n\n    public static final int FillSolid = 0;\n    public static final int ShapeBounding = 0;\n    public static final int ShapeSet = 0;\n\n    private void makeHalfTransparent(X11.Window win, int width, int height) {\n        X11.Display display = CustomX11.INSTANCE.XOpenDisplay(null);\n        //Pixmap shape = XCreatePixmap(dpy, win, 400, 300, 1);\n        X11.Pixmap shape = CustomX11.INSTANCE.XCreatePixmap(display, win, width, height, 1);\n        //GC gc = XCreateGC(dpy, shape, 0, NULL);\n        X11.GC gc2 = CustomX11.INSTANCE.XCreateGC(display, shape, 0, null);\n        //XSetFillStyle(dpy, gc, FillSolid);\n        CustomX11.INSTANCE.XSetFillStyle(display, gc2, FillSolid);\n        //XSetForeground(dpy, gc, 0);\n        CustomX11.INSTANCE.XSetForeground(display, gc2, 0);\n        //XFillRectangle(dpy, shape, gc, 0, 0, 400, 300);\n        CustomX11.INSTANCE.XFillRectangle(display, shape, gc2, 0, 0, width, height);\n        //XSetForeground(dpy, gc, 1);\n        CustomX11.INSTANCE.XSetForeground(display, gc2, 1);\n        //XFillRectangle(dpy, shape, gc, 0, 0, 200, 300);\n        CustomX11.INSTANCE.XFillRectangle(display, shape, gc2, 0, 0, width / 2, height);\n        //XShapeCombineMask(dpy, win, ShapeBounding, 0, 0, shape, ShapeSet);\n        Xext.INSTANCE.XShapeCombineMask(display, win, ShapeBounding, 0, 0, shape, ShapeSet);\n        //XFreeGC(dpy, gc);\n        CustomX11.INSTANCE.XFreeGC(display, gc2);\n    }\n\n    public static void main(String[] args) {\n        launch(args);\n    }\n}\n</code></pre>\n<p>But it doesn't work in JavaFX. Could anyone help me to make JavaFX window transparent for mouse events for Linux X11?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}