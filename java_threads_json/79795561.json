{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-boot-security",
      "spring-webmvc"
    ],
    "owner": {
      "account_id": 426759,
      "reputation": 12702,
      "user_id": 808151,
      "user_type": "registered",
      "accept_rate": 91,
      "profile_image": "https://www.gravatar.com/avatar/8a5d431123d4563c74f239c50213bdff?s=256&d=identicon&r=PG",
      "display_name": "Tim Meyer",
      "link": "https://stackoverflow.com/users/808151/tim-meyer"
    },
    "is_answered": true,
    "view_count": 70,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1761050521,
    "creation_date": 1761032580,
    "last_edit_date": 1761043974,
    "question_id": 79795561,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79795561/request-mapping-no-longer-works-with-spring-boot-starter-oauth2-resource-server",
    "title": "Request mapping no longer works with spring-boot-starter-oauth2-resource-server",
    "body": "<p>I'm developing a service which is used in different contexts, some of which require web security, and others don't.</p>\n<p>I therefore added</p>\n<pre class=\"lang-xml prettyprint-override\"><code>        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;\n            &lt;version&gt;6.5.5&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n</code></pre>\n<p>to my pom.xml and wrote a configuration class with a <code>SecurityFilterChain</code> @Bean which works as follows:</p>\n<ul>\n<li>CSRF protection is disabled in any case (stateless resource server)</li>\n<li>If web security is enabled, I'm setting up <code>httpSecurity.oauth2ResourceServer</code> and <code>http.authorizeHttpRequests</code> with role validation.</li>\n<li>If web security is disabled, I'm just calling:</li>\n</ul>\n<pre class=\"lang-java prettyprint-override\"><code>httpSecurity.authorizeHttpRequests(auth -&gt; auth.anyRequest().permitAll());\n</code></pre>\n<p>Now I've got a unit test for a controller with</p>\n<pre class=\"lang-java prettyprint-override\"><code>    @RequestMapping(\n        method = RequestMethod.POST,\n        value = &quot;/import/{pipeline_name}&quot;,\n        produces = { &quot;application/json&quot; },\n        consumes = { &quot;application/json&quot; }\n    )\n</code></pre>\n<p>where <code>pipeline_name</code> is a @Parameter.</p>\n<p>The Unit Test looks like this:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@WebMvcTest(ImportController.class)\nclass ImportControllerTest {\n\n    @Autowired\n    private MockMvc mockMvc;\n\n    // some more beans and an inner @Configuration class which asks for disabled web security\n\n    @Test\n    @WithMockUser\n    void someTest() throws Exception {\n        doNothing().when(someService).doesStuff();\n        this.mockMvc.perform(\n            post(&quot;/import/test&quot;)\n                .with(jwt())\n                .contentType(MediaType.APPLICATION_JSON)\n                .content(someBody)\n        ).andExpect(status().isNoContent());\n    }\n</code></pre>\n<p>This test worked flawlessly before adding the Spring Boot starter for OAuth2 Resource Server.</p>\n<p>However, with that dependency included, no matter if I set up complex request matchers or just <code>anyRequest().permitALl()</code>, I'm getting a 404 status with the following logs:</p>\n<pre class=\"lang-none prettyprint-override\"><code>o.s.w.s.r.ResourceHttpRequestHandler     : Resource not found\n.w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.servlet.resource.NoResourceFoundException: No static resource import/test.]\n</code></pre>\n<p>Note that the issue only seems to occur in Unit Tests</p>\n<p>Why does the request mapping no longer work in this case?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}