{
  "question": {
    "tags": [
      "java",
      "jvm",
      "graalvm",
      "graalvm-native-image",
      "linkageerror"
    ],
    "owner": {
      "account_id": 15064163,
      "reputation": 17156,
      "user_id": 10871900,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/720202b6e19abc330dcd92e6a1254562?s=256&d=identicon&r=PG",
      "display_name": "dan1st",
      "link": "https://stackoverflow.com/users/10871900/dan1st"
    },
    "is_answered": true,
    "view_count": 192,
    "accepted_answer_id": 79155800,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1753808635,
    "creation_date": 1728775593,
    "last_edit_date": 1753808635,
    "question_id": 79082133,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79082133/can-native-image-warn-about-jvm-linking-errors",
    "title": "Can native-image warn about JVM linking errors?",
    "body": "<p>Java typically links classes at runtime runtime meaning that if a class is replaced in an incompatible way, it may result in a <code>Error</code>s when running the application.</p>\n<p>For example, let's take the following two classes:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class Main{\n    public static void main(String[] args){\n        SomeClass.doSomething();\n    }\n}\npublic class SomeClass{\n    public static void doSomething() {}\n}\n\n</code></pre>\n<p>If we compile both classes together (<code>javac Main.java SomeClass.java</code>) and run <code>Main</code>, it runs successfully.</p>\n<p>However, if we modify <code>SomeClass</code> and recompiling it without recompiling <code>Main</code> (for whatever reason, it might be a library that is replaced without recompiling the dependents):</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class SomeClass {\n    public static void doSomethingNew() {}//name change here\n}\n</code></pre>\n<p>With this, we are (as expected) getting a <code>NoSuchMethodError</code> because <code>Main</code> refers to <code>SomeClass</code>. Similarly, we are getting a <code>NoClassDefFoundError</code> if we delete <code>SomeClass.class</code> and just run <code>Main</code>.</p>\n<p>However, when using GraalVM's <code>native-image</code> tool, we have a closed-world assumption meaning that used all classes must be known at image build-time and cannot be modified. If classes are incompatible or missing, we are still getting the <code>NoSuchMethodError</code>/<code>NoClassDefFoundError</code> (or similar <code>LinkageError</code>s) when running the executable as this behavior is mandated by the specification:</p>\n<pre class=\"lang-none prettyprint-override\"><code>$ native-image -Ob Main\n========================================================================================================================\nGraalVM Native Image: Generating 'main' (executable)...\n========================================================================================================================\n[1/8] Initializing...                                                                                    (2.9s @ 0.11GB)\n Java version: 21.0.2+13-LTS, vendor version: Oracle GraalVM 21.0.2+13.1\n Graal compiler: optimization level: b, target machine: x86-64-v3, PGO: off\n C compiler: gcc (linux, x86_64, 14.2.0)\n Garbage collector: Serial GC (max heap size: 80% of RAM)\n 1 user-specific feature(s):\n - com.oracle.svm.thirdparty.gson.GsonFeature\n------------------------------------------------------------------------------------------------------------------------\nBuild resources:\n - 11.27GB of memory (75.6% of 14.92GB system memory, determined at start)\n - 8 thread(s) (100.0% of 8 available processor(s), determined at start)\n[2/8] Performing analysis...  [******]                                                                   (8.4s @ 0.19GB)\n    2,133 reachable types   (62.1% of    3,437 total)\n    2,066 reachable fields  (45.9% of    4,504 total)\n   10,042 reachable methods (39.3% of   25,580 total)\n      741 types,   112 fields, and   476 methods registered for reflection\n       49 types,    34 fields, and    48 methods registered for JNI access\n        4 native libraries: dl, pthread, rt, z\n[3/8] Building universe...                                                                               (1.3s @ 0.22GB)\n[4/8] Parsing methods...      [*]                                                                        (0.9s @ 0.22GB)\n[5/8] Inlining methods...     [***]                                                                      (1.0s @ 0.25GB)\n[6/8] Compiling methods...    [**]                                                                       (4.9s @ 0.25GB)\n[7/8] Layouting methods...    [*]                                                                        (0.7s @ 0.32GB)\n[8/8] Creating image...       [*]                                                                        (1.5s @ 0.21GB)\n   2.38MB (37.07%) for code area:     5,565 compilation units\n   3.61MB (56.37%) for image heap:   58,333 objects and 43 resources\n 430.86kB ( 6.56%) for other data\n   6.41MB in total\n------------------------------------------------------------------------------------------------------------------------\nTop 10 origins of code area:                                Top 10 object types in image heap:\n   1.26MB java.base                                          733.53kB byte[] for java.lang.String\n 930.06kB svm.jar (Native Image)                             696.27kB byte[] for code metadata\n  84.88kB com.oracle.svm.svm_enterprise                      390.05kB java.lang.String\n  19.45kB org.graalvm.nativeimage.base                       389.10kB heap alignment\n  17.37kB jdk.internal.vm.ci                                 339.78kB java.lang.Class\n  15.33kB jdk.proxy3                                         157.38kB java.util.HashMap$Node\n  14.99kB jdk.proxy1                                         114.01kB char[]\n  14.47kB org.graalvm.collections                            102.19kB byte[] for reflection metadata\n   4.97kB jdk.internal.vm.compiler                            88.68kB java.lang.Object[]\n   3.62kB jdk.proxy2                                          83.32kB com.oracle.svm.core.hub.DynamicHubCompanion\n  471.00B for 1 more packages                                605.70kB for 575 more object types\n                              Use '-H:+BuildReport' to create a report with more details.\n------------------------------------------------------------------------------------------------------------------------\nSecurity report:\n - Binary does not include Java deserialization.\n - Use '--enable-sbom' to embed a Software Bill of Materials (SBOM) in the binary.\n------------------------------------------------------------------------------------------------------------------------\nRecommendations:\n G1GC: Use the G1 GC ('--gc=G1') for improved latency and throughput.\n PGO:  Use Profile-Guided Optimizations ('--pgo') for improved throughput.\n INIT: Adopt '--strict-image-heap' to prepare for the next GraalVM release.\n HEAP: Set max heap for improved and more predictable memory usage.\n CPU:  Enable more CPU features with '-march=native' for improved performance.\n------------------------------------------------------------------------------------------------------------------------\n                        1.5s (6.7% of total time) in 101 GCs | Peak RSS: 0.77GB | CPU load: 5.29\n------------------------------------------------------------------------------------------------------------------------\nProduced artifacts:\n /tmp/y/main (executable)\n========================================================================================================================\nFinished generating 'main' in 21.9s.\n$ ./main \nException in thread &quot;main&quot; java.lang.NoSuchMethodError: SomeClass.doSomething()\n    at Main.main(Main.java:3)\n    at java.base@21.0.2/java.lang.invoke.LambdaForm$DMH/sa346b79c.invokeStaticInit(LambdaForm$DMH)\n</code></pre>\n<p>In the build output, I don't see any mention or warning that some classes are incompatible. I also tried using options like <code>--initialize-at-build-time=Main,SomeClass</code> or <code>--strict-image-heap</code> but this didn't change that behavior.</p>\n<p>Is there any possibility (e.g. via CLI options or by implementing custom <a href=\"https://www.graalvm.org/sdk/javadoc/org/graalvm/nativeimage/hosted/Feature.html\" rel=\"nofollow noreferrer\">Features</a>) to let <code>native-image</code> warn me about incompatibilities like that since it has to check for them anyways (for imitating the said <code>LinkageError</code>s) (maybe I'm just overloooking an option)?<br />\nIf this is fundamentally not possible with <code>native-image</code> or there are problems with implementing that, what are these issues?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}