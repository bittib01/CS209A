{
  "question": {
    "tags": [
      "java",
      "performance"
    ],
    "owner": {
      "account_id": 26398162,
      "reputation": 55,
      "user_id": 20048980,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/ba8b7ff1fb2058f642847beedde24d5a?s=256&d=identicon&r=PG",
      "display_name": "Pai",
      "link": "https://stackoverflow.com/users/20048980/pai"
    },
    "is_answered": false,
    "view_count": 142,
    "answer_count": 0,
    "score": 2,
    "last_activity_date": 1740924074,
    "creation_date": 1739888703,
    "last_edit_date": 1740924074,
    "question_id": 79448582,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79448582/why-is-the-performance-of-system-err-is-significantly-lower-than-system-out-in-j",
    "title": "Why is the performance of System.err is significantly lower than System.out in Java (on Windows)?",
    "body": "<p>I'm conducting a load test on <code>System.out</code>, <code>System.err</code> and <code>logger.info</code>(using SLF4J + Logback) in a Java 8 environment with Spring Boot 2.6.0 and Logback 1.2.7. I have packaged my project into an executable JAR and run it on Windows 11 using the following command: <code>java -jar -Xms256m -Xmx256m .\\happyTest-1.0.2-SNAPSHOT.jar &gt; .\\logs\\happyTest2.log 2&gt;&amp;1</code> .<br />\nHere is API code:</p>\n<pre><code>@RestController\n@RequestMapping(&quot;/log&quot;)\npublic class LogController {\n\n    private static final Logger logger = org.slf4j.LoggerFactory.getLogger(LogController.class);\n\n    private static final int LOOP_COUNT = 100;\n\n    @GetMapping(&quot;/system-out&quot;)\n    public String logSystemOut() {\n        long startTime = System.currentTimeMillis();\n        for (int i = 0; i &lt; LOOP_COUNT; i++) {\n            System.out.println(&quot;hello world&quot;);\n        }\n        long endTime = System.currentTimeMillis();\n        return &quot;Logged messages in &quot; + (endTime - startTime) + &quot; ms&quot;;\n    }\n\n    @GetMapping(&quot;/system-err&quot;)\n    public String logSystemErr() {\n        long startTime = System.currentTimeMillis();\n        for (int i = 0; i &lt; LOOP_COUNT; i++) {\n            System.err.println(&quot;hello world&quot;);\n        }\n        long endTime = System.currentTimeMillis();\n        return &quot;Logged messages in &quot; + (endTime - startTime) + &quot; ms&quot;;\n    }\n\n    @GetMapping(&quot;/info&quot;)\n    public String logInfo() {\n        long startTime = System.currentTimeMillis();\n        for (int i = 0; i &lt; LOOP_COUNT; i++) {\n            logger.info(&quot;hello world&quot;);\n        }\n        long endTime = System.currentTimeMillis();\n        return &quot;Logged messages in &quot; + (endTime - startTime) + &quot; ms&quot;;\n    }\n}\n</code></pre>\n<p>My logback.xml configuration is below:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;configuration scan=&quot;true&quot; scanPeriod=&quot;30 seconds&quot;&gt;\n    \n    &lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;\n        &lt;file&gt;logs/happyTest.log&lt;/file&gt;\n        &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;\n            &lt;fileNamePattern&gt;logs/happyTest.%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt;\n            &lt;maxHistory&gt;30&lt;/maxHistory&gt;\n        &lt;/rollingPolicy&gt;\n        &lt;encoder&gt;\n            &lt;pattern&gt;%msg%n&lt;/pattern&gt;\n        &lt;/encoder&gt;\n    &lt;/appender&gt;\n    \n    &lt;appender name=&quot;ASYNC&quot; class=&quot;ch.qos.logback.classic.AsyncAppender&quot;&gt;\n        &lt;discardingThreshold&gt;0&lt;/discardingThreshold&gt;\n        &lt;queueSize&gt;8192&lt;/queueSize&gt;\n        &lt;appender-ref ref=&quot;FILE&quot;/&gt;\n    &lt;/appender&gt;\n    \n    &lt;root level=&quot;INFO&quot;&gt;\n        &lt;appender-ref ref=&quot;ASYNC&quot;/&gt;\n    &lt;/root&gt;\n&lt;/configuration&gt;\n</code></pre>\n<p>I use JMeter in other computer, use CLI mode run this test plan.\n<a href=\"https://i.sstatic.net/J6le112C.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/J6le112C.png\" alt=\"enter image description here\" /></a>\nNote that every different API just change the request path to test.\n<a href=\"https://i.sstatic.net/nEXWBrPN.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/nEXWBrPN.png\" alt=\"enter image description here\" /></a>\nBased on my understanding, the performance of <code>System.out</code> and <code>System.err</code> should be similar and generally lower than <code>logger.info</code> due to I configure the <code>ch.qos.logback.classic.AsyncAppender</code> in logback.xml.<br />\nYes, it worked as I expected. <code>logger.info</code> is best.<br />\nHowever I was surprised to find that the performance of <code>System.err</code> is significantly lower than <code>System.out</code>.<br />\nHere is <code>System.err</code> performance. <strong>Significantly slower.</strong>\n<a href=\"https://i.sstatic.net/fzZvoYj6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/fzZvoYj6.png\" alt=\"enter image description here\" /></a>\nHere is <code>System.out</code> performence. <strong>Faster compared to</strong> <code>System.err</code>.\n<a href=\"https://i.sstatic.net/vPHNmio7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/vPHNmio7.png\" alt=\"enter image description here\" /></a>\nAfter reviewing the source code of System.java, I noticed that the different of <code>System.out</code> and <code>System.err</code> only is the encode and file descriptor. Both they are <code>BufferedOutputStream</code>, not like some AI claims that <code>System.err</code> is unbufferd.</p>\n<pre><code>// java.lang.System\n// ... other code\npublic final static PrintStream out = null;\npublic final static PrintStream err = null;\n// ... other code\nprivate static void initializeSystemClass() {\n    // ... other code\n    FileInputStream fdIn = new FileInputStream(FileDescriptor.in);\n    FileOutputStream fdOut = new FileOutputStream(FileDescriptor.out);\n    FileOutputStream fdErr = new FileOutputStream(FileDescriptor.err);\n    setIn0(new BufferedInputStream(fdIn));\n    setOut0(newPrintStream(fdOut, props.getProperty(&quot;sun.stdout.encoding&quot;)));\n    setErr0(newPrintStream(fdErr, props.getProperty(&quot;sun.stderr.encoding&quot;)));\n    // ... other code\n}\n// ... other code\nprivate static PrintStream newPrintStream(FileOutputStream fos, String enc) {\n   if (enc != null) {\n        try {\n            return new PrintStream(new BufferedOutputStream(fos, 128), true, enc);\n        } catch (UnsupportedEncodingException uee) {}\n    }\n    return new PrintStream(new BufferedOutputStream(fos, 128), true);\n}\n</code></pre>\n<p>So, why is the performance of <code>System.err</code> is significantly lower than <code>System.out</code>?<br />\nThank you for your insights!</p>\n<p>2025.2.22.<br />\nIn order to discover more information. I retry load test in Ubuntu environment.<br />\nThere are some changes in order for 'Test' to run successfully.<br />\nThe <code>LOOP_COUNT</code> in API code change to 500.<br />\nRun project use command: <code>nohup java -jar -Xms256m -Xmx256m ./happyTest-1.0.2-SNAPSHOT.jar &gt; ./logs/happyTest2.log 2&gt; ./logs/happyTest3.log &amp;</code><br />\nJMeter config as belowï¼š<br />\n<a href=\"https://i.sstatic.net/zOYE3M75.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/zOYE3M75.png\" alt=\"enter image description here\" /></a>\n<a href=\"https://i.sstatic.net/j7HZ37Fd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/j7HZ37Fd.png\" alt=\"enter image description here\" /></a>\nThen, run test plan.<br />\n<code>System.out</code> test result:<br />\n<a href=\"https://i.sstatic.net/VIvcAsth.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/VIvcAsth.png\" alt=\"enter image description here\" /></a>\n<code>System.err</code> test result:<br />\n<a href=\"https://i.sstatic.net/63T848BM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/63T848BM.png\" alt=\"enter image description here\" /></a>\nIt shows the performance in Ubuntu, <code>System.out</code> and <code>System.err</code> is similar. It seems like <code>System.err</code> performance more lower is reason by runing environment.</p>\n<p>2025.2.23<br />\nIn order to discover more information. I retry load test in Windows environment.<br />\nMy test sequence as below:</p>\n<ol>\n<li>Run java project in Windows computer.</li>\n<li><code>System.out</code> load test.<br />\n<a href=\"https://i.sstatic.net/yjeH2U0w.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/yjeH2U0w.png\" alt=\"enter image description here\" /></a></li>\n<li><code>System.err</code> load test.<br />\n<a href=\"https://i.sstatic.net/1Kcr1P03.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/1Kcr1P03.png\" alt=\"enter image description here\" /></a></li>\n<li><code>System.err</code> load test.\n<a href=\"https://i.sstatic.net/lQWRFl59.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/lQWRFl59.png\" alt=\"enter image description here\" /></a></li>\n<li><code>System.out</code> load test.<br />\n<a href=\"https://i.sstatic.net/lQcbHBP9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/lQcbHBP9.png\" alt=\"enter image description here\" /></a></li>\n<li><code>System.out</code> load test.<br />\n<a href=\"https://i.sstatic.net/jthkOXGF.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/jthkOXGF.png\" alt=\"enter image description here\" /></a></li>\n<li><code>System.err</code> load test.<br />\n<a href=\"https://i.sstatic.net/7oxYn02e.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/7oxYn02e.png\" alt=\"enter image description here\" /></a></li>\n</ol>\n<p>Each load test will be spaced approximately 4 minutes apart.<br />\nTotal result file as below:<br />\n<a href=\"https://i.sstatic.net/IYkYZM2W.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/IYkYZM2W.png\" alt=\"enter image description here\" /></a>\nHowever, it seems like nothing is changed, the <code>System.err</code> performance is still more lower.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}