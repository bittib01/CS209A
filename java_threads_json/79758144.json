{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "spring-batch"
    ],
    "owner": {
      "account_id": 43831550,
      "reputation": 1,
      "user_id": 31438709,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/648ca4684e9116b68a2e04ba398e100c?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Nipun Kumar",
      "link": "https://stackoverflow.com/users/31438709/nipun-kumar"
    },
    "is_answered": false,
    "view_count": 89,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1757252115,
    "creation_date": 1757252115,
    "question_id": 79758144,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79758144/how-to-override-spring-batch-step-exitstatus-when-itemreader-read-throws-an-ex",
    "title": "How to override Spring Batch Step ExitStatus when ItemReader.read() throws an exception?",
    "body": "<h3>Problem</h3>\n<p>When my <code>ItemReader.read()</code> throws an exception, the step is marked <code>FAILED</code>.\nIn my <code>afterStep</code> listener I try to override it with:</p>\n<pre class=\"lang-java prettyprint-override\"><code>stepExecution.setStatus(BatchStatus.COMPLETED);\nstepExecution.setExitStatus(ExitStatus.COMPLETED);\n</code></pre>\n<p>This makes the step show as <code>COMPLETED</code> in the repository, but in the job flow the <code>JobExecutionDecider</code> still receives the original <code>FAILED</code> <code>ExitStatus</code>.</p>\n<p>How can I make the overridden <code>ExitStatus</code> propagate correctly so that flow transitions (<code>on(&quot;*&quot;)</code>, <code>decider</code>, etc.) see <code>COMPLETED</code> instead of <code>FAILED</code>?</p>\n<p>I’m experimenting with Spring Batch and trying to override the exit status of a step when the <code>ItemReader.read()</code> method fails.</p>\n<p>Here’s the test I have:</p>\n<pre><code>package com.mdp.mayaanonymizationengine;\n\nimport com.mdp.mayaanonymizationengine.core.AbstractDatabaseProperty;\nimport com.mdp.mayaanonymizationengine.core.IntegrationTest;\nimport lombok.extern.slf4j.Slf4j;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.batch.core.*;\nimport org.springframework.batch.core.job.builder.JobBuilder;\nimport org.springframework.batch.core.job.flow.FlowExecutionStatus;\nimport org.springframework.batch.core.job.flow.JobExecutionDecider;\nimport org.springframework.batch.core.launch.JobLauncher;\nimport org.springframework.batch.core.repository.JobRepository;\nimport org.springframework.batch.core.step.builder.StepBuilder;\nimport org.springframework.batch.item.ExecutionContext;\nimport org.springframework.batch.item.ItemReader;\nimport org.springframework.batch.item.ItemStream;\nimport org.springframework.batch.item.ItemStreamException;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.transaction.PlatformTransactionManager;\n\n@Slf4j\n@IntegrationTest\nclass BatchTest extends AbstractDatabaseProperty {\n\n    @Autowired\n    private JobLauncher jobLauncher;\n\n    @Autowired\n    private PlatformTransactionManager transactionManager;\n\n    @Autowired\n    private JobRepository jobRepository;\n\n    @Test\n    void testStepFailureOverriddenToCompleted() throws Exception {\n        jobLauncher.run(\n                testJob(jobRepository, transactionManager),\n                new JobParameters()\n        );\n    }\n\n    public Job testJob(JobRepository jobRepository,\n                       PlatformTransactionManager transactionManager) {\n        return new JobBuilder(&quot;testJob&quot;, jobRepository)\n                .start(failingStep(jobRepository, transactionManager))\n                .on(&quot;*&quot;).to(decider())\n                .end()\n                .build();\n    }\n\n    public Step failingStep(JobRepository jobRepository,\n                            PlatformTransactionManager transactionManager) {\n        return new StepBuilder(&quot;failingStep&quot;, jobRepository)\n                .&lt;String, String&gt;chunk(1, transactionManager)\n                .reader(new TestBatchReader())\n                .writer(items -&gt; {\n                    // no-op\n                })\n                .listener(new StepExecutionListener() {\n                    @Override\n                    public void beforeStep(StepExecution stepExecution) { }\n\n                    @Override\n                    public ExitStatus afterStep(StepExecution stepExecution) {\n                        System.out.println(&quot;afterStep called, overriding status to COMPLETED&quot;);\n\n                        // Force batch + exit status\n                        stepExecution.setStatus(BatchStatus.COMPLETED);\n                        stepExecution.setExitStatus(ExitStatus.COMPLETED);\n\n                        return ExitStatus.COMPLETED;\n                    }\n                })\n                .build();\n    }\n\n    public JobExecutionDecider decider() {\n        return (JobExecution jobExecution, StepExecution stepExecution) -&gt; {\n            System.out.println(&quot;Decider saw exit status: &quot; + stepExecution.getExitStatus());\n            return FlowExecutionStatus.COMPLETED;\n        };\n    }\n\n    static class TestBatchReader implements ItemReader&lt;String&gt;, ItemStream {\n        @Override\n        public void open(ExecutionContext executionContext) throws ItemStreamException {\n            log.info(&quot;Reader open called&quot;);\n        }\n\n        @Override\n        public String read() {\n            throw new RuntimeException(&quot;Simulated reader failure!&quot;);\n        }\n    }\n}\n\n</code></pre>\n<p>What happens</p>\n<ul>\n<li><p>The reader throws a <code>RuntimeException</code>.</p>\n</li>\n<li><p>The step listener’s <code>afterStep</code> callback sets both <code>BatchStatus</code> and <code>ExitStatus</code> to <code>COMPLETED</code>.</p>\n</li>\n<li><p>In the logs, the job finishes with <code>BatchStatus=COMPLETED</code>, as expected.</p>\n</li>\n<li><p>But the <code>JobExecutionDecider</code> still sees <code>ExitStatus=FAILED;exitDescription=...</code> from the exception.</p>\n</li>\n</ul>\n<p>My question</p>\n<ul>\n<li><p>How can I reliably override the <code>ExitStatus</code> of a step when <code>ItemReader.read()</code> (or similar methods like <code>process</code> / <code>write</code>) throws an exception, so that both:</p>\n</li>\n<li><p>The persisted step status is updated, and</p>\n</li>\n<li><p>Flow transitions (<code>JobExecutionDecider, on(&quot;...&quot;)</code> mappings, etc.) also see the overridden exit status?</p>\n</li>\n</ul>\n<p>Is there a way to make the <code>decider</code> see my overridden <code>ExitStatus</code>, or do I need to handle this earlier than <code>afterStep</code>?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}