{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "redis",
      "spring-data-redis"
    ],
    "owner": {
      "account_id": 32466462,
      "reputation": 25,
      "user_id": 25222856,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/3414c3736c68b9994a700ae1ded2e7a8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Dhananjai Saini",
      "link": "https://stackoverflow.com/users/25222856/dhananjai-saini"
    },
    "is_answered": false,
    "view_count": 990,
    "answer_count": 3,
    "score": 0,
    "last_activity_date": 1722665082,
    "creation_date": 1718685966,
    "last_edit_date": 1718728912,
    "question_id": 78635522,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78635522/unable-to-connect-to-redis-spring-boot",
    "title": "Unable to connect to Redis | Spring Boot",
    "body": "<p>I've a redis service on upstash.io but not able to connect to it from my spring boot application</p>\n<p>This is my redis config</p>\n<pre><code>@Configuration\npublic class RedisConfig {\n\n    @Bean\n    public LettuceConnectionFactory redisConnectionFactory() {\n        RedisStandaloneConfiguration redisStandaloneConfiguration = new RedisStandaloneConfiguration();\n        redisStandaloneConfiguration.setHostName(&quot;myhost&quot;);\n        redisStandaloneConfiguration.setPort(6379);\n        redisStandaloneConfiguration.setPassword(RedisPassword.of(&quot;password&quot;)); // Uncomment if password is needed\n        return new LettuceConnectionFactory(redisStandaloneConfiguration);\n    }\n\n     @Bean\n    public RedisTemplate&lt;Object, Object&gt; redisTemplate() {\n        RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;();\n        template.setConnectionFactory(redisConnectionFactory());\n        template.setKeySerializer(new StringRedisSerializer());\n        template.setValueSerializer(new StringRedisSerializer());\n        return template;\n    }\n\n} \n</code></pre>\n<p>This is my redis service</p>\n<pre><code>@Component \n@RequiredArgsConstructor \npublic class RedisService { \n    \n    @Autowired\n    private final RedisTemplate&lt;Object, Object&gt; redisTemplate; \n    \n    @PostConstruct\n    public void testConnection() {\n        try {\n            redisTemplate.getConnectionFactory().getConnection().ping();\n            System.out.println(&quot;Connected to Redis successfully&quot;);\n        } catch (Exception e) {\n            System.err.println(&quot;Unable to connect to Redis: &quot; + e.getMessage());\n        }\n    }\n \n    public &lt;V&gt; void set(String key, V value, long timeout, TimeUnit timeUnit) { \n        System.out.println(&quot;Storing message to redis cache: Key[&quot; + key + &quot;]&quot;);\n        redisTemplate.opsForValue().set(key, value); \n        redisTemplate.expire(key, timeout, timeUnit); \n    } \n\n    public &lt;V&gt; V get(String key) { \n        return (V) redisTemplate.opsForValue().get(key); \n    } \n \n    public Boolean hasKey(String key) { \n        return redisTemplate.hasKey(key); \n    } \n} \n</code></pre>\n<p>This is my pom.xml</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.0.6&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;com.springprojects&lt;/groupId&gt;\n    &lt;artifactId&gt;realtimechatapp&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;packaging&gt;jar&lt;/packaging&gt;\n    &lt;name&gt;realtimechatapp&lt;/name&gt;\n    &lt;description&gt;Chat Application using Spring Boot&lt;/description&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n        &lt;groupId&gt;javax.persistence&lt;/groupId&gt;\n            &lt;artifactId&gt;javax.persistence-api&lt;/artifactId&gt;\n            &lt;version&gt;2.2&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.mysql&lt;/groupId&gt;\n            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;\n            &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;\n            &lt;version&gt;10.1.18&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;\n            &lt;artifactId&gt;jstl&lt;/artifactId&gt;\n            &lt;version&gt;1.2&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;\n            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;\n            &lt;version&gt;3.1.0&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;\n            &lt;artifactId&gt;thymeleaf-extras-springsecurity6&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/com.google.code.gson/gson --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;\n            &lt;artifactId&gt;gson&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.lettuce&lt;/groupId&gt;\n            &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt; \n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; \n            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; \n        &lt;/dependency&gt; \n\n    &lt;/dependencies&gt;\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;image&gt;\n                        &lt;builder&gt;paketobuildpacks/builder-jammy-base:latest&lt;/builder&gt;\n                    &lt;/image&gt;\n                    &lt;excludes&gt;\n                        &lt;exclude&gt;\n                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                        &lt;/exclude&gt;\n                    &lt;/excludes&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n        &lt;resources&gt;\n            &lt;resource&gt;\n                &lt;directory&gt;src/main/resources&lt;/directory&gt;\n                &lt;filtering&gt;true&lt;/filtering&gt;\n            &lt;/resource&gt;\n        &lt;/resources&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n\n</code></pre>\n<p>Logs:</p>\n<p>Caused by: io.lettuce.core.RedisConnectionException: Connection closed prematurely</p>\n<p>I've tried to increas the timeout but did not work.</p>\n<p>Connecting with redis on local also give same error\nredisStandaloneConfiguration.setHostName(&quot;localhost&quot;);\nredisStandaloneConfiguration.setPort(6379);</p>\n<p>Updated Redis config</p>\n<pre><code>@Configuration\npublic class RedisConfig {\n    \n    @Bean\n    public RedisConnectionFactory redisConnectionFactory() {\n        System.out.println(&quot;Creating RedisConnectionFactory&quot;);\n        return new LettuceConnectionFactory();\n    }\n\n    @Bean\n    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) {\n        System.out.println(&quot;Creating RedisTemplate&quot;);\n        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();\n        template.setConnectionFactory(redisConnectionFactory);\n        template.setKeySerializer(new StringRedisSerializer());\n        template.setValueSerializer(new GenericJackson2JsonRedisSerializer());\n        return template;\n    }\n}\n\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}