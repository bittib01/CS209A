{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-kafka",
      "apache-kafka-streams"
    ],
    "owner": {
      "account_id": 23958940,
      "reputation": 21,
      "user_id": 17949352,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a-/AOh14Gjb6bSCCZLPeDJTZVNpXOSFy2_WchVBgyk1oKgyVA=k-s256",
      "display_name": "Aindrail Santra",
      "link": "https://stackoverflow.com/users/17949352/aindrail-santra"
    },
    "is_answered": false,
    "view_count": 74,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1740135586,
    "creation_date": 1740135586,
    "question_id": 79457145,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79457145/invalid-topology-topology-has-no-stream-threads-and-no-global-threads-must-sub",
    "title": "Invalid topology: Topology has no stream threads and no global threads, must subscribe to at least one source topic or global table. Aindrail",
    "body": "<p>The error is\n**\nError starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.\n2025-02-21T16:09:37.761+05:30 ERROR 38852 --- [Ecommerce] [           main] o.s.boot.SpringApplication               : Application run failed</p>\n<p>org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'inventoryController' defined in file [C:\\Users\\aisantra\\Downloads\\Ecommerce\\target\\classes\\com\\example\\Ecommerce\\controller\\InventoryController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'kafkaStreams' defined in class path resource [com/example/Ecommerce/config/KafkaStreamsConfig.class]: Failed to instantiate [org.apache.kafka.streams.KafkaStreams]: Factory method 'kafkaStreams' threw exception with message: Invalid topology: Topology has no stream threads and no global threads, must subscribe to at least one source topic or global table.\nat org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:804) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1381) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1218) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:563) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:336) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:307) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:334) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.DefaultListableBeanFactory.instantiateSingleton(DefaultListableBeanFactory.java:1122) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingleton(DefaultListableBeanFactory.java:1093) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:1030) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:987) ~[spring-context-6.2.2.jar:6.2.2]\nat org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627) ~[spring-context-6.2.2.jar:6.2.2]\nat org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.4.2.jar:3.4.2]\nat org.springframework.boot.SpringApplication.refresh(SpringApplication.java:752) ~[spring-boot-3.4.2.jar:3.4.2]\nat org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439) ~[spring-boot-3.4.2.jar:3.4.2]\nat org.springframework.boot.SpringApplication.run(SpringApplication.java:318) ~[spring-boot-3.4.2.jar:3.4.2]\nat org.springframework.boot.SpringApplication.run(SpringApplication.java:1361) ~[spring-boot-3.4.2.jar:3.4.2]\nat org.springframework.boot.SpringApplication.run(SpringApplication.java:1350) ~[spring-boot-3.4.2.jar:3.4.2]\nat com.example.Ecommerce.EcommerceApplication.main(EcommerceApplication.java:12) ~[classes/:na]\nCaused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'kafkaStreams' defined in class path resource [com/example/Ecommerce/config/KafkaStreamsConfig.class]: Failed to instantiate [org.apache.kafka.streams.KafkaStreams]: Factory method 'kafkaStreams' threw exception with message: Invalid topology: Topology has no stream threads and no global threads, must subscribe to at least one source topic or global table.\nat org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:657) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:645) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1361) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1191) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:563) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:336) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:307) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:334) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1573) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1519) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:913) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791) ~[spring-beans-6.2.2.jar:6.2.2]\n... 21 common frames omitted\nCaused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.apache.kafka.streams.KafkaStreams]: Factory method 'kafkaStreams' threw exception with message: Invalid topology: Topology has no stream threads and no global threads, must subscribe to at least one source topic or global table.\nat org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:199) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:88) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:168) ~[spring-beans-6.2.2.jar:6.2.2]\nat org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653) ~[spring-beans-6.2.2.jar:6.2.2]\n... 34 common frames omitted\nCaused by: org.apache.kafka.streams.errors.TopologyException: Invalid topology: Topology has no stream threads and no global threads, must subscribe to at least one source topic or global table.\nat org.apache.kafka.streams.processor.internals.TopologyMetadata.getNumStreamThreads(TopologyMetadata.java:377) ~[kafka-streams-3.8.1.jar:na]\nat org.apache.kafka.streams.KafkaStreams.(KafkaStreams.java:1026) ~[kafka-streams-3.8.1.jar:na]\nat org.apache.kafka.streams.KafkaStreams.(KafkaStreams.java:955) ~[kafka-streams-3.8.1.jar:na]\nat org.apache.kafka.streams.KafkaStreams.(KafkaStreams.java:925) ~[kafka-streams-3.8.1.jar:na]\nat org.apache.kafka.streams.KafkaStreams.(KafkaStreams.java:907) ~[kafka-streams-3.8.1.jar:na]\nat org.apache.kafka.streams.KafkaStreams.(KafkaStreams.java:837) ~[kafka-streams-3.8.1.jar:na]\nat com.example.Ecommerce.config.KafkaStreamsConfig.kafkaStreams(KafkaStreamsConfig.java:61) ~[classes/:na]\nat com.example.Ecommerce.config.KafkaStreamsConfig$$SpringCGLIB$$0.CGLIB$kafkaStreams$1() ~[classes/:na]\nat com.example.Ecommerce.config.KafkaStreamsConfig$$SpringCGLIB$$FastClass$$1.invoke() ~[classes/:na]\nat org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258) ~[spring-core-6.2.2.jar:6.2.2]\nat org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:348) ~[spring-context-6.2.2.jar:6.2.2]\nat com.example.Ecommerce.config.KafkaStreamsConfig$$SpringCGLIB$$0.kafkaStreams() ~[classes/:na]\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]\nat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]\nat java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]\nat org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:171) ~[spring-beans-6.2.2.jar:6.2.2]\n... 37 common frames omitted</p>\n<hr />\n<blockquote>\n<p>KafkaStreamsConfig.java file\nthis is kafka streams file which has the stream implementation</p>\n</blockquote>\n<pre class=\"lang-none prettyprint-override\"><code>\nimport jakarta.annotation.PostConstruct;\nimport jakarta.annotation.PreDestroy;\nimport org.apache.kafka.streams.KafkaStreams;\nimport org.apache.kafka.streams.StreamsBuilder;\nimport org.apache.kafka.streams.StreamsConfig;\nimport org.apache.kafka.common.serialization.Serdes;\nimport org.apache.kafka.streams.kstream.KStream;\nimport org.apache.kafka.streams.kstream.Produced;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.kafka.annotation.EnableKafka;\nimport org.springframework.kafka.annotation.EnableKafkaStreams;\nimport org.springframework.kafka.annotation.KafkaStreamsDefaultConfiguration;\nimport org.springframework.kafka.config.KafkaStreamsConfiguration;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n@Configuration\n@EnableKafka\npublic class KafkaStreamsConfig {\n\n    @Value(&quot;${kafka.bootstrap-servers}&quot;)\n    private String bootstrapAddress;\n\n    private KafkaStreams kafkaStreams;\n\n    @Bean(name = KafkaStreamsDefaultConfiguration.DEFAULT_STREAMS_CONFIG_BEAN_NAME)\n    public KafkaStreamsConfiguration kStreamsConfig() {\n        Map&lt;String, Object&gt; props = new HashMap&lt;&gt;();\n        props.put(StreamsConfig.APPLICATION_ID_CONFIG, &quot;inventory-streams-app&quot;);\n        props.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapAddress);\n        props.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass().getName());\n        props.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.Long().getClass().getName());\n\n        return new KafkaStreamsConfiguration(props);\n    }\n    @Bean\n    public KStream&lt;String,Long&gt; kStream(StreamsBuilder streamsBuilder) {\n        String sourceTopic = &quot;order-topics&quot;;\n        String destinationTopic = &quot;inventory-topic&quot;;\n        //create a stream from the source kafka topic\n        KStream&lt;String,Long&gt; orderStream = streamsBuilder.stream(sourceTopic);\n         // Process the order and update the inventory\n        KStream&lt;String,Long&gt; inventoryStream = orderStream.mapValues(orderQuantity-&gt; -orderQuantity);// reduce based on orders\n\n        inventoryStream.to(destinationTopic, Produced.with(Serdes.String(),Serdes.Long()));\n        return inventoryStream;\n    }\n    @Bean\n    public StreamsBuilder streamsBuilder(){\n        return new StreamsBuilder();\n    }\n\n\n    @Bean(destroyMethod = &quot;close&quot;) // Ensures KafkaStreams shuts down properly\n    public KafkaStreams kafkaStreams(StreamsBuilder streamsBuilder) {\n        kafkaStreams = new KafkaStreams(streamsBuilder.build(), kStreamsConfig().asProperties());\n\n        // Graceful Shutdown Hook\n        Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; {\n            System.out.println(&quot;Shutting down Kafka Streams...&quot;);\n            kafkaStreams.close();\n            System.out.println(&quot;Kafka Streams shut down successfully.&quot;);\n        }));\n\n        kafkaStreams.start();\n        return kafkaStreams;\n    }\n\n    @PreDestroy\n    public void closeKafkaStreams() {\n        if (kafkaStreams != null) {\n            System.out.println(&quot;PreDestroy: Closing Kafka Streams...&quot;);\n            kafkaStreams.close();\n            System.out.println(&quot;Kafka Streams closed.&quot;);\n        }\n    }\n}\n\n</code></pre>\n<blockquote>\n<p>InventoryStreamProcessor.java file</p>\n</blockquote>\n<pre class=\"lang-none prettyprint-override\"><code>\nimport org.apache.kafka.streams.StreamsBuilder;\nimport org.apache.kafka.streams.kstream.*;\nimport org.apache.kafka.streams.state.KeyValueStore;\nimport org.apache.kafka.common.serialization.Serdes;\nimport org.springframework.stereotype.Component;\nimport org.springframework.beans.factory.annotation.Autowired;\n\n@Component\npublic class InventoryStreamProcessor {\n\n@Autowired\n    public void buildPipeline(StreamsBuilder streamsBuilder) {\n        KStream&lt;String, Integer&gt; orderStream = streamsBuilder\n                .stream(&quot;order-topics&quot;, Consumed.with(Serdes.String(), Serdes.Integer()));\n\n        KTable&lt;String, Integer&gt; inventoryTable = orderStream\n                .groupByKey(Grouped.with(Serdes.String(), Serdes.Integer()))\n                .aggregate(\n                        () -&gt; 100,  // Default inventory count for each product\n                        (key, orderQty, currentInventory) -&gt; currentInventory - orderQty,\n                        Materialized.&lt;String, Integer, KeyValueStore&lt;org.apache.kafka.common.utils.Bytes, byte[]&gt;&gt;as(&quot;inventory-store&quot;)\n                                .withKeySerde(Serdes.String())\n                                .withValueSerde(Serdes.Integer())\n                );\n\n        inventoryTable.toStream().to(&quot;inventory-topic&quot;);\n    }\n\n}\n</code></pre>\n<blockquote>\n<p>controller</p>\n</blockquote>\n<pre><code>package com.example.Ecommerce.controller;\n\nimport org.apache.kafka.streams.KafkaStreams;\nimport org.apache.kafka.streams.StoreQueryParameters;\nimport org.apache.kafka.streams.state.QueryableStoreTypes;\nimport org.apache.kafka.streams.state.ReadOnlyKeyValueStore;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.*;\n\n@RestController\n@RequestMapping(&quot;/inventory&quot;)\npublic class InventoryController {\n\n    private final KafkaStreams kafkaStreams;\n\n    public InventoryController(KafkaStreams kafkaStreams) {\n        this.kafkaStreams = kafkaStreams;\n    }\n\n    @GetMapping(&quot;/{productId}&quot;)\n    public Integer getInventory(@PathVariable String productId) {\n        ReadOnlyKeyValueStore&lt;String, Integer&gt; inventoryStore = kafkaStreams.store(\n                StoreQueryParameters.fromNameAndType(&quot;inventory-store&quot;, QueryableStoreTypes.keyValueStore())\n        );\n        Integer stock = inventoryStore.get(productId);\n        return (stock!=null)?stock:0;\n    }\n}\n</code></pre>\n<blockquote>\n<p>main file</p>\n</blockquote>\n<pre><code>package com.example.Ecommerce;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;\nimport org.springframework.kafka.annotation.EnableKafkaStreams;\n\n\n@SpringBootApplication\npublic class EcommerceApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(EcommerceApplication.class, args);\n    }\n\n}```\n\n&gt; application.properties\n\nspring.application.name=Ecommerce\n\n\n# Kafka Configuration\nkafka.bootstrap-servers=localhost:9092\nkafka.consumer.group-id=order-group\nkafka.consumer.auto-offset-reset=earliest\nkafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer\nkafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer\nkafka.streams.application-id = inventory-tracking-app\n\n\n \n\n\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}