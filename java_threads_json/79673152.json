{
  "question": {
    "tags": [
      "java",
      "apache-kafka",
      "spring-kafka-test"
    ],
    "owner": {
      "account_id": 18475910,
      "reputation": 170,
      "user_id": 13459462,
      "user_type": "registered",
      "profile_image": "https://lh6.googleusercontent.com/-sqG_ko7_f_w/AAAAAAAAAAI/AAAAAAAAAAA/AAKWJJPOqLF4v__7G86j0MEd3q-cSPoe8A/s256-rj/photo.jpg",
      "display_name": "szczyzanski",
      "link": "https://stackoverflow.com/users/13459462/szczyzanski"
    },
    "is_answered": false,
    "view_count": 756,
    "answer_count": 3,
    "score": 2,
    "last_activity_date": 1757081066,
    "creation_date": 1750411955,
    "question_id": 79673152,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79673152/using-embeddedkafka-with-kafka-clients-3-9-1",
    "title": "Using @EmbeddedKafka with kafka-clients 3.9.1",
    "body": "<p>I'm working on the aplplication using embedded kafka from <code>org.springframework.kafka:spring-kafka-test:3.3.5</code> for testing purposes. Everything worked until I had to change version of <code>org.apache.kafka:kafka-clients</code> from <code>3.8.1</code> to <code>3.9.1</code>. All test fails with <code>NoSuchMethodError</code>:</p>\n<pre><code>Caused by: java.lang.NoSuchMethodError: 'org.apache.kafka.common.network.ChannelBuilder org.apache.kafka.common.network.ChannelBuilders.serverChannelBuilder(org.apache.kafka.common.network.ListenerName, boolean, org.apache.kafka.common.security.auth.SecurityProtocol, org.apache.kafka.common.config.AbstractConfig, org.apache.kafka.common.security.authenticator.CredentialCache, org.apache.kafka.common.security.token.delegation.internals.DelegationTokenCache, org.apache.kafka.common.utils.Time, org.apache.kafka.common.utils.LogContext, java.util.function.Supplier)'\nat kafka.network.Processor.&lt;init&gt;(SocketServer.scala:977)\nat kafka.network.Acceptor.newProcessor(SocketServer.scala:882)\nat kafka.network.Acceptor.$anonfun$addProcessors$1(SocketServer.scala:852)\nat scala.collection.immutable.Range.foreach$mVc$sp(Range.scala:190)\nat kafka.network.Acceptor.addProcessors(SocketServer.scala:851)\nat kafka.network.DataPlaneAcceptor.configure(SocketServer.scala:525)\nat kafka.network.SocketServer.createDataPlaneAcceptorAndProcessors(SocketServer.scala:253)\nat kafka.network.SocketServer.$anonfun$new$31(SocketServer.scala:177)\n</code></pre>\n<p>that is thrown inside of <code>org.apache.kafka:kafka_2.13:3.8.1</code>. My assumption was that bumping all of <code>org.apache.kafka</code> dependencies to <code>3.9.1</code> will help, so I did, and result is:</p>\n<pre><code>java.lang.NoClassDefFoundError: kafka/utils/TestUtils\nat org.springframework.kafka.test.EmbeddedKafkaZKBroker$EmbeddedZookeeper.&lt;init&gt;(EmbeddedKafkaZKBroker.java:800) ~[spring-kafka-test-3.3.5.jar:3.3.5]\nat org.springframework.kafka.test.EmbeddedKafkaZKBroker.afterPropertiesSet(EmbeddedKafkaZKBroker.java:296) ~[spring-kafka-test-3.3.5.jar:3.3.5]\nat org.springframework.kafka.test.EmbeddedKafkaBrokerFactory.create(EmbeddedKafkaBrokerFactory.java:119) ~[spring-kafka-test-3.3.5.jar:3.3.5]\nat org.springframework.kafka.test.context.EmbeddedKafkaContextCustomizer.customizeContext(EmbeddedKafkaContextCustomizer.java:60) ~[spring-kafka-test-3.3.5.jar:3.3.5]\nat org.springframework.boot.test.context.SpringBootContextLoader$ContextCustomizerAdapter.initialize(SpringBootContextLoader.java:453) ~[spring-boot-test-3.4.5.jar:3.4.5]\nat org.springframework.boot.SpringApplication.applyInitializers(SpringApplication.java:612) ~[spring-boot-3.4.5.jar:3.4.5]\nat org.springframework.boot.SpringApplication.prepareContext(SpringApplication.java:383) ~[spring-boot-3.4.5.jar:3.4.5]\nat org.springframework.boot.SpringApplication.run(SpringApplication.java:317) ~[spring-boot-3.4.5.jar:3.4.5]\n</code></pre>\n<p>In fact <code>org.springframework.kafka.test.EmbeddedKafkaZKBroker</code> uses <code>kafka.utils.TestUtils</code> from <code>kafka_2.13</code> that was present in <code>3.8.1.</code> but is not available in <code>3.9.1</code>. I tried bumping <code>spring-kafka-test</code> to <code>3.3.7.</code>, but result is the same. Is there any possible way to make <code>kafka-clients:3.9.1</code> and <code>@EmbeddedKafka</code> work together?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}