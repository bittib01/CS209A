{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "graalvm",
      "graalvm-native-image",
      "spring-boot-3"
    ],
    "owner": {
      "account_id": 6899347,
      "reputation": 293,
      "user_id": 5299452,
      "user_type": "registered",
      "accept_rate": 67,
      "profile_image": "https://www.gravatar.com/avatar/776fb59e1b14e5a61f2fc8fd3cdb2255?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Vibhor Verma",
      "link": "https://stackoverflow.com/users/5299452/vibhor-verma"
    },
    "is_answered": false,
    "view_count": 104,
    "answer_count": 0,
    "score": 2,
    "last_activity_date": 1742531309,
    "creation_date": 1742470483,
    "last_edit_date": 1742531309,
    "question_id": 79522804,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79522804/graalvm-spring-boot-error-with-a-repository-entity-not-a-managed-type",
    "title": "GraalVM Spring Boot error with a repository/entity, not a managed type",
    "body": "<p>I am trying to migrate to GraalVM for Java-17 Springboot v3.4.1 based application. When I am running application with OpenJDK v17.0.14 , project is running fine. I am able to build with GraalVM, but on executing the build executable, it fails with not a managed type exception.</p>\n<p>For GraalVM, I am using <code>GraalVM Liberica-NIK-23.0.7-1 (build 17.0.14+10-LTS)</code></p>\n<p><strong>Stacktrace:</strong></p>\n<pre><code>Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'configLogRepository': Not a managed type: class com.project.demo.module.configLogs.domain.ConfigLog\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1808)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:336)\n        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:289)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:334)\n        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1573)\n        at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1519)\n        at org.springframework.beans.factory.aot.AutowiredFieldValueResolver.resolveValue(AutowiredFieldValueResolver.java:186)\n        ... 192 more\nCaused by: java.lang.IllegalArgumentException: Not a managed type: class com.project.demo.module.configLogs.domain.ConfigLog\n        at org.hibernate.metamodel.model.domain.internal.JpaMetamodelImpl.managedType(JpaMetamodelImpl.java:223)\n        at org.hibernate.metamodel.model.domain.internal.MappingMetamodelImpl.managedType(MappingMetamodelImpl.java:470)\n        at org.hibernate.metamodel.model.domain.internal.MappingMetamodelImpl.managedType(MappingMetamodelImpl.java:100)\n        at org.springframework.data.jpa.repository.support.JpaMetamodelEntityInformation.&lt;init&gt;(JpaMetamodelEntityInformation.java:82)\n        at org.springframework.data.jpa.repository.support.JpaEntityInformationSupport.getEntityInformation(JpaEntityInformationSupport.java:69)\n        at org.springframework.data.jpa.repository.support.JpaRepositoryFactory.getEntityInformation(JpaRepositoryFactory.java:251)\n        at org.springframework.data.jpa.repository.support.JpaRepositoryFactory.getTargetRepository(JpaRepositoryFactory.java:215)\n        at org.springframework.data.jpa.repository.support.JpaRepositoryFactory.getTargetRepository(JpaRepositoryFactory.java:198)\n        at org.springframework.data.jpa.repository.support.JpaRepositoryFactory.getTargetRepository(JpaRepositoryFactory.java:1)\n        at org.springframework.data.repository.core.support.RepositoryFactorySupport.getRepository(RepositoryFactorySupport.java:386)\n        at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.lambda$afterPropertiesSet$4(RepositoryFactoryBeanSupport.java:350)\n        at org.springframework.data.util.Lazy.getNullable(Lazy.java:135)\n        at org.springframework.data.util.Lazy.get(Lazy.java:113)\n        at org.springframework.data.repository.core.support.RepositoryFactoryBeanSupport.afterPropertiesSet(RepositoryFactoryBeanSupport.java:356)\n        at org.springframework.data.jpa.repository.support.JpaRepositoryFactoryBean.afterPropertiesSet(JpaRepositoryFactoryBean.java:132)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1855)\n        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1804)\n        ... 201 more\n</code></pre>\n<p>Complete Stacktrace: <a href=\"https://gist.github.com/vibhcool/dabbe7196c1b2572942fd969af91ff70\" rel=\"nofollow noreferrer\">https://gist.github.com/vibhcool/dabbe7196c1b2572942fd969af91ff70</a></p>\n<p>My DatabaseConfiguration has single DataSource with configs as follows:</p>\n<pre><code>package com.project.demo.config;\n\nimport com.zaxxer.hikari.HikariDataSource;\nimport java.util.HashMap;\nimport java.util.Map;\nimport javax.sql.DataSource;\n\nimport lombok.AllArgsConstructor;\n\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.boot.jdbc.DataSourceBuilder;\nimport org.springframework.boot.orm.jpa.EntityManagerFactoryBuilder;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Primary;\nimport org.springframework.core.env.Environment;\nimport org.springframework.data.jpa.repository.config.EnableJpaRepositories;\nimport org.springframework.orm.jpa.JpaTransactionManager;\nimport org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;\nimport org.springframework.transaction.PlatformTransactionManager;\nimport org.springframework.transaction.annotation.EnableTransactionManagement;\nimport org.springframework.context.EnvironmentAware;\nimport jakarta.persistence.EntityManagerFactory;\n\n@Configuration\n@EnableTransactionManagement\n@EnableJpaRepositories(entityManagerFactoryRef = &quot;postgresEntityManagerFactory&quot;,\n        transactionManagerRef = &quot;postgresTransactionManager&quot;,\n        basePackages = &quot;com.project.demo&quot;)\n@AllArgsConstructor\npublic class DatabaseConfiguration implements EnvironmentAware {\n\n    private Environment environment;\n\n    @Override\n    public void setEnvironment(Environment environment) {\n        this.environment = environment;\n    }\n\n    @Primary\n    @Bean(name = &quot;postgresDataSource&quot;)\n    @ConfigurationProperties(prefix = &quot;spring.datasource&quot;)\n    public HikariDataSource dataSource() {\n        return DataSourceBuilder.create().type(HikariDataSource.class)\n                .driverClassName(&quot;org.postgresql.Driver&quot;)\n                .url(&quot;jdbc:postgresql://localhost:5432/demo&quot;)\n                .username(environment.getProperty(&quot;spring.datasource.username&quot;))\n                .password(environment.getProperty(&quot;spring.datasource.password&quot;)).build();\n    }\n\n    public Map&lt;String, String&gt; hikariConfig() {\n        Map&lt;String, String&gt; properties = new HashMap&lt;&gt;();\n        properties.put(&quot;driverClassName&quot;, &quot;org.postgresql.Driver&quot;);\n        properties.put(&quot;url&quot;, &quot;jdbc:postgresql://localhost:5432/demo&quot;);\n        properties.put(&quot;username&quot;, environment.getProperty(&quot;spring.datasource.username&quot;));\n        properties.put(&quot;password&quot;, environment.getProperty(&quot;spring.datasource.password&quot;));\n        properties.put(&quot;minimumIdle&quot;, &quot;5&quot;); properties.put(&quot;maximumPoolSize&quot;, &quot;8&quot;);\n        properties.put(&quot;idleTimeout&quot;, &quot;30000&quot;);\n        properties.put(&quot;poolName&quot;, &quot;SpringBootJPAHikariCP&quot;);\n        properties.put(&quot;maxLifetime&quot;, &quot;600000&quot;); properties.put(&quot;keepaliveTime&quot;, &quot;60000&quot;);\n        properties.put(&quot;connectionTimeout&quot;, &quot;30000&quot;);\n        properties.put(&quot;initializationFailTimeout&quot;, &quot;10000&quot;);\n        properties.put(&quot;minimumIdle&quot;, &quot;10000&quot;);\n        return properties;\n    }\n\n    @Bean(name = &quot;postgresTransactionManager&quot;)\n    public PlatformTransactionManager transactionManager(EntityManagerFactory entityManagerFactory) {\n        return new JpaTransactionManager(entityManagerFactory);\n    }\n\n    @Bean(name = &quot;postgresEntityManagerFactory&quot;)\n    public LocalContainerEntityManagerFactoryBean entityManagerFactory(EntityManagerFactoryBuilder entityManagerFactoryBuilder, @Qualifier(&quot;postgresDataSource&quot;) DataSource dataSource) {\n        return entityManagerFactoryBuilder.dataSource(dataSource).packages(&quot;com.project.demo&quot;).properties(hikariConfig()).build();\n    }\n}\n</code></pre>\n<p><strong>ConfigLog Entity Class:</strong></p>\n<pre><code>package com.project.demo.module.configLogs.domain;\n\nimport com.project.demo.module.masters.constants.OperationType;\nimport jakarta.persistence.*;\nimport lombok.Getter;\nimport lombok.Setter;\nimport java.time.LocalDateTime;\n\n@Entity\n@Table(name = &quot;config_log&quot;)\n@Getter\n@Setter\npublic class ConfigLog {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column(name = &quot;user_id&quot;)\n    private Long userId;\n\n    @Column(name = &quot;company_id&quot;)\n    private Long companyId;\n\n    @Column(name = &quot;operation_type&quot;)\n    @Enumerated(value = EnumType.STRING)\n    private OperationType operationType;\n\n    @Column(name = &quot;log_time&quot;)\n    private LocalDateTime logTime = LocalDateTime.now();\n\n    @Column(name = &quot;json&quot;)\n    private String json;\n\n    @Override\n    public String toString() {\n        return &quot;ConfigLog{&quot; +\n                &quot;id=&quot; + id +\n                &quot;, userId=&quot; + userId +\n                &quot;, companyId=&quot; + companyId +\n                &quot;, operationType=&quot; + operationType +\n                &quot;, logTime=&quot; + logTime +\n                &quot;, json='&quot; + json + '\\'' +\n                '}';\n    }\n}\n</code></pre>\n<p>Repository class:</p>\n<pre><code>package com.project.demo.module.configLogs.repository;\n\nimport com.project.demo.module.configLogs.domain.ConfigLog;\nimport org.springframework.data.jpa.repository.JpaRepository;\nimport org.springframework.stereotype.Repository;\n\n@Repository\npublic interface ConfigLogRepository extends JpaRepository&lt;ConfigLog, Long&gt; {\n\n}\n\n</code></pre>\n<p>Before creating question, I verified forllowing based on SO questions and github issues pages:</p>\n<ol>\n<li>I am using <code>jakarta.persistence</code> instead of <code>javax.persistence</code></li>\n<li>Similar issue is reported for Projects with multiple DataSource, I verified that I am only using single DataSource</li>\n<li>I have <code>org.hibernate.orm:hibernate-core:6.6.4.Final</code> and <code>org.hibernate.javax.persistence:hibernate-jpa-2.1-api:1.0.0.Final</code> in dependency tree.</li>\n</ol>\n<p>pom.xml : <a href=\"https://gist.github.com/vibhcool/da2388d6688bbb5a652f2cc6b3677e27\" rel=\"nofollow noreferrer\">https://gist.github.com/vibhcool/da2388d6688bbb5a652f2cc6b3677e27</a></p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}