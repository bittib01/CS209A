{
  "question": {
    "tags": [
      "java",
      "multithreading",
      "javafx",
      "concurrency",
      "casting"
    ],
    "owner": {
      "account_id": 18463907,
      "reputation": 185,
      "user_id": 13468313,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/26fc95693e4b2b6e916c27eeab95a2ed?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Foxler2010",
      "link": "https://stackoverflow.com/users/13468313/foxler2010"
    },
    "is_answered": false,
    "view_count": 98,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1750369631,
    "creation_date": 1750369631,
    "question_id": 79672672,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79672672/javafx-concurrency-objects-changing-type",
    "title": "JavaFX Concurrency: Objects &quot;changing&quot; type",
    "body": "<p>I'm creating an implementation of Minesweeper using JavaFX. Here, I have some code that runs in another thread and updates the GUI with the state of the game. It loops thru all the cells on the board and draws the correct thing on the screen.</p>\n<pre><code>for (int x = 0; x &lt; boardWidth(); x++) {\n    for (int y = 0; y &lt; boardHeight(); y++) {\n        int finalY = y;\n        int finalX = x;\n        if (isCleared(finalX, finalY)) {\n            Platform.runLater(() -&gt; drawEmptySquare(finalX, finalY));\n            if (getCell(finalX, finalY) instanceof Mine) {\n                Platform.runLater(() -&gt; drawMine(finalX, finalY));\n            } else if (getCell(finalX, finalY) instanceof NumberCell) {\n                Platform.runLater(() -&gt; drawNumber(finalX, finalY, ((NumberCell) getCell(finalX, finalY)).getNumMines()));\n            }\n        } else if (isFlagged(finalX, finalY)) {\n            Platform.runLater(() -&gt; drawFlag(finalX, finalY));\n        } else {\n            Platform.runLater(() -&gt; drawFullSquare(finalX, finalY));\n        } // end if\n    } // end inner for\n} // end outer for\n</code></pre>\n<p>For most of the time that the app is running, there are no problems. However, when I start a new game, an error message is printed to the console:</p>\n<pre><code>Exception in thread &quot;JavaFX Application Thread&quot; java.lang.ClassCastException: class EmptyCell cannot be cast to class NumberCell (EmptyCell and NumberCell are in unnamed module of loader 'app')\n</code></pre>\n<p>This should be impossible, right? I do have an <code>instanceof</code> check right before the casting happens, which should prevent this specific exception.</p>\n<p>Clearly, something is happening in my code that is allowing an <code>EmptyCell</code> to be used where only a <code>NumberCell</code> should be. I think that the root of my problem lies in the fact that this code is running on a second thread, but I don't know exactly why that is causing <code>EmptyCell</code>s to be used right after we checked that it was a <code>NumberCell</code>.</p>\n<p>How is this exception happening, and what is the proper way to do this that avoids the exception?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}