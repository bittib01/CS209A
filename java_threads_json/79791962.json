{
  "question": {
    "tags": [
      "java",
      "maven",
      "intellij-idea",
      "slf4j",
      "maven-surefire-plugin"
    ],
    "owner": {
      "account_id": 9107988,
      "reputation": 4117,
      "user_id": 6777695,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/82120153a9fce415fd4983897d45d441?s=256&d=identicon&r=PG",
      "display_name": "Hakan54",
      "link": "https://stackoverflow.com/users/6777695/hakan54"
    },
    "is_answered": true,
    "view_count": 128,
    "accepted_answer_id": 79792462,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1761814908,
    "creation_date": 1760605414,
    "last_edit_date": 1760605811,
    "question_id": 79791962,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79791962/noclassdeffounderror-org-slf4j-loggerfactory-when-running-in-intellij-but-works",
    "title": "NoClassDefFoundError: org/slf4j/LoggerFactory when running in Intellij but works fine from the command line",
    "body": "<p>I am having issues related to my tests which are failing because of slf4j-api being absent, which does not make sense because it is present as it is provided as a transitive dependency from one of the libraries.</p>\n<p>The error is:</p>\n<pre><code>java.lang.NoClassDefFoundError: org/slf4j/LoggerFactory\n\n    at nl.altindag.log.util.LogbackUtils.getSlf4jLogger(LogbackUtils.java:66)\n    at nl.altindag.log.util.LogbackUtils.getLogger(LogbackUtils.java:52)\n    at nl.altindag.log.LogCaptor.&lt;init&gt;(LogCaptor.java:56)\n    at nl.altindag.log.LogCaptor.forName(LogCaptor.java:91)\n    at nl.altindag.ssl@10.0.1-SNAPSHOT/nl.altindag.ssl.keymanager.KeyManagerFactoryWrapperShould.&lt;init&gt;(KeyManagerFactoryWrapperShould.java:41)\n    at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:490)\n    at java.base/java.util.Optional.orElseGet(Optional.java:369)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1541)\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1541)\nCaused by: java.lang.ClassNotFoundException: org.slf4j.LoggerFactory\n    at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:581)\n    at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)\n    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:526)\n    ... 9 more\n</code></pre>\n<p>Which indicates that the slf4j-api is absent. However, mvn dependency tree should give more insight of what is being present.</p>\n<pre><code>[INFO] --- dependency:3.7.0:tree (default-cli) @ ayza ---\n[INFO] io.github.hakky54:ayza:jar:10.0.1-SNAPSHOT\n[INFO] +- io.github.hakky54:yaslf4j:jar:1.0.5:compile\n[INFO] +- org.junit.jupiter:junit-jupiter-api:jar:5.14.0:test\n[INFO] |  +- org.opentest4j:opentest4j:jar:1.3.0:test\n[INFO] |  +- org.junit.platform:junit-platform-commons:jar:1.14.0:test\n[INFO] |  \\- org.apiguardian:apiguardian-api:jar:1.1.2:test\n[INFO] +- org.junit.jupiter:junit-jupiter-engine:jar:5.14.0:test\n[INFO] |  \\- org.junit.platform:junit-platform-engine:jar:1.14.0:test\n[INFO] +- org.mockito:mockito-junit-jupiter:jar:5.11.0:test\n[INFO] |  \\- org.mockito:mockito-core:jar:5.11.0:test\n[INFO] |     +- net.bytebuddy:byte-buddy-agent:jar:1.17.8:test\n[INFO] |     \\- org.objenesis:objenesis:jar:3.3:test\n[INFO] +- org.assertj:assertj-core:jar:3.27.6:test\n[INFO] |  \\- net.bytebuddy:byte-buddy:jar:1.17.8:test\n[INFO] +- io.github.hakky54:logcaptor:jar:2.12.1:test\n[INFO] |  +- ch.qos.logback:logback-classic:jar:1.3.15:test\n[INFO] |  |  \\- ch.qos.logback:logback-core:jar:1.3.15:test\n[INFO] |  +- org.apache.logging.log4j:log4j-to-slf4j:jar:2.25.1:test\n[INFO] |  |  \\- org.apache.logging.log4j:log4j-api:jar:2.25.1:test\n[INFO] |  \\- org.slf4j:jul-to-slf4j:jar:2.0.17:test\n[INFO] +- io.github.hakky54:ssl-server:jar:1.0.8:test\n[INFO] |  +- io.netty:netty-codec-http:jar:4.2.4.Final:test\n[INFO] |  |  +- io.netty:netty-common:jar:4.2.4.Final:test\n[INFO] |  |  +- io.netty:netty-buffer:jar:4.2.4.Final:test\n[INFO] |  |  +- io.netty:netty-transport:jar:4.2.4.Final:test\n[INFO] |  |  |  \\- io.netty:netty-resolver:jar:4.2.4.Final:test\n[INFO] |  |  +- io.netty:netty-codec-base:jar:4.2.4.Final:test\n[INFO] |  |  +- io.netty:netty-codec-compression:jar:4.2.4.Final:test\n[INFO] |  |  \\- io.netty:netty-handler:jar:4.2.4.Final:test\n[INFO] |  |     \\- io.netty:netty-transport-native-unix-common:jar:4.2.4.Final:test\n[INFO] |  \\- org.bouncycastle:bcpkix-jdk18on:jar:1.82:test\n[INFO] |     \\- org.bouncycastle:bcutil-jdk18on:jar:1.82:test\n[INFO] |        \\- org.bouncycastle:bcprov-jdk18on:jar:1.82:test\n[INFO] \\- org.java-websocket:Java-WebSocket:jar:1.6.0:test\n[INFO]    \\- org.slf4j:slf4j-api:jar:2.0.13:test\n</code></pre>\n<p>slf4j-api is being provided as a transitive dependency via <code>ch.qos.logback:logback-core</code> which comes from <code>io.github.hakky54:logcaptor</code> and <code>org.java-websocket:Java-WebSocket</code> which are both marked as test scoped dependencies.</p>\n<p>When I run <code>mvn dependency:list</code> it also correctly shows that <code>slf4j-api</code> is present, see here:</p>\n<pre><code>[INFO] The following files have been resolved:\n[INFO]    io.github.hakky54:yaslf4j:jar:1.0.5:compile -- module nl.altindag.yaslf4j\n[INFO]    org.junit.jupiter:junit-jupiter-api:jar:5.14.0:test -- module org.junit.jupiter.api\n[INFO]    org.opentest4j:opentest4j:jar:1.3.0:test -- module org.opentest4j\n[INFO]    org.junit.platform:junit-platform-commons:jar:1.14.0:test -- module org.junit.platform.commons\n[INFO]    org.apiguardian:apiguardian-api:jar:1.1.2:test -- module org.apiguardian.api\n[INFO]    org.junit.jupiter:junit-jupiter-engine:jar:5.14.0:test -- module org.junit.jupiter.engine\n[INFO]    org.junit.platform:junit-platform-engine:jar:1.14.0:test -- module org.junit.platform.engine\n[INFO]    org.mockito:mockito-junit-jupiter:jar:5.11.0:test -- module org.mockito.junit.jupiter [auto]\n[INFO]    org.mockito:mockito-core:jar:5.11.0:test -- module org.mockito [auto]\n[INFO]    net.bytebuddy:byte-buddy-agent:jar:1.17.8:test -- module net.bytebuddy.agent\n[INFO]    org.objenesis:objenesis:jar:3.3:test -- module org.objenesis [auto]\n[INFO]    org.assertj:assertj-core:jar:3.27.6:test -- module org.assertj.core\n[INFO]    net.bytebuddy:byte-buddy:jar:1.17.8:test -- module net.bytebuddy\n[INFO]    io.github.hakky54:logcaptor:jar:2.12.1:test -- module nl.altindag.logcaptor\n[INFO]    ch.qos.logback:logback-classic:jar:1.3.15:test -- module ch.qos.logback.classic\n[INFO]    ch.qos.logback:logback-core:jar:1.3.15:test -- module ch.qos.logback.core\n[INFO]    org.apache.logging.log4j:log4j-to-slf4j:jar:2.25.1:test -- module org.apache.logging.log4j.to.slf4j\n[INFO]    org.apache.logging.log4j:log4j-api:jar:2.25.1:test -- module org.apache.logging.log4j\n[INFO]    org.slf4j:jul-to-slf4j:jar:2.0.17:test -- module jul.to.slf4j\n[INFO]    io.github.hakky54:ssl-server:jar:1.0.8:test -- module nl.altindag.ssl.server\n[INFO]    io.netty:netty-codec-http:jar:4.2.4.Final:test -- module io.netty.codec.http\n[INFO]    io.netty:netty-common:jar:4.2.4.Final:test -- module io.netty.common\n[INFO]    io.netty:netty-buffer:jar:4.2.4.Final:test -- module io.netty.buffer\n[INFO]    io.netty:netty-transport:jar:4.2.4.Final:test -- module io.netty.transport\n[INFO]    io.netty:netty-resolver:jar:4.2.4.Final:test -- module io.netty.resolver\n[INFO]    io.netty:netty-codec-base:jar:4.2.4.Final:test -- module io.netty.codec\n[INFO]    io.netty:netty-codec-compression:jar:4.2.4.Final:test -- module io.netty.codec.compression\n[INFO]    io.netty:netty-handler:jar:4.2.4.Final:test -- module io.netty.handler\n[INFO]    io.netty:netty-transport-native-unix-common:jar:4.2.4.Final:test -- module io.netty.transport.unix.common\n[INFO]    org.bouncycastle:bcpkix-jdk18on:jar:1.82:test -- module org.bouncycastle.pkix\n[INFO]    org.bouncycastle:bcutil-jdk18on:jar:1.82:test -- module org.bouncycastle.util\n[INFO]    org.bouncycastle:bcprov-jdk18on:jar:1.82:test -- module org.bouncycastle.provider\n[INFO]    org.java-websocket:Java-WebSocket:jar:1.6.0:test -- module org.java_websocket\n[INFO]    org.slf4j:slf4j-api:jar:2.0.13:test -- module org.slf4j\n</code></pre>\n<p>I am using <a href=\"https://github.com/Hakky54/yaslf4j\" rel=\"nofollow noreferrer\">yaslf4j</a> as logging api. Which tries to log to slf4j api, fallbacks to log4j2 api and if that is also absent it fallsback to java util logging. I am using this custom logging api so I don't enforce my end-user to use slf4j however, if they are using slf4j it will redirect to logs to slf4j. And the same goes for log4j2. And some end-users don't prefer to use a logging api at all and in that case it will log it to java util logger. The <a href=\"https://github.com/Hakky54/yaslf4j/blob/master/pom.xml#L66-L71\" rel=\"nofollow noreferrer\">pom</a> of yaslf4j has declared slf4j as provided scope, so it will not be included as a transitive dependency for anyone who will use it. The <a href=\"https://github.com/Hakky54/ayza\" rel=\"nofollow noreferrer\">ayza</a> library where I am encountering the issue is now logging to yaslf4j during the tests. Sfl4j api is present during the tests so yaslf4j it forwarding to slf4j-api. I am using <a href=\"https://github.com/Hakky54/log-captor\" rel=\"nofollow noreferrer\">log-captor</a> to captured these logs so I can do assertion on it however it fails to create the logger as it is saying: <code>java.lang.NoClassDefFoundError: org/slf4j/LoggerFactory</code></p>\n<p>The strange part is when I am running <code>mvn clean install</code> from the terminal it works. When I am running the test from intellij as shown below it fails</p>\n<p><a href=\"https://i.sstatic.net/3WN9HwlD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/3WN9HwlD.png\" alt=\"intellij test runner\" /></a></p>\n<p><strong>How to reproduce?</strong></p>\n<ol>\n<li>run <code>git clone https://github.com/Hakky54/ayza.git</code></li>\n<li>run <code>git switch feature/make-slf4j-logger-optional</code></li>\n<li>ensure java 11 or above is configured</li>\n<li>run <code>mvn clean install</code></li>\n</ol>\n<p>Analyse the build result as it will show it has been build sucessfull.</p>\n<ol start=\"5\">\n<li>Open project from Intellij IDEA</li>\n<li>Run test from the explorer as shown from the screenshot above</li>\n</ol>\n<p>The test will fail</p>\n<p>Looking into the maven dependency tree, maven dependency list and the dependency declarations in the pom it gives me the feeling that everything is ok. Running it in the terminal confirms that it works as expected. So my feeling is saying that intellij has trouble resolving the dependencies, but I am not sure. Does someone know what I might have done wrong or should I configure intellij differently? As a side note, I did run invalidate caches. I have tried it on Mac OS and Linux/pop os getting the same failures.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}