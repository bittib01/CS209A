{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "oauth-2.0",
      "spring-authorization-server"
    ],
    "owner": {
      "account_id": 29313159,
      "reputation": 198,
      "user_id": 22458461,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/8bf1f316f8f23997ac18c812d6b73a72?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "fforfabio",
      "link": "https://stackoverflow.com/users/22458461/fforfabio"
    },
    "is_answered": false,
    "view_count": 180,
    "answer_count": 0,
    "score": 1,
    "last_activity_date": 1740397217,
    "creation_date": 1739975292,
    "last_edit_date": 1740397217,
    "question_id": 79451710,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79451710/oauth2-token-revocation-endpoint",
    "title": "OAuth2 Token Revocation Endpoint",
    "body": "<p>I'm trying to write my custom OAuth2 Token Revocation Endpoint as explained <a href=\"https://docs.spring.io/spring-authorization-server/reference/protocol-endpoints.html#oauth2-token-revocation-endpoint\" rel=\"nofollow noreferrer\">here</a> but I'm facing an issue.</p>\n<p>Inside my custom <code>.errorResponseHandler(errorResponseHandler)</code> I want to catch and handle the <strong>OAuth2AuthenticationException</strong> that the <strong>authenticationProvider</strong> throw but this does not happen.<br />\nI've also change approach and I've created a custom <code>CustomAuthenticationEntryPoint implements AuthenticationEntryPoint</code> and insert it inside the filterChain but nothing.</p>\n<p>These are my classes:</p>\n<p><strong>filterChain</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration(proxyBeanMethods = false)\n@EnableWebSecurity\n@Profile(&quot;dev&quot;)\npublic class AuthServerConfigDev extends AuthServerConfigAbstract{\n    private static final Logger logger = LoggerFactory.getLogger(AuthServerConfigDev.class);\n\n    private final OAuth2AuthorizationService authorizationService;\n    //private final TokenRevocationRepository tokenRevocationRepository;\n\n    public AuthServerConfigDev(@Lazy OAuth2AuthorizationService authorizationService/*, TokenRevocationRepository tokenRevocationRepository*/) {\n        this.authorizationService = authorizationService;\n        // this.tokenRevocationRepository = tokenRevocationRepository;\n    }\n\n    @Bean  \n    @Order(Ordered.HIGHEST_PRECEDENCE)\n    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {\n        \n        OAuth2AuthorizationServerConfigurer authzServerConfigurer = new OAuth2AuthorizationServerConfigurer();\n\n        authzServerConfigurer\n            .oidc(withDefaults());\n\n        authzServerConfigurer\n                .authorizationEndpoint(authorizationEndpoint -&gt; authorizationEndpoint\n                        .errorResponseHandler(new ClientAuthenticationFailureHandler()));\n\n        authzServerConfigurer\n                .tokenEndpoint(tokenEndpoint -&gt; tokenEndpoint\n                        .errorResponseHandler(new ClientAuthenticationFailureHandler()));\n        \n        RequestMatcher endpointsMatcher = authzServerConfigurer.getEndpointsMatcher();\n\n        http.addFilterBefore(new GrantFlowFilter(new ClientAuthenticationFailureHandler()), UsernamePasswordAuthenticationFilter.class);\n\n        \n        http\n            .securityMatchers(matchers -&gt; matchers\n                .requestMatchers(\n                        antMatcher(OPENAPI_JSON_URL),\n                        antMatcher(SWAGGER_UI_URL),\n                        antMatcher(REST_USER_PATH + &quot;/**&quot;),\n                        antMatcher(REVOKE_ENDPOINT),\n                        endpointsMatcher))\n            .authorizeHttpRequests(authorize -&gt; authorize\n                .requestMatchers(HttpMethod.GET, OPENAPI_JSON_URL).hasAuthority(&quot;SCOPE.user&quot;)\n                .requestMatchers(HttpMethod.GET, SWAGGER_UI_URL).hasAuthority(&quot;SCOPE.user&quot;)\n                .requestMatchers(FULL_LOGIN_URL).permitAll()\n                .requestMatchers(REVOKE_ENDPOINT).authenticated()\n                .anyRequest().authenticated())\n            .csrf(csrf -&gt; csrf\n                    .ignoringRequestMatchers(endpointsMatcher))\n            .exceptionHandling(exceptions -&gt; exceptions\n                .defaultAuthenticationEntryPointFor(\n                    new LoginUrlAuthenticationEntryPoint(FULL_LOGIN_URL + ParamMissingAuth),\n                    new MediaTypeRequestMatcher(MediaType.TEXT_HTML)))\n            .oauth2ResourceServer(resourceServer -&gt; resourceServer.jwt(withDefaults()))\n            .with(authzServerConfigurer, (authorizationServer) -&gt;\n                    authorizationServer\n                            // As defined in the guide\n                            .tokenRevocationEndpoint(tokenRevocationEndpoint -&gt;\n                                    tokenRevocationEndpoint\n                                            .revocationRequestConverter(new CustomRevocationRequestConverter())\n                                            .authenticationProvider(new CustomRevocationAuthenticationProvider(authorizationService/*, tokenRevocationRepository*/))\n                                            .revocationResponseHandler(new CustomRevocationResponseHandler())\n                                            .errorResponseHandler(new CustomRevocationErrorResponseHandler())));\n\n            return http.build();\n        }\n}\n</code></pre>\n<p><strong>CustomRevocationRequestConverter</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>public class CustomRevocationRequestConverter implements AuthenticationConverter {\n\n    @Override\n    public Authentication convert(HttpServletRequest request) {\n        // Extract the token and token_type_hint from the request parameters\n        String tokenValue = request.getParameter(&quot;token&quot;);\n        String tokenTypeHint = request.getParameter(&quot;token_type_hint&quot;);\n\n        if (tokenValue == null || tokenValue.isEmpty()) {\n            return null; // Return null if the token is not present\n        }\n\n        // Retrieve the client authentication from the SecurityContext\n        Authentication clientPrincipal = SecurityContextHolder.getContext().getAuthentication();\n\n        // Create and return an OAuth2TokenRevocationAuthenticationToken\n        if(tokenTypeHint != null &amp;&amp; !tokenTypeHint.isEmpty())\n            return new OAuth2TokenRevocationAuthenticationToken(tokenValue, clientPrincipal, tokenTypeHint);\n        else {\n            return new OAuth2TokenRevocationAuthenticationToken(tokenValue, clientPrincipal, null);\n        }\n    }\n}\n</code></pre>\n<p><strong>CustomRevocationAuthenticationProvider</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>public class CustomRevocationAuthenticationProvider implements AuthenticationProvider {\n\n    private static final Logger logger = LoggerFactory.getLogger(CustomRevocationAuthenticationProvider.class);\n\n    private final OAuth2AuthorizationService authorizationService;\n    // private final TokenRevocationRepository tokenRevocationRepository;\n\n    public CustomRevocationAuthenticationProvider(OAuth2AuthorizationService authorizationService/*, TokenRevocationRepository tokenRevocationRepository*/) {\n        this.authorizationService = authorizationService;\n        // this.tokenRevocationRepository = tokenRevocationRepository;\n    }\n\n\n    @Transactional\n    @Override\n    public Authentication authenticate(Authentication authentication) throws AuthenticationException {\n        // Check if the authentication object is an instance of OAuth2TokenRevocationAuthenticationToken\n        if (authentication instanceof OAuth2TokenRevocationAuthenticationToken revocationToken) {\n\n            // Extract the token and client authentication details\n            String tokenValue = revocationToken.getToken(); // JWT\n            Authentication clientPrincipal = (Authentication) revocationToken.getPrincipal();  // Cast the principal to Authentication\n            String tokenTypeHint = revocationToken.getTokenTypeHint(); // Token type [access_token, refresh_token]\n            String principalName = clientPrincipal.getName();  // Extract the principal name\n\n            try {\n                if (validateAndRevokeToken(tokenValue, tokenTypeHint, principalName)) {\n                    return new OAuth2TokenRevocationAuthenticationToken(revocationToken.getToken(), clientPrincipal, tokenTypeHint);\n                }\n\n            } catch (OAuth2AuthenticationException e) {\n                // This is the exception that I want to catch and handle with CustomRevocationErrorResponseHandler \n                logger.error(&quot;{} - {}&quot;, &quot;CustomRevocationAuthenticationProvider.authenticate&quot;, e.getError());\n                throw e;\n                // throw new AuthenticationServiceException(e.getError().getDescription(), e);\n            } catch (Exception e) {\n                // Catch all other exceptions including SQL exceptions\n                logger.error(&quot;{} - {}&quot;, &quot;CustomRevocationAuthenticationProvider.authenticate&quot;, e);\n                throw new OAuth2AuthenticationException(new OAuth2Error(SERVER_ERROR, &quot;An error occurred while processing the token revocation request&quot;, null), e);\n            }\n        }\n        return null;\n    }\n\n\n    // Custom validation logic for the token\n    private boolean validateAndRevokeToken(String tokenValue, String tokenType, String principalName) {\n        try {\n            OAuth2Authorization authorization = authorizationService.findByToken(tokenValue, OAuth2TokenType.ACCESS_TOKEN);\n\n            if (authorization == null) {\n                return false; // Token does not exist\n            }\n\n            int deletedRows;\n            if(tokenType != null &amp;&amp; tokenType.equalsIgnoreCase(OAuth2TokenType.ACCESS_TOKEN.getValue())) {\n                // Revocation logic\n                //Optional&lt;Oauth2ClientIdDTO&gt; oauth2ClientIdDTO = tokenRevocationRepository.findClientIdByAccessTokenValue(tokenValue);\n                //validateClientIdDto(oauth2ClientIdDTO, principalName, authorization); // If a check fail it throws OAuth2AuthenticationException\n                //deletedRows = tokenRevocationRepository.deleteByAccessTokenValue(tokenValue);\n\n            } else if (tokenType != null &amp;&amp; tokenType.equalsIgnoreCase(OAuth2TokenType.REFRESH_TOKEN.getValue())) {\n                // Revocation logic\n                //Optional&lt;Oauth2ClientIdDTO&gt; oauth2ClientIdDTO = tokenRevocationRepository.findClientIdByRefreshTokenValue(tokenValue);\n                //validateClientIdDto(oauth2ClientIdDTO, principalName, authorization); // If a check fail it throws OAuth2AuthenticationException\n                //deletedRows = tokenRevocationRepository.deleteByRefreshTokenValue(tokenValue);\n\n            } else {\n                // Revocation logic\n                //Optional&lt;Oauth2ClientIdDTO&gt; oauth2ClientIdDTO = tokenRevocationRepository.findClientIdByAccessTokenValueOrRefreshToken(tokenValue, tokenValue);\n                //validateClientIdDto(oauth2ClientIdDTO, principalName, authorization); // If a check fail it throws OAuth2AuthenticationException\n                //deletedRows = tokenRevocationRepository.deleteByAccessTokenValueOrRefreshTokenValue(tokenValue, tokenValue);\n            }\n\n            if(deletedRows &gt; 0)\n                logger.info(&quot;Token revoked.&quot;);\n\n            return true;\n        } catch (OAuth2AuthenticationException e) {\n            // This is the exception that I want to catch and handle with CustomRevocationErrorResponseHandler \n            logger.error(&quot;{} - {}&quot;, &quot;CustomRevocationAuthenticationProvider.validateAndRevokeToken&quot;, e.getError());\n            throw e;\n        } catch (Exception e) {\n            logger.error(&quot;{} - {}&quot;, &quot;CustomRevocationAuthenticationProvider.validateAndRevokeToken&quot;, e);\n            throw new OAuth2AuthenticationException(new OAuth2Error(SERVER_ERROR, &quot;An error occurred while validating the token&quot;, null), e);\n        }\n    }\n\n    // This is the method that throws the exception that I want to catch and handle with CustomRevocationErrorResponseHandler \n    private void validateClientIdDto(Optional&lt;Oauth2ClientIdDTO&gt; oauth2ClientIdDTO, String principalName, OAuth2Authorization authorization) {\n        logger.debug(&quot;Validating client id of the token to revoke.&quot;);\n        oauth2ClientIdDTO.ifPresentOrElse(dto -&gt; {\n            if (!dto.getClient_id().equalsIgnoreCase(principalName) || !dto.getId().equalsIgnoreCase(authorization.getRegisteredClientId())) {\n                throw new OAuth2AuthenticationException(new OAuth2Error(INVALID_CLIENT, &quot;Client ID validation failed&quot;, null));\n            }}, () -&gt; { // empty optional\n                throw new OAuth2AuthenticationException(new OAuth2Error(INVALID_CLIENT, &quot;Client ID not found&quot;, null));\n            });\n    }\n\n\n    @Override\n    public boolean supports(Class&lt;?&gt; authentication) {\n        return OAuth2TokenRevocationAuthenticationToken.class.isAssignableFrom(authentication);\n    }\n}\n</code></pre>\n<p><strong>CustomRevocationResponseHandler</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>public class CustomRevocationResponseHandler implements AuthenticationSuccessHandler {\n\n    @Override\n    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException {\n\n        // Handle the success response for token revocation\n        response.setStatus(HttpServletResponse.SC_OK);\n        response.setContentType(&quot;application/json&quot;);\n        response.getWriter().write(&quot;{\\&quot;message\\&quot;:\\&quot;Token revoked successfully\\&quot;}&quot;);\n    }\n}\n</code></pre>\n<p><strong>CustomRevocationErrorResponseHandler</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>public class CustomRevocationErrorResponseHandler implements AuthenticationFailureHandler {\n\n    @Override\n    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException {\n\n        if (exception instanceof OAuth2AuthenticationException) {\n\n            OAuth2Error error = ((OAuth2AuthenticationException) exception).getError();\n            String errorCode = error.getErrorCode();\n            String errorDescription = error.getDescription();\n\n\n            // Set the appropriate HTTP status code and error response body based on RFC 6749 Section 5.2\n            response.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n            response.setContentType(&quot;application/json&quot;);\n\n            String errorResponse = String.format(&quot;{\\&quot;error\\&quot;:\\&quot;%s\\&quot;,\\&quot;error_description\\&quot;:\\&quot;%s\\&quot;}&quot;, errorCode, errorDescription);\n            response.getWriter().write(errorResponse);\n\n        } else {\n            response.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n            response.setContentType(&quot;application/json&quot;);\n            response.getWriter().write(&quot;{\\&quot;error\\&quot;:\\&quot;invalid_request\\&quot;,\\&quot;error_description\\&quot;:\\&quot;Invalid request\\&quot;}&quot;);\n        }\n    }\n}\n</code></pre>\n<p><strong>pom.xml</strong></p>\n<pre class=\"lang-java prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n    &lt;packaging&gt;jar&lt;/packaging&gt;\n    \n    &lt;properties&gt;\n        &lt;java.version&gt;17&lt;/java.version&gt;\n        &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;\n        &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n        &lt;project.reporting.outputEncoding&gt;UTF8&lt;/project.reporting.outputEncoding&gt;\n        &lt;springboot.version&gt;3.4.2&lt;/springboot.version&gt;\n        &lt;springsecurity.version&gt;6.4.2&lt;/springsecurity.version&gt;\n        &lt;auth.server.version&gt;1.4.1&lt;/auth.server.version&gt;\n        &lt;spring.oauth2.client.version&gt;6.4.2&lt;/spring.oauth2.client.version&gt;\n        &lt;spring.boot.starter.log4j2.version&gt;3.4.2&lt;/spring.boot.starter.log4j2.version&gt;\n        &lt;sql.server.jdbc.version&gt;12.8.1.jre8&lt;/sql.server.jdbc.version&gt;\n        &lt;open.api.version&gt;2.8.3&lt;/open.api.version&gt;\n        &lt;apache.common.lang.version&gt;3.17.0&lt;/apache.common.lang.version&gt;\n        &lt;spring.session.jdbc.version&gt;3.4.1&lt;/spring.session.jdbc.version&gt;\n        &lt;byte.buddy.version&gt;1.17.0&lt;/byte.buddy.version&gt;\n        &lt;jakarta.mail.version&gt;2.0.1&lt;/jakarta.mail.version&gt;\n    &lt;/properties&gt;\n\n\n    &lt;dependencies&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;\n            &lt;version&gt;${springsecurity.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-security-oauth2-authorization-server&lt;/artifactId&gt;\n            &lt;version&gt;${auth.server.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n    \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-security-oauth2-client&lt;/artifactId&gt;\n            &lt;version&gt;${spring.oauth2.client.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n    \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n            &lt;version&gt;${springboot.version}&lt;/version&gt;\n            &lt;exclusions&gt;\n                &lt;exclusion&gt;\n                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                    &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;\n                &lt;/exclusion&gt;\n            &lt;/exclusions&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n            &lt;version&gt;${springboot.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.microsoft.sqlserver&lt;/groupId&gt;\n            &lt;artifactId&gt;mssql-jdbc&lt;/artifactId&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n            &lt;version&gt;${sql.server.jdbc.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;\n            &lt;version&gt;${spring.boot.starter.log4j2.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n        \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;\n            &lt;version&gt;${springboot.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n    \n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;\n            &lt;version&gt;${apache.common.lang.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-session-jdbc&lt;/artifactId&gt;\n            &lt;version&gt;${spring.session.jdbc.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;\n            &lt;version&gt;${springboot.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springdoc&lt;/groupId&gt;\n            &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt;\n            &lt;version&gt;${open.api.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;net.bytebuddy&lt;/groupId&gt;\n            &lt;artifactId&gt;byte-buddy&lt;/artifactId&gt;\n            &lt;version&gt;${byte.buddy.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.sun.mail&lt;/groupId&gt;\n            &lt;artifactId&gt;jakarta.mail&lt;/artifactId&gt;\n            &lt;version&gt;${jakarta.mail.version}&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;!-- TEST --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;version&gt;${springboot.version}&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;\n            &lt;version&gt;${springsecurity.version}&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;version&gt;${springboot.version}&lt;/version&gt;\n                &lt;executions&gt;\n                    &lt;execution&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;repackage&lt;/goal&gt;\n                        &lt;/goals&gt;\n                    &lt;/execution&gt;\n                    &lt;execution&gt;\n                        &lt;id&gt;build-info&lt;/id&gt;\n                        &lt;goals&gt;\n                            &lt;goal&gt;build-info&lt;/goal&gt;\n                        &lt;/goals&gt;\n                    &lt;/execution&gt;\n                &lt;/executions&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n\n    &lt;/build&gt;\n&lt;/project&gt;\n</code></pre>\n<p>I'm following the guide but I cannot find out why the OAuth2AuthenticationException if throw in my <em>CustomRevocationAuthenticationProvider</em> is not catch by <em>CustomRevocationErrorResponseHandler</em> and handle to return an error to the user. Online and asking to AI there is nothing that helps me.<br />\nIf the exception happen inside <em>CustomRevocationRequestConverter</em> everything is ok.</p>\n<p>Can someone tell me if I'm doing something wrong?</p>\n<p>Thanks.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}