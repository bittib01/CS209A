{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-ai",
      "model-context-protocol"
    ],
    "owner": {
      "account_id": 29939318,
      "reputation": 53,
      "user_id": 22944268,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/ACg8ocJjrIqrZ7auuZ2Sz04GLhl1Ptr8qcEWyaRV-9lqO4egjvfb=k-s256",
      "display_name": "Alanta335",
      "link": "https://stackoverflow.com/users/22944268/alanta335"
    },
    "is_answered": true,
    "view_count": 1727,
    "accepted_answer_id": 79700580,
    "answer_count": 3,
    "score": 5,
    "last_activity_date": 1755934616,
    "creation_date": 1750606142,
    "last_edit_date": 1750754949,
    "question_id": 79675247,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79675247/how-to-pass-data-from-an-mcp-client-to-an-mcp-server-in-java-with-spring-ai",
    "title": "How to pass data from an MCP client to an MCP server in Java with Spring AI?",
    "body": "<p>How can I pass the API key from the MCP client to the MCP server in Spring AI without including it in the prompt? I tried using Tool Context, but it was not working. If this issue can be solved with Tool Context, can anyone share how to do that? Maybe my implementation was wrong.</p>\n<p>MCP Client code where I want to pass API Key from MCP Client to MCP Server:</p>\n<pre class=\"lang-java prettyprint-override\"><code>chatClient\n        .prompt()\n        .system(&quot;&quot;&quot;\n                System prompt.\n                &quot;&quot;&quot;)\n        .user(requestDto.prompt())\n        .toolCallbacks(toolCallbackProvider.getToolCallbacks())\n        .toolContext(Map.of(&quot;apiKey&quot;, &quot;test_key&quot;))\n        .call()\n        .content()\n</code></pre>\n<p>MCP Server where I want to read the API code sent from the client:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Tool(name = &quot;tool name&quot;, description = &quot;tool description&quot;)\npublic List&lt;Data&gt; getData(@ToolParam(description = &quot;des&quot;) TimeRange timeRange,\n                                            ToolContext toolContext) {\n\n}\n</code></pre>\n<p>In the above <code>toolContext</code> I am not able to get API key I send from client.</p>\n<p>There was only an &quot;exchange&quot; key in the <code>toolContext</code> Map context. This is why I reached the conclusion that tool context was not working as I was not able to see the key value in the map I passed from the client.</p>\n<p>This is the config I am using in the client:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Configuration\npublic class MCPConfig {\n    @Bean\n    public SyncMcpToolCallbackProvider toolCallbackProvider(List&lt;McpSyncClient&gt; clients) {\n        return new SyncMcpToolCallbackProvider(clients);\n    }\n}\n</code></pre>\n<p>In the MCP server code:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Tool(name = &quot;tool name&quot;, description = &quot;tool description&quot;)\npublic List&lt;Data&gt; getData(@ToolParam(description = &quot;des&quot;) PlayBackState playBackState,\n                                            ToolContext toolContext) {\nString apiKey = toolContext.getContext().get(&quot;apiKey&quot;).toString();\n}\n</code></pre>\n<p>Here I am getting <code>nullpointerexception</code> as <code>.get(&quot;apiKey&quot;)</code> is returning <code>null</code>. <br />\nIdeally it should have returned the value passed from the MCP Client; <code>&quot;test_key&quot;</code> is the value that should have been present.</p>\n<p>Below is the log I am getting on the above MCP server tool call:</p>\n<pre><code>2025-06-22T20:09:21.463+05:30 TRACE 17000 --- [app-mcp-server] [nio-8081-exec-3] o.s.w.s.f.support.RouterFunctionMapping  : Mapped to io.modelcontextprotocol.server.transport.WebMvcSseServerTransportProvider$$Lambda/0x000001ba36662f38@b76b7d8\n2025-06-22T20:09:21.463+05:30 DEBUG 17000 --- [app-mcp-server] [nio-8081-exec-3] io.modelcontextprotocol.spec.McpSchema   : Received JSON message: {&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;tools/call&quot;,&quot;id&quot;:&quot;355f2a07-8&quot;,&quot;params&quot;:{&quot;name&quot;:&quot;playback_controller&quot;,&quot;arguments&quot;:{&quot;playBackState&quot;:&quot;PAUSE&quot;}}}\n2025-06-22T20:09:21.463+05:30 DEBUG 17000 --- [app-mcp-server] [nio-8081-exec-3] i.m.spec.McpServerSession                : Received request: JSONRPCRequest[jsonrpc=2.0, method=tools/call, id=355f2a07-8, params={name=playback_controller, arguments={playBackState=PAUSE}}]\n2025-06-22T20:09:21.463+05:30 DEBUG 17000 --- [app-mcp-server] [oundedElastic-1] o.s.ai.tool.method.MethodToolCallback    : Starting execution of tool: playback_controller\n2025-06-22T20:09:59.228+05:30 DEBUG 17000 --- [app-mcp-server] [nio-8081-Poller] org.apache.tomcat.util.net.NioEndpoint   : timeout completed: keys processed=2; now=1750603199227; nextExpiration=1750603161517; keyCount=0; hasEvents=false; eval=false\n2025-06-22T20:09:59.231+05:30 DEBUG 17000 --- [app-mcp-server] [oundedElastic-1] i.m.s.t.WebMvcSseServerTransportProvider : Message sent to session a3545270-ab97-4ede-882f-2bdccb36097a\n2025-06-22T20:09:59.232+05:30 TRACE 17000 --- [app-mcp-server] [nio-8081-exec-3] o.s.web.servlet.DispatcherServlet        : No view rendering, null ModelAndView returned.\n2025-06-22T20:09:59.232+05:30 DEBUG 17000 --- [app-mcp-server] [nio-8081-exec-3] o.s.web.servlet.DispatcherServlet        : Completed 200 OK, headers={}\n2025-06-22T20:09:59.232+05:30 TRACE 17000 --- [app-mcp-server] [nio-8081-exec-3] o.s.b.w.s.f.OrderedRequestContextFilter  : Cleared thread-bound request context: org.apache.catalina.connector.RequestFacade@4cb31c2e\n2025-06-22T20:09:59.232+05:30 DEBUG 17000 --- [app-mcp-server] [nio-8081-exec-3] o.a.coyote.http11.Http11InputBuffer      : Before fill(): parsingHeader: [true], parsingRequestLine: [true], parsingRequestLinePhase: [0], parsingRequestLineStart: [0], byteBuffer.position(): [0], byteBuffer.limit(): [0], end: [351]\n</code></pre>\n<p>When I looked into <code>SyncMcpToolCallback</code> class in package <code>org.springframework.ai.mcp</code>:</p>\n<pre class=\"lang-java prettyprint-override\"><code>public String call(String toolArguments, ToolContext toolContext) {\n    return this.call(toolArguments);\n}\n</code></pre>\n<p>ToolContext is not used. So, from my understanding, <code>toolContext</code> is not passed over the network in MCP Client.<br />\nCan this be the reason? If it is, why is that done like that?</p>\n<p>This is the response I get in the MCP client:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{\n    &quot;type&quot;: &quot;about:blank&quot;,\n    &quot;title&quot;: &quot;Bad Request&quot;,\n    &quot;status&quot;: 400,\n    &quot;detail&quot;: &quot;java.util.concurrent.TimeoutException: Did not observe any item or terminal signal within 30000ms in 'Mono.deferContextual â‡¢ at io.modelcontextprotocol.spec.McpClientSession.sendRequest(McpClientSession.java:233)' (and no fallback has been configured)&quot;,\n    &quot;instance&quot;: &quot;/chat&quot;\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}