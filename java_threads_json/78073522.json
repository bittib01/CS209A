{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-data-jpa",
      "migration",
      "java-17"
    ],
    "owner": {
      "account_id": 18484426,
      "reputation": 381,
      "user_id": 13465758,
      "user_type": "registered",
      "profile_image": "https://graph.facebook.com/1886254071508064/picture?type=large",
      "display_name": "Majestix Finger",
      "link": "https://stackoverflow.com/users/13465758/majestix-finger"
    },
    "is_answered": true,
    "view_count": 11398,
    "answer_count": 1,
    "score": 9,
    "last_activity_date": 1730884052,
    "creation_date": 1709114630,
    "last_edit_date": 1730884052,
    "question_id": 78073522,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78073522/spring-boot-3-2-2-entitymanagerfactory-interface-org-hibernate-sessionfactory-s",
    "title": "Spring Boot 3.2.2: EntityManagerFactory interface org.hibernate.SessionFactory seems to conflict with Spring&#39;s EntityManagerFactoryInfo mixin",
    "body": "<p>When migrating from Spring Boot 2.4.3 to <strong>Spring Boot 3.2.2</strong> (by using Java 17.0.2) I ran into the follwing <strong>issue with Spring Data JPA and Hibernate</strong>:</p>\n<pre><code>org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'defaultEntityManagerFactory' defined in class path resource [de/mycompany/vector/backend/config/DefaultJPAConfig.class]: \n    EntityManagerFactory interface [interface org.hibernate.SessionFactory] seems to conflict with Spring's EntityManagerFactoryInfo mixin - consider resetting the 'entityManagerFactoryInterface' property to plain [jakarta.persistence.EntityManagerFactory]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1773)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:521)\n    ...\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)\n    at de.mycompany.vector.backend.Application.main(Application.java:21)\nCaused by: java.lang.IllegalStateException: EntityManagerFactory interface [interface org.hibernate.SessionFactory] seems to conflict with Spring's EntityManagerFactoryInfo mixin - consider resetting the 'entityManagerFactoryInterface' property to plain [jakarta.persistence.EntityManagerFactory]\n    at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createEntityManagerFactoryProxy(AbstractEntityManagerFactoryBean.java:469)\n    ...\nCaused by: java.lang.IllegalArgumentException: methods with same signature getSchemaManager() but incompatible return types: [interface org.hibernate.relational.SchemaManager, interface jakarta.persistence.SchemaManager]\n    at java.base/java.lang.reflect.ProxyGenerator.checkReturnTypes(ProxyGenerator.java:311)\n</code></pre>\n<hr />\n<p>Full command line output while starting up the application is as follows:</p>\n<pre><code>jdk17.0.2\\bin\\java.exe -agentlib:jdwp=transport=dt_socket,address=127.0.0.1:61495,suspend=y,server=n -XX:TieredStopAtLevel=1 -Dspring.profiles.active=dev -Dspring.output.ansi.enabled=always -Dcom.sun.management.jmxremote -Dspring.jmx.enabled=true -Dspring.liveBeansView.mbeanDomain -Dspring.application.admin.enabled=true &quot;-Dmanagement.endpoints.jmx.exposure.include=*&quot; -javaagent:C:\\Users\\Me\\AppData\\Local\\JetBrains\\IntelliJIdea2023.3\\captureAgent\\debugger-agent.jar=file:/C:/Users/Me/AppData/Local/Temp/1/capture.props -Dfile.encoding=UTF-8 -classpath C:\\Users\\Me\\AppData\\Local\\Temp\\1\\classpath477957752.jar de.mycompany.vector.backend.Application\nConnected to the target VM, address: '127.0.0.1:61495', transport: 'socket'\n\nMySpringBootBackendApp [Spring Boot Backend]\n2024-02-27 17:33:51,302 INFO  [background-preinit] o.h.v.i.u.Version: HV000001: Hibernate Validator 8.0.1.Final\n2024-02-27 17:33:51,380 INFO  [main] o.s.b.StartupInfoLogger: Starting Application using Java 17.0.2 with PID 30932 (C:\\Develop\\projects\\myapp\\src\\backend\\target\\classes started by Me in C:\\Develop\\projects\\myapp\\src\\backend)\n2024-02-27 17:33:51,381 DEBUG [main] o.s.b.StartupInfoLogger: Running with Spring Boot v3.2.2, Spring v6.1.3\n2024-02-27 17:33:51,382 INFO  [main] o.s.b.SpringApplication: The following 1 profile is active: &quot;dev&quot;\n2024-02-27 17:33:55,279 INFO  [main] o.s.d.r.c.RepositoryConfigurationDelegate: Bootstrapping Spring Data JPA repositories in DEFAULT mode.\n2024-02-27 17:33:55,536 INFO  [main] o.s.d.r.c.RepositoryConfigurationDelegate: Finished Spring Data repository scanning in 244 ms. Found 19 JPA repository interfaces.\n2024-02-27 17:33:59,911 INFO  [main] o.s.b.w.e.t.TomcatWebServer: Tomcat initialized with port 8081 (http)\n2024-02-27 17:33:59,930 INFO  [main] o.a.j.l.DirectJDKLog: Initializing ProtocolHandler [&quot;http-nio-8081&quot;]\n2024-02-27 17:33:59,934 INFO  [main] o.a.j.l.DirectJDKLog: Starting service [Tomcat]\n2024-02-27 17:33:59,935 INFO  [main] o.a.j.l.DirectJDKLog: Starting Servlet engine: [Apache Tomcat/10.1.18]\n2024-02-27 17:34:00,109 INFO  [main] o.a.j.l.DirectJDKLog: Initializing Spring embedded WebApplicationContext\n2024-02-27 17:34:00,112 INFO  [main] o.s.b.w.s.c.ServletWebServerApplicationContext: Root WebApplicationContext: initialization completed in 8480 ms\n2024-02-27 17:34:03,136 INFO  [main] o.f.c.i.l.s.Slf4jLog: Database: jdbc:oracle:thin:@myDBHost:1234:XXX (Oracle 19.0)\n2024-02-27 17:34:04,731 INFO  [main] o.f.c.i.l.s.Slf4jLog: Successfully validated 133 migrations (execution time 00:01.188s)\n2024-02-27 17:34:05,155 INFO  [main] o.f.c.i.l.s.Slf4jLog: Current version of schema &quot;NBP_TEST&quot;: 2.121\n2024-02-27 17:34:05,187 INFO  [main] o.f.c.i.l.s.Slf4jLog: Schema &quot;NBP_TEST&quot; is up to date. No migration necessary.\n2024-02-27 17:34:06,689 INFO  [main] o.e.s.o.t.o.p.UpfrontAllocatingPageSource: Allocating 20.0MB in chunks\n2024-02-27 17:34:06,739 INFO  [main] o.e.c.EhcacheManager: Cache 'keyAccountDataCache' created in EhcacheManager.\n2024-02-27 17:34:06,746 INFO  [main] o.e.s.o.t.o.p.UpfrontAllocatingPageSource: Allocating 10.0MB in chunks\n2024-02-27 17:34:06,752 INFO  [main] o.e.c.EhcacheManager: Cache 'meterInfoCache' created in EhcacheManager.\n2024-02-27 17:34:06,798 INFO  [main] o.e.j.Eh107CacheManager: Registering Ehcache MBean javax.cache:type=CacheStatistics,CacheManager=file./C./Develop/projects/myapp/src/backend/target/classes/ehcache.xml,Cache=keyAccountDataCache\n2024-02-27 17:34:06,802 INFO  [main] o.e.j.Eh107CacheManager: Registering Ehcache MBean javax.cache:type=CacheStatistics,CacheManager=file./C./Develop/projects/myapp/src/backend/target/classes/ehcache.xml,Cache=meterInfoCache\n2024-02-27 17:34:07,011 INFO  [main] o.h.j.i.u.LogHelper: HHH000204: Processing PersistenceUnitInfo [name: default]\n2024-02-27 17:34:07,149 INFO  [main] o.h.Version: HHH000412: Hibernate ORM core version 6.4.1.Final\n2024-02-27 17:34:07,238 INFO  [main] o.h.c.i.RegionFactoryInitiator: HHH000026: Second-level cache disabled\n2024-02-27 17:34:08,824 INFO  [main] o.s.o.j.p.SpringPersistenceUnitInfo: No LoadTimeWeaver setup: ignoring JPA class transformer\n2024-02-27 17:34:12,277 INFO  [main] o.h.e.t.j.p.i.JtaPlatformInitiator: HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)\n2024-02-27 17:34:12,350 INFO  [main] o.s.o.j.AbstractEntityManagerFactoryBean: Initialized JPA EntityManagerFactory for persistence unit 'default'\n2024-02-27 17:34:12,356 WARN  [main] o.s.c.s.AbstractApplicationContext: Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'defaultEntityManagerFactory' defined in class path resource [de/mycompany/vector/backend/config/DefaultJPAConfig.class]: EntityManagerFactory interface [interface org.hibernate.SessionFactory] seems to conflict with Spring's EntityManagerFactoryInfo mixin - consider resetting the 'entityManagerFactoryInterface' property to plain [jakarta.persistence.EntityManagerFactory]\n2024-02-27 17:34:12,369 INFO  [main] o.e.c.EhcacheManager: Cache 'keyAccountDataCache' removed from EhcacheManager.\n2024-02-27 17:34:12,372 INFO  [main] o.e.c.EhcacheManager: Cache 'meterInfoCache' removed from EhcacheManager.\n2024-02-27 17:34:12,382 INFO  [main] o.a.j.l.DirectJDKLog: Stopping service [Tomcat]\n2024-02-27 17:34:12,415 INFO  [main] o.s.b.a.l.ConditionEvaluationReportLogger: \n\nError starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.\n2024-02-27 17:34:12,450 ERROR [main] o.s.b.SpringApplication: Application run failed\norg.springframework.beans.factory.BeanCreationException: Error creating bean with name 'defaultEntityManagerFactory' defined in class path resource [de/mycompany/vector/backend/config/DefaultJPAConfig.class]: EntityManagerFactory interface [interface org.hibernate.SessionFactory] seems to conflict with Spring's EntityManagerFactoryInfo mixin - consider resetting the 'entityManagerFactoryInterface' property to plain [jakarta.persistence.EntityManagerFactory]\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1773)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:521)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)\n    at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)\n    at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1231)\n    at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:949)\n    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)\n    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)\n    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)\n    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)\n    at de.mycompany.vector.backend.Application.main(Application.java:21)\nCaused by: java.lang.IllegalStateException: EntityManagerFactory interface [interface org.hibernate.SessionFactory] seems to conflict with Spring's EntityManagerFactoryInfo mixin - consider resetting the 'entityManagerFactoryInterface' property to plain [jakarta.persistence.EntityManagerFactory]\n    at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createEntityManagerFactoryProxy(AbstractEntityManagerFactoryBean.java:469)\n    at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:403)\n    at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1820)\n    at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1769)\n    ... 16 common frames omitted\nCaused by: java.lang.IllegalArgumentException: methods with same signature getSchemaManager() but incompatible return types: [interface org.hibernate.relational.SchemaManager, interface jakarta.persistence.SchemaManager]\n    at java.base/java.lang.reflect.ProxyGenerator.checkReturnTypes(ProxyGenerator.java:311)\n    at java.base/java.lang.reflect.ProxyGenerator.generateClassFile(ProxyGenerator.java:488)\n    at java.base/java.lang.reflect.ProxyGenerator.generateProxyClass(ProxyGenerator.java:178)\n    at java.base/java.lang.reflect.Proxy$ProxyBuilder.defineProxyClass(Proxy.java:558)\n    at java.base/java.lang.reflect.Proxy$ProxyBuilder.build(Proxy.java:670)\n    at java.base/java.lang.reflect.Proxy.lambda$getProxyConstructor$1(Proxy.java:440)\n    at java.base/jdk.internal.loader.AbstractClassLoaderValue$Memoizer.get(AbstractClassLoaderValue.java:329)\n    at java.base/jdk.internal.loader.AbstractClassLoaderValue.computeIfAbsent(AbstractClassLoaderValue.java:205)\n    at java.base/java.lang.reflect.Proxy.getProxyConstructor(Proxy.java:438)\n    at java.base/java.lang.reflect.Proxy.newProxyInstance(Proxy.java:1037)\n    at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.createEntityManagerFactoryProxy(AbstractEntityManagerFactoryBean.java:464)\n    ... 20 common frames omitted\nDisconnected from the target VM, address: '127.0.0.1:61495', transport: 'socket'\n\nProcess finished with exit code 1\n</code></pre>\n<hr />\n<p>My coding is as shown below (class '<em>DefaultJPAConfig</em>'):<br />\nThe exception occures after creation of '<em>defaultEntityManagerFactory</em>' bean.</p>\n<pre><code>package de.mycompany.vector.backend.config;\n\nimport jakarta.persistence.EntityManagerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.boot.autoconfigure.orm.jpa.JpaProperties;\nimport org.springframework.boot.orm.jpa.EntityManagerFactoryBuilder;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.context.annotation.Primary;\nimport org.springframework.core.env.Environment;\nimport org.springframework.core.io.ClassPathResource;\nimport org.springframework.core.io.Resource;\nimport org.springframework.data.jpa.repository.config.EnableJpaRepositories;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.jdbc.datasource.DriverManagerDataSource;\nimport org.springframework.jdbc.datasource.init.DatabasePopulator;\nimport org.springframework.jdbc.datasource.init.DatabasePopulatorUtils;\nimport org.springframework.jdbc.datasource.init.ResourceDatabasePopulator;\nimport org.springframework.orm.jpa.JpaTransactionManager;\nimport org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;\nimport org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;\nimport org.springframework.transaction.PlatformTransactionManager;\nimport org.springframework.transaction.annotation.EnableTransactionManagement;\nimport org.springframework.util.CollectionUtils;\n\nimport javax.sql.DataSource;\n\nimport java.util.Map;\nimport java.util.Properties;\n\n@Configuration\n@EnableTransactionManagement\n@EnableJpaRepositories(basePackages = &quot;de.mycompany.vector.backend.dao&quot;,\n  entityManagerFactoryRef = &quot;defaultEntityManagerFactory&quot;,\n  transactionManagerRef = &quot;defaultTransactionManager&quot;\n)\npublic class DefaultJPAConfig {\n\n  private final Environment env;\n\n  private final JpaProperties jpaProperties;\n\n  public DefaultDataSourceConfig(@Autowired Environment env, @Autowired JpaProperties jpaProperties) {\n    this.env = env;\n    this.jpaProperties = jpaProperties;\n  }\n\n  @Bean(name = {&quot;defaultDataSource&quot;})\n  @Primary\n  public DataSource defaultDataSource() {\n    if (env == null) {\n      return null;\n    }\n    DriverManagerDataSource dataSource = new DriverManagerDataSource();\n    String url = env.getProperty(&quot;spring.datasource.url&quot;);\n    String driver = env.getProperty(&quot;spring.datasource.driver-class&quot;);\n    String username = env.getProperty(&quot;spring.datasource.username&quot;);\n    String password = env.getProperty(&quot;spring.datasource.password&quot;);\n    dataSource.setDriverClassName(driver);\n    dataSource.setUrl(url);\n    dataSource.setUsername(username);\n    dataSource.setPassword(password);\n    Resource initSchema = new ClassPathResource(&quot;schema.sql&quot;);\n    if (initSchema.exists()) {\n      DatabasePopulator databasePopulator = new ResourceDatabasePopulator(initSchema);\n      DatabasePopulatorUtils.execute(databasePopulator, dataSource);\n    }\n    return dataSource;\n  }\n\n  /**\n   * provide a simple jdbc template to export data without all the expensive JPA/ORM functions\n   */\n  @Bean(name = {&quot;nbpJdbcTemplate&quot;})\n  public JdbcTemplate jdbcTemplate() {\n    return new JdbcTemplate(defaultDataSource());\n  }\n\n  @Bean(name = &quot;defaultEntityManagerFactory&quot;)\n  @Primary\n  @Autowired\n  public LocalContainerEntityManagerFactoryBean defaultEntityManagerFactory(\n    EntityManagerFactoryBuilder entityManagerFactoryBuilder,\n    @Qualifier(&quot;defaultDataSource&quot;) DataSource ds) {\n    return entityManagerFactoryBuilder\n      .dataSource(ds)\n      .packages(&quot;de.mycompany.vector.backend.model&quot;)\n      .properties(jpaProperties != null ? jpaProperties.getProperties() : null)\n      .persistenceUnit(&quot;default&quot;)\n      .build();\n  }\n\n  @Bean(name = &quot;defaultTransactionManager&quot;)\n  @Primary\n  @Autowired\n  public PlatformTransactionManager defaultTransactionManager(EntityManagerFactory entityManagerFactory) {\n    return new JpaTransactionManager(entityManagerFactory);\n  }\n\n}\n</code></pre>\n<hr />\n<p>Spring Boot/JPA related configuration in application context file 'application-dev.yml':</p>\n<pre><code>spring:\n  ...\n  jpa:\n    # show-sql: true\n    hibernate:\n      ddl-auto: validate\n      naming:\n        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl\n    properties:\n      hibernate:\n        jdbc:\n          batch_size: 500\n      jakarta:\n        persistence:\n          schema-generation:\n            scripts:\n              action: create\n              create-target: create.sql\n              create-source: metadata\n\n  datasource:\n    url: jdbc:oracle:thin:@myDBHost:1234:XXX\n    username: NBP_TEST\n    password: &lt;secret&gt;\n    driver-class: oracle.jdbc.driver.OracleDriver\n    hikari:\n      connection-timeout: 60000\n      maximum-pool-size: 5\n</code></pre>\n<hr />\n<p>Spring Boot/JPA related Maven dependencies in 'pom.xml':</p>\n<pre><code>&lt;!-- Spring Boot Starter Parent --&gt;\n&lt;parent&gt;\n  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n  &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n  &lt;version&gt;3.2.2&lt;/version&gt;\n&lt;/parent&gt;\n\n...\n\n&lt;dependencies&gt;\n\n    ...\n\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n      &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n      &lt;exclusions&gt;\n        &lt;exclusion&gt;\n          &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;\n          &lt;artifactId&gt;tomcat-jdbc&lt;/artifactId&gt;\n        &lt;/exclusion&gt;\n      &lt;/exclusions&gt;\n    &lt;/dependency&gt;\n\n    &lt;!-- Oracle Database JDBC driver --&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;com.oracle.database.jdbc&lt;/groupId&gt;\n      &lt;artifactId&gt;ojdbc10&lt;/artifactId&gt;\n      &lt;version&gt;19.22.0.0&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    ...\n\n&lt;/dependencies&gt;\n</code></pre>\n<hr />\n<p>Any help will be very much appreciated!</p>\n<p>Best regards,<br />\nMaik</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}