{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "cors",
      "spring-websocket",
      "spring-cloud-gateway"
    ],
    "owner": {
      "account_id": 10149091,
      "reputation": 382,
      "user_id": 7496320,
      "user_type": "registered",
      "accept_rate": 0,
      "profile_image": "https://www.gravatar.com/avatar/1c55ba7c1365c8cf442d330fa0b44a18?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Aks 1316",
      "link": "https://stackoverflow.com/users/7496320/aks-1316"
    },
    "is_answered": false,
    "view_count": 88,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1726934576,
    "creation_date": 1726931661,
    "last_edit_date": 1726934576,
    "question_id": 79009869,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79009869/how-to-handle-cors-configuration-of-api-gateway-and-socket-in-springboot-microse",
    "title": "How to handle CORS configuration of API gateway and Socket in Springboot Microservices",
    "body": "<p>I have a Springboot Microservice application. I have 4 microservices in my application.</p>\n<pre><code>API-gateway,\nuser-management,\nidm-service,\nengine-service.\n</code></pre>\n<p>I am using react as frontend here.</p>\n<p>API-gateway contains CORS related configuration and I am using web-socket for my engine-service so it has web socket configuration.\nI am facing issue while communicating with socket of engine-service.\nWhen I am trying to initiate socket connection from react. First it will go to API-gateway so I have to add required CORS configuration in API-gateway.</p>\n<p><strong>API-gateway configuration:</strong></p>\n<pre><code>cors-configurations:\n  '[/**]':\n    allowCredentials: true\n    allowedOrigins:\n      - &quot;http://localhost:3000&quot;\n    allowedHeaders: &quot;*&quot;\n    allowedMethods:\n      - GET\n      - POST\n      - DELETE\n      - PUT\n      - OPTIONS\n      - PATCH\n</code></pre>\n<p>I have to add <code>allowCredentials: true</code> to allow web socket connection and it is working fine.</p>\n<p><strong>engine-service socket configuration:</strong></p>\n<pre><code>@Override\n  public void registerStompEndpoints(StompEndpointRegistry registry) {\n    registry.addEndpoint(registryEndpoint).setAllowedOrigins(&quot;http://localhost:3000&quot;).withSockJS();\n  }\n</code></pre>\n<p>Now again I have to add <code>setAllowedOrigins</code> in websocket configuration. so when request comes to engine-service, I am getting error like this</p>\n<pre><code>The 'Access-Control-Allow-Origin' header contains multiple values 'http://localhost:3000, http://localhost:3000', but only one is allowed.\n</code></pre>\n<p>Now I am unable to find solution for this. All the request must go via API-gateway so I have to add CORS configuration there else I will get CORS error in API-gateway. If I am adding <code>setAllowedOrigins</code> in API-gateway I am getting error in engine-service.</p>\n<p>Can you please guide me on this error?\nFor websocket connection, Should I directly communicate with engine-service and not going via API-gateway?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}