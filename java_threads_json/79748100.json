{
  "question": {
    "tags": [
      "java",
      "tcp",
      "nio"
    ],
    "owner": {
      "account_id": 8602812,
      "reputation": 871,
      "user_id": 7390103,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/6c30a51e7297b944219221ea0fa01d18?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Spaceship222",
      "link": "https://stackoverflow.com/users/7390103/spaceship222"
    },
    "is_answered": true,
    "view_count": 156,
    "accepted_answer_id": 79759664,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1757407222,
    "creation_date": 1756304408,
    "last_edit_date": 1756371463,
    "question_id": 79748100,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79748100/tcp-connection-refused-given-multiple-concurrent-connection",
    "title": "TCP Connection Refused Given multiple concurrent connection",
    "body": "<p>I try to play with multiple concurrent tcp connection in Java.\nGiven 250 concurrent tcp connection, some of them will get connection refused.\nIt surprises me due to only 250 connection.<br />\nIn large web application, there should be much more concurrent connection. Actually, I test it similarly in spring boot web application. I got same connection refused error.<br />\nAny idea why?  (Note: Below example is tested on Windows 11 PC)</p>\n<pre class=\"lang-java prettyprint-override\"><code>public class TcpServer {\n\n    public static void main(String[] args) throws Exception {\n        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();\n        serverSocketChannel.socket().bind(new InetSocketAddress(8090), 500);\n\n        while (true) {\n            var socketChannel = serverSocketChannel.accept();\n            System.out.println(&quot;client connected: &quot; + socketChannel.getRemoteAddress());\n            socketChannel.close();\n        }\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public class TcpStressTest {\n\n    static AtomicInteger successCount = new AtomicInteger(0);\n    static AtomicInteger failureCount = new AtomicInteger(0);\n\n    public static void main(String[] args) throws Exception {\n        // create 10k threads to connect to server\n        int N = 250;\n        ExecutorService executorService = java.util.concurrent.Executors.newFixedThreadPool(50);\n        List&lt;Future&lt;Object&gt;&gt; futures = new java.util.ArrayList&lt;&gt;();\n        for (int i = 0; i &lt; N; i++) {\n            Future&lt;?&gt; submit = executorService.submit(() -&gt; {\n                TcpClient client = new TcpClient();\n                int start = client.start();\n                if (start == 1) {\n                    successCount.incrementAndGet();\n                } else {\n                    failureCount.incrementAndGet();\n                }\n            });\n            futures.add((Future&lt;Object&gt;) submit);\n        }\n        for (Future&lt;Object&gt; future : futures) {\n            try {\n                future.get();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n        System.out.println(&quot;All clients finished&quot;);\n        System.out.println(&quot;Success count: &quot; + successCount.get());\n        System.out.println(&quot;Failure count: &quot; + failureCount.get());\n    }\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>public class TcpClient {\n\n    private static final String SERVER_HOST = &quot;localhost&quot;;\n    private static final int SERVER_PORT = 8090;\n\n    public int start() {\n        try {\n            SocketChannel socketChannel = SocketChannel.open();\n            socketChannel.connect(new java.net.InetSocketAddress(SERVER_HOST, SERVER_PORT));\n            socketChannel.close();\n            return 1;\n        } catch (java.io.IOException e) {\n            System.out.println(&quot;[Thread: &quot; + Thread.currentThread().getName() + &quot; Connection failed: &quot; + e.getMessage());\n            return 0;\n        }\n    }\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}