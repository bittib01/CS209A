{
  "question": {
    "tags": [
      "java",
      "spring-security",
      "jwt"
    ],
    "owner": {
      "account_id": 30636393,
      "reputation": 21,
      "user_id": 23485744,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/33a5eedbae0457c2442003fddc2cc263?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "BDorries",
      "link": "https://stackoverflow.com/users/23485744/bdorries"
    },
    "is_answered": true,
    "view_count": 1861,
    "accepted_answer_id": 78070019,
    "answer_count": 2,
    "score": -1,
    "last_activity_date": 1739120456,
    "creation_date": 1708972134,
    "question_id": 78063144,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78063144/request-getheaderauthorization-returning-null",
    "title": "request.getheader(&quot;Authorization&quot;) returning null",
    "body": "<p>I am working on a decoupled react.js and Java with Spring Boot application and have just finished the first part of the backend. I admittedly don't have a firm grasp of Spring Security when it comes to using JWTs but I have been following along with a video tutorial and have read the docs to the best of my ability. Unfortunately, the tutorial is somewhat outdated and I've had to refactor certain parts of it to account for deprecations. I have apparently made an error at some point and can't figure out what I did wrong.</p>\n<p>When I go to localhost:8080 (the port the backend is running on), I get a 403 error. This suggested to me that it was an issue with the <code>SecurityConfiguration</code> so I verified that the &quot;/&quot; endpoint was in the <code>permitAll()</code> line and it was. Here is my entire <code>SecurityConfiguration</code>:</p>\n<pre><code>package com.keyoflife.keyoflife.config;\n\nimport com.keyoflife.keyoflife.services.UserDetailsLoader;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.core.Ordered;\nimport org.springframework.core.annotation.Order;\nimport org.springframework.http.HttpMethod;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.config.Customizer;\nimport org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\nimport org.springframework.security.web.authentication.www.BasicAuthenticationFilter;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.CorsConfigurationSource;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\n\nimport java.util.Arrays;\n\n@Configuration\n@EnableWebSecurity\n@Order(Ordered.HIGHEST_PRECEDENCE)\npublic class SecurityConfiguration {\n    private final UserDetailsLoader usersLoader;\n    private final JwtFilter jwtFilter;\n    public SecurityConfiguration(UserDetailsLoader usersLoader, JwtFilter jwtFilter) {\n        this.usersLoader = usersLoader;\n        this.jwtFilter = jwtFilter;\n    }\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        //TODO: remove this\n        //get the hashed version of 'asdfasdf' to save in db\n        //System.out.println(new BCryptPasswordEncoder().encode(&quot;asdfasdf&quot;));\n        return new BCryptPasswordEncoder();\n    }\n    @Bean\n    public AuthenticationManager authenticationManager(HttpSecurity http, PasswordEncoder passwordEncoder)\n            throws Exception {\n        AuthenticationManagerBuilder authenticationManagerBuilder = http.getSharedObject(AuthenticationManagerBuilder.class);\n        authenticationManagerBuilder.userDetailsService(usersLoader).passwordEncoder(passwordEncoder);\n        return authenticationManagerBuilder.build();\n    }\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        return http\n                .csrf(AbstractHttpConfigurer::disable)\n                .cors(Customizer.withDefaults())\n                .authorizeHttpRequests(auth -&gt; auth\n                        .requestMatchers(&quot;/user-dash&quot;).authenticated()\n                        .requestMatchers(HttpMethod.OPTIONS,&quot;/api/auth/**&quot;, &quot;/login&quot;, &quot;/&quot;).permitAll()\n                )\n                .sessionManagement(sess -&gt; sess.sessionCreationPolicy(SessionCreationPolicy.STATELESS))\n                .httpBasic(Customizer.withDefaults())\n                .addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class)\n                .formLogin((login) -&gt; login\n                        .loginPage(&quot;/login&quot;)\n                        .failureUrl(&quot;/login&quot;)\n                        .defaultSuccessUrl(&quot;/user-dash&quot;))\n                /* Logout configuration */\n                .logout((logout) -&gt; logout\n                        .logoutSuccessUrl(&quot;/&quot;))\n                .build();\n    }\n    \n    @Bean\n    public CorsConfigurationSource corsConfigurationSource() {\n        CorsConfiguration configuration = new CorsConfiguration();\n        configuration.addAllowedOrigin(&quot;http://127.0.0.1:8080&quot;);\n        configuration.setAllowedMethods(Arrays.asList(&quot;GET&quot;, &quot;POST&quot;));\n        configuration.setAllowedHeaders(Arrays.asList(&quot;Content-Type&quot;, &quot;Authorization&quot;));\n        configuration.setAllowCredentials(true); // for cookies. bc everyone likes cookies\n\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        source.registerCorsConfiguration(&quot;/**&quot;, configuration);\n        return source;\n    }\n\n}\n</code></pre>\n<p>Next, I went through the stack trace and saw that the error actually occurred in my <code>JWTFilter</code> on the <code>chain.doFilter</code> line seen here in the first <code>if()</code> statement of the <code>doFilterInternal</code> method: I will post the first part of this class as the rest seems inconsequential since the code isn't getting passed the first return:</p>\n<pre><code>protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws ServletException, IOException {\n\n        // Get authorization header and validate\n        final String header = request.getHeader(&quot;Authorization&quot;);\n        System.out.println(header);\n        //ensure header has text and starts with &quot;Bearer &quot;\n        if (!StringUtils.hasText(header) || (StringUtils.hasText(header) &amp;&amp; !header.startsWith(&quot;Bearer &quot;))) {\n            chain.doFilter(request, response); //Access Denied Exception thrown here because header is null\n            return;\n        }\n\n//rest of method below\n\n}\n</code></pre>\n<p>I added the <code>System.out</code> line to see what the value of <code>header</code> was, and found that when I try to go to localhost8080, that value is &quot;Basic (alpha-numeric string)&quot; but when I try to access the /api/auth/login endpoint with</p>\n<pre><code>{\n    &quot;username&quot;:&quot;testUser&quot;,\n    &quot;password&quot;: &quot;asdfasdf&quot;\n}\n</code></pre>\n<p>using Postman with a JSON body and POST method, I get a 401 error and a null <code>header</code>. I did verify that this is an actual user in my db.</p>\n<p>I have seen several other SO posts regarding this issue and have read through them all. Several of the posts suggest to add a cors config which I have (see <code>SecurityConfiguration</code> code). Another says to add the &quot;Authorization&quot; arg to the <code>getHeader</code> line in the <code>JWTFilter</code> which I already have. I'm at a loss for where to go from here and so this is my first SO post ever. I've been reading SO for years now but never got so stuck that I needed to ask a question before. I apologize if I've left something pertinent out. Please let me know and I'll edit my question. I just didn't want to flood the post with extraneous code.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}