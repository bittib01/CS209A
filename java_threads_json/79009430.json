{
  "question": {
    "tags": [
      "java",
      "json",
      "spring-boot",
      "jsonschema",
      "json-schema-validator"
    ],
    "owner": {
      "account_id": 17224421,
      "reputation": 1,
      "user_id": 12470447,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/6df4b9c144e5cc3e81327ba97b5ad35f?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Arun",
      "link": "https://stackoverflow.com/users/12470447/arun"
    },
    "is_answered": false,
    "view_count": 126,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1727289057,
    "creation_date": 1726917759,
    "last_edit_date": 1727083971,
    "question_id": 79009430,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79009430/how-to-use-ref-to-set-conditions-on-objects-of-sub-schemas-using-json-schema-dr",
    "title": "How to use $ref to set conditions on objects of sub schemas using json schema draft 2020-12 in a spring boot project?",
    "body": "<p>I'm trying to do json schema validation in spring boot 3.3.3, in resources folder I have put the schemas main.json, sub1.json and sub2.json. I’m using $ref to refer other schema objects from main schema and I want to set a field condition in sub2 based on a value of property from sub1, but I’m getting required field missing always when validating even when value is different. Added expected and obtained result at the end with same results.</p>\n<p><strong>Dependency used for schema validation:</strong></p>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.networknt&lt;/groupId&gt;\n    &lt;artifactId&gt;json-schema-validator&lt;/artifactId&gt;\n    &lt;version&gt;1.4.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p><strong>Bean to load schemas:</strong></p>\n<pre><code>@Bean\npublic JsonSchema jsonSchema() {\n    return JsonSchemaFactory.getInstance(SpecVersion.VersionFlag.V202012)\n        .getSchema(getClass().getClassLoader().getResourceAsStream(“/main.json”));\n}\n</code></pre>\n<p><strong>Controller method:</strong></p>\n<pre><code>@Autowired\nprivate JsonSchema jsonSchema;\n\n@Autowired\nprivate ObjectMapper objectMapper;\n\n@PostMapping(&quot;/validate&quot;)\npublic void validate(@RequestBody RequestDto request) {\n    JsonNode jsonNode = objectMapper.valueToTree(request);\n    Set&lt;ValidationMessage&gt; validationMessages = jsonSchema.validate(jsonNode);\n    \n    if (!validationMessages.isEmpty()) {\n        throw new JsonSchemaValidationException(validationMessages);\n    }\n    log.info(&quot;Validation Passed&quot;);\n}\n</code></pre>\n<p><strong>main.json:</strong></p>\n<pre><code>{\n    &quot;$schema&quot;: &quot;https://json-schema.org/draft/2020-12/schema&quot;,\n    &quot;title&quot;: &quot;ResponsePayload&quot;,\n    &quot;description&quot;: &quot;Payload object response&quot;,\n    &quot;type&quot;: &quot;object&quot;,\n    &quot;properties&quot;: {\n        &quot;objectA&quot;: {\n            &quot;$ref&quot;: &quot;classpath:/sub1.json&quot;\n        },\n        &quot;objectB&quot;: {\n            &quot;$ref&quot;: &quot;classpath:/sub2.json&quot;\n        },\n        &quot;objectC&quot;: {\n            &quot;$ref&quot;: &quot;classpath:/sub3.json&quot;\n        }\n    },\n    &quot;required&quot;: [\n        &quot;objectA&quot;,\n        &quot;objectB&quot;\n    ]\n}\n</code></pre>\n<p><strong>sub1.json:</strong></p>\n<pre><code>{\n    &quot;$schema&quot;: &quot;https://json-schema.org/draft/2020-12/schema&quot;,\n    &quot;title&quot;: &quot;Sub1Payload&quot;,\n    &quot;description&quot;: &quot;Sub payload 1&quot;,\n    &quot;type&quot;: &quot;object&quot;,\n    &quot;properties&quot;: {\n        &quot;name&quot;: {\n            &quot;type&quot;: &quot;string&quot;\n        },\n        &quot;number&quot;: {\n            &quot;type&quot;: &quot;integer&quot;\n        },\n        &quot;type-emp-land&quot;: {\n            &quot;type&quot;: &quot;object&quot;,\n            &quot;properties&quot;: {\n                &quot;location&quot;: {\n                    &quot;type&quot;: &quot;string&quot;\n                },\n                &quot;area&quot;: {\n                    &quot;type&quot;: &quot;string&quot;\n                }\n            }\n        }\n    },\n    &quot;required&quot;: [\n        &quot;name&quot;,\n        &quot;number&quot;,\n        &quot;type-emp-land&quot;\n    ]\n}\n</code></pre>\n<p><strong>sub2.json:</strong></p>\n<pre><code>{\n    &quot;$schema&quot;: &quot;https://json-schema.org/draft/2020-12/schema&quot;,\n    &quot;title&quot;: &quot;Sub2Payload&quot;,\n    &quot;description&quot;: &quot;Sub payload 2&quot;,\n    &quot;type&quot;: &quot;object&quot;,\n    &quot;properties&quot;: {\n        &quot;location&quot;: {\n            &quot;type&quot;: &quot;string&quot;\n        },\n        &quot;area&quot;: {\n            &quot;type&quot;: &quot;string&quot;\n        },\n        &quot;radius&quot;: {\n            &quot;type&quot;: &quot;object&quot;,\n            &quot;properties&quot;: {\n                &quot;cm&quot;: {\n                    &quot;type&quot;: &quot;integer&quot;\n                },\n                &quot;km&quot;: {\n                    &quot;type&quot;: &quot;integer&quot;\n                }\n            }\n        },\n        &quot;type-emp-land-location&quot;: {\n            &quot;$ref&quot;: &quot;classpath:/sub1.json#/properties/type-emp-land/properties/location&quot;\n        }\n    },\n    &quot;required&quot;: [\n        &quot;location&quot;,\n        &quot;area&quot;\n    ],\n    &quot;allOf&quot;: [\n        {\n            &quot;if&quot;: {\n                &quot;properties&quot;: {\n                    &quot;type-emp-land-location&quot;: {\n                        &quot;const&quot;: &quot;InsideNothingHall&quot;\n                    }\n                }\n            },\n            &quot;then&quot;: {\n                &quot;required&quot;: [\n                    &quot;radius&quot;\n                ]\n            }\n        }\n    ]\n}\n</code></pre>\n<p><strong>Input 1:</strong></p>\n<pre><code>{\n    &quot;objectA&quot;: {\n        &quot;name&quot;: &quot;Wired&quot;,\n        &quot;number&quot;: 1234,\n        &quot;type-emp-land&quot;: {\n            &quot;location&quot;: &quot;InsideNothingHall&quot;,\n            &quot;area&quot;: &quot;Inside square&quot;\n        }\n    },\n    &quot;objectB&quot;: {\n        &quot;location&quot;: &quot;Mid&quot;,\n        &quot;area&quot;: &quot;50 cm&quot;\n    }\n}\n</code></pre>\n<p><strong>Expected:</strong></p>\n<pre><code>JsonSchemaValidationException with required field 'radius' missing message.\n</code></pre>\n<p><strong>Output:</strong></p>\n<pre><code> JsonSchemaValidationException with required field 'radius' missing message\n</code></pre>\n<p><strong>Input 2:</strong></p>\n<pre><code>{\n    &quot;objectA&quot;: {\n        &quot;name&quot;: &quot;Wired&quot;,\n        &quot;number&quot;: 1234,\n        &quot;type-emp-land&quot;: {\n            &quot;location&quot;: &quot;OutTown&quot;,\n            &quot;area&quot;: &quot;Inside square&quot;\n        }\n    },\n    &quot;objectB&quot;: {\n        &quot;location&quot;: &quot;Mid&quot;,\n        &quot;area&quot;: &quot;50 cm&quot;\n    }\n}\n</code></pre>\n<p><strong>Expected:</strong></p>\n<p><code>Validation Passed - log</code>.</p>\n<p><strong>Output:</strong></p>\n<pre><code>JsonSchemaValidationException with required field 'radius' missing message\n</code></pre>\n<p>For both the cases I’m getting the same exception, but in case of input2 no exception should occur.</p>\n<p>What am I missing here?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}