{
  "question": {
    "tags": [
      "java",
      "excel",
      "excel-formula",
      "apache-poi"
    ],
    "owner": {
      "account_id": 10562993,
      "reputation": 65,
      "user_id": 7782173,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/5b089e391f3ea272c48b6f8b9d4bd75e?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "shubham dua",
      "link": "https://stackoverflow.com/users/7782173/shubham-dua"
    },
    "is_answered": true,
    "view_count": 90,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1737629445,
    "creation_date": 1737617713,
    "question_id": 79380189,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79380189/complex-formula-not-working-in-excel-data-validation-but-works-fine-in-value-com",
    "title": "Complex formula not working in Excel Data validation but works fine in value computation",
    "body": "<p>I have an excel formula that I want to add as Data validation in my sheet but the validation breaks for all inputs. Formula:</p>\n<pre><code>AND(\nLEN(\n    IFERROR(\n        LEFT(\n            INDIRECT(ADDRESS(ROW(), COLUMN())),\n            FIND(&quot;,&quot;, INDIRECT(ADDRESS(ROW(), COLUMN()))) - 1\n        ),\n        INDIRECT(ADDRESS(ROW(), COLUMN()))\n    )\n) &lt;= 5,\n\nLEN(\n    MID(\n        INDIRECT(ADDRESS(ROW(), COLUMN())),\n        IFERROR(\n            FIND(\n                &quot;$$$$&quot;, \n                IFERROR(\n                    SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 1),\n                    INDIRECT(ADDRESS(ROW(), COLUMN()))\n                )\n            ) + 1,\n            LEN(INDIRECT(ADDRESS(ROW(), COLUMN())))\n        ),\n        IFERROR(\n            IFERROR(\n                FIND(\n                    &quot;$$$$&quot;, \n                    IFERROR(\n                        SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 2),\n                        INDIRECT(ADDRESS(ROW(), COLUMN()))\n                    )\n                ),\n                LEN(INDIRECT(ADDRESS(ROW(), COLUMN()))) + 1\n            ) - IFERROR(\n                FIND(\n                    &quot;$$$$&quot;, \n                    IFERROR(\n                        SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 1),\n                        INDIRECT(ADDRESS(ROW(), COLUMN()))\n                    )\n                ) + 1,\n                LEN(INDIRECT(ADDRESS(ROW(), COLUMN())))\n            ),\n            0\n        )\n    )\n) &lt;= 5,\n\nLEN(\n    MID(\n        INDIRECT(ADDRESS(ROW(), COLUMN())),\n        IFERROR(\n            FIND(\n                &quot;$$$$&quot;, \n                IFERROR(\n                    SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 2),\n                    INDIRECT(ADDRESS(ROW(), COLUMN()))\n                )\n            ) + 1,\n            LEN(INDIRECT(ADDRESS(ROW(), COLUMN())))\n        ),\n        IFERROR(\n            IFERROR(\n                FIND(\n                    &quot;$$$$&quot;, \n                    IFERROR(\n                        SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 3),\n                        INDIRECT(ADDRESS(ROW(), COLUMN()))\n                    )\n                ),\n                LEN(INDIRECT(ADDRESS(ROW(), COLUMN()))) + 1\n            ) - IFERROR(\n                FIND(\n                    &quot;$$$$&quot;, \n                    IFERROR(\n                        SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 2),\n                        INDIRECT(ADDRESS(ROW(), COLUMN()))\n                    )\n                ) + 1,\n                LEN(INDIRECT(ADDRESS(ROW(), COLUMN())))\n            ),\n            0\n        )\n    )\n) &lt;= 5,\n\nLEN(\n    MID(\n        INDIRECT(ADDRESS(ROW(), COLUMN())),\n        IFERROR(\n            FIND(\n                &quot;$$$$&quot;, \n                IFERROR(\n                    SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 3),\n                    INDIRECT(ADDRESS(ROW(), COLUMN()))\n                )\n            ) + 1,\n            LEN(INDIRECT(ADDRESS(ROW(), COLUMN())))\n        ),\n        IFERROR(\n            IFERROR(\n                FIND(\n                    &quot;$$$$&quot;, \n                    IFERROR(\n                        SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 4),\n                        INDIRECT(ADDRESS(ROW(), COLUMN()))\n                    )\n                ),\n                LEN(INDIRECT(ADDRESS(ROW(), COLUMN()))) + 1\n            ) - IFERROR(\n                FIND(\n                    &quot;$$$$&quot;, \n                    IFERROR(\n                        SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 3),\n                        INDIRECT(ADDRESS(ROW(), COLUMN()))\n                    )\n                ) + 1,\n                LEN(INDIRECT(ADDRESS(ROW(), COLUMN())))\n            ),\n            0\n        )\n    )\n) &lt;= 5,\n\nLEN(\n    MID(\n        INDIRECT(ADDRESS(ROW(), COLUMN())),\n        IFERROR(\n            FIND(\n                &quot;$$$$&quot;, \n                IFERROR(\n                    SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 4),\n                    INDIRECT(ADDRESS(ROW(), COLUMN()))\n                )\n            ) + 1,\n            LEN(INDIRECT(ADDRESS(ROW(), COLUMN())))\n        ),\n        IFERROR(\n            IFERROR(\n                FIND(\n                    &quot;$$$$&quot;, \n                    IFERROR(\n                        SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 5),\n                        INDIRECT(ADDRESS(ROW(), COLUMN()))\n                    )\n                ),\n                LEN(INDIRECT(ADDRESS(ROW(), COLUMN()))) + 1\n            ) - IFERROR(\n                FIND(\n                    &quot;$$$$&quot;, \n                    IFERROR(\n                        SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;$$$$&quot;, 4),\n                        INDIRECT(ADDRESS(ROW(), COLUMN()))\n                    )\n                ) + 1,\n                LEN(INDIRECT(ADDRESS(ROW(), COLUMN())))\n            ),\n            0\n        )\n    )\n) &lt;= 5,\n\nLEN(INDIRECT(ADDRESS(ROW(), COLUMN()))) - LEN(SUBSTITUTE(INDIRECT(ADDRESS(ROW(), COLUMN())), &quot;,&quot;, &quot;&quot;)) &lt;= 4\n</code></pre>\n<p>)</p>\n<p>Objective:\nI want to make sure that in a given cell, not more than N words are present with &quot;,&quot; as delimiter and not more than M characters per word.</p>\n<p>Now I know this looks overly complex but this is to ensure backward compatibility with older Excel versions.\nAny better approach is welcome. One limitation, we cannot use VBA.</p>\n<p>The formula uses combination of FIND, SUBSTITUTE and MID to extract each word and check for these restrictions.\nTEXTSPLIT is not used since it is only available in recent Excel versions and my use case is to make this backward compatible</p>\n<p>Now when I add this formula as computation for some other cell it works perfectly fine but fails when added for Data Validation.\nNote: This works perfectly fine in <strong>Google sheets.</strong></p>\n<p>Anyone has any idea on why this might be happening? Even a single character input also breaks the validation.</p>\n<p>Follow up question: I experimented with TEXTSPLIT method too but when I am adding it to my sheet through my Java service, it doesn't work. I go to data validation section, it's there. When I click OK, the formula apparently activates and the checks work fine</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}