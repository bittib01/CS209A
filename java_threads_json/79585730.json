{
  "question": {
    "tags": [
      "java",
      "spring",
      "spring-boot",
      "security"
    ],
    "owner": {
      "account_id": 4110235,
      "reputation": 65,
      "user_id": 3373220,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/46b0b420e3962915c9e42cdd333f93f8?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "RituV",
      "link": "https://stackoverflow.com/users/3373220/rituv"
    },
    "is_answered": true,
    "view_count": 207,
    "accepted_answer_id": 79587750,
    "answer_count": 3,
    "score": 0,
    "last_activity_date": 1745903940,
    "creation_date": 1745298686,
    "question_id": 79585730,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79585730/spring-security-6-custom-filter-not-getting-applied-to-specific-url-pattern-in",
    "title": "Spring Security 6 Custom Filter not getting applied to specific url pattern in",
    "body": "<p>I have a configuration class where I want the custom filter SecFilters to be applied to the specific url patterns only(/api/v1/, /api/* etc).I have a separate bean for login too. But this custom filter is getting applied to all urls including /login and not adhering to only the specified pattern.Below is the code.</p>\n<pre><code>@Configuration\n@EnableWebSecurity\n@EnableMethodSecurity //Required for @PreAuthorize\npublic class SLWebConfig{\n\n    @Bean\n    @Order(1)\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception{\n\n        http.csrf(AbstractHttpConfigurer::disable);\n        http.authorizeHttpRequests((authz) -&gt; authz\n\n                .requestMatchers(&quot;/api/v1/&quot;).permitAll() //allowing to accessed with authentication\n                .requestMatchers(&quot;/api/*&quot;).authenticated() //securing only the client APIs\n                .requestMatchers(&quot;*/users/{userId}/**&quot;).access(new WebExpressionAuthorizationManager(&quot;@userSecurity.hasUserId(authentication,#userId)&quot;))\n        );\n        http.sessionManagement(sess -&gt; sess.sessionCreationPolicy(SessionCreationPolicy.STATELESS));\n        http.addFilterBefore(new SecFilters(), UsernamePasswordAuthenticationFilter.class);\n        return http.build();\n    }\n\n\n\n    @Bean\n    @Order(2)\n    public SecurityFilterChain defaultFilterChain(HttpSecurity http) throws Exception{\n        http\n                .authorizeHttpRequests(auth -&gt; auth.anyRequest().permitAll())\n                .formLogin(form -&gt; form\n                        .loginPage(&quot;/login&quot;).permitAll()\n                ).csrf(AbstractHttpConfigurer::disable);\n        return http.build();\n\n    }\n\n\n    @Bean\n    public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration)\n            throws Exception {\n        return authenticationConfiguration.getAuthenticationManager();\n    }\n}\n\n\nBelow is my custom Filter\n\n\n@Component\npublic class SecFilters extends GenericFilterBean{\n\n \n    private static TokenExtractor tokenExtractor = new BearerTokenExtractor();\n\n    private LicenseService licenseService;\n    @Autowired\n    public void setLicenseService(LicenseService licenseService) {\n        this.licenseService = licenseService;\n    }\n\n    private static final ResourceBundle resourceBundle = ResourceBundle.getBundle(&quot;i18n.messages&quot;, new Locale(&quot;en&quot;));\n\n    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)\n            throws IOException, ServletException {\n\n        try\n        {\n            HttpServletRequest httpServletRequest = (HttpServletRequest) request;\n            HttpServletResponse httpServletResponse = (HttpServletResponse) response;\n\n            //checking the licence of the server\n            if(licenseService.isLicenseExpired()) {\n                httpServletResponse.setStatus(HttpServletResponse.SC_FORBIDDEN);\n                return;\n            }\n\n            String requestURL = httpServletRequest.getRequestURI();\n            if(System.getenv(&quot;SERVER_LOG_LEVEL&quot;).equals(&quot;INFO&quot;)){\n                SLLogger.logInfo(httpServletRequest.getRequestURL().toString());\n            }\n\n\n            //request from UI client : Place holder\n            if (null != httpServletRequest.getHeader(&quot;www-Authorization&quot;)) {\n\n            }\n\n            String header = httpServletRequest.getHeader(&quot;Authorization&quot;);\n\n            // Get the token from the request\n\n\n\n            \n           \n            Authentication authentication = (Authentication) httpServletRequest.getUserPrincipal();\n            String token = null;\n            if(authentication != null)\n                token = authentication.getPrincipal().toString();\n           \n\n                try {\n\n                    \n\n                \n\n            chain.doFilter(request, response);\n\n        }catch (IndexOutOfBoundsException e)\n        {\n            ((HttpServletResponse) response).setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n            throw e;\n        }\n        catch (HttpClientErrorException e) {\n           \n            throw e;\n        } \n    }\n\n   \n    @Bean\n    public FilterRegistrationBean&lt;SecFilters&gt; clientRequestFilterRegistrationBean(SecFilters OAuthRequestFilter1){\n        FilterRegistrationBean&lt;SecFilters&gt; registrationBean = new FilterRegistrationBean&lt;SecFilters&gt;();\n        registrationBean.setFilter(OAuthRequestFilter1);\n        registrationBean.setEnabled(false);\n        return registrationBean;\n    }\n}\n</code></pre>\n<p>Please let me know how I can have separate rules for different urls. This has stopped working after I upgraded to spring 6 and spring boot 3.\nThank you in advance.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}