{
  "question": {
    "tags": [
      "java",
      "spring",
      "pdfbox"
    ],
    "owner": {
      "account_id": 31466950,
      "reputation": 1,
      "user_id": 24289947,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/76cde9eebbcb91c9bfdf923734aa7848?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Anorak",
      "link": "https://stackoverflow.com/users/24289947/anorak"
    },
    "is_answered": false,
    "view_count": 78,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1714467280,
    "creation_date": 1712952697,
    "last_edit_date": 1713968569,
    "question_id": 78318524,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78318524/need-help-calculating-the-total-length-of-a-line-path-in-a-pdf",
    "title": "Need help calculating the total length of a line path in a pdf",
    "body": "<p>i'm trying to create a small application for a friend that has a workshop. I started this as a small project to also advance my java knowledge a bit.</p>\n<p>Right now i have some calculations that i made after researching.\nThe problem is that the calculation does not output the correct number and i'm unsure how to proceed further or where i could find more information to finetune the calculation.</p>\n<p>Im using Apache PDFBox\nAnd the pdf i have is checking for magenta colored lines</p>\n<p>So my question is the following, can anyone give me more information or some help in getting this calculation right? Right now my pdf should return : 3017,789mm but its length of magenta paths: 7371.512237553014</p>\n<p>I dont want to display it or anything, i just need the information</p>\n<p>here's my code so far :</p>\n<pre><code>public class PdfCalculatorUtil extends PDFGraphicsStreamEngine {\n    private double totalLength = 0;\n    private Point2D.Double currentPoint = new Point2D.Double();\n    private Point2D.Double startPoint = new Point2D.Double();\n    private boolean inMagentaPath = false;\n\n    public PdfCalculatorUtil(PDPage page) {\n        super(page);\n    }\n\n    @Override\n    public void appendRectangle(Point2D p0, Point2D p1, Point2D p2, Point2D p3) {\n    }\n\n    @Override\n    public void drawImage(PDImage pdImage) {\n    }\n\n    @Override\n    public void clip(int windingRule) {\n    }\n\n    @Override\n    public void moveTo(float x, float y) {\n        currentPoint.setLocation(x, y);\n        startPoint.setLocation(x, y);\n    }\n\n    @Override\n    public void lineTo(float x, float y) {\n        totalLength += currentPoint.distance(x, y);\n        currentPoint.setLocation(x, y);\n    }\n\n    @Override\n    public void curveTo(float x1, float y1, float x2, float y2, float x3, float y3) {\n        // Calculate the length of the BÃ©zier curve segment\n        totalLength += bezierLength(x1, y1, x2, y2, x3, y3);\n        currentPoint.setLocation(x3, y3); // Update the current point\n    }\n\n    @Override\n    public Point2D getCurrentPoint() {\n        return currentPoint;\n    }\n\n    @Override\n    public void closePath() {\n        totalLength += currentPoint.distance(startPoint);\n        currentPoint.setLocation(startPoint);\n    }\n\n    @Override\n    public void endPath() {\n    }\n\n    @Override\n    public void strokePath() {\n    }\n\n    @Override\n    public void fillPath(int windingRule) {\n    }\n\n    @Override\n    public void fillAndStrokePath(int windingRule) {\n    }\n\n    @Override\n    public void shadingFill(COSName shadingName) {\n    }\n\n    public double getTotalLength() {\n        return totalLength;\n    }\n\n    public void extractPathLengths(PDDocument document) throws IOException {\n        for (PDPage page : document.getPages()) {\n            processPage(page);\n        }\n    }\n\n    private PDRectangle getPageDimensions(PDPage page) {\n        return page.getMediaBox();\n    }\n\n    private double getUnitsPerPoint(PDPage page) {\n        PDRectangle mediaBox = getPageDimensions(page);\n        // Calculate the length of the diagonal of the media box\n        double diagonalLength = Math.sqrt(Math.pow(mediaBox.getWidth(), 2) + Math.pow(mediaBox.getHeight(), 2));\n        // Get the diagonal length in points\n        return diagonalLength / Math.sqrt(2);\n    }\n\n    private String getPageUnits(PDPage page) {\n        double unitsPerPoint = getUnitsPerPoint(page);\n        // Determine the units\n        if (unitsPerPoint &gt;= 25.4) {\n            return &quot;millimeters&quot;;\n        } else if (unitsPerPoint &gt;= 2.54) {\n            return &quot;centimeters&quot;;\n        } else {\n            return &quot;points&quot;;\n        }\n    }\n\n    public void checkPdfUnits(PDDocument document) {\n        for (PDPage page : document.getPages()) {\n            String units = getPageUnits(page);\n            System.out.println(&quot;Page Units: &quot; + units);\n        }\n    }\n\n    @Override\n    public void processOperator(Operator operator, List&lt;COSBase&gt; operands) {\n        String operation = operator.getName();\n        if (&quot;m&quot;.equals(operation)) {\n            if (inMagentaPath) {\n                float x = ((COSNumber) operands.get(0)).floatValue();\n                float y = ((COSNumber) operands.get(1)).floatValue();\n                moveTo(x, y);\n                System.out.println(&quot;Move to (magenta): (&quot; + x + &quot;, &quot; + y + &quot;)&quot;);\n            }\n        } else if (&quot;l&quot;.equals(operation)) {\n            if (inMagentaPath) {\n                float x = ((COSNumber) operands.get(0)).floatValue();\n                float y = ((COSNumber) operands.get(1)).floatValue();\n                lineTo(x, y);\n                System.out.println(&quot;Line To (magenta): (&quot; + x + &quot;, &quot; + y + &quot;)&quot;);\n            }\n        } else if (&quot;h&quot;.equals(operation)) {\n            closePath();\n        } else if (&quot;c&quot;.equals(operation)) {\n            if (inMagentaPath) {\n            float x1 = ((COSNumber) operands.get(0)).floatValue();\n            float y1 = ((COSNumber) operands.get(1)).floatValue();\n            float x2 = ((COSNumber) operands.get(2)).floatValue();\n            float y2 = ((COSNumber) operands.get(3)).floatValue();\n            float x3 = ((COSNumber) operands.get(4)).floatValue();\n            float y3 = ((COSNumber) operands.get(5)).floatValue();\n            double segmentLength = bezierLength(x1, y1, x2, y2, x3, y3);\n            curveTo(x1, y1, x2, y2, x3, y3);\n            System.out.println(&quot;Bezier Segment Length (magenta): &quot; + segmentLength);\n            }\n        } else if (&quot;K&quot;.equals(operation)) {\n            // Set CMYK color\n            float c = ((COSNumber) operands.get(0)).floatValue();\n            float m = ((COSNumber) operands.get(1)).floatValue();\n            float y = ((COSNumber) operands.get(2)).floatValue();\n            float k = ((COSNumber) operands.get(3)).floatValue();\n            // Check for magenta color\n            inMagentaPath = c == 0.0 &amp;&amp; m == 1.0 &amp;&amp; y == 0.0 &amp;&amp; k == 0.0;\n        }\n    }\n\n    private double bezierLength(double x1, double y1, double x2, double y2, double x3, double y3) {\n        double ax = 3 * x1 + 3 * x2 - x3;\n        double ay = 3 * y1 + 3 * y2 - y3;\n        double bx = 3 * x1 - 3 * x2 + 3 * x3;\n        double by = 3 * y1 - 3 * y2 + 3 * y3;\n        double cx = 3 * x2 - 3 * x3;\n        double cy = 3 * y2 - 3 * y3;\n        double integral = 0;\n        int nt = 100; // Increase the number of intervals for better accuracy\n        double dt = 1.0 / nt;\n        for (int i = 0; i &lt; nt; i++) {\n            double t2 = Math.pow(i * dt, 2);\n            double t3 = Math.pow(i * dt, 3);\n            double sqrtTerm = Math.sqrt(ax * t2 + bx * t3 + cx);\n            double sqrtTermY = Math.sqrt(ay * t2 + by * t3 + cy);\n            if (!Double.isNaN(sqrtTerm) &amp;&amp; !Double.isInfinite(sqrtTerm) &amp;&amp;\n                    !Double.isNaN(sqrtTermY) &amp;&amp; !Double.isInfinite(sqrtTermY)) {\n                integral += Math.sqrt(sqrtTerm * sqrtTerm + sqrtTermY * sqrtTermY) * dt;\n            }\n        }\n        return integral;\n    }\n}\n\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}