{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-data",
      "h2",
      "spring-data-jdbc"
    ],
    "owner": {
      "account_id": 11899514,
      "reputation": 95,
      "user_id": 8707914,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/3ced8d83a1ca2fd17d1638644affe541?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "fragilepriCe",
      "link": "https://stackoverflow.com/users/8707914/fragileprice"
    },
    "is_answered": true,
    "view_count": 196,
    "accepted_answer_id": 79302615,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1735024613,
    "creation_date": 1734803389,
    "last_edit_date": 1735024613,
    "question_id": 79299850,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79299850/cannot-invoke-org-springframework-data-relational-core-mapping-relationalpersist",
    "title": "Cannot invoke org.springframework.data.relational.core.mapping.RelationalPersistentEntity.getPropertyAccessor(Object)",
    "body": "<p>I keep getting this exception when persisting/inserting a new entity using Spring Data JDBC. What is wrong with my entity?</p>\n<ol>\n<li><p>I already have the version field without final in the audit metadata.</p>\n</li>\n<li><p>I checked the constructor and properties of the entity to ensure\nthey align with Spring Data JDBCâ€™s.</p>\n</li>\n</ol>\n<p>This is the exception that I am facing</p>\n<pre><code>java.lang.NullPointerException: Cannot invoke &quot;org.springframework.data.relational.core.mapping.RelationalPersistentEntity.getPropertyAccessor(Object)&quot; because &quot;persistentEntity&quot; is null\n    at org.springframework.data.jdbc.core.convert.SqlParametersFactory.getParameterSource(SqlParametersFactory.java:235) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.convert.SqlParametersFactory.lambda$getParameterSource$2(SqlParametersFactory.java:251) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.mapping.model.BasicPersistentEntity.doWithProperties(BasicPersistentEntity.java:320) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.data.mapping.PersistentEntity.doWithAll(PersistentEntity.java:297) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.convert.SqlParametersFactory.getParameterSource(SqlParametersFactory.java:238) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.convert.SqlParametersFactory.forUpdate(SqlParametersFactory.java:98) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.convert.DefaultDataAccessStrategy.update(DefaultDataAccessStrategy.java:132) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.JdbcAggregateChangeExecutionContext.updateWithoutVersion(JdbcAggregateChangeExecutionContext.java:338) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.JdbcAggregateChangeExecutionContext.executeUpdateRoot(JdbcAggregateChangeExecutionContext.java:121) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.AggregateChangeExecutor.execute(AggregateChangeExecutor.java:93) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.AggregateChangeExecutor.lambda$executeSave$0(AggregateChangeExecutor.java:61) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at java.base/java.util.ArrayList.forEach(ArrayList.java:1597) ~[na:na]\n    at org.springframework.data.relational.core.conversion.SaveBatchingAggregateChange.forEachAction(SaveBatchingAggregateChange.java:64) ~[spring-data-relational-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.AggregateChangeExecutor.executeSave(AggregateChangeExecutor.java:61) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.JdbcAggregateTemplate.performSave(JdbcAggregateTemplate.java:505) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.core.JdbcAggregateTemplate.save(JdbcAggregateTemplate.java:171) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at org.springframework.data.jdbc.repository.support.SimpleJdbcRepository.save(SimpleJdbcRepository.java:69) ~[spring-data-jdbc-3.4.1.jar:3.4.1]\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]\n    at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:359) ~[spring-aop-6.2.1.jar:6.2.1]\n    at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:515) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:284) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:752) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.1.jar:6.2.1]\n    at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:174) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:149) ~[spring-data-commons-3.4.1.jar:3.4.1]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.1.jar:6.2.1]\n    at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:380) ~[spring-tx-6.2.1.jar:6.2.1]\n    at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.2.1.jar:6.2.1]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.1.jar:6.2.1]\n    at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:138) ~[spring-tx-6.2.1.jar:6.2.1]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.1.jar:6.2.1]\n    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223) ~[spring-aop-6.2.1.jar:6.2.1]\n    at jdk.proxy2/jdk.proxy2.$Proxy96.save(Unknown Source) ~[na:na]\n    at com.ezycorp.eve.application.AdminController.createMerchant(AdminController.java:32) ~[classes/:na]\n    at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103) ~[na:na]\n    at java.base/java.lang.reflect.Method.invoke(Method.java:580) ~[na:na]\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:257) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:190) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.1.jar:6.2.1]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:986) ~[spring-webmvc-6.2.1.jar:6.2.1]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:891) ~[spring-webmvc-6.2.1.jar:6.2.1]\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.1.jar:6.2.1]\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1088) ~[spring-webmvc-6.2.1.jar:6.2.1]\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:978) ~[spring-webmvc-6.2.1.jar:6.2.1]\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.1.jar:6.2.1]\n    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903) ~[spring-webmvc-6.2.1.jar:6.2.1]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564) ~[tomcat-embed-core-10.1.34.jar:6.0]\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.1.jar:6.2.1]\n    at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.34.jar:6.0]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:114) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.1.jar:6.2.1]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:397) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:905) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1741) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1190) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.34.jar:10.1.34]\n    at java.base/java.lang.Thread.run(Thread.java:1570) ~[na:na]\n\n</code></pre>\n<p>Below are my java classes</p>\n<pre><code>\npublic class MerchantId extends EntityId&lt;String&gt; {\n    public MerchantId(String id) {\n        super(id);\n    }\n}\n\npublic class MerchantKeyId extends EntityId&lt;Integer&gt; {\n\n    public MerchantKeyId(Integer id) {\n        super(id);\n    }\n}\n\npublic class BalanceId extends EntityId&lt;Integer&gt; {\n    public BalanceId(Integer id) {\n        super(id);\n    }\n}\n\n\npublic class AuditMetadata {\n\n    @CreatedDate\n    private Instant createdAt;\n\n    @LastModifiedDate\n    private Instant updatedAt;\n\n    @Version\n    private int version=0;\n//omitted getters and setters\n}\n</code></pre>\n<pre><code>public enum DashboardPermission {\n    DP1,\n    DP2\n}\n\npublic enum PaymentGateway {\n    PG1,\n    PG2\n}\n</code></pre>\n<pre><code>@Table(&quot;merchant&quot;)\npublic class Merchant {\n\n    @Id\n    private  MerchantId id;\n\n    private  String name;\n    \n    private  MerchantKeyId merchantKeyId;\n\n    private  String username;\n\n    private  String password;\n\n    private  boolean enabled;\n\n    @Embedded(onEmpty = USE_EMPTY)\n    private  Collection&lt;DashboardPermission&gt; dashboardPermissions;\n    \n    private  BalanceId balanceId;\n\n    private  PaymentGateway paymentGateway;\n\n    private  String webhookUrl;\n\n    @Embedded(onEmpty = USE_NULL)\n    private final AuditMetadata auditMetadata = new AuditMetadata();\n\n    @PersistenceCreator\n    public Merchant(\n            MerchantId merchantId,\n            String name,\n            String username,\n            String password,\n            List&lt;DashboardPermission&gt; dashboardPermissions,\n            PaymentGateway paymentGateway,\n            MerchantKeyId merchantKeyId,\n            BalanceId balanceId\n\n    ) {\n        this.id = merchantId;\n        this.name = name;\n        this.username = username;\n        this.password = password;\n        this.enabled=true;\n        this.dashboardPermissions = dashboardPermissions;\n        this.merchantKeyId=merchantKeyId;\n        this.balanceId=balanceId;\n        this.paymentGateway=paymentGateway;\n        this.webhookUrl=&quot;&quot;;\n    }\n\n//omitted getters\n}\n</code></pre>\n<p>Added my converters</p>\n<pre><code>@WritingConverter\npublic class IdConverter implements Converter&lt;EntityId&lt;?&gt;,Object&gt; {\n    @Override\n    public Object convert(EntityId&lt;?&gt; source) {\n        return source.getId();\n    }\n}\n\n@WritingConverter\npublic class DashboardPermissionConverter implements Converter&lt;Collection&lt;DashboardPermission&gt;, String&gt; {\n    @Override\n    public String convert(Collection&lt;DashboardPermission&gt; source) {\n\n        return source.stream().map(Enum::name)\n                .collect(Collectors.joining(&quot;,&quot;));\n    }\n}\n\n@Configuration\npublic class DatabaseConfig extends AbstractJdbcConfiguration {\n\n    @Override\n    protected List&lt;?&gt; userConverters() {\n        return Arrays.asList(new IdConverter(),\n                new DashboardPermissionConverter());\n    }\n}\n\n\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}