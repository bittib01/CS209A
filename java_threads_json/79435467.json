{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-batch"
    ],
    "owner": {
      "account_id": 27600608,
      "reputation": 1,
      "user_id": 21065915,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/AEdFTp5G3J35MolsI1asFyLcnxoBocvdsChSxXCWHsQ0hA=k-s256",
      "display_name": "Mashrab Buranov",
      "link": "https://stackoverflow.com/users/21065915/mashrab-buranov"
    },
    "is_answered": true,
    "view_count": 266,
    "accepted_answer_id": 79464229,
    "answer_count": 1,
    "score": -1,
    "last_activity_date": 1740414040,
    "creation_date": 1739434654,
    "last_edit_date": 1739504504,
    "question_id": 79435467,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79435467/does-spring-batch-create-tables-with-table-prefix",
    "title": "Does Spring Batch create tables with table prefix?",
    "body": "<p>I'm learning how to work with Spring Batch for processing data.</p>\n<p>Do i need to create tables with my prefix manually based on schema in Spring Batch core? Or am i missing something?</p>\n<p>Here some sources from my project:</p>\n<p>BatchConfiguration</p>\n<pre><code>@Configuration\n@EnableScheduling\n@FieldDefaults(level = PRIVATE, makeFinal = true)\n@RequiredArgsConstructor\npublic class BatchConfiguration {\n\n    BatchProperties properties;\n    OrderService orderService;\n\n    @Bean\n    public Job updateOrderStatusJob(JobRepository jobRepository, PlatformTransactionManager platformTransactionManager) {\n        Step updateOrderStatusStep = new StepBuilder(&quot;updateOrderStatusStep&quot;, jobRepository)\n                .tasklet(orderStatusUpdateTasklet(), platformTransactionManager)\n                .build();\n\n        return new JobBuilder(properties.getJob().getName(), jobRepository)\n                .start(updateOrderStatusStep)\n                .listener(orderStatusUpdateJobListener())\n                .build();\n    }\n\n    @Bean\n    public Tasklet orderStatusUpdateTasklet() {\n        return new OrderStatusUpdateTasklet(orderService);\n    }\n\n    @Bean\n    public JobExecutionListener orderStatusUpdateJobListener() {\n        return new OrderStatusUpdateJobListener();\n    }\n\n    @Bean\n    public OrderStatusUpdateJobScheduler orderStatusUpdateJobScheduler(JobLauncher jobLauncher, Job job) {\n        return new OrderStatusUpdateJobScheduler(jobLauncher, job);\n    }\n\n}\n</code></pre>\n<p>OrderStatusUpdateTasklet</p>\n<pre><code>@FieldDefaults(level = PRIVATE, makeFinal = true)\n@RequiredArgsConstructor\npublic class OrderStatusUpdateTasklet implements Tasklet {\n\n    OrderService orderService;\n\n    @Override\n    public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception {\n        LocalDateTime tenMinutesAgo = LocalDateTime.now().minusMinutes(10);\n        List&lt;Order&gt; orders = orderService.getAllOrders();\n\n        List&lt;Order&gt; updatedOrders = new ArrayList&lt;&gt;();\n        for (Order order : orders) {\n            if (order.getCreatedAt().isBefore(tenMinutesAgo) &amp;&amp; order.getIsActive()) {\n                order.setIsActive(false);\n                updatedOrders.add(order);\n            }\n        }\n\n        orderService.saveOrders(updatedOrders);\n\n        return FINISHED;\n    }\n\n}\n</code></pre>\n<p>OrderStatusUpdateJobScheduler</p>\n<pre><code>@FieldDefaults(level = PRIVATE, makeFinal = true)\n@Slf4j\n@RequiredArgsConstructor\npublic class OrderStatusUpdateJobScheduler {\n\n    private static final int TEN_SECONDS = 10000;\n\n    JobLauncher jobLauncher;\n    Job updateOrderStatusJob;\n\n    @Scheduled(fixedDelay = TEN_SECONDS)\n    public void launchStatusUpdateJob() {\n        try {\n            jobLauncher.run(updateOrderStatusJob, new JobParameters());\n        } catch (Exception e) {\n            log.error(&quot;Error launching order status update job&quot;, e);\n        }\n    }\n}\n</code></pre>\n<p>application.yml</p>\n<pre><code>server:\n  port: ${BT_PORT:8080}\n\nspring:\n  name: spring-boot-batch-test\n  config:\n    import:\n    - classpath:application-db.yml\n    - classpath:application-batch.yml\n\n\n</code></pre>\n<p>application-batch.yml</p>\n<pre><code>spring:\n  batch:\n    job:\n      name: update-order-status\n    jdbc:\n      initialize-schema: always\n      table-prefix: MY_CUSTOM_BATCH_\n</code></pre>\n<p>application-db.yml</p>\n<pre><code>spring:\n  datasource:\n    url: ${DB_URL:jdbc:postgresql://localhost:5432/spring_batch_test}\n    username: ${DB_USERNAME:spring_batch_test}\n    password: ${DB_PASSWORD}\n    driver-class-name: ${DB_DRIVER:org.postgresql.Driver}\n    hikari:\n      pool-name: spring-batch-hikari-db-pool\n      connection-timeout: 30000\n      maximum-pool-size: 10\n  jpa:\n    hibernate:\n      ddl-auto: ${DB_HIBERNATE_DDL_AUTO:update}\n      dialect: ${DB_HIBERNATE_DIALECT:org.hibernate.dialect.PostgreSQLDialect}\n</code></pre>\n<p>my pom file:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;\n         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;3.3.5&lt;/version&gt;\n    &lt;/parent&gt;\n\n    &lt;artifactId&gt;spring-boot-batch-test&lt;/artifactId&gt;\n\n    &lt;properties&gt;\n        &lt;maven.compiler.source&gt;21&lt;/maven.compiler.source&gt;\n        &lt;maven.compiler.target&gt;21&lt;/maven.compiler.target&gt;\n        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n    &lt;/properties&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n            &lt;version&gt;3.3.5&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n            &lt;version&gt;3.3.5&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-batch&lt;/artifactId&gt;\n            &lt;version&gt;3.3.5&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;version&gt;1.18.36&lt;/version&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.postgresql&lt;/groupId&gt;\n            &lt;artifactId&gt;postgresql&lt;/artifactId&gt;\n            &lt;version&gt;42.7.4&lt;/version&gt;\n            &lt;scope&gt;runtime&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre>\n<p>I'm trying to create batch job using tables prefixed with &quot;MY_CUSTOM_BATCH_&quot;. But my application failed to start.</p>\n<p>On application startup I'm getting error bad sql grammar:</p>\n<pre><code>2025-02-13T12:07:59.928+06:00 ERROR 32268 --- [   scheduling-1] .n.m.b.e.j.OrderStatusUpdateJobScheduler : Error launching order status update job\n\norg.springframework.jdbc.BadSqlGrammarException: PreparedStatementCallback; bad SQL grammar [SELECT JOB_INSTANCE_ID, JOB_NAME\nFROM MY_CUSTOM_BATCH_JOB_INSTANCE\nWHERE JOB_NAME = ?\n and JOB_KEY = ?]\n    at org.springframework.jdbc.support.SQLStateSQLExceptionTranslator.doTranslate(SQLStateSQLExceptionTranslator.java:112) ~[spring-jdbc-6.1.14.jar:6.1.14]\n    at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:107) ~[spring-jdbc-6.1.14.jar:6.1.14]\n    at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:116) ~[spring-jdbc-6.1.14.jar:6.1.14]\n    ...\n    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]\n    at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]\nCaused by: org.postgresql.util.PSQLException: ERROR: relation &quot;my_custom_batch_job_instance&quot; does not exist\n- Position: 39\n    at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2733) ~[postgresql-42.7.4.jar:42.7.4]\n\ncom.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeQuery(HikariProxyPreparedStatement.java) ~[HikariCP-5.1.0.jar:na]\n    at org.springframework.jdbc.core.JdbcTemplate$1.doInPreparedStatement(JdbcTemplate.java:732) ~[spring-jdbc-6.1.14.jar:6.1.14]\n    ...\n    at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:658) ~[spring-jdbc-6.1.14.jar:6.1.14]\n    ... 33 common frames omitted\n2025-02-13T12:07:59.956+06:00 ERROR 32268 --- [           main] o.s.boot.SpringApplication               : Application run failed\n</code></pre>\n<p>Currently my application creates tables but without the prefixes:</p>\n<pre><code>docker exec -it postgres16 psql -U spring_batch_test\npsql (16.6 (Debian 16.6-1.pgdg120+1))\nType &quot;help&quot; for help.\n\nspring_batch_test=&gt; \\dt\n                         List of relations\n Schema |             Name             | Type  |       Owner\n--------+------------------------------+-------+-------------------\n public | batch_job_execution          | table | spring_batch_test\n public | batch_job_execution_context  | table | spring_batch_test\n public | batch_job_execution_params   | table | spring_batch_test\n public | batch_job_instance           | table | spring_batch_test\n public | batch_step_execution         | table | spring_batch_test\n public | batch_step_execution_context | table | spring_batch_test\n public | orders                       | table | spring_batch_test\n(7 rows)\n\nspring_batch_test=&gt;\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}