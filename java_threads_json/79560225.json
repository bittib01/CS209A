{
  "question": {
    "tags": [
      "java",
      "hibernate",
      "jpa",
      "unique-constraint"
    ],
    "owner": {
      "account_id": 28594286,
      "reputation": 31,
      "user_id": 21892813,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/AGNmyxY7reYO_0UIpeBEn7SkDS8OrNaiEMVJIiDw6AZx=k-s256",
      "display_name": "Mahdi Sahebzamani",
      "link": "https://stackoverflow.com/users/21892813/mahdi-sahebzamani"
    },
    "is_answered": false,
    "view_count": 86,
    "answer_count": 0,
    "score": 3,
    "last_activity_date": 1748966360,
    "creation_date": 1744038456,
    "last_edit_date": 1748966360,
    "question_id": 79560225,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79560225/hibernate-mappingexception-foreign-key-column-count-mismatch-with-referenced-p",
    "title": "Hibernate MappingException - Foreign key column count mismatch with referenced primary key",
    "body": "<p>I am encountering an error when trying to save data using JPA and Hibernate. The error message is:</p>\n<pre><code>Caused by: org.hibernate.MappingException: Foreign key (FKi3uxs48nod3arim7hhpwx1anb:role_group [app_group_id])) must have same number of columns as the referenced primary key (app_group [id, app_id, group_id])\n</code></pre>\n<p>I have the following table definitions and entity mappings:</p>\n<p>app_group table creation:</p>\n<pre><code>create table app_group\n(\n    id           varchar(36) not null,\n    group_id     varchar(36) not null,\n    app_id       varchar(36) not null,\n    primary key (id),\n    unique (group_id, app_id),\n    constraint app_group_group_fk foreign key (group_id) references `group` (id),\n    constraint app_group_app_fk foreign key (app_id) references `app` (id)\n);\n</code></pre>\n<p>AppGroup JPA entity:</p>\n<pre><code>@Entity\n@Table(name = &quot;app_group&quot;)\npublic class AppGroup implements Serializable {\n    @Id \n    @Size(min = 36, max = 36)\n    protected String id;\n\n    @ManyToOne \n    @JoinColumn(name = &quot;app_id&quot;)\n    private App app;\n\n    @ManyToOne\n    @JoinColumn(name = &quot;group_id&quot;)\n    private Group group;\n\n    @OneToMany(mappedBy = &quot;appGroup&quot;, cascade = CascadeType.ALL, orphanRemoval = true)\n    private Set&lt;RoleGroup&gt; groupRoles = new HashSet&lt;&gt;();\n}\n</code></pre>\n<p>role_group table creation:</p>\n<pre><code>create table role_group\n(\n    id           varchar(36) not null,\n    group_id     varchar(36) not null,\n    role_id       varchar(36) not null,\n    app_group_id varchar(36) not null,\n    primary key (id),\n    unique (group_id, role_id),\n    constraint role_group_group_fk foreign key (group_id) references `group` (id),\n    constraint role_group_role_fk foreign key (role_id) references `role` (id),\n    constraint role_group_app_group_fk foreign key (app_group_id) references `app_group` (id)\n);\n</code></pre>\n<p>RoleGroup JPA entity:</p>\n<pre><code>@Entity\n@Table(name = &quot;role_group&quot;)\n@Accessors(fluent = true)\npublic class RoleGroup {\n    @Id \n    @Size(min = 36, max = 36)\n    protected String id;\n\n    @ManyToOne\n    @JoinColumn(name = &quot;role_id&quot;)\n    private Role role;\n\n    @ManyToOne\n    @JoinColumn(name = &quot;group_id&quot;)\n    private Group group;\n\n    @ManyToOne\n    @JoinColumn(name = &quot;app_group_id&quot;)\n    private AppGroup appGroup;\n}\n</code></pre>\n<p>Issue:\nThe <code>app_group</code> table has a primary key <code>id</code> and a unique constraint on <code>(group_id, app_id)</code>, which should work fine.</p>\n<p>The error indicates that the <code>app_group</code> table has a composite key, referring to <code>(id, app_id, group_id)</code> as the primary key, but thatâ€™s not the case in the schema.</p>\n<p>Could anyone help explain why Hibernate is treating <code>app_group</code> as having a composite primary key instead of just <code>id</code>? And how can I resolve this issue?</p>\n<p>[EDIT]</p>\n<p>To provide additional information, here are my <code>App</code> and <code>Group</code> JPA entities.</p>\n<p>Group JPA entity:</p>\n<pre><code>@Entity\n@Table(name = &quot;`group`&quot;)\npublic class Group {\n    @Id \n    @Size(min = 36, max = 36)\n    protected String id;\n\n    @ManyToMany(mappedBy = &quot;groups&quot;)\n    private final Set&lt;App&gt; apps;\n}\n</code></pre>\n<p>App JPA entity:</p>\n<pre><code>@Entity\n@Table(name = &quot;app&quot;)\npublic class App {\n    @Id \n    @Size(min = 36, max = 36)\n    protected String id;\n\n    @ManyToMany\n    @JoinTable(\n            name = &quot;app_group&quot;,\n            joinColumns = {@JoinColumn(name = &quot;app_id&quot;)}, inverseJoinColumns = {@JoinColumn(name = &quot;group_id&quot;)}\n    )\n    private Set&lt;Group&gt; groups;\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}