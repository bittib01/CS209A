{
  "question": {
    "tags": [
      "java",
      "apache-kafka",
      "zstd"
    ],
    "owner": {
      "account_id": 35502,
      "reputation": 28679,
      "user_id": 100565,
      "user_type": "registered",
      "accept_rate": 59,
      "profile_image": "https://www.gravatar.com/avatar/c35777e0d2751654391d03ccdf67edc4?s=256&d=identicon&r=PG",
      "display_name": "MeBigFatGuy",
      "link": "https://stackoverflow.com/users/100565/mebigfatguy"
    },
    "is_answered": true,
    "view_count": 3891,
    "answer_count": 2,
    "score": 0,
    "last_activity_date": 1725915543,
    "creation_date": 1724394948,
    "last_edit_date": 1724521476,
    "question_id": 78904593,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78904593/apache-kafka-3-8-0-and-zstd-jni-so-load-issues",
    "title": "Apache Kafka 3.8.0 and zstd-jni so load issues",
    "body": "<p>This question is directly related to this previous stackoverflow question&quot;</p>\n<p><a href=\"https://stackoverflow.com/questions/78844387/upgrading-apache-kafka-client-to-3-8-0-issue/78863516#78863516\">Upgrading Apache Kafka client to 3.8.0 issue</a></p>\n<p>But i don't see how that answers the question</p>\n<p>3.8.0 has added the need to add zstd-jni.jar to the client side. This jar extracts an .so out of that jar to /tmp. However /tmp needs to be executable. If tmp isn't executable,</p>\n<p>The advice is to set -DZstdNativePath=some/path to write to somewhere that is.</p>\n<p>However, looking at the code, DZstdNativePath expects the path to be the full .so path, as if you manually installed the .so yourself.</p>\n<p>So in fact if you just specify a directory, the error message is</p>\n<p>java.lang.UnsatisfiedLinkError: Expecting an absolute path of the library: lib</p>\n<p>Looking at the code, there is another variable</p>\n<p>-DZstdTempFolder=lib</p>\n<p>Based on the code, it looks like it will try to extract the .so in this directory.</p>\n<p>However, that doesn't seem to happen.</p>\n<p>Here is the code responsible for loading that .so</p>\n<p><a href=\"https://github.com/luben/zstd-jni/blob/master/src/main/java/com/github/luben/zstd/util/Native.java\" rel=\"nofollow noreferrer\">https://github.com/luben/zstd-jni/blob/master/src/main/java/com/github/luben/zstd/util/Native.java</a></p>\n<p>when i set</p>\n<p>-DZstdTempFolder=lib</p>\n<p>i get</p>\n<p>java.lang.UnsatisfiedLinkError: /tmp/libzstd-jni-1.5.6-315290147135917141017.so: /tmp/libzstd-jni-1.5.6-315290147135917141017.so: failed to map segment from shared object\nno zstd-jni-1.5.6-3 in java.library.path: /usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\nUnsupported OS/arch, cannot find /linux/amd64/libzstd-jni-1.5.6-3.so or load zstd-jni-1.5.6-3 from system libraries. Please try building from source the jar or providing libzstd-jni-1.5.6-3 in your system.</p>\n<p>Taking a step back, why would 3.8.0 now require this jar, if i am not using compression?\nIf i have to, how do you get this to work?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}