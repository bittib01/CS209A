{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "hibernate",
      "hql"
    ],
    "owner": {
      "account_id": 24182486,
      "reputation": 367,
      "user_id": 18142927,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/3c697c7fe3ecf61c37633257211d0f8d?s=256&d=identicon&r=PG",
      "display_name": "u4963840",
      "link": "https://stackoverflow.com/users/18142927/u4963840"
    },
    "is_answered": false,
    "view_count": 30,
    "closed_date": 1726670926,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1727111110,
    "creation_date": 1726661878,
    "last_edit_date": 1727111110,
    "question_id": 78998163,
    "link": "https://stackoverflow.com/questions/78998163/using-a-constructor-in-hql-gives-mappingexception-when-using-it-in-repository-in",
    "closed_reason": "Duplicate",
    "title": "Using a Constructor in HQL gives MappingException when using it in repository interface but works fine when using it in service class",
    "body": "<p>According to chapter Using a Constructor in HQL in <a href=\"https://www.baeldung.com/hibernate-query-to-custom-class\" rel=\"nofollow noreferrer\">https://www.baeldung.com/hibernate-query-to-custom-class</a> I should be able to use my DTO constructor in @Query select statement.</p>\n<p>However when I try to do this I get <code>MappingException</code>. I would like to know what do wrong and how to fix this?</p>\n<p>My error is:</p>\n<pre class=\"lang-none prettyprint-override\"><code>2024-09-18 15:01:48.030 ERROR 15688 --- [nio-9997-exec-4] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.data.mapping.MappingException: Couldn't find PersistentEntity for type class com.example.cameldemo.dto.MyDto!] with root cause\n\norg.springframework.data.mapping.MappingException: Couldn't find PersistentEntity for type class com.example.cameldemo.dto.MyDto!\n    at org.springframework.data.mapping.context.MappingContext.getRequiredPersistentEntity(MappingContext.java:79) ~[spring-data-commons-2.6.0.jar:2.6.0]\n    at org.springframework.data.mapping.context.PersistentEntities.getRequiredPersistentEntity(PersistentEntities.java:115) ~[spring-data-commons-2.6.0.jar:2.6.0]\n    at org.springframework.data.rest.webmvc.PersistentEntityResourceAssembler.wrap(PersistentEntityResourceAssembler.java:90) ~[spring-data-rest-webmvc-3.6.0.jar:3.6.0]\n    at org.springframework.data.rest.webmvc.PersistentEntityResourceAssembler.toModel(PersistentEntityResourceAssembler.java:73) ~[spring-data-rest-webmvc-3.6.0.jar:3.6.0]\n    at org.springframework.data.rest.webmvc.AbstractRepositoryRestController.entitiesToResources(AbstractRepositoryRestController.java:110) ~[spring-data-rest-webmvc-3.6.0.jar:3.6.0]\n    at org.springframework.data.rest.webmvc.AbstractRepositoryRestController.toCollectionModel(AbstractRepositoryRestController.java:80) ~[spring-data-rest-webmvc-3.6.0.jar:3.6.0]\n    at org.springframework.data.rest.webmvc.RepositorySearchController.lambda$toModel$1(RepositorySearchController.java:204) ~[spring-data-rest-webmvc-3.6.0.jar:3.6.0]\n    at java.util.Optional.map(Optional.java:215) ~[na:1.8.0_402]\n    at org.springframework.data.rest.webmvc.RepositorySearchController.toModel(RepositorySearchController.java:201) ~[spring-data-rest-webmvc-3.6.0.jar:3.6.0]\n    at org.springframework.data.rest.webmvc.RepositorySearchController.executeSearch(RepositorySearchController.java:185) ~[spring-data-rest-webmvc-3.6.0.jar:3.6.0]\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_402]\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_402]\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_402]\n    at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_402]\n    at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205) ~[spring-web-5.3.13.jar:5.3.13]\n    at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:150) ~[spring-web-5.3.13.jar:5.3.13]\n    at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:117) ~[spring-webmvc-5.3.13.jar:5.3.13]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:895) ~[spring-webmvc-5.3.13.jar:5.3.13]\n    at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:808) ~[spring-webmvc-5.3.13.jar:5.3.13]\n    at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-5.3.13.jar:5.3.13]\n    at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1067) ~[spring-webmvc-5.3.13.jar:5.3.13]\n    at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:963) ~[spring-webmvc-5.3.13.jar:5.3.13]\n    at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006) ~[spring-webmvc-5.3.13.jar:5.3.13]\n    at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:898) ~[spring-webmvc-5.3.13.jar:5.3.13]\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:655) ~[tomcat-embed-core-9.0.55.jar:4.0.FR]\n    at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883) ~[spring-webmvc-5.3.13.jar:5.3.13]\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:764) ~[tomcat-embed-core-9.0.55.jar:4.0.FR]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:227) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53) ~[tomcat-embed-websocket-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-5.3.13.jar:5.3.13]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.13.jar:5.3.13]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-5.3.13.jar:5.3.13]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.13.jar:5.3.13]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-5.3.13.jar:5.3.13]\n    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) ~[spring-web-5.3.13.jar:5.3.13]\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:189) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:162) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:197) ~[tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:97) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:540) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:135) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:78) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:357) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:382) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:895) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1722) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) [tomcat-embed-core-9.0.55.jar:9.0.55]\n    at java.lang.Thread.run(Thread.java:750) [na:1.8.0_402]\n</code></pre>\n<p>MyTable entitty class is:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.example.cameldemo.entity;\n\nimport javax.persistence.Entity;\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.GenerationType;\nimport javax.persistence.Id;\n\n@Entity\npublic class MyTable {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    public Long id;\n    public String a;\n    public String b;\n    public String c;\n}\n</code></pre>\n<p>My DTO class is:</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.example.cameldemo.dto;\n\npublic class MyDto {\n\n  public Long id;\n  public String c;\n\n  public MyDto(Long id, String c) {\n    this.id = id;\n    this.c = c;\n  }\n}\n</code></pre>\n<p>And my repository class is</p>\n<pre class=\"lang-java prettyprint-override\"><code>package com.example.cameldemo.repository;\n\nimport com.example.cameldemo.dto.MyDto;\nimport com.example.cameldemo.entity.MyTable;\nimport java.util.List;\nimport org.springframework.data.jpa.repository.Query;\nimport org.springframework.data.repository.PagingAndSortingRepository;\nimport org.springframework.data.rest.core.annotation.RepositoryRestResource;\nimport org.springframework.data.rest.core.annotation.RestResource;\n\n@RepositoryRestResource\npublic interface MyTableRepository extends PagingAndSortingRepository&lt;MyTable, Long&gt; {\n\n  @RestResource\n  @Query(&quot;SELECT new com.example.cameldemo.dto.MyDto(mt.id, mt.c) FROM MyTable mt&quot;)\n  List&lt;MyDto&gt; findAllWithQuery();\n\n}\n</code></pre>\n<p>What do I need to do to be able to select DTO like that?</p>\n<p>Edit: This question was closed as ClassNotFoundException, however I don't consider it to be an other ClassNotFoundException question. First of all ClassNotFoundException is never directly mentioned in stack trace and 2nd if I use that same class in any other way it does find the class. For example, if I create the following service method then it successfully returns me the List:</p>\n<pre class=\"lang-java prettyprint-override\"><code>  public List&lt;MyDto&gt; findLimitedResults() {\n    TypedQuery&lt;MyDto&gt; query = entityManager.createQuery(&quot;SELECT new com.example.cameldemo.dto.MyDto(mt.id, mt.c) FROM MyTable mt&quot;, MyDto.class);\n    return query.getResultList();\n  }\n</code></pre>\n<p>Edit [solution]: âœ… Turned out the problem with projection was that I was calling it directly over Spring rest interface. If repository returns projection or DTO then there needs to be something in between repository and rest response. For example rest controller that calls repository method and returns whatever repository method is returning. Or for better code style a service could be added in between rest controller and repository.</p>\n<p>Here is working example:</p>\n<p>Repository:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RepositoryRestResource\npublic interface MyTableRepository extends PagingAndSortingRepository&lt;MyTable, Long&gt; {\n\n  @RestResource\n  @Query(&quot;SELECT new com.example.cameldemo.dto.MyDto(mt.id, mt.c) FROM MyTable mt&quot;)\n  Object[] findAllWithQuery();\n\n  @RestResource\n  @Query(&quot;SELECT new com.example.cameldemo.dto.MyDto(mt.id, mt.c) FROM MyTable mt&quot;)\n  List&lt;MyDto&gt; findAllWithQueryDto();\n\n  @RestResource\n  @Query(&quot;SELECT mt.id AS id, mt.c AS c FROM MyTable mt&quot;)\n  List&lt;MyProjection&gt; findAllWithQueryProjection();\n\n}\n</code></pre>\n<p>Controller:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@RestController\npublic class MyController {\n\n    @Autowired\n    private MyTableRepository myTableRepository;\n\n    @GetMapping(&quot;/myDtos2&quot;)\n    public List&lt;MyProjection&gt; getMyDtos2() {\n        return myTableRepository.findAllWithQueryProjection();\n    }\n\n    @GetMapping(&quot;/myDtos3&quot;)\n    public List&lt;MyDto&gt; getMyDtos3() {\n        return myTableRepository.findAllWithQueryDto();\n    }\n\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}