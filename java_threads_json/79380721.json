{
  "question": {
    "tags": [
      "java",
      "android"
    ],
    "owner": {
      "account_id": 7813671,
      "reputation": 13,
      "user_id": 5909098,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/d8ff6945cfbedeb6bac3bfa9761724c3?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "praneetk2",
      "link": "https://stackoverflow.com/users/5909098/praneetk2"
    },
    "is_answered": false,
    "view_count": 29,
    "answer_count": 0,
    "score": 1,
    "last_activity_date": 1737629411,
    "creation_date": 1737629411,
    "question_id": 79380721,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79380721/android-printservice-printjob-document-data-is-of-very-low-quality-filedescript",
    "title": "Android PrintService printjob document data is of very low quality. FileDescriptor gives inputstream that reads to a very low quality file. Tried alot",
    "body": "<p>Android PrintService printjob document data is of very low quality. FileDescriptor gives inputstream that reads to a very low quality file. Tried researching on net but got nothing good. Stuck in this from last four days, Any help would be greatly appreciated</p>\n<p>public class CustomPrintService extends PrintService {</p>\n<pre><code>private static final String TAG = &quot;Praneet&quot;;\nprivate PrinterInfo mThermalPrinter;\n@Override\npublic void onCreate() {\n    super.onCreate();\n    Log.e(TAG, &quot;Custom Print Service created.&quot;);\n    mThermalPrinter = new PrinterInfo.Builder(generatePrinterId(&quot;BT-582&quot;),\n            &quot;Kebio Prints&quot;, PrinterInfo.STATUS_IDLE).build();\n}\n\n@Override\nprotected PrinterDiscoverySession onCreatePrinterDiscoverySession() {\n    return new CustomPrinterDiscoverySession();\n}\n\n@Override\nprotected void onRequestCancelPrintJob(PrintJob printJob) {\n    Log.e(TAG, &quot;Canceling print job: &quot; + printJob.getId());\n    if (printJob.isStarted()) {\n        printJob.cancel();\n    }\n}\n\n@Override\nprotected void onPrintJobQueued(PrintJob printJob) {\n    if (printJob.isQueued()) {\n        Log.e(TAG, &quot;Processing queued print job: &quot; + printJob.getId());\n        processPrintJob(printJob);\n    }\n}\n\n@Override\npublic void onDestroy() {\n    super.onDestroy();\n    Log.e(TAG, &quot;Custom Print Service destroyed.&quot;);\n}\n\nprivate void processPrintJob(PrintJob printJob) {\n    PrintDocument document = printJob.getDocument();\n    if (document != null) {\n        try (ParcelFileDescriptor descriptor = document.getData();\n             InputStream inputStream = new ParcelFileDescriptor.AutoCloseInputStream(descriptor)) {\n\n            // Define the output PDF file path\n            File outputFile = new File(getExternalFilesDir(null), &quot;printed_document.pdf&quot;);\n            try (OutputStream outputStream = new FileOutputStream(outputFile)) {\n\n                // Copy content from input stream to output stream (PDF generation)\n                byte[] buffer = new byte[5*1024];\n                int bytesRead;\n                while ((bytesRead = inputStream.read(buffer)) != -1) {\n                    outputStream.write(buffer, 0, bytesRead);\n                }\n\n                Log.d(&quot;Praneet&quot;, &quot;PDF generated at: &quot; + outputFile.getAbsolutePath());\n                printJob.complete(); // Mark job as completed\n            } catch (Exception e) {\n                Log.e(&quot;Praneet&quot;, &quot;Error writing PDF: &quot; + e.getMessage());\n                printJob.fail(&quot;Failed to generate PDF&quot;);\n            }\n        } catch (Exception e) {\n            Log.e(&quot;Praneet&quot;, &quot;Error reading print document: &quot; + e.getMessage());\n            printJob.fail(&quot;Failed to process document&quot;);\n        }\n    } else {\n        Log.e(&quot;Praneet&quot;, &quot;No document available&quot;);\n        printJob.fail(&quot;No document to print&quot;);\n    }\n}\n// Custom printer discovery session\nprivate class CustomPrinterDiscoverySession extends PrinterDiscoverySession {\n\n    private final List&lt;PrinterInfo&gt; discoveredPrinters = new ArrayList&lt;&gt;();\n\n    @Override\n    public void onStartPrinterDiscovery(List&lt;PrinterId&gt; priorityList) {\n        Log.e(TAG, &quot;Starting printer discovery...&quot;);\n\n        // Simulate discovering a single printer\n        PrintAttributes.MediaSize customSize = new PrintAttributes.MediaSize(mThermalPrinter.getId().getLocalId(),\n\n                &quot;58mm thermal Paper&quot;, 58, 100);\n\n\n        PrinterCapabilitiesInfo capabilities =\n                new PrinterCapabilitiesInfo.Builder(mThermalPrinter.getId())\n                        .addMediaSize(customSize, true)\n\n                        .addResolution(new PrintAttributes.Resolution(mThermalPrinter.getId().getLocalId(), &quot;Default&quot;, 1000, 1000), true)\n                        .setColorModes(PrintAttributes.COLOR_MODE_MONOCHROME, PrintAttributes.COLOR_MODE_MONOCHROME)\n                        .build();\n\n        PrinterInfo printerInfo = new PrinterInfo.Builder(mThermalPrinter.getId(), &quot;Kebio Prints&quot;, PrinterInfo.STATUS_IDLE)\n                .setCapabilities(capabilities)\n                .build();\n\n        discoveredPrinters.add(printerInfo);\n        addPrinters(discoveredPrinters);\n        Log.e(TAG, &quot;Printer discovered: &quot; + printerInfo.getName());\n    }\n\n    @Override\n    public void onStopPrinterDiscovery() {\n        Log.e(TAG, &quot;Stopping printer discovery...&quot;);\n    }\n\n    @Override\n    public void onValidatePrinters(List&lt;PrinterId&gt; printerIds) {\n        Log.e(TAG, &quot;Validating printers...&quot;);\n    }\n\n    @Override\n    public void onStartPrinterStateTracking(PrinterId printerId) {\n        Log.e(TAG, &quot;Starting printer state tracking for: &quot; + printerId.getLocalId());\n    }\n\n    @Override\n    public void onStopPrinterStateTracking(PrinterId printerId) {\n        Log.e(TAG, &quot;Stopping printer state tracking for: &quot; + printerId.getLocalId());\n    }\n\n    @Override\n    public void onDestroy() {\n        Log.e(TAG, &quot;Destroying discovery session...&quot;);\n    }\n}\n</code></pre>\n<p>}</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}