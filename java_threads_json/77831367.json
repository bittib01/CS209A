{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-security",
      "jwk",
      "spring-resource-server"
    ],
    "owner": {
      "account_id": 2206549,
      "reputation": 2712,
      "user_id": 1949628,
      "user_type": "registered",
      "accept_rate": 92,
      "profile_image": "https://i.sstatic.net/zomLZ.png?s=256",
      "display_name": "scre_www",
      "link": "https://stackoverflow.com/users/1949628/scre-www"
    },
    "is_answered": true,
    "view_count": 1460,
    "accepted_answer_id": 77832106,
    "answer_count": 1,
    "score": -1,
    "last_activity_date": 1712052803,
    "creation_date": 1705484577,
    "question_id": 77831367,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/77831367/spring-boot-security-resource-server-how-to-reload-a-jwkset-on-jwt-validation",
    "title": "Spring Boot Security Resource Server - how to reload a JWKset on JWT validation failure",
    "body": "<p>Given the following code:</p>\n<pre><code>@Configuration\n@EnableWebSecurity\nclass MyCustomSecurityConfiguration {\n    @Bean\n    open fun filterChain(http: HttpSecurity): SecurityFilterChain {\n        http {\n            authorizeRequests {\n                authorize(anyRequest, authenticated)\n            }\n            oauth2ResourceServer {\n                jwt {}\n            }\n        }\n        return http.build()\n    }\n}\n</code></pre>\n<p>And this configuration:</p>\n<pre><code>spring:\n  security:\n    oauth2:\n      resourceserver:\n        jwt:\n          jwk-set-uri: https://idp.example.com/.well-known/jwks.json\n</code></pre>\n<p>With this example every incoming request will be checked for a valid JWK by <a href=\"https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/jwt.html\" rel=\"nofollow noreferrer\">Spring Oauth 2.0 Resource Server dependency</a>. This works but I do occasionaly see 401's. I know this happens because the JWKset I'm loading is very dynamic. We use rotating keys for signing JWT's and keys are added and removed in the JWKset frequently.</p>\n<p>By default Nimbus refreshes the in-memory JWKset every 5 minutes. I can lower the value to something shorter like 1 second if I want. However when I do this, I still see a small amount of 401's.</p>\n<p><strong>I'm looking for a way to refresh the JWKset on JWT Authentication failure in Spring Boot. Next I want to check the request again with the refreshed JWKset and test if it passes now. This will make the request slower but it is better than serving a 401.</strong></p>\n<p>I see no way to do this in de Spring Documentation. I also don't know how to &quot;reprocess&quot; a failed 401 request in Spring Security.</p>\n<p>Hence my question, how can I do this?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}