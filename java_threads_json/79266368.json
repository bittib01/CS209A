{
  "question": {
    "tags": [
      "java",
      "angular",
      "spring-boot"
    ],
    "owner": {
      "account_id": 29155086,
      "reputation": 19,
      "user_id": 22335060,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/YP84i.jpg?s=256",
      "display_name": "Ali Turgut",
      "link": "https://stackoverflow.com/users/22335060/ali-turgut"
    },
    "is_answered": true,
    "view_count": 132,
    "accepted_answer_id": 79302967,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1748362816,
    "creation_date": 1733776030,
    "last_edit_date": 1748362816,
    "question_id": 79266368,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79266368/spring-boot-angular18-uploading-photo",
    "title": "Spring Boot Angular18 Uploading Photo",
    "body": "<p>I'm trying to do Full-stack website by myself. I'm spring developer and I'm trying to learn Angular. My code is working but it is very slow. I upload a photo to the program but it can not appear, sometimes it takes 40 - 60 seconds. I think it isn't normal, when I clicked the upload button it is saved in a database but it won't show up in the front end web page.</p>\n<p>Below are the code for both my back and front ends. Has anyone had this problem before?</p>\n<pre class=\"lang-html prettyprint-override\"><code>&lt;div class=&quot;row&quot;&gt;\n    &lt;!-- Product Image --&gt;\n     &lt;div class=&quot;col-md-6 product-image&quot;&gt;\n      &lt;img *ngIf=&quot;product.imageUrl; else uploadPhoto&quot; [src]=&quot;product.imageUrl&quot;  class=&quot;img-fluid rounded shadow-lg&quot;&gt;\n      &lt;div *ngIf=&quot;isLoading&quot; class=&quot;loading-overlay&quot;&gt;\n        &lt;div class=&quot;spinner&quot;&gt;&lt;/div&gt;\n      &lt;/div&gt;\n      \n      &lt;ng-template #uploadPhoto&gt;\n        &lt;div class=&quot;upload-container&quot;&gt;\n          &lt;label class=&quot;upload-photo-btn&quot;&gt;\n            &lt;input type=&quot;file&quot; (change)=&quot;onFileSelected($event)&quot; id=&quot;photoUpload&quot; hidden&gt;\n            &lt;span&gt;Upload Photo&lt;/span&gt;\n          &lt;/label&gt;\n        &lt;/div&gt;\n      &lt;/ng-template&gt;\n      \n    &lt;/div&gt;\n</code></pre>\n<pre class=\"lang-js prettyprint-override\"><code> onFileSelected(event: Event): void {\n    const input = event.target as HTMLInputElement;\n    if (input?.files?.length) {\n      const file = input.files[0];\n  \n      // When the loading starts, we set isLoading to true\n      this.isLoading = true;\n  \n      // We call the photo upload service\n      this.productService.uploadPhoto(this.product.id, file).subscribe({\n        next: (response) =&gt; {\n          // If the photo is successfully uploaded, we update the URL\n          this.product.imageUrl = response;\n          console.log(&quot;Photo uploaded successfully: &quot;, response);\n        },\n        error: (error) =&gt; {\n          // In case of an error, we show the correct error message to the user\n          this.isLoading = false; // We hide the spinner when an error occurs\n          if (error.status === 400) {\n            alert('The file format is invalid or the file is too large. Please try again.');\n          } else if (error.status === 500) {\n            alert('A server error occurred. Please try again later.');\n          } else {\n            alert('There was an error trying to load the photo. Please try again.');\n          }\n          console.error(&quot;An error occurred while uploading the photo: &quot;, error);\n        },\n        complete: () =&gt; {\n          // After the installation process is completed, we hide the spinner\n          this.isLoading = false;\n        }\n      });\n    }\n  }\n</code></pre>\n<pre class=\"lang-js prettyprint-override\"><code>uploadPhoto(productId:number, file:File) : Observable&lt;string&gt; {\n    const formData = new FormData();\n    formData.append('file',file,file.name);\n\n    return this.http.post&lt;string&gt;(`http://localhost:8080/v1/photos/upload/${productId}`, formData,{responseType: 'text' as 'json' });\n\n  }\n</code></pre>\n<p>Application properties:</p>\n<pre class=\"lang-ini prettyprint-override\"><code>server.tomcat.connection-timeout=60s\nspring.servlet.multipart.max-file-size=3MB\nspring.servlet.multipart.max-request-size=3MB\nfile.upload-dir = src/main/resources/static/uploads\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@RestController\n@RequestMapping(&quot;/v1/photos&quot;)\npublic class FileStorageController {\n\n\n    private final FileStorageService fileStorageService;\n    private final ProductRepository productRepository;\n\n\n    public FileStorageController(FileStorageService fileStorageService, ProductRepository productRepository) {\n        this.fileStorageService = fileStorageService;\n        this.productRepository = productRepository;\n    }\n\n    @PostMapping(&quot;/upload/{id}&quot;)\n    public ResponseEntity&lt;String&gt; uploadfile(@PathVariable int id, @RequestParam(&quot;file&quot;) MultipartFile multipartFile){\n            try {\n                Product product = productRepository.findById(id).orElseThrow(() -&gt; new IdNotFoundException(id));\n                String photoUrl = fileStorageService.saveFile(multipartFile);\n                product.setImageUrl(photoUrl);\n                productRepository.save(product);\n\n               return ResponseEntity.ok(photoUrl);\n            }catch (Exception e){\n                return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(&quot;Error: &quot; + e.getMessage());\n            }\n\n    }\n\n\n}\n</code></pre>\n<pre class=\"lang-java prettyprint-override\"><code>@Service\npublic class FileStorageService {\n\n    private final String uploadDir;\n    private final long MAX_FILE_SIZE = 3 * 1024 * 1024 ;\n    // Constructor with @Value to read upload directory from application.properties\n    public FileStorageService(@Value(&quot;${file.upload-dir}&quot;) String uploadDir) {\n        this.uploadDir = Paths.get(uploadDir).toAbsolutePath().toString();\n    }\n\n    public String saveFile(MultipartFile file) throws IOException {\n        if (file.isEmpty()) {\n            throw new RuntimeException(&quot;File is empty!&quot;);\n        }\n\n        if(file.getSize() &gt; MAX_FILE_SIZE){\n            throw new RuntimeException(&quot;File size exceeds the maximum allowed size of 3 MB.&quot;);\n        }\n        // Generate a unique file name\n        String fileName = UUID.randomUUID().toString() + &quot;_&quot; + file.getOriginalFilename();\n        Path filePath = Paths.get(uploadDir, fileName);\n\n        // Create directories if they don't exist\n        Files.createDirectories(filePath.getParent());\n\n        Files.write(filePath, file.getBytes());\n\n        return &quot;/uploads/&quot; + fileName;\n    }\n}\n</code></pre>\n<p>I'd like to solve this problem to make my web application faster.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}