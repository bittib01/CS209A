{
  "question": {
    "tags": [
      "java",
      "springdoc",
      "springdoc-openapi-ui",
      "swagger-3.0",
      "spring-boot-security"
    ],
    "owner": {
      "account_id": 37514060,
      "reputation": 23,
      "user_id": 28285313,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/94c9e00417d87f8e4f640a5102fa6891?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Emalee",
      "link": "https://stackoverflow.com/users/28285313/emalee"
    },
    "is_answered": true,
    "view_count": 264,
    "accepted_answer_id": 79188782,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1732552661,
    "creation_date": 1731580087,
    "last_edit_date": 1732552661,
    "question_id": 79188335,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79188335/a-very-specific-spring-boot-actuator-swagger-integration-question",
    "title": "A very specific spring boot actuator / swagger integration question",
    "body": "<p>I'm launching my springboot webapp and navigating to localhost/api/myservice/swagger-ui/index.html, but getting a 401 Unauthorized. I've done all the usual things from now countless answers on SO, but none seem to apply specifically to this pairing of spring and spring doc. One limitation I have is Java 1.8, else I would use newer versions of software. Handcuffs.</p>\n<p>Short version:\nspring-boot: 2.7.18\nspring-doc: 1.8.0</p>\n<p>pom.xml snippets:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;2.7.18&lt;/version&gt;\n    &lt;/parent&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springdoc&lt;/groupId&gt;\n            &lt;artifactId&gt;springdoc-openapi-ui&lt;/artifactId&gt;\n            &lt;version&gt;1.8.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n</code></pre>\n<p>When I checked, the oldest version of springboot for springdocs was past Java 1.8.</p>\n<p>application.yml snippets:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>springdoc:\n  api-docs:\n    path: /api-docs/**\n  swagger-ui:\n    enabled = true\n    path = /swagger-ui.html\n    tryItOutEnabled = false\n    filter = false\n    syntaxHighlight.activated = true\nspring:\n  mvc:\n    pathmatch:\n      matching-strategy: ant_path_matcher\nserver:\n  servlet:\n    context-path: /api/myservice\n</code></pre>\n<p>SwaggerConfig.java snippets:</p>\n<pre><code>@Configuration\npublic class SwaggerConfig {\n    @Bean\n    public GroupedOpenApi api() {\n        return GroupedOpenApi.builder()\n                .group(&quot;my/package/**&quot;)\n                .pathsToMatch(&quot;/**&quot;)\n                .packagesToExclude(&quot;/error.**&quot;)\n                .build();\n    }\n\n    @Bean\n    public OpenAPI apiInfo() {\n        final String securitySchemeName = &quot;bearerAuth&quot;;\n        return new OpenAPI()\n                .addSecurityItem(new SecurityRequirement().addList(securitySchemeName))\n                .components(new Components().addSecuritySchemes(\n                        securitySchemeName,\n                        new SecurityScheme()\n                                .name(securitySchemeName)\n                                .type(SecurityScheme.Type.HTTP)\n                                .in(SecurityScheme.In.HEADER)\n                                .scheme(&quot;bearer&quot;)\n                                .bearerFormat(&quot;JWT&quot;)\n                ))\n                .info(new Info()\n                        .title(title)\n                        .version(version)\n                        .description(&quot;&quot;)\n                )\n                .servers(Collections.singletonList(\n                        new Server()\n                                .url(contextPath)\n                                .description(&quot;Default Server URL&quot;)\n                ));\n    }\n}\n</code></pre>\n<p>SpringConfiguration.java snippets:</p>\n<pre><code>@Configuration\n@EnableGlobalMethodSecurity(prePostEnabled = true)\npublic class SpringConfiguration {\n    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n// I have tried very many things here, but I don't see how it could get much more permissive than this ;)\n        http\n                .csrf().disable()\n                .authorizeRequests().anyRequest().permitAll();\n        return http\n                .build();\n    }\n\n    @Bean\n    public RequestMatcher requestMatcher() {\n        this.log.debug(&quot;Creating request matcher&quot;);\n        List&lt;RequestMatcher&gt; requestMatchers = new ArrayList&lt;&gt;();\n        requestMatchers.add(new AntPathRequestMatcher(&quot;/**&quot;));\n        return new OrRequestMatcher(requestMatchers);\n    }\n\n    @Bean\n    public CustomAuthenticationFilter customAuthenticationFilter(\n            RequestMatcher requestMatcher,\n            AuthenticationConfiguration authenticationConfiguration)\n            throws Exception {\n        CustomAuthenticationFilter result = new CustomAuthenticationFilter(requestMatcher);\n        result.setAuthenticationManager(authenticationConfiguration.getAuthenticationManager());\n        return result;\n    }\n\n}\n</code></pre>\n<p>When I uncomment the CustomAuthenticationFilter stuff, I get the 401 Unauthorized hitting localhost/api/myservice/swagger-ui/index.html, because that class is being applied, but when I comment it out, I hit the swagger page just fine.</p>\n<p>I'm new to this version of SpringBoot and new to Swagger 3 and new to springdocs. I have this working in other microservices that use a FilterRegistrationBean instead of something like CustomAuthenticationFilter, and I'm not sure why the same configurations don't work in this repository. Bonus points if this can be done without disabling csrf.</p>\n<p>When I navigate to localhost/api/myservice/swagger-ui/index.html I get a 401 Unauthorized. I expect the Swagger page to load without needing authorization.</p>\n<p>When I comment out the CustomAuthenticationFilter bean, I get the expected result. I'm not sure why beyond being certain that the CustomAuthenticationFilter is being used to secure Swagger pages when I don't want it to.</p>\n<p>I have also tried</p>\n<pre><code>    @Bean\n    public WebSecurityCustomizer webSecurityCustomizer(@Value(&quot;${server.servlet.context-path}&quot;) String contextPath) {\n        return web -&gt; web\n                .ignoring()\n                .antMatchers(&quot;/v3/api-docs/**&quot;, &quot;/swagger-ui.html&quot;, &quot;/swagger-ui/**&quot;, contextPath + &quot;/swagger-ui/**&quot;);\n    }\n</code></pre>\n<p>which issues printed warnings on the console about using authorizeHttpRequests instead. And I've tried that as well.</p>\n<pre><code>    @Bean\n    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http\n                .csrf().disable()\n                .authorizeRequests()\n                //.authorizeHttpRequests()\n                .antMatchers(\n                        &quot;/v2/api-docs&quot;,\n                        &quot;/v3/api-docs/**&quot;,\n                        &quot;/swagger-resources/**&quot;,\n                        &quot;/swagger-ui/**&quot;,\n                        &quot;/swagger-ui.html&quot;,\n                        &quot;/swagger-ui/index.html&quot;,\n                        contextPath + &quot;/swagger-ui/index.html&quot;,\n                        &quot;/configuration/ui&quot;,\n                        &quot;/configuration/security&quot;,\n                        &quot;/webjars/**&quot;,\n                        &quot;/api/**&quot;,\n                        contextPath + &quot;/swagger-ui/**&quot;\n                ).permitAll()\n                .and().authorizeRequests().antMatchers(&quot;/api/**&quot;).authenticated();\n        return http.build();\n    }\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}