{
  "question": {
    "tags": [
      "java",
      "apache-kafka",
      "pom.xml",
      "apache-kafka-connect",
      "grpc-java"
    ],
    "owner": {
      "account_id": 19785893,
      "reputation": 11,
      "user_id": 14489859,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/4ac079705dee457792173199fff15404?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Charles Morin",
      "link": "https://stackoverflow.com/users/14489859/charles-morin"
    },
    "is_answered": false,
    "view_count": 95,
    "answer_count": 0,
    "score": 1,
    "last_activity_date": 1726974946,
    "creation_date": 1726963765,
    "last_edit_date": 1726974946,
    "question_id": 79010652,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79010652/shaded-jar-for-kafka-connector-using-grpc-netty-shaded-not-working",
    "title": "Shaded jar for Kafka Connector using grpc-netty-shaded not working",
    "body": "<p>I am building a shaded jar that I want to run on a Kafka Connect cluster. This jar is a simple gRPC client that consumes Kafka messages from a topic then sends them to a server. However, when I run my jar on the Kafka Connect cluster it gives me this error:</p>\n<pre><code>java.util.ServiceConfigurationError: io.grpc.ManagedChannelProvider: io.grpc.netty.NettyChannelProvider not a subtype\n     at java.base/java.util.ServiceLoader.fail(ServiceLoader.java:593)\n     at java.base/java.util.ServiceLoader$LazyClassPathLookupIterator.hasNextService(ServiceLoader.java:1244)\n     at java.base/java.util.ServiceLoader$LazyClassPathLookupIterator.hasNext(ServiceLoader.java:1273)\n     at java.base/java.util.ServiceLoader$2.hasNext(ServiceLoader.java:1309)\n     at java.base/java.util.ServiceLoader$3.hasNext(ServiceLoader.java:1393)\n     at io.grpc.ServiceProviders.loadAll(ServiceProviders.java:67)\n     at io.grpc.ManagedChannelRegistry.getDefaultRegistry(ManagedChannelRegistry.java:101)\n     at io.grpc.ManagedChannelProvider.provider(ManagedChannelProvider.java:43)\n     at io.grpc.ManagedChannelBuilder.forAddress(ManagedChannelBuilder.java:44)\n     at com.pinax.kafka.paymentgateway.connect.sink.PaymentGatewayClient.start(PaymentGatewayClient.java:46)\n     at com.pinax.kafka.paymentgateway.connect.sink.PaymentGatewaySinkTask.start(PaymentGatewaySinkTask.java:29)\n     at org.apache.kafka.connect.runtime.WorkerSinkTask.initializeAndStart(WorkerSinkTask.java:333)\n     at org.apache.kafka.connect.runtime.WorkerTask.doRun(WorkerTask.java:227)\n     at org.apache.kafka.connect.runtime.WorkerTask.run(WorkerTask.java:284)\n     at org.apache.kafka.connect.runtime.isolation.Plugins.lambda$withClassLoader$7(Plugins.java:339)\n     at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n     at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n     at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n</code></pre>\n<p>I really dont understand what is the issue here. It seems that <code>grpc-netty-shaded</code> cannot find the type that should normally be there. Here's what I'm doing in my <code>pom.xml</code>:</p>\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n\n  &lt;groupId&gt;com.pinax.kafka.paymentgateway.connect.sink&lt;/groupId&gt;\n  &lt;artifactId&gt;pinax-payment-gateway-kafka-connect&lt;/artifactId&gt;\n  &lt;version&gt;0.0.1&lt;/version&gt;\n\n  &lt;name&gt;pinax-payment-gateway-kafka-connect&lt;/name&gt;\n\n  &lt;properties&gt;\n    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;\n    &lt;maven.compiler.source&gt;17&lt;/maven.compiler.source&gt;\n    &lt;maven.compiler.target&gt;17&lt;/maven.compiler.target&gt;\n    &lt;grpc.version&gt;1.66.0&lt;/grpc.version&gt;\n  &lt;/properties&gt;\n\n  &lt;dependencyManagement&gt;\n    &lt;dependencies&gt;\n      &lt;dependency&gt;\n        &lt;groupId&gt;io.grpc&lt;/groupId&gt;\n        &lt;artifactId&gt;grpc-bom&lt;/artifactId&gt;\n        &lt;version&gt;${grpc.version}&lt;/version&gt;\n        &lt;type&gt;pom&lt;/type&gt;\n        &lt;scope&gt;import&lt;/scope&gt;\n      &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n  &lt;/dependencyManagement&gt;\n\n  &lt;dependencies&gt;\n\n    &lt;!--Kafka Connect dependencies--&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;\n      &lt;artifactId&gt;connect-api&lt;/artifactId&gt;\n      &lt;version&gt;3.7.0&lt;/version&gt;\n      &lt;scope&gt;provided&lt;/scope&gt;\n    &lt;/dependency&gt;\n\n    &lt;dependency&gt;\n        &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;\n        &lt;artifactId&gt;protobuf-java-util&lt;/artifactId&gt;\n        &lt;version&gt;4.28.0&lt;/version&gt;\n    &lt;/dependency&gt;\n\n    &lt;!--gRPC dependencies--&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;io.grpc&lt;/groupId&gt;\n      &lt;artifactId&gt;grpc-netty-shaded&lt;/artifactId&gt;\n      &lt;scope&gt;runtime&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;io.grpc&lt;/groupId&gt;\n      &lt;artifactId&gt;grpc-stub&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;io.grpc&lt;/groupId&gt;\n      &lt;artifactId&gt;grpc-protobuf&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n\n    &lt;!--For proto annotation--&gt;\n    &lt;dependency&gt;\n      &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;\n      &lt;artifactId&gt;annotations-api&lt;/artifactId&gt;\n      &lt;version&gt;6.0.53&lt;/version&gt;\n      &lt;scope&gt;provided&lt;/scope&gt;\n    &lt;/dependency&gt;\n\n  &lt;/dependencies&gt;\n\n  &lt;build&gt;\n\n      &lt;extensions&gt;\n        &lt;extension&gt;\n          &lt;groupId&gt;kr.motd.maven&lt;/groupId&gt;\n          &lt;artifactId&gt;os-maven-plugin&lt;/artifactId&gt;\n          &lt;version&gt;1.7.1&lt;/version&gt;\n        &lt;/extension&gt;\n      &lt;/extensions&gt;\n\n      &lt;plugins&gt;\n\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;\n          &lt;version&gt;3.6.0&lt;/version&gt;\n          &lt;executions&gt;\n            &lt;execution&gt;\n              &lt;phase&gt;package&lt;/phase&gt;\n              &lt;goals&gt;\n                &lt;goal&gt;shade&lt;/goal&gt;\n              &lt;/goals&gt;\n              &lt;configuration&gt;\n                &lt;createDependencyReducedPom&gt;false&lt;/createDependencyReducedPom&gt;\n                &lt;transformers&gt;\n                  &lt;transformer implementation=&quot;org.apache.maven.plugins.shade.resource.ServicesResourceTransformer&quot;/&gt;\n                &lt;/transformers&gt;\n              &lt;/configuration&gt;\n            &lt;/execution&gt;\n          &lt;/executions&gt;\n        &lt;/plugin&gt;\n\n        &lt;plugin&gt;\n          &lt;groupId&gt;org.xolstice.maven.plugins&lt;/groupId&gt;\n          &lt;artifactId&gt;protobuf-maven-plugin&lt;/artifactId&gt;\n          &lt;version&gt;0.6.1&lt;/version&gt;\n          &lt;configuration&gt;\n            &lt;protocArtifact&gt;com.google.protobuf:protoc:3.25.3:exe:${os.detected.classifier}&lt;/protocArtifact&gt;\n            &lt;pluginId&gt;grpc-java&lt;/pluginId&gt;\n            &lt;pluginArtifact&gt;io.grpc:protoc-gen-grpc-java:1.66.0:exe:${os.detected.classifier}&lt;/pluginArtifact&gt;\n            &lt;clearOutputDirectory&gt;false&lt;/clearOutputDirectory&gt;\n            &lt;outputDirectory&gt;${basedir}/src/main/java&lt;/outputDirectory&gt;\n          &lt;/configuration&gt;\n          &lt;executions&gt;\n            &lt;execution&gt;\n              &lt;goals&gt;\n                &lt;goal&gt;compile&lt;/goal&gt;\n                &lt;goal&gt;compile-custom&lt;/goal&gt;\n              &lt;/goals&gt;\n            &lt;/execution&gt;\n          &lt;/executions&gt;\n        &lt;/plugin&gt;\n\n      &lt;/plugins&gt;\n\n  &lt;/build&gt;\n&lt;/project&gt;\n</code></pre>\n<p>So it creates two jars, one being the jar with all dependencies.</p>\n<p>I've been stuck on this issue for a long time now, even tried to use <code>grpc-netty</code> without the <code>shaded</code> but when I decompile the jar it always seem like <code>grpc-netty-shaded</code> is used.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}