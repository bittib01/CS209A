{
  "question": {
    "tags": [
      "java",
      "spring",
      "oracle-database",
      "spring-boot",
      "testcontainers"
    ],
    "owner": {
      "account_id": 18586978,
      "reputation": 3850,
      "user_id": 15000097,
      "user_type": "registered",
      "profile_image": "https://i.sstatic.net/yFl4M.jpg?s=256",
      "display_name": "Georgii Lvov",
      "link": "https://stackoverflow.com/users/15000097/georgii-lvov"
    },
    "is_answered": true,
    "view_count": 380,
    "accepted_answer_id": 79692947,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1752756210,
    "creation_date": 1751470161,
    "last_edit_date": 1752660921,
    "question_id": 79687696,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79687696/oracle-testcontainer-is-not-starting-in-the-pipeline",
    "title": "Oracle testcontainer is not starting in the pipeline",
    "body": "<p>I am using Java 21 and Spring Boot 3.3.3, and starting a test container with Oracle DB in my integration tests like this:</p>\n<p>build.gradle:</p>\n<pre class=\"lang-none prettyprint-override\"><code>testImplementation &quot;org.testcontainers:oracle-free:1.20.1&quot;\n</code></pre>\n<p>Oracle container setup:</p>\n<pre class=\"lang-java prettyprint-override\"><code>import org.junit.jupiter.api.extension.BeforeAllCallback;\nimport org.junit.jupiter.api.extension.ExtensionContext;\nimport org.testcontainers.oracle.OracleContainer;\n\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.Statement;\nimport java.time.Duration;\n\n\npublic class OracleTestContainerExtension implements BeforeAllCallback {\n\n    private static final String ORACLE_IMAGE = &quot;gvenzl/oracle-free:23.5-slim-faststart&quot;;\n    private static final String SYSTEM_USERNAME = &quot;SYSTEM&quot;;\n\n    private static final OracleContainer ORACLE_CONTAINER = new OracleContainer(ORACLE_IMAGE)\n            .withStartupTimeout(Duration.ofMinutes(5))\n            .withPassword(&quot;test_password&quot;)\n            .withDatabaseName(&quot;test_db&quot;)\n            .withReuse(true);\n\n    @Override\n    public void beforeAll(ExtensionContext context) throws Exception {\n        if (!ORACLE_CONTAINER.isRunning()) {\n            ORACLE_CONTAINER.start();\n\n            createTablesAndQueues();\n\n            System.setProperty(&quot;spring.datasource.url&quot;, ORACLE_CONTAINER.getJdbcUrl());\n            System.setProperty(&quot;spring.datasource.username&quot;, SYSTEM_USERNAME);\n            System.setProperty(&quot;spring.datasource.password&quot;, ORACLE_CONTAINER.getPassword());\n        }\n    }\n\n    private void createTablesAndQueues() throws Exception {\n        try (Connection connection = DriverManager.getConnection(\n                ORACLE_CONTAINER.getJdbcUrl(),\n                SYSTEM_USERNAME,\n                ORACLE_CONTAINER.getPassword())) {\n\n            Statement statement = connection.createStatement();\n            statement.executeUpdate(loadFromResources(&quot;/data/sql/init/init_queue_tables_and_queues.sql&quot;));\n\n            statement.close();\n        }\n    }\n}\n</code></pre>\n<p>Then I use this extension in the test:</p>\n<pre class=\"lang-java prettyprint-override\"><code>@SpringBootTest(webEnvironment = RANDOM_PORT)\n@ExtendWith(OracleTestContainerExtension.class)\nclass IntegrationTests {\n  // tests\n}\n</code></pre>\n<p>When I start my tests locally, they work, but if I start tests in the pipeline, I receive an error:</p>\n<pre class=\"lang-none prettyprint-override\"><code>ERROR [Test worker] o.t.c.GenericContainer: Log output from the failed container:\n    CONTAINER: starting up...\n    CONTAINER: first database startup, initializing...\n    CONTAINER: starting up Oracle Database...\n    LSNRCTL for Linux: Version 23.0.0.0.0 - for Oracle Cloud and Engineered Systems on 25-JUN-2025 13:44:16\n    Copyright (c) 1991, 2024, Oracle.  All rights reserved.\n    Starting /opt/oracle/product/23ai/dbhomeFree/bin/tnslsnr: please wait...\n    TNSLSNR for Linux: Version 23.0.0.0.0 - for Oracle Cloud and Engineered Systems\n    System parameter file is /opt/oracle/product/23ai/dbhomeFree/network/admin/listener.ora\n    Log messages written to /opt/oracle/diag/tnslsnr/7974453683d2/listener/alert/log.xml\n    Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC_FOR_FREE)))\n    Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=0.0.0.0)(PORT=1521)))\n    Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC_FOR_FREE)))\n    STATUS of the LISTENER\n    ------------------------\n    Alias                     LISTENER\n    Version                   TNSLSNR for Linux: Version 23.0.0.0.0 - for Oracle Cloud and Engineered Systems\n    Start Date                25-JUN-2025 13:44:17\n    Uptime                    0 days 0 hr. 0 min. 0 sec\n    Trace Level               off\n    Security                  ON: Local OS Authentication\n    SNMP                      OFF\n    Default Service           FREE\n    Listener Parameter File   /opt/oracle/product/23ai/dbhomeFree/network/admin/listener.ora\n    Listener Log File         /opt/oracle/diag/tnslsnr/7974453683d2/listener/alert/log.xml\n    Listening Endpoints Summary...\n      (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC_FOR_FREE)))\n      (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=0.0.0.0)(PORT=1521)))\n    The listener supports no services\n    The command completed successfully\n    ORA-00600: internal error code, arguments: [ksmcsg: failed to get total shm available], [], [], [], [], [], [], [], [], [], [], []\n    ORA-27300: OS system dependent operation:Cannot open /proc/sys/kernel/shm failed with status: 75\n    ORA-27301: OS failure message: Value too large for defined data type\n    ORA-27302: failure occurred at: sskgmgtssa_1\n</code></pre>\n<p>My integration test stage for the GitLab pipeline is:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>integration-tests:\n  stage: test\n  # There is a problem with gradle 8.12\n  # Before changing the version to 8.12 you have to check if a test in the services is still running\n  # Error loading shared library ld-linux-x86-64.so.2: No such file or directory\n  image: dockerhub.devops.mycompany.com/gradle:8.14-jdk21-alpine\n  cache:\n    key: &quot;$CI_COMMIT_REF_SLUG-gradle&quot;\n    paths:\n      - &quot;.gradle&quot;\n  variables:\n    DOCKER_DRIVER: overlay2\n    DOCKER_TLS_CERTDIR: &quot;/certs&quot;\n    DOCKER_HOST: tcp://docker:2376\n    DOCKER_TLS_VERIFY: 1\n    DOCKER_CERT_PATH: &quot;$DOCKER_TLS_CERTDIR/client&quot;\n  services:\n    - name: 'dockerhub.devops.mycompany.com/docker:28.3.0-dind' # DOCKER_DIND_IMAGE\n      command: [ '--registry-mirror=https://dockerhub.devops.mycompany.com' ]\n      alias: docker\n  tags:\n    - otc_run_sysbox_xl\n  script:\n    - $GRADLE_CLI_BIN ${TRACE+--debug} --build-cache --gradle-user-home $GRADLE_USER_HOME/ -x build integrationTest\n  rules:\n    - if: $GRADLE_INTEGRATION_TESTS_ENABLED == &quot;true&quot;\n  needs:\n    - gradle-build\n  artifacts:\n    when: on_success\n    expire_in: 1 day\n    paths:\n      - ./**/build/reports/tests/integrationTest/*\n</code></pre>\n<p>I see that this happened after switching the GitLab runner in our infrastructure, and I can't use the old runner.</p>\n<p>I also think the problem might be that <a href=\"https://docs.docker.com/security/for-admins/hardened-desktop/enhanced-container-isolation/#what-happens-when-enhanced-container-isolation-is-turned-on\" rel=\"nofollow noreferrer\">Enhanced Container Isolation</a> is enabled, but I haven't been able to figure out how to bypass it to solve my problem.</p>\n<p>Any ideas?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}