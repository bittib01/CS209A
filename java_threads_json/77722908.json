{
  "question": {
    "tags": [
      "java",
      "amazon-web-services",
      "amazon-sqs"
    ],
    "owner": {
      "account_id": 5776494,
      "reputation": 161,
      "user_id": 4558427,
      "user_type": "registered",
      "accept_rate": 40,
      "profile_image": "https://lh6.googleusercontent.com/-bEiC0bkEMNs/AAAAAAAAAAI/AAAAAAAAABM/7ALgq7emFp8/s256-rj/photo.jpg",
      "display_name": "Raphallal",
      "link": "https://stackoverflow.com/users/4558427/raphallal"
    },
    "is_answered": true,
    "view_count": 961,
    "accepted_answer_id": 79185756,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1731514055,
    "creation_date": 1703693481,
    "question_id": 77722908,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/77722908/connection-to-sqs-from-ec2-is-lost-from-time-to-time",
    "title": "Connection to SQS from EC2 is lost from time to time",
    "body": "<p>Once a month on average, I lose the connection to AWS SQS from my java applications running on AWS EC2 machines:</p>\n<blockquote>\n<p>Received an UnknownHostException when attempting to interact with a service. See cause for the exact endpoint that is failing to resolve. If this is happening on an endpoint that previously worked, there may be a network connectivity issue or your DNS cache could be storing endpoints for too long.</p>\n</blockquote>\n<p>With a root cause :\n<code>java.net.UnknownHostException: sqs.eu-west-3.amazonaws.com</code></p>\n<p>I've checked my java cache DNS configurations, that are the default ones of the docker image <code>amazoncorretto:17-alpine</code>:</p>\n<ul>\n<li><code>networkaddress.cache.ttl=30</code></li>\n<li><code>networkaddress.cache.negative.ttl=10</code></li>\n</ul>\n<p>Here is how I configure my SqsClient, using the AWS SDKv2:</p>\n<pre class=\"lang-java prettyprint-override\"><code>SqsClient sqsClient = SqsClient.builder()\n                    .region(Region.EU_WEST_3)\n                    .credentialsProvider(InstanceProfileCredentialsProvider.create())\n                    .build();\n</code></pre>\n<p>And how I consume message:</p>\n<pre class=\"lang-java prettyprint-override\"><code>ReceiveMessageRequest receiveMessageRequest = ReceiveMessageRequest.builder()\n                    .queueUrl(queueUrl)\n                    .maxNumberOfMessages(1)\n                    .visibilityTimeout(30)\n                    .build();\n\nsqsClient.receiveMessage(sqsRequest)\n                .messages()\n                .forEach(message -&gt; /*some processing*/);\n</code></pre>\n<p>As I use the default configuration of the <code>SqsClient</code>, I am using <code>software.amazon.awssdk.core.retry.RetryMode.STANDARD</code> that retries twice, with an exponential back-off starting at 100ms, meaning that I will retry for less than a second, so below my <code>networkaddress.cache.negative.ttl</code> configuration.</p>\n<ol>\n<li>Should I only increase the number of retries ?</li>\n<li>I have multiple applications connecting to a <code>eu-west-3</code> SQS queue, that are configured more or less in the same way. Shouldn't they all throw the <code>UnknownHostException</code> at the same moment ?</li>\n</ol>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}