{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "dockerfile",
      "gdal"
    ],
    "owner": {
      "account_id": 943688,
      "reputation": 3411,
      "user_id": 971355,
      "user_type": "registered",
      "accept_rate": 79,
      "profile_image": "https://i.sstatic.net/824X5yBT.jpg?s=256",
      "display_name": "ka3ak",
      "link": "https://stackoverflow.com/users/971355/ka3ak"
    },
    "is_answered": false,
    "view_count": 125,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1729751933,
    "creation_date": 1729690904,
    "last_edit_date": 1729691411,
    "question_id": 79118193,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79118193/java-lang-unsatisfiedlinkerror-int-org-gdal-gdalconst-gdalconstjni-gdt-int8-ge",
    "title": "java.lang.UnsatisfiedLinkError: &#39;int org.gdal.gdalconst.gdalconstJNI.GDT_Int8_get()&#39; when using org.gdal and osgeo/gdal in docker",
    "body": "<p>I want to containerize a SpringBoot app and make use of <strong>gdal</strong>.\nFor this I use in my <strong>pom.xml</strong></p>\n<pre><code>&lt;dependency&gt;\n        &lt;groupId&gt;org.gdal&lt;/groupId&gt;\n        &lt;artifactId&gt;gdal&lt;/artifactId&gt;\n        &lt;version&gt;3.8.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>and</p>\n<pre><code>FROM osgeo/gdal:ubuntu-full-3.6.3\n</code></pre>\n<p>in the <strong>Dockerfile</strong>.</p>\n<p>However it looks like org.gdal refers to a constant which doesn't exist. I'll describe it later. But first are the crucial parts of the source code:</p>\n<p><strong>Dockerfile</strong>:</p>\n<pre><code>FROM maven:3.9.5-amazoncorretto-21 as build\n\nWORKDIR /app\nCOPY target/converter-service-1.0.0-SNAPSHOT.jar app.jar\n\nRUN mkdir -p target/extracted\nRUN java -Djarmode=layertools -jar app.jar extract --destination target/extracted\n\nFROM osgeo/gdal:ubuntu-full-3.6.3\n\nENV GDAL_DATA=&quot;/usr/share/gdal&quot;\nENV GDAL_DRIVER_PATH=&quot;/usr/lib/x86_64-linux-gnu/gdalplugins&quot;\nENV PROJ_LIB=&quot;/usr/share/proj&quot;\nENV PATH=&quot;/usr/share/gdal:${PATH}&quot;\n\nWORKDIR app\nRUN apt update &amp;&amp; apt install -y openjdk-21-jre-headless\nARG EXTRACTED=/app/target/extracted\nCOPY --from=build ${EXTRACTED}/dependencies/ ./\nCOPY --from=build ${EXTRACTED}/spring-boot-loader/ ./\nCOPY --from=build ${EXTRACTED}/snapshot-dependencies/ ./\nCOPY --from=build ${EXTRACTED}/application/ ./\nENTRYPOINT [&quot;java&quot;, &quot;-Djava.library.path=/usr/share/java/&quot;, &quot;org.springframework.boot.loader.launch.JarLauncher&quot; ]\n</code></pre>\n<p><strong>Java code</strong></p>\n<pre><code>package my;\nimport org.springframework.stereotype.Service;\nimport org.gdal.gdal.gdal;\nimport org.gdal.gdalconst.gdalconstConstants;\n...\n\n@Service\npublic class Grib2ToGeoTiffService {\n\n    static {\n        gdal.AllRegister();\n    }\n\n    @PostConstruct\n    private void postConstruct() {\n            convert(\n                    ResourceUtils.getFile(&quot;classpath:file.grib2&quot;),\n                    new File(&quot;/tmp/output&quot;)\n            );\n\n        }\n\n    public boolean convert(File gribFile, File geotiffOutputDir) throws Exception {\n        if (!gribFile.exists()) {\n            log.error(&quot;File does not exist: '{}'&quot;, gribFile.getAbsolutePath());\n            return false;\n        }\n\n        var gribType = getGribType(gribFile.getName());\n        log.info(&quot;Grib type '{}' for '{}'&quot;, gribType, gribFile.getName());\n\n        Dataset dataset = gdal.Open(gribFile.getAbsolutePath(), gdalconstConstants.GA_ReadOnly);\n        if (dataset == null) {\n            log.warn(&quot;Unable to open file: &quot; + gribFile.getAbsolutePath());\n            return false;\n        }\n\n        int bandCount = dataset.getRasterCount();\n        Map&lt;String, Settings&gt; settingsMap = getSettingsMap(gribType);\n\n        for (int bandId = 1; bandId &lt;= bandCount; bandId++) {\n            if (settingsMap.containsKey(Integer.toString(bandId))) {\n                processBand(dataset, bandId, geotiffOutputDir, gribType, settingsMap);\n            }\n        }\n\n        dataset.delete();\n\n        return true;\n    }\n\n}\n</code></pre>\n<p>After the app is run in the container the following error occurs:</p>\n<pre><code>Caused by: java.lang.UnsatisfiedLinkError: 'int org.gdal.gdalconst.gdalconstJNI.GDT_Int8_get()'\n        at org.gdal.gdalconst.gdalconstJNI.GDT_Int8_get(Native Method) ~[gdal-3.8.0.jar:na]\n        at org.gdal.gdalconst.gdalconstConstants.&lt;clinit&gt;(gdalconstConstants.java:14) ~[gdal-3.8.0.jar:na]\n        at my.service.Grib2ToGeoTiffService.convert(Grib2ToGeoTiffService.java:121) ~[classes/:1.0.0-SNAPSHOT]\n...\n</code></pre>\n<p>The corresponding line in the code is:</p>\n<pre><code>Dataset dataset = gdal.Open(gribFile.getAbsolutePath(), gdalconstConstants.GA_ReadOnly);\n</code></pre>\n<p>I exported <strong>gdal.h</strong> from the running container and couldn't find the constant.\nHere is an excerpt from this file where the constants are defined:</p>\n<pre><code>...\n/*! Pixel data types */\ntypedef enum\n{\n    /*! Unknown or unspecified type */ GDT_Unknown = 0,\n    /*! Eight bit unsigned integer */ GDT_Byte = 1,\n    /*! Sixteen bit unsigned integer */ GDT_UInt16 = 2,\n    /*! Sixteen bit signed integer */ GDT_Int16 = 3,\n    /*! Thirty two bit unsigned integer */ GDT_UInt32 = 4,\n    /*! Thirty two bit signed integer */ GDT_Int32 = 5,\n    /*! 64 bit unsigned integer (GDAL &gt;= 3.5)*/ GDT_UInt64 = 12,\n    /*! 64 bit signed integer  (GDAL &gt;= 3.5)*/ GDT_Int64 = 13,\n    /*! Thirty two bit floating point */ GDT_Float32 = 6,\n    /*! Sixty four bit floating point */ GDT_Float64 = 7,\n    /*! Complex Int16 */ GDT_CInt16 = 8,\n    /*! Complex Int32 */ GDT_CInt32 = 9,\n    /* TODO?(#6879): GDT_CInt64 */\n    /*! Complex Float32 */ GDT_CFloat32 = 10,\n    /*! Complex Float64 */ GDT_CFloat64 = 11,\n    GDT_TypeCount = 14 /* maximum type # + 1 */\n} GDALDataType;\n...\n</code></pre>\n<p>What causes the error? Maybe</p>\n<pre><code>&lt;dependency&gt;\n        &lt;groupId&gt;org.gdal&lt;/groupId&gt;\n        &lt;artifactId&gt;gdal&lt;/artifactId&gt;\n        &lt;version&gt;3.8.0&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<p>and</p>\n<pre><code>FROM osgeo/gdal:ubuntu-full-3.6.3\n</code></pre>\n<p>are incompatible or do I do something else wrong?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}