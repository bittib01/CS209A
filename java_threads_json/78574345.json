{
  "question": {
    "tags": [
      "java",
      "google-cloud-vertex-ai",
      "grpc-java",
      "google-gemini",
      "langchain4j"
    ],
    "owner": {
      "account_id": 5533732,
      "reputation": 237,
      "user_id": 4392827,
      "user_type": "registered",
      "accept_rate": 67,
      "profile_image": "https://www.gravatar.com/avatar/c0d9ae13b78d42ca98e6cade090f8fe9?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "kstanisz",
      "link": "https://stackoverflow.com/users/4392827/kstanisz"
    },
    "is_answered": false,
    "view_count": 569,
    "answer_count": 3,
    "score": 1,
    "last_activity_date": 1734724402,
    "creation_date": 1717491450,
    "last_edit_date": 1734724402,
    "question_id": 78574345,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78574345/invalid-argument-using-langchain4j-tools-with-gemini-model",
    "title": "INVALID ARGUMENT using Langchain4j tools with Gemini model",
    "body": "<p>I'm using Langchain4j with gemini-1.5-pro model. I have defined some tools (function calling) and always after third call there is an exception:</p>\n<pre class=\"lang-none prettyprint-override\"><code>io.grpc.StatusRuntimeException: INVALID_ARGUMENT: Please ensure that function call turn comes immediately after a user turn or after a function response turn.\nat io.grpc.Status.asRuntimeException(Status.java:533) ~[grpc-api-1.62.2.jar:1.62.2]\nat io.grpc.stub.ClientCalls$UnaryStreamToFuture.onClose(ClientCalls.java:538) ~[grpc-stub-1.62.2.jar:1.62.2]\nat io.grpc.PartialForwardingClientCallListener.onClose(PartialForwardingClientCallListener.java:39) ~[grpc-api-1.62.2.jar:1.62.2]\nat io.grpc.ForwardingClientCallListener.onClose(ForwardingClientCallListener.java:23) ~[grpc-api-1.62.2.jar:1.62.2]\nat io.grpc.ForwardingClientCallListener$SimpleForwardingClientCallListener.onClose(ForwardingClientCallListener.java:40) ~[grpc-api-1.62.2.jar:1.62.2]\nat com.google.api.gax.grpc.ChannelPool$ReleasingClientCall$1.onClose(ChannelPool.java:570) ~[gax-grpc-2.48.0.jar:2.48.0]\nat io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:574) ~[grpc-core-1.62.2.jar:1.62.2]\nat io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:72) ~[grpc-core-1.62.2.jar:1.62.2]\nat io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInternal(ClientCallImpl.java:742) ~[grpc-core-1.62.2.jar:1.62.2]\nat io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:723) ~[grpc-core-1.62.2.jar:1.62.2]\nat io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37) ~[grpc-core-1.62.2.jar:1.62.2]\nat io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133) ~[grpc-core-1.62.2.jar:1.62.2]\nat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]\nat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]\nat java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]\n</code></pre>\n<p>What does it mean and how can I avoid that?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}