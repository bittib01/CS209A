{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "spring-security"
    ],
    "owner": {
      "account_id": 23666882,
      "reputation": 35,
      "user_id": 17694238,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/e159eab35c444b660b53e15a60a8a0dd?s=256&d=identicon&r=PG",
      "display_name": "Didimaox",
      "link": "https://stackoverflow.com/users/17694238/didimaox"
    },
    "is_answered": true,
    "view_count": 100,
    "answer_count": 1,
    "score": -3,
    "last_activity_date": 1717022987,
    "creation_date": 1716329077,
    "last_edit_date": 1717022987,
    "question_id": 78514539,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78514539/spring-security-always-being-redirected-to-login-page-no-matter-what",
    "title": "Spring security, always being redirected to login page no matter what",
    "body": "<p>30/05 Edit: Currently experiencing the following issue: Always redirected to the login page despite seemingly allowing the access to all pages without the requirement of being logged in.</p>\n<p>MyUserDetails:</p>\n<pre><code>    package com.example.DevNote.security;\n\nimport com.example.DevNote.model.Users;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\n\nimport java.util.Arrays;\nimport java.util.Collection;\n\npublic class MyUserDetails implements UserDetails {\n\n    private Users user;\n\n    public MyUserDetails(Users user) {\n        this.user = user;\n    }\n\n    @Override\n    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {\n        SimpleGrantedAuthority authority = new SimpleGrantedAuthority(user.getRole().name()); \n\n        return Arrays.asList(authority);\n    }\n\n    @Override\n    public String getPassword() {\n        return user.getPassword();\n    }\n\n    @Override\n    public String getUsername() {\n        return user.getUsername();\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return true;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return true;\n    }\n\n}\n</code></pre>\n<p>UsersDetailsServiceImpl:</p>\n<pre><code>    package com.example.DevNote.security;\n\nimport com.example.DevNote.model.Users;\nimport com.example.DevNote.repository.UsersRepository;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\n\npublic class UserDetailsServiceImpl implements UserDetailsService\n{\n    @Autowired\n    private UsersRepository userRepository;\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        Users user = userRepository.getUserByUsername(username);\n\n        if (user == null) {\n            throw new UsernameNotFoundException(&quot;Utilisateur introuvable&quot;);\n        }\n\n        return new MyUserDetails(user);\n    }\n\n}\n</code></pre>\n<p>SecurityConfig:</p>\n<pre><code>package com.example.DevNote.security;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.authentication.dao.DaoAuthenticationProvider;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@Configuration\npublic class SecurityConfig  {\n\n    @Bean\n    public UserDetailsService userDetailsService() {\n        return new UserDetailsServiceImpl();\n    }\n\n    @Bean\n    public BCryptPasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n\n    @Bean\n    public DaoAuthenticationProvider authenticationProvider() {\n        DaoAuthenticationProvider authProvider = new DaoAuthenticationProvider();\n        authProvider.setUserDetailsService(userDetailsService());\n        authProvider.setPasswordEncoder(passwordEncoder());\n\n        return authProvider;\n    }\n\n    @Bean\n    SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {\n        http.authorizeHttpRequests(\n                        auth -&gt; auth.anyRequest().authenticated())\n                .formLogin(login -&gt; login.permitAll())\n                .logout(logout -&gt; logout.permitAll())\n        ;\n\n        return http.build();\n    }\n\n}\n</code></pre>\n<p>UsersController:</p>\n<pre><code>package com.example.DevNote.controller;\n\nimport com.example.DevNote.DTO.UsersRegistrationDTO;\nimport com.example.DevNote.service.UserService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.validation.BindingResult;\nimport org.springframework.validation.annotation.Validated;\nimport org.springframework.web.bind.annotation.*;\n\n@RestController \n\n@RequestMapping(&quot;/api/users&quot;) \npublic class UsersController {\n\n    @Autowired\n    private UserService userService;\n\n    @PostMapping(&quot;/register&quot;)  \n\n    public ResponseEntity&lt;?&gt; registerUser(@RequestBody @Validated UsersRegistrationDTO userdto, BindingResult bindingResult) \n\n    {\n        if (bindingResult.hasErrors()) \n        {\n\n            return ResponseEntity.badRequest().body(bindingResult.getAllErrors());\n        }\n\n        try  \n        {\n            userService.createUser(userdto);\n            return ResponseEntity.ok(&quot;Création du compte utilisateur réussie&quot;); \n        }\n        catch (Exception e) \n\n        {\n            return ResponseEntity.badRequest().body(e.getMessage()); \n\n        }\n    }\n\n}\n</code></pre>\n<p>UsersVueController:</p>\n<pre><code>package com.example.DevNote.controller;\n\nimport com.example.DevNote.service.UserService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\n\n\n@RequestMapping(&quot;/vue/users&quot;)\n@Controller\npublic class UsersVueController\n{\n    @Autowired\n    private UserService userService;\n\n    @GetMapping(&quot;/register&quot;)\n    public String register() {\n        return &quot;register&quot;;\n    }\n\n    @GetMapping(&quot;/login&quot;)\n    public String login() {\n        return &quot;login&quot;;\n    }\n\n}\n</code></pre>\n<p>UserService:</p>\n<pre><code>package com.example.DevNote.service;\nimport com.example.DevNote.DTO.UsersRegistrationDTO;\nimport com.example.DevNote.model.Role;\nimport com.example.DevNote.model.Users;\nimport com.example.DevNote.repository.UsersRepository;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\n@Service\npublic class UserService  {\n\n    @Autowired\n    private UsersRepository usersRepository;\n\n    @Autowired\n    private BCryptPasswordEncoder passwordEncoder;\n\n    public Users createUserTestMapping(String username, String email, String password, Role role) {\n        Users user = new Users(username, email, password, role);\n        usersRepository.save(user);\n        return user;\n    }\n\n    @Transactional\n    public Users createUser(UsersRegistrationDTO dto) throws Exception  \n\n    {\n        if (usersRepository.existsByUsername(dto.getUsername()))\n        {\n            throw new Exception(&quot;Le nom d'utilisateur est déjà pris.&quot;);\n        }\n        if (usersRepository.existsByEmail(dto.getEmail()))\n        {\n            throw new Exception(&quot;L'adresse e-mail est déjà utilisée.&quot;);\n        }\n\n        Role defaultrole = Role.Apprenant;\n        String hashedPassword = passwordEncoder.encode(dto.getPassword());\n        Users user = new Users(dto.getUsername(), dto.getEmail(), hashedPassword, defaultrole);\n        usersRepository.save(user);\n        return user;\n    }\n\n}\n</code></pre>\n<p>Thank you very much in advance</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}