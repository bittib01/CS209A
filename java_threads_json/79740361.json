{
  "question": {
    "tags": [
      "java",
      "jax-rs",
      "docx"
    ],
    "owner": {
      "account_id": 39241929,
      "reputation": 21,
      "user_id": 29177314,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/1d09c5596d3d7891019fa8453a744b8d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Gopika Ravikumar",
      "link": "https://stackoverflow.com/users/29177314/gopika-ravikumar"
    },
    "is_answered": false,
    "view_count": 79,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1755735935,
    "creation_date": 1755633972,
    "question_id": 79740361,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79740361/docx-file-generated-by-jax-rs-api-shows-compatibility-error-in-word",
    "title": "DOCX file generated by JAX-RS API shows compatibility error in Word",
    "body": "<p>I am generating a .docx file in a JAX-RS API.\nWhen I save it directly to disk like this:</p>\n<pre><code>try (FileOutputStream fos = new FileOutputStream(&quot;localSavedFile.docx&quot;)) {\noutputDocument(fos);\n</code></pre>\n<p>}</p>\n<p>the file opens fine in MS Word.</p>\n<p>But when I try to return it from the API using StreamingOutput:</p>\n<pre><code>StreamingOutput stream = output -&gt; {\ntry {\n    outputDocument(output);\n} catch (Exception e) {\n    throw new RuntimeException(e);\n}\n};\n\nreturn Response.ok(stream)\n        .header(&quot;Content-Disposition&quot;, &quot;attachment; filename=\\&quot;file.docx\\&quot;&quot;)\n        .type(&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;)\n        .build();\n</code></pre>\n<p>Word shows a compatibility error (something like “The file is corrupt or cannot be opened properly”) when opening the downloaded file.</p>\n<p>How I generate the DOCX</p>\n<pre><code>public void outputDocument(final OutputStream outputStream) throws Exception {             \nWordprocessingMLPackage wordPackage = WordprocessingMLPackage.createPackage();\nMainDocumentPart mainDocumentPart = wordPackage.getMainDocumentPart();\n\n\n//other code where docx is generated\n\n// finally write the package to the provided stream\nwordPackage.save(outputStream);\n</code></pre>\n<p>}</p>\n<p>What I’ve tried:</p>\n<p>Saving with FileOutputStream works fine (so the document itself is valid).</p>\n<p>Setting explicit Content-Type and Content-Disposition.</p>\n<p>Adding Content-Length.</p>\n<p>Why does the same document open fine when written to a local file, but shows a compatibility error when streamed in a JAX-RS response?\nDo I need to flush/close the stream differently, or are there extra headers required for Office files?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}