{
  "question": {
    "tags": [
      "java",
      "java-2d"
    ],
    "owner": {
      "account_id": 2459590,
      "reputation": 487,
      "user_id": 2144031,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/bce0dabdb468b315e4eea57adb422f57?s=256&d=identicon&r=PG",
      "display_name": "spring_dev101",
      "link": "https://stackoverflow.com/users/2144031/spring-dev101"
    },
    "is_answered": false,
    "view_count": 155,
    "answer_count": 0,
    "score": 3,
    "last_activity_date": 1763149301,
    "creation_date": 1761472133,
    "question_id": 79799961,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79799961/why-does-java-fontmetrics-return-wrong-string-bounds-specially-height-for-some",
    "title": "Why does Java FontMetrics return wrong string bounds (specially height) for some .ttf?",
    "body": "<p>Iâ€™m generating text images for different .ttf fonts in a method using Java2D, most of the fonts it works fine. The issue is with some fonts it return wrong &quot;Y&quot; value.</p>\n<pre><code>// params\nFile workingDir = new File(&quot;/Users/vigo/test-dir/&quot;);\nint verticalPadding = 2;\nint horizontalPadding = 2;\nFile fontFile = new File(workingDir, &quot;Arabella.ttf&quot;);\nString text = &quot;Hello World&quot;;\nFont font = Font.createFont(Font.TRUETYPE_FONT, fontFile).deriveFont(40f);\n\n// calculate bounds\nBufferedImage temp = new BufferedImage(1, 1, BufferedImage.TYPE_INT_ARGB);\nGraphics2D g2d = temp.createGraphics();\nFontMetrics fm = g2d.getFontMetrics(font);\n\n// get image width and height\nint width = fm.stringWidth(text) + (horizontalPadding * 2);\nint height = (int) Math.ceil(fm.getAscent() + fm.getDescent() + fm.getLeading()) + (verticalPadding * 2);\n\n// get x and y draw points\nint x = horizontalPadding;\nint y = verticalPadding + fm.getAscent();\ng2d.dispose();\n\n// create the actual image and draw text\nBufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);\ng2d = image.createGraphics();\ng2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);\ng2d.setBackground(Color.WHITE);\ng2d.fillRect(0, 0, width, height);\ng2d.setColor(Color.BLACK);\ng2d.setFont(font);\ng2d.drawString(text, x, y);\ng2d.dispose();\n\nImageIO.write(image, &quot;png&quot;, new File(workingDir, &quot;text-img.png&quot;));\n</code></pre>\n<p>Code working perfectly with most of the fonts (example image with open sans font):</p>\n<p><a href=\"https://i.sstatic.net/CbaNE3sr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/CbaNE3sr.png\" alt=\"enter image description here\" /></a></p>\n<p>But with few fonts, example <a href=\"https://www.fontsum.com/arabella-ds-font\" rel=\"nofollow noreferrer\">arabella</a> returns wrong &quot;Y&quot; value:</p>\n<p><a href=\"https://i.sstatic.net/HltJ6s1O.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/HltJ6s1O.png\" alt=\"enter image description here\" /></a></p>\n<p>Is there a better way to get consistent visual height across fonts when rendering text images?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}