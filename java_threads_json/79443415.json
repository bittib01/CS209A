{
  "question": {
    "tags": [
      "java",
      "gradle",
      "quarkus",
      "shadowjar"
    ],
    "owner": {
      "account_id": 9839308,
      "reputation": 13,
      "user_id": 7288714,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/47e21135bc1aca1b218c659b88616f9d?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Leo.Kim",
      "link": "https://stackoverflow.com/users/7288714/leo-kim"
    },
    "is_answered": false,
    "view_count": 147,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1744781672,
    "creation_date": 1739719295,
    "question_id": 79443415,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79443415/quarkus-quarkusgeneratecode-fails-when-shadow-plugin-is-applied-in-root-gradle-p",
    "title": "Quarkus quarkusGenerateCode Fails When shadow Plugin is Applied in Root Gradle Project",
    "body": "<h1>Description:</h1>\n<p>I'm building a Quarkus project using Gradle, and during the quarkusGenerateCode task, I encounter the following error:</p>\n<pre class=\"lang-bash prettyprint-override\"><code> ./gradlew clean build                                                                                                                                  âœ” \n\n&gt; Task :quarkusGenerateCode\n2025-02-16T15:12:40.186701Z /127.0.0.1:60733 to /127.0.0.1:60732 workers ERROR Unable to create Lookup for ctx java.lang.NoSuchMethodError: 'java.util.stream.Stream org.apache.logging.log4j.util.ServiceLoaderUtil.loadServices(java.lang.Class, java.lang.invoke.MethodHandles$Lookup, boolean)'\n        at org.apache.logging.log4j.core.impl.ThreadContextDataInjector.getServiceProviders(ThreadContextDataInjector.java:77)\n        at org.apache.logging.log4j.core.impl.ThreadContextDataInjector.&lt;clinit&gt;(ThreadContextDataInjector.java:64)\n        at org.apache.logging.log4j.core.impl.ThreadContextDataInjector$ForDefaultThreadContextMap.&lt;init&gt;(ThreadContextDataInjector.java:93)\n        at org.apache.logging.log4j.core.impl.ContextDataInjectorFactory.createDefaultInjector(ContextDataInjectorFactory.java:91)\n        at org.apache.logging.log4j.core.impl.ContextDataInjectorFactory.createInjector(ContextDataInjectorFactory.java:71)\n        at org.apache.logging.log4j.core.lookup.ContextMapLookup.&lt;init&gt;(ContextMapLookup.java:34)\n        at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n        at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)\n        at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)\n        at org.apache.logging.log4j.core.util.ReflectionUtil.instantiate(ReflectionUtil.java:189)\n        at org.apache.logging.log4j.core.lookup.Interpolator.&lt;init&gt;(Interpolator.java:86)\n        at org.apache.logging.log4j.core.lookup.Interpolator.&lt;init&gt;(Interpolator.java:105)\n        at org.apache.logging.log4j.core.config.AbstractConfiguration.&lt;init&gt;(AbstractConfiguration.java:135)\n        at org.apache.logging.log4j.core.config.NullConfiguration.&lt;init&gt;(NullConfiguration.java:32)\n        at org.apache.logging.log4j.core.LoggerContext.&lt;clinit&gt;(LoggerContext.java:74)\n        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.createContext(ClassLoaderContextSelector.java:254)\n        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.locateContext(ClassLoaderContextSelector.java:218)\n        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.getContext(ClassLoaderContextSelector.java:140)\n        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.getContext(ClassLoaderContextSelector.java:123)\n        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:230)\n        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:47)\n        at org.apache.logging.log4j.LogManager.getContext(LogManager.java:118)\n        at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:622)\n        at org.jboss.logging.Log4j2Logger.&lt;init&gt;(Log4j2Logger.java:36)\n        at org.jboss.logging.Log4j2LoggerProvider.getLogger(Log4j2LoggerProvider.java:36)\n        at org.jboss.logging.Log4j2LoggerProvider.getLogger(Log4j2LoggerProvider.java:32)\n        at org.jboss.logging.LoggerProviders.logProvider(LoggerProviders.java:160)\n        at org.jboss.logging.LoggerProviders.tryLog4j2(LoggerProviders.java:124)\n        at org.jboss.logging.LoggerProviders.findProvider(LoggerProviders.java:85)\n        at org.jboss.logging.LoggerProviders.find(LoggerProviders.java:32)\n        at org.jboss.logging.LoggerProviders.&lt;clinit&gt;(LoggerProviders.java:29)\n        at org.jboss.logging.Logger.getLogger(Logger.java:2467)\n        at org.jboss.logging.Logger.getLogger(Logger.java:2493)\n        at io.quarkus.bootstrap.classloading.QuarkusClassLoader.&lt;clinit&gt;(QuarkusClassLoader.java:38)\n        at io.quarkus.bootstrap.app.CuratedApplication.getOrCreateAugmentClassLoader(CuratedApplication.java:197)\n        at io.quarkus.bootstrap.app.CuratedApplication.createDeploymentClassLoader(CuratedApplication.java:338)\n        at io.quarkus.gradle.tasks.worker.CodeGenWorker.execute(CodeGenWorker.java:48)\n        at org.gradle.workers.internal.DefaultWorkerServer.execute(DefaultWorkerServer.java:63)\n        at org.gradle.workers.internal.AbstractClassLoaderWorker$1.create(AbstractClassLoaderWorker.java:54)\n        at org.gradle.workers.internal.AbstractClassLoaderWorker$1.create(AbstractClassLoaderWorker.java:48)\n        at org.gradle.internal.classloader.ClassLoaderUtils.executeInClassloader(ClassLoaderUtils.java:100)\n        at org.gradle.workers.internal.AbstractClassLoaderWorker.executeInClassLoader(AbstractClassLoaderWorker.java:48)\n        at org.gradle.workers.internal.IsolatedClassloaderWorker.run(IsolatedClassloaderWorker.java:49)\n        at org.gradle.workers.internal.IsolatedClassloaderWorker.run(IsolatedClassloaderWorker.java:30)\n        at org.gradle.workers.internal.WorkerDaemonServer.run(WorkerDaemonServer.java:109)\n        at org.gradle.workers.internal.WorkerDaemonServer.run(WorkerDaemonServer.java:78)\n        at org.gradle.process.internal.worker.request.WorkerAction$1.call(WorkerAction.java:159)\n        at org.gradle.process.internal.worker.child.WorkerLogEventListener.withWorkerLoggingProtocol(WorkerLogEventListener.java:41)\n        at org.gradle.process.internal.worker.request.WorkerAction.lambda$run$1(WorkerAction.java:156)\n        at org.gradle.internal.operations.CurrentBuildOperationRef.with(CurrentBuildOperationRef.java:85)\n        at org.gradle.process.internal.worker.request.WorkerAction.run(WorkerAction.java:148)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:568)\n        at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)\n        at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)\n        at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:182)\n        at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:164)\n        at org.gradle.internal.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:414)\n        at org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:64)\n        at org.gradle.internal.concurrent.AbstractManagedExecutor$1.run(AbstractManagedExecutor.java:48)\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n        at java.base/java.lang.Thread.run(Thread.java:842)\n\n\n</code></pre>\n<h1>Project Structure</h1>\n<p>My root project contains both Spring Boot and Quarkus subprojects. The Spring Boot subproject requires the shadow plugin to generate a fat JAR for AWS Lambda deployment. However, when I declare the shadow plugin in the root build.gradle.kts, Quarkus fails to generate code locally.</p>\n<h1>Reproduction Steps</h1>\n<p>This issue occurs when I add shadow in the root build.gradle.kts:</p>\n<p>Root build.gradle.kts</p>\n<pre class=\"lang-kotlin prettyprint-override\"><code>plugins {\n    kotlin(&quot;jvm&quot;) version &quot;2.0.21&quot;\n    id(&quot;com.github.johnrengelman.shadow&quot;) version &quot;8.1.1&quot; apply false\n    id(&quot;io.quarkus&quot;) version &quot;3.18.2&quot;\n}\n\nrepositories {\n    mavenCentral()\n    gradlePluginPortal()\n}\n\ndependencies {\n}\n\ngroup = &quot;com.example&quot;\nversion = &quot;1.0.0-SNAPSHOT&quot;\n\njava {\n    sourceCompatibility = JavaVersion.VERSION_17\n    targetCompatibility = JavaVersion.VERSION_17\n}\n</code></pre>\n<p>When apply false is added to the shadow plugin, the quarkusGenerateCode task fails. Removing this fixes the issue, but then my Spring Boot project cannot use the shadowJar build.</p>\n<h1>Question</h1>\n<p>How can I configure Gradle so that:</p>\n<p>Spring Boot projects can still use the shadow plugin.\nQuarkus projects do not fail on quarkusGenerateCode.\nRoot project remains the common configuration without causing conflicts between Quarkus and Spring Boot.\nIs there a way to apply shadow only in Spring Boot subprojects while keeping the root project clean and avoiding the quarkusGenerateCode issue? Any workaround to prevent Quarkus from breaking due to shadow in the root project?</p>\n<p>Thanks.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}