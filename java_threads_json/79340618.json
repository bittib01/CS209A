{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "maven",
      "spring-data",
      "lombok"
    ],
    "owner": {
      "account_id": 34123156,
      "reputation": 41,
      "user_id": 26398025,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/e51c53ca37cd541a1d2fa0e6dabafcfc?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Vlad",
      "link": "https://stackoverflow.com/users/26398025/vlad"
    },
    "is_answered": true,
    "view_count": 1544,
    "answer_count": 2,
    "score": 3,
    "last_activity_date": 1738176121,
    "creation_date": 1736366527,
    "question_id": 79340618,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79340618/row-was-updated-or-deleted-by-another-transaction-or-unsaved-value-mapping-was",
    "title": "Row was updated or deleted by another transaction (or unsaved-value mapping was incorrect): [com.example.mysqlplanefinder.models.Aircraft#34]",
    "body": "<p>I'm reading a book &quot;spring-boot up and running&quot;. And I have the following problem, I don't understand how to solve it.</p>\n<p><em>org.springframework.orm.ObjectOptimisticLockingFailureException: Row was updated or deleted by another transaction (or unsaved-value mapping was incorrect): [com.example.mysqlplanefinder.models.Aircraft#34]</em></p>\n<p>Aircraft.java</p>\n<pre><code>package com.example.mysqlplanefinder.models;\n\nimport com.fasterxml.jackson.annotation.JsonProperty;\nimport jakarta.persistence.Entity;\nimport jakarta.persistence.GeneratedValue;\nimport jakarta.persistence.Id;\nimport java.time.Instant;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\n\n@Entity\n@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class Aircraft {\n    @Id\n    @GeneratedValue\n    private Long id;\n\n    private String callsign, squawk, reg, flightno, route, type, category;\n\n    private int altitude, heading, speed;\n    @JsonProperty(&quot;vert_rate&quot;)\n    private int vertRate;\n    @JsonProperty(&quot;selected_altitude&quot;)\n    private int selectedAltitude;\n\n    private double lat, lon, barometer;\n    @JsonProperty(&quot;polar_distance&quot;)\n    private double polarDistance;\n    @JsonProperty(&quot;polar_bearing&quot;)\n    private double polarBearing;\n\n    @JsonProperty(&quot;is_adsb&quot;)\n    private boolean isADSB;\n    @JsonProperty(&quot;is_on_ground&quot;)\n    private boolean isOnGround;\n\n    @JsonProperty(&quot;last_seen_time&quot;)\n    private Instant lastSeenTime;\n    @JsonProperty(&quot;pos_update_time&quot;)\n    private Instant posUpdateTime;\n    @JsonProperty(&quot;bds40_seen_time&quot;)\n    private Instant bds40SeenTime;\n}\n</code></pre>\n<p>AircraftRepository.java</p>\n<pre><code>package com.example.mysqlplanefinder.repositories;\n\nimport com.example.mysqlplanefinder.models.Aircraft;\nimport org.springframework.data.repository.CrudRepository;\n\npublic interface AircraftRepository extends CrudRepository&lt;Aircraft, Long&gt; { }\n\n</code></pre>\n<p>PlanePoller.java</p>\n<pre><code>package com.example.mysqlplanefinder;\n\nimport com.example.mysqlplanefinder.models.Aircraft;\nimport com.example.mysqlplanefinder.repositories.AircraftRepository;\nimport lombok.NonNull;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.scheduling.annotation.EnableScheduling;\nimport org.springframework.scheduling.annotation.Scheduled;\nimport org.springframework.stereotype.Component;\nimport org.springframework.web.reactive.function.client.WebClient;\n\n@EnableScheduling\n@Component\n@RequiredArgsConstructor\nclass PlanePoller {\n    @NonNull\n    private final AircraftRepository repository;\n    private WebClient client =\n            WebClient.create(&quot;http://localhost:7634/aircraft&quot;);\n\n    @Scheduled(fixedRate = 1000)\n    private void pollPlanes() {\n        repository.deleteAll();\n\n        client.get()\n                .retrieve()\n                .bodyToFlux(Aircraft.class)\n                .filter(plane -&gt; !plane.getReg().isEmpty())\n                .toStream()\n                .forEach(repository::save);\n\n        repository.findAll().forEach(System.out::println);\n    }\n}\n\n</code></pre>\n<p>I've tried to delete method <code>.deleteAll()</code> and add Versions how was recommended Ai, but nothing helped.</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}