{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "hibernate"
    ],
    "owner": {
      "account_id": 5178848,
      "reputation": 5,
      "user_id": 4145112,
      "user_type": "registered",
      "accept_rate": 12,
      "profile_image": "https://www.gravatar.com/avatar/85a447bfcf15f47e4764fe2944fe7c91?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Removed",
      "link": "https://stackoverflow.com/users/4145112/removed"
    },
    "is_answered": false,
    "view_count": 129,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1763176017,
    "creation_date": 1762988978,
    "last_edit_date": 1763042664,
    "question_id": 79818320,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79818320/spring-boot-3-3-migration-cannot-resolve-reference-to-bean-jpasharedem-entityma",
    "title": "Spring Boot 3.3 migration. Cannot resolve reference to bean jpaSharedEM_entityManagerFactory",
    "body": "<p>I'm migrating from Spring Boot 2.7 to Spring Boot 3.3.13. This means that I'm migrating even from Hibernate 5 to Hibernate 6.\nI'm having an annoying problem when I start my Spring Application about the configuration of my database configuration classes.</p>\n<p>This is my one of my database configuration classes that i had on Spring Boot 2.7 (I censored package sensible names):</p>\n<pre><code>package ***.datasource;\n\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.boot.jdbc.DataSourceBuilder;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.orm.jpa.JpaTransactionManager;\nimport org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;\nimport org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;\nimport org.springframework.transaction.PlatformTransactionManager;\n\nimport jakarta.persistence.EntityManagerFactory;\nimport javax.sql.DataSource;\nimport java.util.HashMap;\n\n/**\n * &lt;p&gt;\n * Data source configuration for Anag Database.\n *\n */\n\n@Configuration   \n@ConditionalOnProperty(prefix = &quot;spring.anag.datasource&quot;, name = &quot;url&quot;)\npublic class AnagSourceConfiguration {\n\n    @Value(&quot;${spring.anag.hibernate.hbm2ddl.auto:validate}&quot;)\n    private String hibernateHbm2ddlAuto;\n\n    @Value(&quot;${hibernate.dialect}&quot;)\n    private String hibernateDialect;\n\n    @Bean(name = &quot;anagDataSource&quot;)\n    @ConfigurationProperties(&quot;spring.anag.datasource&quot;)\n    public DataSource anagDataSource() {return DataSourceBuilder.create().build();\n    }\n\n    @Bean(name = &quot;anagEntityManagerFactory&quot;)\n    public LocalContainerEntityManagerFactoryBean anagEntityManagerFactory() {\n       LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean();\n       em.setDataSource(anagDataSource());\n       em.setPackagesToScan(&quot;***.entity.anag&quot;);\n       HibernateJpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter();\n       em.setJpaVendorAdapter(vendorAdapter);\n       final HashMap&lt;String, Object&gt; properties = new HashMap&lt;&gt;();\n       properties.put(&quot;hibernate.hbm2ddl.auto&quot;, hibernateHbm2ddlAuto);\n       properties.put(&quot;hibernate.dialect&quot;, hibernateDialect);\n       em.setJpaPropertyMap(properties);\n       return em;\n    }\n\n    @Bean(name = &quot;anagTransactionManager&quot;)\n    public PlatformTransactionManager jpaTransactionManager(EntityManagerFactory anagEntityManagerFactory) {\n       return new JpaTransactionManager(anagEntityManagerFactory);\n    }\n}\n</code></pre>\n<p>I manage to update something for the migration: I replaced every javax use with jakarta excluding the DataSource class since it seems a jakarta counterpart doesen't exists. Then, I added the Hibernate dialect on the properties and I replaced &quot;jdbc-url&quot; with &quot;url&quot; on ConditionalProperty name. Did same on yaml file of course.</p>\n<p>Then, this is my repositories configuration class:</p>\n<pre><code>package ***.config;\n\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.jpa.repository.config.EnableJpaRepositories;\n\n\n@Configuration\n@EnableJpaRepositories(\n       basePackages = &quot;***.repositories.anag&quot;,\n       entityManagerFactoryRef = &quot;anagEntityManagerFactory&quot;,\n       transactionManagerRef = &quot;anagTransactionManager&quot;\n)\npublic class AnagRepositoriesConfig {\n}\n</code></pre>\n<p>I dont think I have to change something here.</p>\n<p>Now, I'm having this error when I start my application:</p>\n<pre><code>Error creating bean with name 'delegatorFilter' defined in file [C:\\\\Users\\\\***\\\\config\\\\DelegatorFilter.class]: Unsatisfied dependency expressed through constructor parameter 2: Error creating bean with name 'userDelegationService' defined in file [C:\\\\**\\\\service\\\\UserDelegationService.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userAccountDelegationRepository' defined in **.repositories.anag.UserAccountDelegationRepository defined in @EnableJpaRepositories declared on AnagRepositoriesConfig: Cannot resolve reference to bean 'jpaSharedEM_anagEntityManagerFactory' while setting bean property\n\n\nParameter 0 of constructor in **.service.UserDelegationService required a bean named 'anagEntityManagerFactory' that could not be found.\\r\\n\\r\\n\\r\\nAction:\\r\\n\\r\\nConsider defining a bean named 'anagEntityManagerFactory' in your configuration\n</code></pre>\n<p>This part is pretty strange:  Cannot resolve reference to bean 'jpaSharedEM_anagEntityManagerFactory. It seems a strange concatenation name with jpaSharedEm_ and my bean anagEntityManagerFactory. Why Spring search this bean name? I have to change some name configuration?</p>\n<p>I don't think the problem depends from my UserAccountDelegationRepository. This is just the first repository that Spring met when the application starts. I changed the order declaration of repositories on the service and I meet this problem even for other repositories.</p>\n<p>Someone met this problem? I see here there are some question about this same problem but I didn't find any relevant answer. I did all the best practices to migrate to Spring Boot 3. There are no more javax on code and I even removed every dependency. Can someone help me?</p>\n<p>This is my yaml config about anag datasource:</p>\n<pre><code>spring:\n  anag:\n    datasource:\n      url: &quot;jdbc:mysql://xxxxxxxx:3306/anag?useUnicode=true&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC&amp;tinyInt1isBit=false&amp;useSSL=false&quot;\n      driver-class-name: com.mysql.cj.jdbc.Driver\n      username: xxxxxxxx\n      password: xxxxxxxx\n    hibernate:\n      hbm2ddl:\n        auto: validate\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}