{
  "question": {
    "tags": [
      "java",
      "encryption",
      "bouncycastle",
      "pgp",
      "openpgp"
    ],
    "owner": {
      "account_id": 30698704,
      "reputation": 11,
      "user_id": 23537270,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/ACg8ocLGBedXabhyCGiQzzARG9r3z-h1awHKG5ksEWPMkiAO=k-s256",
      "display_name": "kanha",
      "link": "https://stackoverflow.com/users/23537270/kanha"
    },
    "is_answered": false,
    "view_count": 219,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1729793968,
    "creation_date": 1709649767,
    "last_edit_date": 1709661596,
    "question_id": 78108544,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78108544/output-to-the-pgp-encryption-logic-is-incorrect",
    "title": "Output to the PGP encryption logic is incorrect",
    "body": "<p>I am trying to encrypt a message in PGP, but the encryption is not working properly. The encryption message I am getting is not being decrypted. On using a platform online to  decrypt and encrypt using same set of keys- its working good. But when I am trying to encryptÂ it using my logic- it's not working.</p>\n<p>I have added public/private keys that I generated for the test.</p>\n<p>I feel the output of the message encryption code using PGP is wrong.This is the error I am facing when I am trying to decrypt the PGP message that I fetched as output from the below code -</p>\n<blockquote>\n<p>org.bouncycastle.openpgp.PGPRuntimeOperationException: Iterator failed to get next object: unknown object in stream: 20 Caused by: java.io.IOException: unknown object in stream:</p>\n</blockquote>\n<p>This is the groovy code-</p>\n<pre class=\"lang-java prettyprint-override\"><code>@Grab(group='org.bouncycastle', module='bcpkix-jdk15on', version='1.70')\n@Grab(group='org.bouncycastle', module='bcpg-jdk15on', version='1.70')\n@Grab(group='org.bouncycastle', module='bcprov-jdk15on', version='1.70')\n\nimport java.io.ByteArrayInputStream\nimport java.io.ByteArrayOutputStream\nimport java.io.InputStream\nimport java.io.OutputStream\nimport java.io.IOException\nimport java.security.SecureRandom\nimport java.util.Iterator\nimport org.bouncycastle.openpgp.*\nimport org.bouncycastle.openpgp.operator.jcajce.JcePublicKeyKeyEncryptionMethodGenerator\nimport org.bouncycastle.openpgp.operator.jcajce.JcePGPDataEncryptorBuilder\nimport org.bouncycastle.openpgp.operator.jcajce.JcaKeyFingerprintCalculator\nimport org.bouncycastle.util.Iterable\nimport org.bouncycastle.bcpg.ArmoredOutputStream\n\n\nString message = &quot;This is a secret message.&quot;\nbyte[] messageBytes = message.getBytes(&quot;UTF-8&quot;)\nbyte[] encryptedMessage\n\n\nPGPPublicKey publicKey = readPublicKey(&quot;&quot;&quot;-----BEGIN PGP PUBLIC KEY BLOCK-----\nVersion: Keybase OpenPGP v1.0.0\nComment: https://keybase.io/crypto\n\nxo0EZd8jJgEEAMUFpO19INzZGSl/RWfqFMvDOBSBV3AFIGdBzUCGCDgOP2A784eg\ndSemCezryl8Ik32oJp+a+yWoZmv+jT8J1rSgBPBX1rsA5OdmqEIQ4fZar8tTw/gN\nPozNwAFIS+VuYwLRkY7wTkBDj+a2yh6XBH6SkT5AvOhIEEEFMhsBElJFABEBAAHN\nD2thcmFuIDxrQHMuY29tPsKtBBMBCgAXBQJl3yMmAhsvAwsJBwMVCggCHgECF4AA\nCgkQibbxXQCyUgmQuAQAsU2b5vT8xXC3cKG+6whSjYgdH8pJ4yXOQ69olIH7+gA+\nHdqVmWh+b4eTBxQlv/HQ/w3tPhjmfC/YTJKKuqThOcvXTEd97lwzcrI6nm0QuX/q\nP5IwNO7vEzjmUc2jgSoj1eQHkTYJ5u3Vu4XjRpbxj84wVU3Br4fxuZg/NCs9EXnO\njQRl3yMmAQQAsRq/6Yp+1+3x0z6b+CDxx8QVN2KoKIWCY611SJRuPX7MTuOUjtZ7\n2/pvID1lohJVUMTerskdVOvZo6zTzEymD4uMbqd4IPGzir4+yHDKefz7FTjCtKen\nWRXKu7vDWsLXjgbigU+0lWQ7lacUR4tQ3DH3ysf2O5jfHXADkiJS5U8AEQEAAcLA\ngwQYAQoADwUCZd8jJgUJDwmcAAIbLgCoCRCJtvFdALJSCZ0gBBkBCgAGBQJl3yMm\nAAoJEBftRsxoEmYlp2sD/3JRZeMONe4rEsJyfRSlQkPLLv+nAS/q+s1ZB2m0iyhq\n0uJl9mMI1nJ5bWLq2rlCgpNpx12pW1vqE0RyOzBEwlfvugNRGxyezF2tjgesaLvz\nJE/Wt82tmT0lKf+DI5KKfYlACdOB5qXkxageXsyy95tl/2g0GHkzl2phFBIn/n3T\n98YEAJ6H6ldp7PBgpI/NB8CcDA+1UQGfYul9xi4qV42ThOeWD1yPXtokKPjc/QZh\nFPiZ6uPoch85oHJY0r9OJnJXIqJWJvIvCJQ+d1JgivCMHcE23Yd1QCl7F4dXTm8Y\nDjspdGbNkwBoKEHrQkdH1CMJI5gs1hO98Zqs5iEFS+YTYwwzzo0EZd8jJgEEAOUy\n1hRwz/5XpLJtxoAAq6lJtsNh4gfQ2SHU7bODtuNTt6Q1vcPgmv5lNNewhW4dUZza\n806VJkoSjaY8tgkHO0rF1AsPOMP3VSrEyHcIlL/aMz/5yUxr5iqACou7jv4rJfnJ\nhF/mAynEQ1D/DVYcqxYTo1J22qySoSYmwZ6s5toDABEBAAHCwIMEGAEKAA8FAmXf\nIyYFCQ8JnAACGy4AqAkQibbxXQCyUgmdIAQZAQoABgUCZd8jJgAKCRCqiMN3fbsk\nN5ArA/43YpAsO9Gjz+s+Ew33zusv+j59jSiGSNuATfTnQ61tYtTqdEDrC9p05fj+\n+VePh7Nb28Eze9MBxEwbIPyVrM8N1CsPSVp0Xw5iymiFBMa8DbGZQS5NUHQJnci9\n2uzJygdGB2RzrAl29A45wd09AHGfmriluYw9aKyQe5hEDMBeT60ABACsvp17ZnAq\nNGAQqxxE0xFbflhGlvHiR2CVqRb57hcIybkWxrhHBY67PTgCvNQIzX6+05nBZ7fg\n+PX5twSnejx4TBOlgegJnHQCdSXnBGy2DChceeXrFIhgR2KDXtkDwd7zQBWEplKP\nl6zVJWLRjNCwhMZYSxCPgw8E5VXgESs89g==\n=b1tp\n-----END PGP PUBLIC KEY BLOCK-----&quot;&quot;&quot;)\n\n\nPGPEncryptedDataGenerator encryptedDataGenerator = new PGPEncryptedDataGenerator(\n                new JcePGPDataEncryptorBuilder(PGPEncryptedData.AES_256)\n                        .setWithIntegrityPacket(true)\n                        .setSecureRandom(new SecureRandom())\n)\n\nencryptedDataGenerator.addMethod(\n        new JcePublicKeyKeyEncryptionMethodGenerator(publicKey)\n                .setSecureRandom(new SecureRandom()))\n\nByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();\nArmoredOutputStream aOut = new ArmoredOutputStream(byteArrayOutputStream);\nOutputStream cOut = encryptedDataGenerator.open(aOut, messageBytes.length);\ncOut.write(messageBytes);\ncOut.close();\naOut.close();\nSystem.out.println(byteArrayOutputStream.toString());\n\n\n\n\nprivate PGPPublicKey readPublicKey(String publicKeyString) throws IOException, PGPException {\n    InputStream inputStream = PGPUtil.getDecoderStream(new ByteArrayInputStream(publicKeyString.getBytes(&quot;UTF-8&quot;)))\n    PGPPublicKeyRingCollection pgpPublicKeyRingCollection = new PGPPublicKeyRingCollection(inputStream, new JcaKeyFingerprintCalculator())\n\n    Iterator publicKeyRingIter = pgpPublicKeyRingCollection.getKeyRings()\n\n    while (publicKeyRingIter.hasNext()) {\n        PGPPublicKeyRing publicKeyRing = (PGPPublicKeyRing) publicKeyRingIter.next()\n        Iterator&lt;PGPPublicKey&gt; publicKeyIter = publicKeyRing.getPublicKeys()\n\n        while (publicKeyIter.hasNext()) {\n            PGPPublicKey key = publicKeyIter.next()\n            if (key.isEncryptionKey()) {\n                return key\n            }\n        }\n    }\n    throw new IllegalArgumentException(&quot;Can't find encryption key in key ring.&quot;)\n}\n</code></pre>\n<p>This is the private key-</p>\n<pre class=\"lang-none prettyprint-override\"><code>-----BEGIN PGP PRIVATE KEY BLOCK-----\nVersion: Keybase OpenPGP v1.0.0\nComment: https://keybase.io/crypto\n\n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\n5VXgESs89g==\n=gEXS\n-----END PGP PRIVATE KEY BLOCK-----\n</code></pre>\n<p>The output is -</p>\n<pre><code>-----BEGIN PGP MESSAGE-----\nVersion: BCPG v1.70\n\nhIwDibbxXQCyUgkBA/9ErJnw641vPYrGFWFCexLVUx7S7BelxO1wB0ujjp6hJctA\nGNmy9xJjOoFyT4HhBrJo5CrKkL5nkYxsuYQFpeMzWKQbWgMa7PjWVmRXc5LwgqlK\nBsmoOppIO2LyNGT+N+7plnPwe/HzDfxMrcwYJWayD+ARpGRbjel0xO7WeHIMVNJC\nAeQ1wXeTjaF0rooxZtfFIcymcEbuXbPaAbG2o7n+4DG1mIovQ89scSrVYjo0XAMz\n5JA9qZOfXj3fa1itRmNfrZEk\n=prY8\n-----END PGP MESSAGE-----\n</code></pre>\n<p>But I am unable to decrypt this. What am I doing wrong while encrypting?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}