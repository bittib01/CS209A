{
  "question": {
    "tags": [
      "java",
      "kubernetes",
      "google-cloud-dataflow",
      "apache-beam",
      "airflow-2.x"
    ],
    "owner": {
      "account_id": 11780629,
      "reputation": 383,
      "user_id": 8620369,
      "user_type": "registered",
      "profile_image": "https://lh4.googleusercontent.com/-9EAC6bwLcEA/AAAAAAAAAAI/AAAAAAAAE6o/shEi3hGQTLs/s256-rj/photo.jpg",
      "display_name": "Maria Dorohin",
      "link": "https://stackoverflow.com/users/8620369/maria-dorohin"
    },
    "is_answered": false,
    "view_count": 89,
    "answer_count": 1,
    "score": -1,
    "last_activity_date": 1743608585,
    "creation_date": 1721245741,
    "last_edit_date": 1743608585,
    "question_id": 78761374,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78761374/how-can-i-capture-exceptions-thrown-by-a-java-application-within-airflows-on-fa",
    "title": "How can I capture exceptions thrown by a Java application within Airflow&#39;s on_failure_callback?",
    "body": "<p>I am using Airflow to run <code>KubernetesPodOperator</code> tasks that run java application image.</p>\n<p>The java application use beam dataflow.</p>\n<p>My custom airflow operators inherit <code>KubernetesPodOperator</code>.</p>\n<p>I am trying to catch java application exceptions in <code>on_failure_callback</code> airflow method.</p>\n<p>But I am getting <code>AirflowException</code> instead of real exception.</p>\n<p>I can not add try catch on my java code as I am using beam and <code>pipeline.run()</code> or <code>pipeline.waitUntilFinish()</code> don't directly throw exceptions that I can catch in a try-catch block.\nThe result.waitUntilFinish() method in the Beam pipeline only captures exceptions that occur during the job's setup. It does not capture runtime exceptions that happen while the data is being processed.</p>\n<p>How can I get java application exception on <code>on_failure_callback</code>?</p>\n<pre><code>def task_failure(context):\n    exception = context.get('exception')\n    if exception:\n        exception_type = type(exception).__name__\n\n\ndefault_args = {\n    'on_failure_callback': task_failure\n}\n\n with models.DAG(\n                dag_name,\n                default_args=default_args,\n                start_date=start_date,\n                schedule_interval=interval\n        ) as dag:\n</code></pre>\n<p>versions:</p>\n<ul>\n<li>airflow 2.2.5</li>\n<li>composer 2.1.9</li>\n<li>Kubernetes 1.29</li>\n<li>java 17</li>\n</ul>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}