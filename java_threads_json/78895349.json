{
  "question": {
    "tags": [
      "java",
      "circuit-breaker"
    ],
    "owner": {
      "account_id": 26283448,
      "reputation": 1,
      "user_id": 19951583,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a-/AFdZuco--QB5i3n6rV2Zv_AL5dQ2lsUUK1Y8EO_WgzbQzw=k-s256",
      "display_name": "Renzo EC",
      "link": "https://stackoverflow.com/users/19951583/renzo-ec"
    },
    "is_answered": false,
    "view_count": 110,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1724427410,
    "creation_date": 1724219946,
    "last_edit_date": 1724324906,
    "question_id": 78895349,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78895349/circuitbreaker-fallback-method-doesnt-work-with-valid-requestbody-exception",
    "title": "@CircuitBreaker fallback method doesn&#39;t work with @Valid @RequestBody exception",
    "body": "<p>I have create a small spring api proyect and I would like do an exception handler with CircuitBreaker for valid JSON exceptions.</p>\n<p>This is my object model:</p>\n<pre><code>import javax.validation.constraints.NotNull;\nimport lombok.Data;\n\n@Data\npublic class Client {\n    \n    @NotNull\n    private Long id;\n\n    @NotNull\n    private String name;\n\n    @NotNull\n    private Integer age;\n}\n</code></pre>\n<p>My controller post method is:</p>\n<pre><code>@RestController\n@RequestMapping(&quot;/client&quot;)\npublic class ClientController {\n@PostMapping(&quot;/create&quot;)\n\n    @CircuitBreaker(name=&quot;validationDataHandler&quot;, fallbackMethod = &quot;fallbackCreateClient&quot;)\n    public Mono&lt;ResponseEntity&lt;Client&gt;&gt; createClient(@Valid @RequestBody Client client) {\n        System.out.println(&quot;------- METHOD CREATE -------&quot;);\n        return clientService.createClient(client)\n                        .map(created -&gt; ResponseEntity.ok(created));\n    }\n\nprivate Mono&lt;ResponseEntity&lt;Client&gt;&gt; fallbackCreateClient(Client client, Throwable e) {\n        System.out.println(&quot;&lt;&lt;&lt;&lt; CIRCUIT BREAKER &gt;&gt;&gt;&gt;&quot;);\n        return Mono.just(ResponseEntity.badRequest()));\n    }\n\n}\n</code></pre>\n<p>clientService has connect with the database, and I'm using spring mongodb reactive to manage the connections with the database.</p>\n<p>when the body request has empty field an exception is throw, but circuitbreaker has never fired.\nI think because the exception is thron before the method start but I'm not sure how can I use circuitbreaker for cases like this.</p>\n<p>I hope someone can helpme solving this problem</p>\n<p><strong><strong>EDIT 1</strong></strong>*\nthe dependencies used are:</p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;2.7.5&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;com.amigo.programador&lt;/groupId&gt;\n    &lt;artifactId&gt;ms-client&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;ms-client&lt;/name&gt;\n    &lt;description&gt;Project for Spring Boot&lt;/description&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;11&lt;/java.version&gt;\n        &lt;spring-cloud.version&gt;2021.0.3&lt;/spring-cloud.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-mongodb-reactive&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;optional&gt;true&lt;/optional&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n          &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-cloud-starter-circuitbreaker-resilience4j&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.amigo.programador&lt;/groupId&gt;\n            &lt;artifactId&gt;library&lt;/artifactId&gt;\n            &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;dependencyManagement&gt;\n        &lt;dependencies&gt;\n            &lt;dependency&gt;\n                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;\n                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;\n                &lt;type&gt;pom&lt;/type&gt;\n                &lt;scope&gt;import&lt;/scope&gt;\n            &lt;/dependency&gt;\n        &lt;/dependencies&gt;\n    &lt;/dependencyManagement&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n                &lt;configuration&gt;\n                    &lt;excludes&gt;\n                        &lt;exclude&gt;\n                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n                        &lt;/exclude&gt;\n                    &lt;/excludes&gt;\n                &lt;/configuration&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;\n\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}