{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "multiple-databases"
    ],
    "owner": {
      "account_id": 11827466,
      "reputation": 1698,
      "user_id": 8655052,
      "user_type": "registered",
      "accept_rate": 100,
      "profile_image": "https://www.gravatar.com/avatar/2a84239167eb54108821e2abe83acea6?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Mr.DevEng",
      "link": "https://stackoverflow.com/users/8655052/mr-deveng"
    },
    "is_answered": true,
    "view_count": 200,
    "accepted_answer_id": 79737279,
    "answer_count": 2,
    "score": 3,
    "last_activity_date": 1755357425,
    "creation_date": 1755167553,
    "last_edit_date": 1755239218,
    "question_id": 79735274,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79735274/java-lang-illegalstateexception-java-lang-nosuchmethoderror-error-while-config",
    "title": "java.lang.IllegalStateException: java.lang.NoSuchMethodError: error while configuring multiple database in springboot microservice project",
    "body": "<p>I am trying to do a sample microservice which involves pulling data from multiple databases. And while configuring I am getting the <code>Exception in thread &quot;main&quot; java.lang.IllegalStateException: java.lang.NoSuchMethodError: 'void org.springframework.data.jpa.repository.config.JpaRepositoryConfigExtension.registerLazyIfNotAlreadyRegistered</code> error.</p>\n<p>My <strong>application.properties</strong> file is like the following:</p>\n<pre><code>spring.datasource.primary.url=jdbc:postgresql://localhost:5432/firstdbsample\nspring.datasource.primary.username=postgres\nspring.datasource.primary.password=postgresql\nspring.datasource.primary.driver-class-name=org.postgresql.Driver\n\nspring.datasource.secondary.url=jdbc:postgresql://localhost:5432/seconddbsample\nspring.datasource.secondary.username=postgres\nspring.datasource.secondary.password=postgresql\nspring.datasource.secondary.driver-class-name=org.postgresql.Driver\n</code></pre>\n<p>I kept all my model, controller and repository classes separately for separate packages, like the following:</p>\n<pre><code>com.multidb.primary.controller\ncom.multidb.primary.model\ncom.multidb.primary.repository\ncom.multidb.secondary.controller\ncom.multidb.secondary.model\ncom.multidb.secondary.repository\n</code></pre>\n<p>And <strong>created 2 separate configuration class</strong> for primary and secondary. I kept in com.multidb.config package with PrimaryConfig.java and SecondaryConfig.java</p>\n<pre><code>com.multidb.config.PrimaryConfig.java\ncom.multidb.config.SecondaryConfig.java\n</code></pre>\n<p><strong>PrimaryConfig.java</strong> file:</p>\n<pre><code>@Configuration\n@EnableJpaRepositories(\nbasePackages = &quot;com.multidb.primary.repository&quot;,\nentityManagerFactoryRef = &quot;primaryEntityManagerFactory&quot;,\ntransactionManagerRef = &quot;primaryTransactionManager&quot;\n)\npublic class PrimaryConfig {\n\n@Bean(name = &quot;primaryDataSource&quot;)\n@ConfigurationProperties(prefix = &quot;spring.datasource.primary&quot;)\npublic DataSource primaryDataSource() {\n    return DataSourceBuilder.create().build();\n}\n@Bean(name = &quot;primaryEntityManagerFactory&quot;)\npublic LocalContainerEntityManagerFactoryBean primaryEntityManagerFactory(\n        @Qualifier(&quot;primaryDataSource&quot;) DataSource dataSource) {\n    LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean();\n    em.setDataSource(dataSource);\n    em.setPackagesToScan(new String[] { &quot;com.multidb.primary.model&quot; });\n    HibernateJpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter();\n    em.setJpaVendorAdapter(vendorAdapter);\n    return em;\n}\n@Bean(name = &quot;primaryTransactionManager&quot;)\npublic PlatformTransactionManager primaryTransactionManager(\n        @Qualifier(&quot;primaryEntityManagerFactory&quot;) EntityManagerFactory entityManagerFactory) \n {\n    return new JpaTransactionManager(entityManagerFactory);\n  }\n}\n</code></pre>\n<p><strong>SecondaryConfig.java:</strong></p>\n<pre><code>@Configuration\n@EnableJpaRepositories(\nbasePackages = &quot;com.multidb.secondary.repository&quot;,\nentityManagerFactoryRef = &quot;secondaryEntityManagerFactory&quot;,\ntransactionManagerRef = &quot;secondaryTransactionManager&quot;\n  )\n  public class SecondaryConfig {\n\n@Bean(name = &quot;secondaryDataSource&quot;)\n@ConfigurationProperties(prefix = &quot;spring.datasource.secondary&quot;)\npublic DataSource secondaryDataSource() {\n    return DataSourceBuilder.create().build();\n}\n@Bean(name = &quot;secondaryEntityManagerFactory&quot;)\npublic LocalContainerEntityManagerFactoryBean secondaryEntityManagerFactory(\n        @Qualifier(&quot;secondaryDataSource&quot;) DataSource dataSource) {\n    LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean();\n    em.setDataSource(dataSource);\n    em.setPackagesToScan(new String[] { &quot;com.multidb.secondary.model&quot; });\n    HibernateJpaVendorAdapter vendorAdapter = new HibernateJpaVendorAdapter();\n    em.setJpaVendorAdapter(vendorAdapter);\n    return em;\n}\n@Bean(name = &quot;secondaryTransactionManager&quot;)\npublic PlatformTransactionManager secondaryTransactionManager(\n        @Qualifier(&quot;secondaryEntityManagerFactory&quot;) EntityManagerFactory entityManagerFactory) {\n    return new JpaTransactionManager(entityManagerFactory);\n}\n\n}\n</code></pre>\n<p><strong>Error like the following:</strong></p>\n<blockquote>\n<p>Correct the classpath of your application so that it contains a single, compatible version of org.springframework.data.jpa.repository.config.JpaRepositoryConfigExtension\nException in thread &quot;main&quot; java.lang.IllegalStateException: java.lang.NoSuchMethodError: 'void org.springframework.data.jpa.repository.config.JpaRepositoryConfigExtension.registerLazyIfNotAlreadyRegistered(java.util.function.Supplier, org.springframework.beans.factory.support.BeanDefinitionRegistry, java.lang.String, java.lang.Object)'</p>\n</blockquote>\n<p><strong>Referred tutorials:</strong></p>\n<ul>\n<li><p><a href=\"https://mookypoo.medium.com/spring-boot-connect-to-multiple-databases-4cd56773fbcc\" rel=\"nofollow noreferrer\">https://mookypoo.medium.com/spring-boot-connect-to-multiple-databases-4cd56773fbcc</a></p>\n</li>\n<li><p><a href=\"https://www.baeldung.com/spring-data-jpa-multiple-databases\" rel=\"nofollow noreferrer\">https://www.baeldung.com/spring-data-jpa-multiple-databases</a></p>\n</li>\n<li><p><a href=\"https://stackoverflow.com/questions/30337582/spring-boot-configure-and-use-two-data-sources\">Spring Boot configure and use two data sources</a></p>\n</li>\n</ul>\n<p><strong>POM.xml:</strong></p>\n<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\nxsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n&lt;parent&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n    &lt;version&gt;3.5.4&lt;/version&gt;\n    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n&lt;/parent&gt;\n&lt;groupId&gt;com.multidb&lt;/groupId&gt;\n&lt;artifactId&gt;MultiDb&lt;/artifactId&gt;\n&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n&lt;packaging&gt;war&lt;/packaging&gt;\n&lt;name&gt;MultiDb&lt;/name&gt;\n&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\n&lt;url/&gt;\n&lt;licenses&gt;\n    &lt;license/&gt;\n&lt;/licenses&gt;\n&lt;developers&gt;\n    &lt;developer/&gt;\n&lt;/developers&gt;\n&lt;scm&gt;\n    &lt;connection/&gt;\n    &lt;developerConnection/&gt;\n    &lt;tag/&gt;\n    &lt;url/&gt;\n&lt;/scm&gt;\n&lt;properties&gt;\n    &lt;java.version&gt;17&lt;/java.version&gt;\n&lt;/properties&gt;\n&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n            &lt;dependency&gt;\n        &lt;groupId&gt;org.postgresql&lt;/groupId&gt;\n        &lt;artifactId&gt;postgresql&lt;/artifactId&gt;\n        &lt;scope&gt;runtime&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;\n        &lt;scope&gt;provided&lt;/scope&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n        &lt;scope&gt;test&lt;/scope&gt;\n    &lt;/dependency&gt;   \n    \n&lt;/dependencies&gt;\n\n&lt;build&gt;\n    &lt;plugins&gt;\n        &lt;plugin&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n        &lt;/plugin&gt;\n    &lt;/plugins&gt;\n&lt;/build&gt;\n\n&lt;/project&gt;\n</code></pre>\n<p><strong>Update/Modification After Suggested Springboot Version 3.3.3</strong></p>\n<pre><code>  &lt;parent&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n    &lt;version&gt;3.3.3&lt;/version&gt; // changed from 3.5.4 to 3.3.3\n    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n&lt;/parent&gt;\n</code></pre>\n<p><strong>Updated Error Message</strong></p>\n<p><code>Caused by: org.hibernate.service.spi.ServiceException: Unable to create requested service [org.hibernate.engine.jdbc.env.spi.JdbcEnvironment] due to: Unable to determine Dialect without JDBC metadata (please set 'jakarta.persistence.jdbc.url' for common cases or 'hibernate.dialect' when a custom Dialect implementation must be provided)</code></p>\n<p><a href=\"https://i.sstatic.net/wiyl1AfY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.sstatic.net/wiyl1AfY.png\" alt=\"enter image description here\" /></a></p>\n<p>Can anyone suggest where I went in wrong in implementation or suggest good documentation for reference please?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}