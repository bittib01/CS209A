{
  "question": {
    "tags": [
      "java",
      "spring-boot",
      "server",
      "client",
      "ocpp"
    ],
    "owner": {
      "account_id": 30663667,
      "reputation": 11,
      "user_id": 23507567,
      "user_type": "registered",
      "profile_image": "https://lh3.googleusercontent.com/a/ACg8ocKOVswSAbJxdPbqKjF5vB_rfw_vEIVUoJiYN3eor-PC=k-s256",
      "display_name": "Romain Geurts",
      "link": "https://stackoverflow.com/users/23507567/romain-geurts"
    },
    "is_answered": false,
    "view_count": 529,
    "answer_count": 2,
    "score": 1,
    "last_activity_date": 1759339217,
    "creation_date": 1712671025,
    "last_edit_date": 1759339217,
    "question_id": 78298986,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/78298986/how-to-mange-ocpp-architecture-on-java-spring-boot-app",
    "title": "How to mange ocpp architecture on java spring boot app",
    "body": "<p>I don't understand how the server and client from the <a href=\"https://openchargealliance.org/\" rel=\"nofollow noreferrer\"><em>Open Charge Alliance</em></a> OCA-OCPP library for Java work with the EV Charger. I don't understand which port I have to use for requesting WebSocket and how to configure the EV Charger (Mennekes).</p>\n<p>I want to have a server that sends requests to the client, and the client sends requests to the EV charger. I don't want to have a client that has to manage two separate connections, one for the server and the other for the EV charger.</p>\n<pre><code>public class OCPPClient {\n    private IClientAPI client;\n    private ClientCoreProfile core;\n    private JSONConfiguration configuration;\n    private WssSocket wssSocket;\n\n    public void connect(String ipChargingPoint, String port) throws Exception {\n\n        // The core profile is mandatory\n        core = new ClientCoreProfile(new ClientCoreEventHandler() {})\n            \n        configuration = JSONConfiguration.get();\n        configuration.setParameter(JSONConfiguration.USERNAME_PARAMETER, &quot;operator&quot;);\n        configuration.setParameter(JSONConfiguration.PASSWORD_PARAMETER, &quot;CX1zRpdK&quot;);\n        configuration.setParameter(JSONConfiguration.TCP_NO_DELAY_PARAMETER, false);\n        configuration.setParameter(JSONConfiguration.PROXY_PARAMETER, null);\n        configuration.setParameter(JSONConfiguration.PING_INTERVAL_PARAMETER, 300);\n        configuration.setParameter(JSONConfiguration.WEBSOCKET_WORKER_COUNT, 4);\n        configuration.setParameter(JSONConfiguration.CONNECT_TIMEOUT_IN_MS_PARAMETER, 10000);\n\n        wssSocket = new WssSocket();\n        wssSocket.uri(new URI(&quot;ws://&quot; + ipChargingPoint + &quot;:&quot; + port));\n\n        client = new JSONClient(core, &quot;137640200473&quot;, wssSocket, configuration);\n\n        client.connect(&quot;ws://&quot; + ipChargingPoint + &quot;:&quot; + port, null);\n    }\n\n    public void sendBootNotification() throws Exception {\n\n        // Use the feature profile to help create event\n        Request request = core.createBootNotificationRequest(&quot;some vendor&quot;, &quot;some model&quot;);\n\n        // Client returns a promise which will be filled once it receives a confirmation.\n        client.send(request).whenComplete((s, ex) -&gt; System.out.println(s));\n    }\n\n    public IClientAPI getClient() {\n        return client;\n    }\n\n    public void disconnect() {\n        client.disconnect();\n    }\n\n}\n\n</code></pre>\n<pre><code>@Data\npublic class OCPPServer {\n\n        private JSONServer server;\n        private ServerCoreProfile core;\n        private Map&lt;String, OCPPClient&gt; clients = new HashMap&lt;&gt;();\n        private JSONConfiguration configuration;\n\n\n\n\n    public void started() throws Exception\n        {\n            if (server != null)\n                return;\n            configuration = JSONConfiguration.get();\n            configuration.setParameter(JSONConfiguration.USERNAME_PARAMETER, &quot;operator&quot;);\n            configuration.setParameter(JSONConfiguration.PASSWORD_PARAMETER, &quot;CX1zRpdK&quot;);\n            configuration.setParameter(JSONConfiguration.TCP_NO_DELAY_PARAMETER, true);\n            configuration.setParameter(JSONConfiguration.PROXY_PARAMETER, 3000);\n            configuration.setParameter(JSONConfiguration.PING_INTERVAL_PARAMETER, 300);\n            configuration.setParameter(JSONConfiguration.WEBSOCKET_WORKER_COUNT, 4);\n            configuration.setParameter(JSONConfiguration.CONNECT_TIMEOUT_IN_MS_PARAMETER, 10000);\n\n            // The core profile is mandatory\n            core = new ServerCoreProfile(new ServerCoreEventHandler() {});\n\n            server = new JSONServer(core,configuration);\n            server.open(&quot;172.28.2.83&quot;, 3000, new ServerEvents() {})\n            System.out.println(&quot;Server started and listening on 172.28.2.83:3000&quot;);\n\n        }\n\n    public void sendClearCacheRequestToClient(String idStation) throws Exception {\n        // Récupérer le client correspondant à l'ID de la station\n        OCPPClient client = clients.get(idStation);\n\n        if (client != null) {\n            // Utiliser le profil de fonctionnalité pour aider à créer l'événement\n            ClearCacheRequest request = core.createClearCacheRequest();\n\n            // Le client renvoie une promesse qui sera remplie une fois qu'il recevra une confirmation.\n            client.getClient().send(request).whenComplete((confirmation, ex) -&gt; {\n                if (ex != null) {\n                    System.out.println(&quot;Failed to send ClearCacheRequest to client: &quot; + ex.getMessage());\n                } else {\n                    //Le serveur a reçu une confirmation de la station de recharge\n                    System.out.println(&quot;ClearCacheRequest sent to client: &quot; + confirmation);\n                }\n            });\n        } else {\n            System.out.println(&quot;No client found for station ID: &quot; + idStation);\n        }\n    }\n\n    public void stop(){\n            server.close();\n    }\n\n\n    public int getActiveSessions() {\n        return clients.size();\n    }\n\n    public void createSessions(String idStation, String ipStation, String port ) {\n        OCPPClient client = new OCPPClient();\n        if(server == null){\n            try {\n                started();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n        try {\n            client.connect(ipStation, port); // Assurez-vous que l'adresse IP de la station est correcte\n            System.out.println(&quot;Connected to ws://&quot; + ipStation + &quot; on port &quot; + port);\n            clients.put(idStation, client);\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n\n    public OCPPClient getClient(String uuid) {\n        return clients.get(uuid);\n    }\n}\n</code></pre>\n<pre><code>\n\nclass OCPPConnectionTest {\n\n    @Test\n    void testClientServerConnection() throws Exception {\n        OCPPServer server = new OCPPServer();\n\n\n            // Start the server\n            server.started();\n            assertEquals(0, server.getActiveSessions());\n\n            // Connect the client and send boot notification\n            server.createSessions(&quot;1&quot;, &quot;172.28.2.57&quot;, &quot;3000&quot;);\n            server.getClient(&quot;1&quot;).sendBootNotification();\n\n            // Verify that the server has an active session\n            assertEquals(1, server.getActiveSessions());\n\n    }\n\n\n}\n</code></pre>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}