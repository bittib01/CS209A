{
  "question": {
    "tags": [
      "java",
      "encryption",
      "aes",
      "encryption-symmetric",
      "javax.crypto"
    ],
    "owner": {
      "account_id": 37604239,
      "reputation": 105,
      "user_id": 28332552,
      "user_type": "registered",
      "profile_image": "https://www.gravatar.com/avatar/5a84dbd7a917124e895a66d1b7b38d61?s=256&d=identicon&r=PG&f=y&so-version=2",
      "display_name": "Lucy",
      "link": "https://stackoverflow.com/users/28332552/lucy"
    },
    "is_answered": true,
    "view_count": 166,
    "accepted_answer_id": 79810502,
    "answer_count": 1,
    "score": 0,
    "last_activity_date": 1762370928,
    "creation_date": 1762362142,
    "question_id": 79810381,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/79810381/why-do-i-need-an-ivparameter-and-how-do-i-implement-it",
    "title": "Why do I need an IvParameter and how do I implement it?",
    "body": "<p>I'm trying to write a java program that encrypts and decrypts a byte array of text based on a password, but when decrypting, it returns an error</p>\n<p>Error message:</p>\n<pre><code>Exception in thread &quot;main&quot; java.security.InvalidAlgorithmParameterException: Wrong parameter type: IvParameterSpec expected\n        at java.base/sun.security.util.PBEUtil$PBES2Params.initialize(Unknown Source)\n        at java.base/sun.security.util.PBEUtil$PBES2Params.getPBEKeySpec(Unknown Source)\n        at java.base/com.sun.crypto.provider.PBES2Core.engineInit(Unknown Source)\n        at java.base/javax.crypto.Cipher.implInit(Unknown Source)\n        at java.base/javax.crypto.Cipher.chooseProvider(Unknown Source)\n        at java.base/javax.crypto.Cipher.init(Unknown Source)\n        at java.base/javax.crypto.Cipher.init(Unknown Source)\n        at edu.ntnu.idi.idat.encryption.Encryption.decrypt(Encryption.java:130)\n        at edu.ntnu.idi.idat.App.main(App.java:117)\n</code></pre>\n<p>I'm not really sure where the IvParameterSpec is supposed to go, why it's needed or how I should make it.</p>\n<p>The offending code:</p>\n<pre><code>    private final SecretKey passwordKey;\n    private PBEParameterSpec pbeParamSpec;\n    public Encryption(\n        final String password\n        ) throws NoSuchAlgorithmException, InvalidKeySpecException {\n            \n        byte[] salt = {\n            (byte)0xc7, (byte)0x73, (byte)0x21, (byte)0x8c,\n            (byte)0x7e, (byte)0xc8, (byte)0xee, (byte)0x99\n        };\n        int iteration = 20;\n        this.pbeParamSpec = new PBEParameterSpec(salt, iteration);\n\n        PBEKeySpec pbeKeySpec = new PBEKeySpec(\n            password.toCharArray()\n            );\n        SecretKeyFactory keyFac = SecretKeyFactory.getInstance(\n            &quot;PBEWithHmacSHA256AndAES_128&quot;\n            );\n        SecretKey pbeKey = keyFac.generateSecret(pbeKeySpec);\n        this.passwordKey = pbeKey;\n\n    public byte[] encrypt(\n        final byte[] plainText\n        ) throws NoSuchAlgorithmException,\n        NoSuchPaddingException,\n        InvalidKeyException,\n        IllegalBlockSizeException,\n        BadPaddingException, InvalidAlgorithmParameterException {\n        Cipher cipher = Cipher.getInstance(&quot;PBEWithHmacSHA256AndAES_128&quot;);\n        cipher.init(Cipher.ENCRYPT_MODE, this.passwordKey, this.pbeParamSpec);\n        return cipher.doFinal(plainText);\n    }\n\n    public byte[] decrypt(\n        final byte[] cipherText\n        ) throws NoSuchAlgorithmException,\n        NoSuchPaddingException,\n        InvalidKeyException,\n        IllegalBlockSizeException,\n        BadPaddingException, InvalidAlgorithmParameterException {\n        Cipher cipher = Cipher.getInstance(&quot;PBEWithHmacSHA256AndAES_128&quot;);\n        cipher.init(Cipher.DECRYPT_MODE, this.passwordKey, this.pbeParamSpec);\n        return cipher.doFinal(cipherText);\n    }\n</code></pre>\n<p>I originally tried without PBEParameterSpec, but I got an error, so I caved in and added it. From my understanding, the PBEParameterSpec object contains all information about salting and stuff, which should be all that the decryption step needs, so why would it need additional information about initiation vectors?</p>\n"
  },
  "answers": [],
  "question_comments": [],
  "answer_comments": {}
}